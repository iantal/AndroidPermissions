package com.w545taxxxg9.storage;

import android.content.ContentValues;
import android.content.Context;
import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;
import android.database.sqlite.SQLiteQueryBuilder;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Vector;

public class BrowsingHistoryStorage
{
  private DatabaseOpenHelper _dbHelper;
  
  public BrowsingHistoryStorage(Context paramContext)
  {
    this._dbHelper = new DatabaseOpenHelper(paramContext);
  }
  
  public void addHistoryItem(String paramString1, String paramString2, Date paramDate)
  {
    ContentValues localContentValues = new ContentValues();
    localContentValues.put("title", paramString1);
    localContentValues.put("url", paramString2);
    localContentValues.put("visitTime", DatabaseOpenHelper.SQL_DATE_FORMAT.format(paramDate));
    this._dbHelper.getWritableDatabase().insert("history", null, localContentValues);
  }
  
  public Cursor getHistoryItemsGroupedByUrl(String paramString)
  {
    String str = null;
    String[] arrayOfString = null;
    if (paramString != null)
    {
      str = "url MATCH ?";
      arrayOfString = new String[1];
      arrayOfString[0] = ("*" + paramString + "*");
    }
    paramString = new SQLiteQueryBuilder();
    paramString.setTables("history");
    return paramString.query(this._dbHelper.getReadableDatabase(), new String[] { "rowId _id", "title", "url" }, str, arrayOfString, "url", null, null, "3");
  }
  
  public Cursor loadHistory(Date paramDate1, Date paramDate2)
  {
    String str1 = "";
    Vector localVector = new Vector();
    if (paramDate1 != null)
    {
      str1 = "" + "visitTime>= ?";
      localVector.add(DatabaseOpenHelper.SQL_DATE_FORMAT.format(paramDate1));
    }
    String str2 = str1;
    if (paramDate2 != null)
    {
      str2 = str1;
      if (paramDate1 != null) {
        str2 = str1 + " AND ";
      }
      str2 = str2 + "visitTime<= ?";
      localVector.add(DatabaseOpenHelper.SQL_DATE_FORMAT.format(paramDate2));
    }
    paramDate1 = new String[localVector.size()];
    localVector.toArray(paramDate1);
    paramDate2 = new SQLiteQueryBuilder();
    paramDate2.setTables("history");
    paramDate1 = paramDate2.query(this._dbHelper.getReadableDatabase(), new String[] { "rowId _id", "title", "url", "visitTime" }, str2, paramDate1, null, null, null);
    if (paramDate1 == null) {
      return null;
    }
    if (!paramDate1.moveToFirst())
    {
      paramDate1.close();
      return null;
    }
    return paramDate1;
  }
}
