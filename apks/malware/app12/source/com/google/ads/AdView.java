package com.google.ads;

import android.app.Activity;
import android.content.Context;
import android.content.res.Resources;
import android.content.res.Resources.NotFoundException;
import android.util.AttributeSet;
import android.util.TypedValue;
import android.view.ViewGroup;
import android.widget.FrameLayout;
import android.widget.LinearLayout;
import android.widget.RelativeLayout;
import android.widget.TextView;
import com.google.ads.internal.d;
import com.google.ads.internal.j;
import com.google.ads.util.AdUtil;
import com.google.ads.util.i.c;
import java.util.HashSet;
import java.util.Set;

public class AdView
  extends RelativeLayout
  implements Ad
{
  private m a;
  private d b;
  
  public AdView(Activity paramActivity, AdSize paramAdSize, String paramString)
  {
    super(paramActivity.getApplicationContext());
    try
    {
      a(paramActivity, paramAdSize, null);
      b(paramActivity, paramAdSize, null);
      a(paramActivity, paramAdSize, paramString);
      return;
    }
    catch (com.google.ads.internal.b paramString)
    {
      a(paramActivity, paramString.c("Could not initialize AdView"), paramAdSize, null);
      paramString.a("Could not initialize AdView");
    }
  }
  
  public AdView(Context paramContext, AttributeSet paramAttributeSet)
  {
    super(paramContext, paramAttributeSet);
    a(paramContext, paramAttributeSet);
  }
  
  public AdView(Context paramContext, AttributeSet paramAttributeSet, int paramInt)
  {
    this(paramContext, paramAttributeSet);
  }
  
  private int a(Context paramContext, int paramInt)
  {
    return (int)TypedValue.applyDimension(1, paramInt, paramContext.getResources().getDisplayMetrics());
  }
  
  private String a(String paramString, Context paramContext, AttributeSet paramAttributeSet, boolean paramBoolean1, boolean paramBoolean2)
    throws com.google.ads.internal.b
  {
    paramAttributeSet = paramAttributeSet.getAttributeValue("http://schemas.android.com/apk/lib/com.google.ads", paramString);
    String str;
    TypedValue localTypedValue;
    if ((paramAttributeSet != null) && (paramAttributeSet.startsWith("@string/")) && (paramBoolean1))
    {
      str = paramAttributeSet.substring("@string/".length());
      paramContext = paramContext.getPackageName();
      localTypedValue = new TypedValue();
    }
    for (;;)
    {
      try
      {
        getResources().getValue(paramContext + ":string/" + str, localTypedValue, true);
        if (localTypedValue.string != null)
        {
          paramContext = localTypedValue.string.toString();
          if ((!paramBoolean2) || (paramContext != null)) {
            break label223;
          }
          throw new com.google.ads.internal.b("Required XML attribute \"" + paramString + "\" missing", true);
        }
      }
      catch (Resources.NotFoundException paramContext)
      {
        throw new com.google.ads.internal.b("Could not find resource for " + paramString + ": " + paramAttributeSet, true, paramContext);
      }
      throw new com.google.ads.internal.b("Resource " + paramString + " was not a string: " + localTypedValue, true);
      label223:
      return paramContext;
      paramContext = paramAttributeSet;
    }
  }
  
  private void a(Activity paramActivity, AdSize paramAdSize, String paramString)
    throws com.google.ads.internal.b
  {
    FrameLayout localFrameLayout = new FrameLayout(paramActivity);
    localFrameLayout.setFocusable(false);
    this.a = m.a(this, paramString, paramActivity, localFrameLayout, paramAdSize);
    this.b = new d(this.a, false);
    setGravity(17);
    try
    {
      paramActivity = j.a(paramActivity, this.b);
      if (paramActivity != null)
      {
        paramActivity.addView(localFrameLayout, -2, -2);
        addView(paramActivity, -2, -2);
        return;
      }
      addView(localFrameLayout, -2, -2);
      return;
    }
    catch (VerifyError paramActivity)
    {
      com.google.ads.util.b.a("Gestures disabled: Not supported on this version of Android.", paramActivity);
      addView(localFrameLayout, -2, -2);
    }
  }
  
  private void a(Context paramContext, AttributeSet paramAttributeSet)
  {
    if (paramAttributeSet == null) {}
    do
    {
      return;
      for (;;)
      {
        try
        {
          localObject2 = a("adSize", paramContext, paramAttributeSet, false, true);
          if (!"BANNER".equals(localObject2)) {
            continue;
          }
          localObject1 = AdSize.BANNER;
          if (localObject1 != null) {
            continue;
          }
          try
          {
            throw new com.google.ads.internal.b("Attribute \"adSize\" invalid: " + (String)localObject2, true);
          }
          catch (com.google.ads.internal.b localB2)
          {
            localObject2 = localObject1;
            localObject1 = localB2;
          }
        }
        catch (com.google.ads.internal.b localB1)
        {
          Object localObject1;
          boolean bool;
          Activity localActivity;
          Object localObject2 = null;
          continue;
        }
        a(paramContext, ((com.google.ads.internal.b)localObject1).c("Could not initialize AdView"), (AdSize)localObject2, paramAttributeSet);
        ((com.google.ads.internal.b)localObject1).a("Could not initialize AdView");
        if (isInEditMode()) {
          break;
        }
        ((com.google.ads.internal.b)localObject1).b("Could not initialize AdView");
        return;
        if ("SMART_BANNER".equals(localObject2)) {
          localObject1 = AdSize.SMART_BANNER;
        } else if ("IAB_MRECT".equals(localObject2)) {
          localObject1 = AdSize.IAB_MRECT;
        } else if ("IAB_BANNER".equals(localObject2)) {
          localObject1 = AdSize.IAB_BANNER;
        } else if ("IAB_LEADERBOARD".equals(localObject2)) {
          localObject1 = AdSize.IAB_LEADERBOARD;
        } else if ("IAB_WIDE_SKYSCRAPER".equals(localObject2)) {
          localObject1 = AdSize.IAB_WIDE_SKYSCRAPER;
        } else {
          localObject1 = null;
        }
      }
      if (!a("adUnitId", paramAttributeSet)) {
        throw new com.google.ads.internal.b("Required XML attribute \"adUnitId\" missing", true);
      }
      if (isInEditMode())
      {
        a(paramContext, "Ads by Google", -1, (AdSize)localObject1, paramAttributeSet);
        return;
      }
      localObject2 = a("adUnitId", paramContext, paramAttributeSet, true, true);
      bool = paramAttributeSet.getAttributeBooleanValue("http://schemas.android.com/apk/lib/com.google.ads", "loadAdOnCreate", false);
      if (!(paramContext instanceof Activity)) {
        break;
      }
      localActivity = (Activity)paramContext;
      a(localActivity, (AdSize)localObject1, paramAttributeSet);
      b(localActivity, (AdSize)localObject1, paramAttributeSet);
      a(localActivity, (AdSize)localObject1, (String)localObject2);
    } while (!bool);
    localObject2 = b("testDevices", paramContext, paramAttributeSet, false, false);
    if (((Set)localObject2).contains("TEST_EMULATOR"))
    {
      ((Set)localObject2).remove("TEST_EMULATOR");
      ((Set)localObject2).add(AdRequest.TEST_EMULATOR);
    }
    loadAd(new AdRequest().setTestDevices((Set)localObject2).setKeywords(b("keywords", paramContext, paramAttributeSet, false, false)));
    return;
    throw new com.google.ads.internal.b("AdView was initialized with a Context that wasn't an Activity.", true);
  }
  
  private void a(Context paramContext, String paramString, AdSize paramAdSize, AttributeSet paramAttributeSet)
  {
    com.google.ads.util.b.b(paramString);
    a(paramContext, paramString, -65536, paramAdSize, paramAttributeSet);
  }
  
  private boolean a(Context paramContext, AdSize paramAdSize, AttributeSet paramAttributeSet)
  {
    if (!AdUtil.c(paramContext))
    {
      a(paramContext, "You must have AdActivity declared in AndroidManifest.xml with configChanges.", paramAdSize, paramAttributeSet);
      return false;
    }
    return true;
  }
  
  private boolean a(String paramString, AttributeSet paramAttributeSet)
  {
    return paramAttributeSet.getAttributeValue("http://schemas.android.com/apk/lib/com.google.ads", paramString) != null;
  }
  
  private Set<String> b(String paramString, Context paramContext, AttributeSet paramAttributeSet, boolean paramBoolean1, boolean paramBoolean2)
    throws com.google.ads.internal.b
  {
    paramContext = a(paramString, paramContext, paramAttributeSet, paramBoolean1, paramBoolean2);
    paramString = new HashSet();
    if (paramContext != null)
    {
      paramContext = paramContext.split(",");
      int j = paramContext.length;
      int i = 0;
      while (i < j)
      {
        paramAttributeSet = paramContext[i].trim();
        if (paramAttributeSet.length() != 0) {
          paramString.add(paramAttributeSet);
        }
        i += 1;
      }
    }
    return paramString;
  }
  
  private boolean b(Context paramContext, AdSize paramAdSize, AttributeSet paramAttributeSet)
  {
    if (!AdUtil.b(paramContext))
    {
      a(paramContext, "You must have INTERNET and ACCESS_NETWORK_STATE permissions in AndroidManifest.xml.", paramAdSize, paramAttributeSet);
      return false;
    }
    return true;
  }
  
  void a(Context paramContext, String paramString, int paramInt, AdSize paramAdSize, AttributeSet paramAttributeSet)
  {
    AdSize localAdSize = paramAdSize;
    if (paramAdSize == null) {
      localAdSize = AdSize.BANNER;
    }
    localAdSize = AdSize.createAdSize(localAdSize, paramContext.getApplicationContext());
    if (getChildCount() == 0)
    {
      if (paramAttributeSet != null) {
        break label174;
      }
      paramAdSize = new TextView(paramContext);
      paramAdSize.setGravity(17);
      paramAdSize.setText(paramString);
      paramAdSize.setTextColor(paramInt);
      paramAdSize.setBackgroundColor(-16777216);
      if (paramAttributeSet != null) {
        break label189;
      }
      paramString = new LinearLayout(paramContext);
      label88:
      paramString.setGravity(17);
      if (paramAttributeSet != null) {
        break label203;
      }
    }
    label174:
    label189:
    label203:
    for (paramAttributeSet = new LinearLayout(paramContext);; paramAttributeSet = new LinearLayout(paramContext, paramAttributeSet))
    {
      paramAttributeSet.setGravity(17);
      paramAttributeSet.setBackgroundColor(paramInt);
      paramInt = a(paramContext, localAdSize.getWidth());
      int i = a(paramContext, localAdSize.getHeight());
      paramString.addView(paramAdSize, paramInt - 2, i - 2);
      paramAttributeSet.addView(paramString);
      addView(paramAttributeSet, paramInt, i);
      return;
      paramAdSize = new TextView(paramContext, paramAttributeSet);
      break;
      paramString = new LinearLayout(paramContext, paramAttributeSet);
      break label88;
    }
  }
  
  public void destroy()
  {
    this.b.b();
  }
  
  public boolean isReady()
  {
    if (this.b == null) {
      return false;
    }
    return this.b.q();
  }
  
  public boolean isRefreshing()
  {
    if (this.b == null) {
      return false;
    }
    return this.b.r();
  }
  
  public void loadAd(AdRequest paramAdRequest)
  {
    if (this.b != null)
    {
      if (isRefreshing()) {
        this.b.e();
      }
      this.b.a(paramAdRequest);
    }
  }
  
  public void setAdListener(AdListener paramAdListener)
  {
    this.a.j.a(paramAdListener);
  }
  
  public void stopLoading()
  {
    if (this.b != null) {
      this.b.z();
    }
  }
}
