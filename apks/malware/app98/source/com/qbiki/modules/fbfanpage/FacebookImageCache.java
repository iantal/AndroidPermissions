package com.qbiki.modules.fbfanpage;

import android.graphics.Bitmap;
import android.util.Log;
import java.util.Collections;
import java.util.Iterator;
import java.util.LinkedHashMap;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;

public class FacebookImageCache
{
  private static final String TAG = "FacebookImageCache";
  private Map<String, Bitmap> cache = Collections.synchronizedMap(new LinkedHashMap(10, 1.5F, true));
  private long limit = 1000000L;
  private long size = 0L;
  
  public FacebookImageCache()
  {
    setLimit(Runtime.getRuntime().maxMemory() / 4L);
  }
  
  private void checkSize()
  {
    Log.i("FacebookImageCache", "cache size=" + this.size + " length=" + this.cache.size());
    if (this.size > this.limit)
    {
      Iterator localIterator = this.cache.entrySet().iterator();
      do
      {
        if (!localIterator.hasNext()) {
          break;
        }
        Map.Entry localEntry = (Map.Entry)localIterator.next();
        this.size -= getSizeInBytes((Bitmap)localEntry.getValue());
        localIterator.remove();
      } while (this.size > this.limit);
      Log.i("FacebookImageCache", "Clean cache. New size " + this.cache.size());
    }
  }
  
  public void clear()
  {
    this.cache.clear();
  }
  
  public Bitmap get(String paramString)
  {
    try
    {
      if (!this.cache.containsKey(paramString)) {
        return null;
      }
      paramString = (Bitmap)this.cache.get(paramString);
      return paramString;
    }
    catch (NullPointerException paramString) {}
    return null;
  }
  
  long getSizeInBytes(Bitmap paramBitmap)
  {
    if (paramBitmap == null) {
      return 0L;
    }
    return paramBitmap.getRowBytes() * paramBitmap.getHeight();
  }
  
  public void put(String paramString, Bitmap paramBitmap)
  {
    try
    {
      if (this.cache.containsKey(paramString)) {
        this.size -= getSizeInBytes((Bitmap)this.cache.get(paramString));
      }
      this.cache.put(paramString, paramBitmap);
      this.size += getSizeInBytes(paramBitmap);
      checkSize();
      return;
    }
    catch (Throwable paramString)
    {
      paramString.printStackTrace();
    }
  }
  
  public void setLimit(long paramLong)
  {
    this.limit = paramLong;
    Log.i("FacebookImageCache", "MemoryCache will use up to " + this.limit / 1024.0D / 1024.0D + "MB");
  }
}
