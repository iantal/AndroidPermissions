package com.qbiki.modules.signaturestamp;

import android.content.Intent;
import android.graphics.Bitmap;
import android.os.Bundle;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.ViewGroup;
import android.webkit.WebView;
import android.widget.ImageView;
import com.actionbarsherlock.view.Menu;
import com.actionbarsherlock.view.MenuInflater;
import com.actionbarsherlock.view.MenuItem;
import com.qbiki.seattleclouds.App;
import com.qbiki.seattleclouds.SCFragment;
import com.qbiki.util.DialogUtil;
import com.qbiki.util.ImageUtil;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;

public class SignatureStampFragment
  extends SCFragment
{
  private final int DRAW_REQUEST_CODE = 1;
  private View fView = null;
  private String pageId = "";
  private String signatureImagePath = null;
  private ImageView signatureView;
  private WebView webView;
  
  public SignatureStampFragment() {}
  
  private String copyToSDCard(String paramString)
  {
    if (!App.isExternalStorageWritable())
    {
      DialogUtil.showAlert(getActivity(), 2131362108, 2131362109);
      return null;
    }
    Object localObject = App.getAppExternalStoragePath();
    localObject = (String)localObject + "/SignatureStamp";
    new File((String)localObject).mkdirs();
    paramString = new File(paramString);
    paramString.getName();
    localObject = new File((String)localObject + "/" + paramString.getName());
    try
    {
      copy(paramString, (File)localObject);
      return ((File)localObject).getAbsolutePath();
    }
    catch (IOException paramString)
    {
      Log.d("SignatureStamp", "Exception", paramString);
    }
    return null;
  }
  
  private void openSignatureDrawer()
  {
    Intent localIntent = new Intent(getActivity(), DrawSurfaceActivity.class);
    localIntent.putExtra("surfWidth", this.signatureView.getWidth());
    localIntent.putExtra("surfHeight", this.signatureView.getHeight());
    startActivityForResult(localIntent, 1);
  }
  
  void copy(File paramFile1, File paramFile2)
    throws IOException
  {
    paramFile1 = new FileInputStream(paramFile1);
    paramFile2 = new FileOutputStream(paramFile2);
    byte[] arrayOfByte = new byte['Ð€'];
    for (;;)
    {
      int i = paramFile1.read(arrayOfByte);
      if (i <= 0) {
        break;
      }
      paramFile2.write(arrayOfByte, 0, i);
    }
    paramFile1.close();
    paramFile2.close();
  }
  
  protected void init()
  {
    this.webView = ((WebView)this.fView.findViewById(2131100215));
    this.signatureView = ((ImageView)this.fView.findViewById(2131100216));
    Bundle localBundle = getArguments();
    if (localBundle != null) {
      this.pageId = localBundle.getString("pageId");
    }
    this.webView.loadUrl(App.getResourceUrl(this.pageId));
    this.signatureView.setOnClickListener(new View.OnClickListener()
    {
      public void onClick(View paramAnonymousView)
      {
        SignatureStampFragment.this.openSignatureDrawer();
      }
    });
  }
  
  public void onActivityResult(int paramInt1, int paramInt2, Intent paramIntent)
  {
    switch (paramInt1)
    {
    }
    for (;;)
    {
      super.onActivityResult(paramInt1, paramInt2, paramIntent);
      return;
      if ((paramInt2 == -1) && (paramIntent != null))
      {
        this.signatureImagePath = paramIntent.getExtras().getString("imagePath");
        Bitmap localBitmap = ImageUtil.getScaledExternalBitmap(this.signatureImagePath, this.signatureView.getWidth(), this.signatureView.getHeight(), true);
        this.signatureView.setImageBitmap(localBitmap);
      }
    }
  }
  
  public void onCreateOptionsMenu(Menu paramMenu, MenuInflater paramMenuInflater)
  {
    paramMenuInflater.inflate(2131558436, paramMenu);
    super.onCreateOptionsMenu(paramMenu, paramMenuInflater);
  }
  
  public View onCreateView(LayoutInflater paramLayoutInflater, ViewGroup paramViewGroup, Bundle paramBundle)
  {
    this.fView = paramLayoutInflater.inflate(2130903221, paramViewGroup, false);
    init();
    return this.fView;
  }
  
  public boolean onOptionsItemSelected(MenuItem paramMenuItem)
  {
    switch (paramMenuItem.getItemId())
    {
    }
    for (;;)
    {
      return super.onOptionsItemSelected(paramMenuItem);
      sendEmail();
    }
  }
  
  /* Error */
  public void sendEmail()
  {
    // Byte code:
    //   0: new 107	android/content/Intent
    //   3: dup
    //   4: ldc -3
    //   6: invokespecial 254	android/content/Intent:<init>	(Ljava/lang/String;)V
    //   9: astore_1
    //   10: aload_0
    //   11: getfield 27	com/qbiki/modules/signaturestamp/SignatureStampFragment:signatureImagePath	Ljava/lang/String;
    //   14: ifnull +43 -> 57
    //   17: aload_0
    //   18: aload_0
    //   19: getfield 27	com/qbiki/modules/signaturestamp/SignatureStampFragment:signatureImagePath	Ljava/lang/String;
    //   22: invokespecial 256	com/qbiki/modules/signaturestamp/SignatureStampFragment:copyToSDCard	(Ljava/lang/String;)Ljava/lang/String;
    //   25: astore_2
    //   26: aload_2
    //   27: ifnull +30 -> 57
    //   30: aload_1
    //   31: ldc_w 258
    //   34: invokevirtual 262	android/content/Intent:setType	(Ljava/lang/String;)Landroid/content/Intent;
    //   37: pop
    //   38: aload_1
    //   39: ldc_w 264
    //   42: new 77	java/io/File
    //   45: dup
    //   46: aload_2
    //   47: invokespecial 80	java/io/File:<init>	(Ljava/lang/String;)V
    //   50: invokestatic 270	android/net/Uri:fromFile	(Ljava/io/File;)Landroid/net/Uri;
    //   53: invokevirtual 273	android/content/Intent:putExtra	(Ljava/lang/String;Landroid/os/Parcelable;)Landroid/content/Intent;
    //   56: pop
    //   57: aload_1
    //   58: ldc_w 275
    //   61: invokevirtual 262	android/content/Intent:setType	(Ljava/lang/String;)Landroid/content/Intent;
    //   64: pop
    //   65: aload_1
    //   66: ldc_w 277
    //   69: aload_0
    //   70: getfield 25	com/qbiki/modules/signaturestamp/SignatureStampFragment:pageId	Ljava/lang/String;
    //   73: invokestatic 281	com/qbiki/seattleclouds/App:getResourceStream	(Ljava/lang/String;)Ljava/io/InputStream;
    //   76: invokestatic 287	com/qbiki/util/DataUtil:readString	(Ljava/io/InputStream;)Ljava/lang/String;
    //   79: invokestatic 293	android/text/Html:fromHtml	(Ljava/lang/String;)Landroid/text/Spanned;
    //   82: invokevirtual 296	android/content/Intent:putExtra	(Ljava/lang/String;Ljava/lang/CharSequence;)Landroid/content/Intent;
    //   85: pop
    //   86: aload_0
    //   87: aload_1
    //   88: invokevirtual 300	com/qbiki/modules/signaturestamp/SignatureStampFragment:startActivity	(Landroid/content/Intent;)V
    //   91: return
    //   92: astore_1
    //   93: return
    //   94: astore_1
    //   95: aload_0
    //   96: invokevirtual 51	com/qbiki/modules/signaturestamp/SignatureStampFragment:getActivity	()Landroid/support/v4/app/FragmentActivity;
    //   99: ldc_w 301
    //   102: iconst_0
    //   103: invokestatic 307	android/widget/Toast:makeText	(Landroid/content/Context;II)Landroid/widget/Toast;
    //   106: invokevirtual 310	android/widget/Toast:show	()V
    //   109: return
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	110	0	this	SignatureStampFragment
    //   9	79	1	localIntent	Intent
    //   92	1	1	localException	Exception
    //   94	1	1	localActivityNotFoundException	android.content.ActivityNotFoundException
    //   25	22	2	str	String
    // Exception table:
    //   from	to	target	type
    //   57	86	92	java/lang/Exception
    //   86	91	94	android/content/ActivityNotFoundException
  }
}
