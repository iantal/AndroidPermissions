package com.qbiki.modules.dropbox.medialist;

import android.content.Context;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.ProgressBar;
import android.widget.TextView;
import com.qbiki.seattleclouds.App;
import com.qbiki.util.ImageCache;
import java.io.File;

public class ListItemViews
{
  Context context;
  ImageCache imageCache;
  
  public ListItemViews(Context paramContext)
  {
    this.context = paramContext;
    this.imageCache = new ImageCache();
  }
  
  private Bitmap loadImageFromLocal(String paramString)
  {
    paramString = new File(paramString);
    if (paramString.exists()) {
      return BitmapFactory.decodeFile(paramString.getAbsolutePath());
    }
    return null;
  }
  
  private void updateBadge(ImageView paramImageView, MediaFile paramMediaFile)
  {
    if (paramMediaFile.getMediaFileStatus() == MediaFile.MediaFileStatus.ONLINE)
    {
      paramImageView.setImageResource(2130837679);
      return;
    }
    paramImageView.setImageResource(2130837681);
  }
  
  private void updateImage(ImageView paramImageView, MediaFile paramMediaFile)
  {
    paramMediaFile = new File(App.getAppResourcesPath() + "/" + paramMediaFile.getMediaFileImageTHMB());
    if (this.imageCache.get(paramMediaFile.toString()) != null) {
      paramImageView.setImageBitmap(this.imageCache.get(paramMediaFile.toString()));
    }
    while (!paramMediaFile.exists()) {
      return;
    }
    Bitmap localBitmap = loadImageFromLocal(paramMediaFile.toString());
    this.imageCache.put(paramMediaFile.toString(), localBitmap);
    paramImageView.setImageBitmap(localBitmap);
  }
  
  public View getDownloadInProgressView(View paramView, MediaFile paramMediaFile)
  {
    Object localObject;
    if ((paramView == null) || (!DownloadInProgressViewHolder.class.isInstance(paramView)))
    {
      localObject = (ViewGroup)((LayoutInflater)this.context.getSystemService("layout_inflater")).inflate(2130903230, null);
      paramView = new DownloadInProgressViewHolder((TextView)((ViewGroup)localObject).findViewById(2131100244), (ImageView)((ViewGroup)localObject).findViewById(2131100243), (ProgressBar)((ViewGroup)localObject).findViewById(2131100246));
      ((ViewGroup)localObject).setTag(paramView);
    }
    for (;;)
    {
      paramView.txtFileName.setText(paramMediaFile.getMediaFileTitle());
      paramView.progressBar.setProgress(paramMediaFile.getMediaFileProgress());
      updateImage(paramView.imageFileImage, paramMediaFile);
      return localObject;
      localObject = paramView;
      paramView = (DownloadInProgressViewHolder)paramView.getTag();
    }
  }
  
  public View getFileView(View paramView, MediaFile paramMediaFile)
  {
    Object localObject;
    if ((paramView == null) || (!FileViewHolder.class.isInstance(paramView)))
    {
      localObject = (ViewGroup)((LayoutInflater)this.context.getSystemService("layout_inflater")).inflate(2130903231, null);
      paramView = new FileViewHolder((TextView)((ViewGroup)localObject).findViewById(2131100244), (TextView)((ViewGroup)localObject).findViewById(2131100247), (ImageView)((ViewGroup)localObject).findViewById(2131100243), (ImageView)((ViewGroup)localObject).findViewById(2131100248));
      ((ViewGroup)localObject).setTag(paramView);
    }
    for (;;)
    {
      paramView.txtFileName.setText(paramMediaFile.getMediaFileTitle());
      paramView.txtFileInfo.setText(paramMediaFile.getFileSizeString() + ", " + paramMediaFile.getModifiedDate());
      updateImage(paramView.imageFileImage, paramMediaFile);
      updateBadge(paramView.imgBadge, paramMediaFile);
      return localObject;
      localObject = paramView;
      paramView = (FileViewHolder)paramView.getTag();
    }
  }
  
  private static class DownloadInProgressViewHolder
  {
    final ImageView imageFileImage;
    final ProgressBar progressBar;
    final TextView txtFileName;
    
    DownloadInProgressViewHolder(TextView paramTextView, ImageView paramImageView, ProgressBar paramProgressBar)
    {
      this.txtFileName = paramTextView;
      this.imageFileImage = paramImageView;
      this.progressBar = paramProgressBar;
    }
  }
  
  private static class FileViewHolder
  {
    final ImageView imageFileImage;
    final ImageView imgBadge;
    final TextView txtFileInfo;
    final TextView txtFileName;
    
    FileViewHolder(TextView paramTextView1, TextView paramTextView2, ImageView paramImageView1, ImageView paramImageView2)
    {
      this.txtFileName = paramTextView1;
      this.txtFileInfo = paramTextView2;
      this.imageFileImage = paramImageView1;
      this.imgBadge = paramImageView2;
    }
  }
}
