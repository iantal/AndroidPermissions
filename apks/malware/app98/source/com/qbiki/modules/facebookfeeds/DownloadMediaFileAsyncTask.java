package com.qbiki.modules.facebookfeeds;

import android.os.AsyncTask;
import android.util.Log;
import com.qbiki.util.AsyncTaskListener;
import java.io.BufferedInputStream;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.URL;
import java.net.URLConnection;
import nl.siegmann.epublib.util.IOUtil;

class DownloadMediaFileAsyncTask
  extends AsyncTask<String, Integer, Void>
{
  private static final String TAG = DownloadMediaFileAsyncTask.class.getSimpleName();
  private AsyncTaskListener mTaskListener;
  
  DownloadMediaFileAsyncTask() {}
  
  private boolean DownloadFile(String paramString1, String paramString2)
  {
    try
    {
      paramString1 = new URL(paramString1);
      paramString1.openConnection().connect();
      paramString1 = new BufferedInputStream(paramString1.openStream());
      FileOutputStream localFileOutputStream = new FileOutputStream(paramString2);
      IOUtil.copy(paramString1, localFileOutputStream);
      localFileOutputStream.close();
      paramString1.close();
      return true;
    }
    catch (IOException paramString1)
    {
      paramString2 = new File(paramString2);
      if (paramString2.exists()) {
        paramString2.delete();
      }
      Log.e(TAG, "Download error" + paramString1, paramString1);
    }
    return false;
  }
  
  protected Void doInBackground(String... paramVarArgs)
  {
    if (DownloadFile(paramVarArgs[0], paramVarArgs[1]))
    {
      this.mTaskListener.asyncTaskFinished(paramVarArgs[1]);
      return null;
    }
    this.mTaskListener.asyncTaskFinished(null);
    return null;
  }
  
  void setTaskListener(AsyncTaskListener paramAsyncTaskListener)
  {
    this.mTaskListener = paramAsyncTaskListener;
  }
}
