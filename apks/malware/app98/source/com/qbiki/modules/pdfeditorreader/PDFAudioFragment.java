package com.qbiki.modules.pdfeditorreader;

import android.content.DialogInterface;
import android.media.MediaPlayer;
import android.media.MediaPlayer.OnCompletionListener;
import android.media.MediaPlayer.OnErrorListener;
import android.media.MediaPlayer.OnPreparedListener;
import android.os.Bundle;
import android.os.Handler;
import android.support.v4.app.DialogFragment;
import android.support.v4.app.FragmentActivity;
import android.view.LayoutInflater;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.ViewGroup;
import android.widget.ImageButton;
import android.widget.SeekBar;
import android.widget.SeekBar.OnSeekBarChangeListener;
import android.widget.TextView;
import java.util.Timer;
import java.util.TimerTask;

public class PDFAudioFragment
  extends DialogFragment
  implements MediaPlayer.OnPreparedListener, MediaPlayer.OnCompletionListener, MediaPlayer.OnErrorListener
{
  public static final String AUDIO_FILE_PATH = "AUDIO_FILE_PATH";
  private String audioFile = null;
  private TextView durationdText = null;
  private TextView elapsedText = null;
  private ImageButton ffButton = null;
  private View fview = null;
  private MediaPlayer mediaPlayer;
  private ImageButton playPauseButton = null;
  private ImageButton rewButton = null;
  private SeekBar seekBar = null;
  private Timer timer = null;
  
  public PDFAudioFragment() {}
  
  private void startTimer()
  {
    if (this.timer == null)
    {
      this.timer = new Timer();
      this.timer.schedule(new TimerTask()
      {
        public void run()
        {
          PDFAudioFragment.this.updateAudioProgress();
        }
      }, 500L, 500L);
    }
  }
  
  private void stopTimer()
  {
    if (this.timer != null)
    {
      this.timer.cancel();
      this.timer.purge();
      this.timer = null;
    }
  }
  
  public int getCurrentPosition()
  {
    return this.mediaPlayer.getCurrentPosition();
  }
  
  public int getDuration()
  {
    return this.mediaPlayer.getDuration();
  }
  
  public boolean isPlaying()
  {
    return this.mediaPlayer.isPlaying();
  }
  
  public void onCancel(DialogInterface paramDialogInterface)
  {
    super.onCancel(paramDialogInterface);
    stopTimer();
    this.mediaPlayer.stop();
    this.mediaPlayer.release();
    this.mediaPlayer = null;
  }
  
  public void onCompletion(MediaPlayer paramMediaPlayer)
  {
    pause();
    this.mediaPlayer.seekTo(0);
    updateAudioProgress();
  }
  
  public View onCreateView(LayoutInflater paramLayoutInflater, ViewGroup paramViewGroup, Bundle paramBundle)
  {
    paramBundle = getArguments();
    if (paramBundle != null) {
      this.audioFile = paramBundle.getString("AUDIO_FILE_PATH");
    }
    this.fview = paramLayoutInflater.inflate(2130903164, paramViewGroup, false);
    this.fview.setMinimumWidth(300);
    this.playPauseButton = ((ImageButton)this.fview.findViewById(2131100029));
    this.rewButton = ((ImageButton)this.fview.findViewById(2131100028));
    this.ffButton = ((ImageButton)this.fview.findViewById(2131100030));
    this.elapsedText = ((TextView)this.fview.findViewById(2131100031));
    this.durationdText = ((TextView)this.fview.findViewById(2131100033));
    this.seekBar = ((SeekBar)this.fview.findViewById(2131100032));
    this.playPauseButton.setEnabled(false);
    this.rewButton.setEnabled(false);
    this.ffButton.setEnabled(false);
    this.seekBar.setEnabled(false);
    return this.fview;
  }
  
  public boolean onError(MediaPlayer paramMediaPlayer, int paramInt1, int paramInt2)
  {
    this.playPauseButton.setEnabled(true);
    this.rewButton.setEnabled(true);
    this.ffButton.setEnabled(true);
    this.seekBar.setEnabled(true);
    return false;
  }
  
  public void onHiddenChanged(boolean paramBoolean)
  {
    if (paramBoolean) {
      this.mediaPlayer.pause();
    }
    super.onHiddenChanged(paramBoolean);
  }
  
  public void onPrepared(MediaPlayer paramMediaPlayer)
  {
    new Handler().post(new Runnable()
    {
      public void run()
      {
        PDFAudioFragment.this.elapsedText.setText("00:00");
        int i = PDFAudioFragment.this.getDuration() / 1000;
        PDFAudioFragment.this.durationdText.setText(i / 60 + ":" + i % 60);
        PDFAudioFragment.this.seekBar.setMax(i);
        PDFAudioFragment.this.playPauseButton.setEnabled(true);
        PDFAudioFragment.this.rewButton.setEnabled(true);
        PDFAudioFragment.this.ffButton.setEnabled(true);
        PDFAudioFragment.this.seekBar.setEnabled(true);
        PDFAudioFragment.this.playPauseButton.setOnClickListener(new View.OnClickListener()
        {
          public void onClick(View paramAnonymous2View)
          {
            if (PDFAudioFragment.this.isPlaying())
            {
              PDFAudioFragment.this.pause();
              return;
            }
            PDFAudioFragment.this.start();
          }
        });
        PDFAudioFragment.this.ffButton.setOnClickListener(new View.OnClickListener()
        {
          public void onClick(View paramAnonymous2View)
          {
            PDFAudioFragment.this.seekTo(PDFAudioFragment.this.getCurrentPosition() / 1000 + 2);
          }
        });
        PDFAudioFragment.this.rewButton.setOnClickListener(new View.OnClickListener()
        {
          public void onClick(View paramAnonymous2View)
          {
            PDFAudioFragment.this.seekTo(PDFAudioFragment.this.getCurrentPosition() / 1000 - 2);
          }
        });
        PDFAudioFragment.this.seekBar.setOnSeekBarChangeListener(new SeekBar.OnSeekBarChangeListener()
        {
          public void onProgressChanged(SeekBar paramAnonymous2SeekBar, int paramAnonymous2Int, boolean paramAnonymous2Boolean)
          {
            if (paramAnonymous2Boolean) {
              PDFAudioFragment.this.seekTo(paramAnonymous2Int);
            }
            PDFAudioFragment.this.elapsedText.setText(paramAnonymous2Int / 60 + ":" + paramAnonymous2Int % 60);
          }
          
          public void onStartTrackingTouch(SeekBar paramAnonymous2SeekBar)
          {
            PDFAudioFragment.this.pause();
          }
          
          public void onStopTrackingTouch(SeekBar paramAnonymous2SeekBar)
          {
            PDFAudioFragment.this.start();
          }
        });
        PDFAudioFragment.this.start();
      }
    });
  }
  
  public void onStop()
  {
    super.onStop();
    if (this.mediaPlayer != null) {
      pause();
    }
  }
  
  /* Error */
  public void onViewCreated(View paramView, Bundle paramBundle)
  {
    // Byte code:
    //   0: aload_0
    //   1: aload_1
    //   2: aload_2
    //   3: invokespecial 203	android/support/v4/app/DialogFragment:onViewCreated	(Landroid/view/View;Landroid/os/Bundle;)V
    //   6: aload_0
    //   7: new 101	android/media/MediaPlayer
    //   10: dup
    //   11: invokespecial 204	android/media/MediaPlayer:<init>	()V
    //   14: putfield 99	com/qbiki/modules/pdfeditorreader/PDFAudioFragment:mediaPlayer	Landroid/media/MediaPlayer;
    //   17: aload_0
    //   18: getfield 99	com/qbiki/modules/pdfeditorreader/PDFAudioFragment:mediaPlayer	Landroid/media/MediaPlayer;
    //   21: aload_0
    //   22: invokevirtual 208	android/media/MediaPlayer:setOnPreparedListener	(Landroid/media/MediaPlayer$OnPreparedListener;)V
    //   25: aload_0
    //   26: getfield 99	com/qbiki/modules/pdfeditorreader/PDFAudioFragment:mediaPlayer	Landroid/media/MediaPlayer;
    //   29: aload_0
    //   30: invokevirtual 212	android/media/MediaPlayer:setOnCompletionListener	(Landroid/media/MediaPlayer$OnCompletionListener;)V
    //   33: aload_0
    //   34: getfield 99	com/qbiki/modules/pdfeditorreader/PDFAudioFragment:mediaPlayer	Landroid/media/MediaPlayer;
    //   37: aload_0
    //   38: invokevirtual 216	android/media/MediaPlayer:setOnErrorListener	(Landroid/media/MediaPlayer$OnErrorListener;)V
    //   41: new 218	java/io/File
    //   44: dup
    //   45: aload_0
    //   46: getfield 49	com/qbiki/modules/pdfeditorreader/PDFAudioFragment:audioFile	Ljava/lang/String;
    //   49: invokespecial 221	java/io/File:<init>	(Ljava/lang/String;)V
    //   52: astore_2
    //   53: aconst_null
    //   54: astore_1
    //   55: new 223	java/io/FileInputStream
    //   58: dup
    //   59: aload_2
    //   60: invokespecial 226	java/io/FileInputStream:<init>	(Ljava/io/File;)V
    //   63: astore_2
    //   64: aload_0
    //   65: getfield 99	com/qbiki/modules/pdfeditorreader/PDFAudioFragment:mediaPlayer	Landroid/media/MediaPlayer;
    //   68: aload_2
    //   69: invokevirtual 230	java/io/FileInputStream:getFD	()Ljava/io/FileDescriptor;
    //   72: invokevirtual 234	android/media/MediaPlayer:setDataSource	(Ljava/io/FileDescriptor;)V
    //   75: aload_0
    //   76: getfield 99	com/qbiki/modules/pdfeditorreader/PDFAudioFragment:mediaPlayer	Landroid/media/MediaPlayer;
    //   79: invokevirtual 237	android/media/MediaPlayer:prepare	()V
    //   82: aload_0
    //   83: getfield 99	com/qbiki/modules/pdfeditorreader/PDFAudioFragment:mediaPlayer	Landroid/media/MediaPlayer;
    //   86: invokevirtual 240	android/media/MediaPlayer:start	()V
    //   89: return
    //   90: astore_2
    //   91: aload_1
    //   92: ifnull -3 -> 89
    //   95: aload_1
    //   96: invokevirtual 243	java/io/FileInputStream:close	()V
    //   99: return
    //   100: astore_1
    //   101: return
    //   102: astore_1
    //   103: aload_2
    //   104: astore_1
    //   105: goto -14 -> 91
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	108	0	this	PDFAudioFragment
    //   0	108	1	paramView	View
    //   0	108	2	paramBundle	Bundle
    // Exception table:
    //   from	to	target	type
    //   55	64	90	java/io/IOException
    //   95	99	100	java/io/IOException
    //   64	89	102	java/io/IOException
  }
  
  public void pause()
  {
    this.mediaPlayer.pause();
    this.playPauseButton.setImageResource(17301540);
    stopTimer();
  }
  
  public void seekTo(int paramInt)
  {
    this.mediaPlayer.seekTo(paramInt * 1000);
  }
  
  public void start()
  {
    startTimer();
    updateAudioProgress();
    this.playPauseButton.setImageResource(17301539);
    this.mediaPlayer.start();
  }
  
  protected void updateAudioProgress()
  {
    getActivity().runOnUiThread(new Runnable()
    {
      public void run()
      {
        int i = PDFAudioFragment.this.getCurrentPosition() / 1000;
        PDFAudioFragment.this.seekBar.setProgress(i);
        PDFAudioFragment.this.elapsedText.setText(i / 60 + ":" + i % 60);
      }
    });
  }
}
