package com.qbiki.location;

import android.os.Bundle;
import android.support.v4.app.FragmentActivity;
import android.view.LayoutInflater;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.Button;
import android.widget.ListView;
import com.google.android.bitmapfun.ImageCache.ImageCacheParams;
import com.qbiki.feedback.LocationModel;
import com.qbiki.seattleclouds.App;
import com.qbiki.seattleclouds.FragmentInfo;
import com.qbiki.seattleclouds.SCListFragment;
import com.qbiki.util.ImageResourceFetcher;
import java.util.ArrayList;

public class LocationsListFragment
  extends SCListFragment
{
  public static final String ARG_DISTANCE_IN_MILES = "resultDistanceInMiles";
  public static final String ARG_LOCATIONS = "locationsList";
  private ArrayList<LocationModel> locationsList;
  private ImageResourceFetcher mImageFetcher;
  private View mView;
  private boolean resultDistanceInMiles = true;
  private Button showOnMapBtn;
  
  public LocationsListFragment() {}
  
  private void showOnMapAction()
  {
    Bundle localBundle = new Bundle();
    localBundle.putParcelableArrayList("locationsList", this.locationsList);
    App.showPage(new FragmentInfo(ImageMarkerMapFragment.class.getName(), localBundle), this);
  }
  
  public View onCreateView(LayoutInflater paramLayoutInflater, ViewGroup paramViewGroup, Bundle paramBundle)
  {
    this.mView = paramLayoutInflater.inflate(2130903156, paramViewGroup, false);
    return this.mView;
  }
  
  public void onViewCreated(View paramView, Bundle paramBundle)
  {
    super.onViewCreated(paramView, paramBundle);
    paramView = getArguments();
    if (paramView != null)
    {
      this.locationsList = paramView.getParcelableArrayList("locationsList");
      this.resultDistanceInMiles = paramView.getBoolean("resultDistanceInMiles", true);
    }
    if (this.locationsList == null) {
      this.locationsList = new ArrayList();
    }
    this.showOnMapBtn = ((Button)this.mView.findViewById(2131099992));
    this.showOnMapBtn.setOnClickListener(new View.OnClickListener()
    {
      public void onClick(View paramAnonymousView)
      {
        LocationsListFragment.this.showOnMapAction();
      }
    });
    paramView = new ImageCache.ImageCacheParams(getActivity(), "locationListImageCache");
    paramView.setMemCacheSizePercent(0.25F);
    this.mImageFetcher = new ImageResourceFetcher(getActivity(), 100);
    this.mImageFetcher.addImageCache(getActivity().getSupportFragmentManager(), paramView);
    setListAdapter(new LocationsListAdapter(getActivity(), this.locationsList, this.mImageFetcher, this.resultDistanceInMiles));
    getListView().setOnItemClickListener(new AdapterView.OnItemClickListener()
    {
      public void onItemClick(AdapterView<?> paramAnonymousAdapterView, View paramAnonymousView, int paramAnonymousInt, long paramAnonymousLong)
      {
        paramAnonymousAdapterView = new ArrayList();
        paramAnonymousAdapterView.add(LocationsListFragment.this.locationsList.get(paramAnonymousInt));
        paramAnonymousView = new Bundle();
        paramAnonymousView.putParcelableArrayList("locationsList", paramAnonymousAdapterView);
        paramAnonymousView.putBoolean("resultDistanceInMiles", LocationsListFragment.this.resultDistanceInMiles);
        App.showPage(new FragmentInfo(ImageMarkerMapFragment.class.getName(), paramAnonymousView), LocationsListFragment.this);
      }
    });
  }
}
