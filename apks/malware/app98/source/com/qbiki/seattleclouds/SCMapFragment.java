package com.qbiki.seattleclouds;

import android.app.Activity;
import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;
import android.support.v4.app.FragmentActivity;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.Toast;
import com.google.android.gms.maps.GoogleMap;
import com.google.android.gms.maps.MapView;
import com.qbiki.util.DeviceUtil;

public class SCMapFragment
  extends SCFragment
{
  private static final String TAG = "SCMapFragment";
  private boolean LOGV = false;
  private boolean mGetGooglePlayServicesButtonFixApplied = false;
  private MapView mMapView;
  private boolean myLocationWasEnabled = false;
  
  public SCMapFragment() {}
  
  private Button findGetGooglePlayServicesButton(ViewGroup paramViewGroup)
  {
    Button localButton = null;
    int i = 0;
    for (;;)
    {
      Object localObject = localButton;
      if (i < paramViewGroup.getChildCount())
      {
        localObject = paramViewGroup.getChildAt(i);
        if (!(localObject instanceof Button)) {
          break label40;
        }
        localObject = (Button)localObject;
      }
      label40:
      do
      {
        return localObject;
        if (!(localObject instanceof ViewGroup)) {
          break;
        }
        localButton = findGetGooglePlayServicesButton((ViewGroup)localObject);
        localObject = localButton;
      } while (localButton != null);
      i += 1;
    }
  }
  
  private void fixGetGooglePlayServicesButtonIfNeeded()
  {
    if (DeviceUtil.isPlayStoreAppInstalled(getActivity())) {}
    do
    {
      Button localButton;
      do
      {
        do
        {
          return;
        } while (this.mGetGooglePlayServicesButtonFixApplied);
        if (this.LOGV) {
          Log.v("SCMapFragment", "Google Play Store app not installed, applying \"Get Google Play Services\" workaround...");
        }
        localButton = findGetGooglePlayServicesButton(this.mMapView);
        if (localButton != null) {
          break;
        }
      } while (!this.LOGV);
      Log.v("SCMapFragment", "\"Get Google Play Services\" not found!");
      return;
      localButton.setOnClickListener(new View.OnClickListener()
      {
        public void onClick(View paramAnonymousView)
        {
          if (SCMapFragment.this.LOGV) {
            Log.v("SCMapFragment", "\"Get Google Play Services\" workaround activated");
          }
          paramAnonymousView = new Intent("android.intent.action.VIEW");
          paramAnonymousView.setData(Uri.parse("http://play.google.com/store/apps/details?id=com.google.android.gms"));
          paramAnonymousView.setFlags(524288);
          FragmentActivity localFragmentActivity = SCMapFragment.this.getActivity();
          if (localFragmentActivity != null) {
            localFragmentActivity.startActivityForResult(paramAnonymousView, 0);
          }
        }
      });
      this.mGetGooglePlayServicesButtonFixApplied = true;
    } while (!this.LOGV);
    Log.v("SCMapFragment", "\"Get Google Play Services\" workaround applied successfully");
  }
  
  public boolean checkReady()
  {
    if ((this.mMapView == null) || (this.mMapView.getMap() == null))
    {
      if (getActivity() != null) {
        Toast.makeText(getActivity(), 2131362191, 0).show();
      }
      return false;
    }
    return true;
  }
  
  public GoogleMap getMap()
  {
    if (this.mMapView != null) {
      return this.mMapView.getMap();
    }
    return null;
  }
  
  public void onActiveChanged(boolean paramBoolean)
  {
    super.onActiveChanged(paramBoolean);
    if (!checkReady()) {}
    do
    {
      return;
      if (!paramBoolean) {
        this.myLocationWasEnabled = this.mMapView.getMap().isMyLocationEnabled();
      }
    } while (!this.myLocationWasEnabled);
    this.mMapView.getMap().setMyLocationEnabled(paramBoolean);
  }
  
  public void onCreate(Bundle paramBundle)
  {
    setSurfaceViewFixEnabled(true);
    super.onCreate(paramBundle);
  }
  
  public View onCreateView(LayoutInflater paramLayoutInflater, ViewGroup paramViewGroup, Bundle paramBundle)
  {
    return paramLayoutInflater.inflate(2130903139, paramViewGroup, false);
  }
  
  public void onDestroyView()
  {
    super.onDestroyView();
    this.mMapView.onDestroy();
  }
  
  public void onLowMemory()
  {
    super.onLowMemory();
    this.mMapView.onLowMemory();
  }
  
  public void onPause()
  {
    super.onPause();
    this.mMapView.onPause();
  }
  
  public void onResume()
  {
    super.onResume();
    this.mMapView.onResume();
    fixGetGooglePlayServicesButtonIfNeeded();
  }
  
  public void onSaveInstanceState(Bundle paramBundle)
  {
    super.onSaveInstanceState(paramBundle);
    this.mMapView.onSaveInstanceState(paramBundle);
  }
  
  public void onViewCreated(View paramView, Bundle paramBundle)
  {
    super.onViewCreated(paramView, paramBundle);
    this.mMapView = ((MapView)paramView.findViewById(2131099684));
    this.mMapView.onCreate(paramBundle);
  }
}
