package com.google.android.gms.internal;

import android.app.Activity;
import android.content.Context;
import android.os.Binder;
import android.os.Bundle;
import android.os.IBinder;
import android.view.Display;
import android.view.View;
import android.view.View.OnAttachStateChangeListener;
import android.view.ViewTreeObserver;
import android.view.ViewTreeObserver.OnGlobalLayoutListener;
import android.view.Window;
import java.lang.ref.WeakReference;

public class bn
{
  protected bj cs;
  protected a dh;
  
  private bn(bj paramBj, int paramInt)
  {
    this.cs = paramBj;
    this.dh = new a(paramInt, null);
  }
  
  public static bn a(bj paramBj, int paramInt)
  {
    if (ba.ab()) {
      return new b(paramBj, paramInt);
    }
    return new bn(paramBj, paramInt);
  }
  
  public void a(View paramView) {}
  
  public void am()
  {
    this.cs.a(this.dh.di, this.dh.ap());
  }
  
  public Bundle an()
  {
    return this.dh.ap();
  }
  
  public IBinder ao()
  {
    return this.dh.di;
  }
  
  public void setGravity(int paramInt)
  {
    this.dh.gravity = paramInt;
  }
  
  public static final class a
  {
    public int bottom = 0;
    public IBinder di = null;
    public int dj = -1;
    public int gravity;
    public int left = 0;
    public int right = 0;
    public int top = 0;
    
    private a(int paramInt)
    {
      this.gravity = paramInt;
      this.di = new Binder();
    }
    
    public Bundle ap()
    {
      Bundle localBundle = new Bundle();
      localBundle.putInt("popupLocationInfo.gravity", this.gravity);
      localBundle.putInt("popupLocationInfo.displayId", this.dj);
      localBundle.putInt("popupLocationInfo.left", this.left);
      localBundle.putInt("popupLocationInfo.top", this.top);
      localBundle.putInt("popupLocationInfo.right", this.right);
      localBundle.putInt("popupLocationInfo.bottom", this.bottom);
      return localBundle;
    }
  }
  
  static final class b
    extends bn
    implements View.OnAttachStateChangeListener, ViewTreeObserver.OnGlobalLayoutListener
  {
    private boolean cC = false;
    private WeakReference<View> dk;
    
    protected b(bj paramBj, int paramInt)
    {
      super(paramInt, null);
    }
    
    private void b(View paramView)
    {
      int i = -1;
      if (ba.af()) {
        i = paramView.getDisplay().getDisplayId();
      }
      IBinder localIBinder = paramView.getWindowToken();
      int[] arrayOfInt = new int[2];
      paramView.getLocationInWindow(arrayOfInt);
      int j = paramView.getWidth();
      int k = paramView.getHeight();
      this.dh.dj = i;
      this.dh.di = localIBinder;
      this.dh.left = arrayOfInt[0];
      this.dh.top = arrayOfInt[1];
      this.dh.right = (arrayOfInt[0] + j);
      this.dh.bottom = (arrayOfInt[1] + k);
      if (this.cC)
      {
        am();
        this.cC = false;
      }
    }
    
    public void a(View paramView)
    {
      Object localObject2;
      Object localObject1;
      if (this.dk != null)
      {
        localObject2 = (View)this.dk.get();
        Context localContext = this.cs.getContext();
        localObject1 = localObject2;
        if (localObject2 == null)
        {
          localObject1 = localObject2;
          if ((localContext instanceof Activity)) {
            localObject1 = ((Activity)localContext).getWindow().getDecorView();
          }
        }
        if (localObject1 != null)
        {
          localObject1 = ((View)localObject1).getViewTreeObserver();
          if (!ba.ae()) {
            break label169;
          }
          ((ViewTreeObserver)localObject1).removeOnGlobalLayoutListener(this);
        }
      }
      for (;;)
      {
        this.dk = null;
        localObject2 = this.cs.getContext();
        localObject1 = paramView;
        if (paramView == null)
        {
          localObject1 = paramView;
          if ((localObject2 instanceof Activity))
          {
            localObject1 = ((Activity)localObject2).findViewById(16908290);
            paramView = (View)localObject1;
            if (localObject1 == null) {
              paramView = ((Activity)localObject2).getWindow().getDecorView();
            }
            bk.b("PopupManager", "You have not specified a View to use as content view for popups. Falling back to the Activity content view which may not work properly in future versions of the API. Use setViewForPopups() to set your content view.");
            localObject1 = paramView;
          }
        }
        if (localObject1 == null) {
          break;
        }
        this.dk = new WeakReference(localObject1);
        ((View)localObject1).addOnAttachStateChangeListener(this);
        ((View)localObject1).getViewTreeObserver().addOnGlobalLayoutListener(this);
        return;
        label169:
        ((ViewTreeObserver)localObject1).removeGlobalOnLayoutListener(this);
      }
      bk.c("PopupManager", "No content view usable to display popups. Popups will not be displayed in response to this client's calls. Use setViewForPopups() to set your content view.");
    }
    
    public void am()
    {
      if (this.dh.di != null)
      {
        super.am();
        return;
      }
      if (this.dk != null) {}
      for (boolean bool = true;; bool = false)
      {
        this.cC = bool;
        return;
      }
    }
    
    public void onGlobalLayout()
    {
      if (this.dk == null) {}
      View localView;
      do
      {
        return;
        localView = (View)this.dk.get();
      } while (localView == null);
      b(localView);
    }
    
    public void onViewAttachedToWindow(View paramView)
    {
      b(paramView);
    }
    
    public void onViewDetachedFromWindow(View paramView)
    {
      this.cs.aj();
      paramView.removeOnAttachStateChangeListener(this);
    }
  }
}
