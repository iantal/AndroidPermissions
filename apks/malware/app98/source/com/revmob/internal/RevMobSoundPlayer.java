package com.revmob.internal;

import android.app.Activity;
import android.media.MediaPlayer;
import android.media.MediaPlayer.OnCompletionListener;
import java.io.FileInputStream;
import java.io.IOException;

public class RevMobSoundPlayer
  implements AsyncTaskCompleteListener
{
  private DownloadManager downloader;
  private MediaPlayer media;
  
  public RevMobSoundPlayer() {}
  
  private void playSoundFromUrl(Activity paramActivity, String paramString)
  {
    if ((paramString != null) && (paramString.length() > 0))
    {
      this.downloader = new DownloadManager(paramActivity, paramString, paramString.substring(paramString.lastIndexOf('/') + 1), this);
      this.downloader.execute(new String[0]);
    }
  }
  
  public void onTaskComplete(String paramString)
  {
    if (this.downloader.getIsSuccessful())
    {
      this.media = new MediaPlayer();
      paramString = this.downloader.getAudioFile();
      this.media.setOnCompletionListener(new MediaPlayer.OnCompletionListener()
      {
        public void onCompletion(MediaPlayer paramAnonymousMediaPlayer)
        {
          RevMobSoundPlayer.this.media.release();
        }
      });
    }
    try
    {
      paramString = new FileInputStream(paramString);
      this.media.setDataSource(paramString.getFD());
      this.media.prepare();
      this.media.start();
      paramString.close();
      return;
    }
    catch (IOException paramString)
    {
      RMLog.d(paramString.toString());
    }
  }
  
  public void playBannerSound(Activity paramActivity, String paramString)
    throws IOException
  {
    playSoundFromUrl(paramActivity, paramString);
  }
  
  public void playFullscreenSound(Activity paramActivity, String paramString)
    throws IOException
  {
    playSoundFromUrl(paramActivity, paramString);
  }
  
  public void playPopupSound(Activity paramActivity, String paramString)
    throws IOException
  {
    playSoundFromUrl(paramActivity, paramString);
  }
}
