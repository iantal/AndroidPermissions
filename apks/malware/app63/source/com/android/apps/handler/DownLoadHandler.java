package com.android.apps.handler;

import android.app.Notification;
import android.app.NotificationManager;
import android.app.PendingIntent;
import android.app.Service;
import android.content.Intent;
import android.os.Handler;
import android.os.Message;
import android.widget.RemoteViews;
import com.android.apps.R.id;
import com.android.apps.R.layout;

public class DownLoadHandler
  extends Handler
{
  private Intent intent = null;
  private NotificationManager nfm = null;
  private Notification notification = null;
  private String packageName = null;
  private Service service = null;
  
  public DownLoadHandler() {}
  
  public DownLoadHandler(Intent paramIntent, Service paramService)
  {
    this.intent = paramIntent;
    this.service = paramService;
    init();
  }
  
  private void init()
  {
    if (this.intent != null)
    {
      this.packageName = this.intent.getStringExtra("package");
      if ((this.packageName != null) && (!"".equals(this.packageName)))
      {
        this.nfm = ((NotificationManager)this.service.getSystemService("notification"));
        this.notification = new Notification(17301633, "开始下载", System.currentTimeMillis());
        PendingIntent localPendingIntent = PendingIntent.getActivity(this.service, 0, new Intent(), 0);
        this.notification.contentView = new RemoteViews(this.packageName, R.layout.notification);
        this.notification.contentView.setProgressBar(R.id.progress, 100, 0, false);
        this.notification.flags = 16;
        this.notification.contentIntent = localPendingIntent;
      }
    }
  }
  
  public void handleMessage(Message paramMessage)
  {
    if ((paramMessage != null) && (this.notification != null)) {}
    switch (paramMessage.what)
    {
    default: 
      this.service.stopService(this.intent);
    case 0: 
    case 1: 
      do
      {
        return;
        this.notification.contentView.setProgressBar(R.id.progress, 100, 100, false);
        this.notification.contentView.setTextViewText(R.id.progress_text, paramMessage.obj.toString());
        this.notification.icon = 17301634;
        this.nfm.notify(0, this.notification);
        this.nfm.cancel(0);
        return;
      } while (paramMessage.arg1 < 0);
      this.notification.contentView.setProgressBar(R.id.progress, 100, paramMessage.arg1, false);
      this.notification.contentView.setTextViewText(R.id.progress_text, paramMessage.obj.toString());
      this.nfm.notify(0, this.notification);
      return;
    }
    this.notification.contentView.setProgressBar(R.id.progress, 100, 0, false);
    this.notification.contentView.setTextViewText(R.id.progress_text, paramMessage.obj.toString());
    this.service.stopService(this.intent);
  }
}
