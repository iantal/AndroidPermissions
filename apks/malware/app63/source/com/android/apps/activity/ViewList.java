package com.android.apps.activity;

import android.app.Activity;
import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.view.KeyEvent;
import android.widget.ListView;
import com.android.apps.R.id;
import com.android.apps.R.layout;
import com.android.apps.bean.AdAdvertisement;
import com.android.apps.connect.HttpUtil;
import com.android.apps.listenerinterface.OnAdStateListener;
import com.android.apps.util.AdManager;
import com.android.apps.util.ApkUtil;
import com.android.apps.util.CheckNet;
import com.android.apps.util.ListAdapter;
import com.android.apps.util.ToastUtil;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

public class ViewList
  extends Activity
{
  public static String activatePackage;
  public static boolean activation = false;
  public static boolean isDwonFail = false;
  public static List<AdAdvertisement> listNvAd;
  public static List<Map<String, Object>> listitem = new ArrayList();
  public static Context mContext;
  ListAdapter adapter;
  ApkUtil apkUtil;
  private int backNum = 0;
  HttpUtil httpUtil;
  private List<Map<String, Object>> listItem;
  private ListView listView;
  SharedPreferences preferences;
  private ToastUtil toastUtil;
  
  public ViewList() {}
  
  private List<Map<String, Object>> getListItem()
  {
    listitem = new ArrayList();
    if ((listNvAd != null) && (listNvAd.size() > 0))
    {
      Iterator localIterator = listNvAd.iterator();
      while (localIterator.hasNext())
      {
        AdAdvertisement localAdAdvertisement = (AdAdvertisement)localIterator.next();
        HashMap localHashMap = new HashMap();
        String str2 = localAdAdvertisement.getsIconUrl();
        String str1 = str2;
        if (!str2.startsWith("http")) {
          str1 = AdManager.dpiStr + str2;
        }
        localHashMap.put("image", str1);
        localHashMap.put("adId", Integer.valueOf(localAdAdvertisement.getId()));
        localHashMap.put("appName", localAdAdvertisement.getName());
        localHashMap.put("appInfo", localAdAdvertisement.getApkInfo());
        localHashMap.put("apkUrl", localAdAdvertisement.getApkUrl());
        localHashMap.put("apkName", localAdAdvertisement.getApkName());
        localHashMap.put("startApk", Boolean.valueOf(localAdAdvertisement.isApkStart()));
        localHashMap.put("packageName", localAdAdvertisement.getApkPackage());
        localHashMap.put("categoryId", Integer.valueOf(localAdAdvertisement.getCategoryId()));
        listitem.add(localHashMap);
      }
    }
    return listitem;
  }
  
  private void setAdapter()
  {
    this.listItem = getListItem();
    this.adapter = new ListAdapter(this.listItem, this);
    this.listView.setAdapter(this.adapter);
  }
  
  protected void onActivityResult(int paramInt1, int paramInt2, Intent paramIntent)
  {
    boolean bool;
    if (paramInt1 == 1024)
    {
      bool = CheckNet.isConnect();
      new StringBuilder("重新判断网络连接！").append(bool).toString();
      if ((bool) || (AdManager.sdkVersion.equals("15"))) {
        break label61;
      }
      AdManager.openConnect(listNvAd, this);
    }
    for (;;)
    {
      super.onActivityResult(paramInt1, paramInt2, paramIntent);
      return;
      label61:
      AdManager.isConnect = bool;
      AdManager.getAd();
      AdManager.adViewDestory();
      AdManager.initAdView();
    }
  }
  
  protected void onCreate(Bundle paramBundle)
  {
    super.onCreate(paramBundle);
    setContentView(R.layout.adviewlist);
    this.httpUtil = new HttpUtil();
    this.apkUtil = new ApkUtil(this);
    this.apkUtil.initState();
    mContext = this;
    AdManager.adContext = this;
    com.android.apps.util.UserInfo.mContext = this;
    this.toastUtil = new ToastUtil(mContext);
    this.listView = ((ListView)findViewById(R.id.adviewlist_listview));
    com.android.apps.util.ImageLoader.context = this;
    listNvAd = new ArrayList();
    if (AdManager.erInternet) {
      this.toastUtil.toast("网络连接异常，请您稍后再试。");
    }
    paramBundle = AdManager.listNvAd;
    listNvAd = paramBundle;
    AdManager.openConnect(paramBundle, this);
    if (listNvAd != null) {
      setAdapter();
    }
    AdManager.checkQuietlyDownloadPermission(this);
  }
  
  public boolean onKeyDown(int paramInt, KeyEvent paramKeyEvent)
  {
    if (this.backNum <= 0)
    {
      this.backNum += 1;
      this.toastUtil.toast("退出安装则游戏无法被激活，再按一次退出程序。");
      return false;
    }
    if ((paramInt == 4) && (paramKeyEvent.getRepeatCount() == 0))
    {
      OnAdStateListener localOnAdStateListener = AdManager.adactivation;
      if (localOnAdStateListener != null) {
        localOnAdStateListener.onBack();
      }
    }
    return super.onKeyDown(paramInt, paramKeyEvent);
  }
}
