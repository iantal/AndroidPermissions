package a.b.a.a.a;

import android.app.PendingIntent;
import android.content.Context;
import android.content.Intent;
import android.os.Handler;
import android.os.Looper;
import android.os.Messenger;
import java.io.IOException;
import java.util.concurrent.BlockingQueue;
import java.util.concurrent.LinkedBlockingQueue;
import java.util.concurrent.TimeUnit;

public class a
{
  static a a;
  final BlockingQueue b = new LinkedBlockingQueue();
  private Context c;
  private PendingIntent d;
  private Handler e = new b(this, Looper.getMainLooper());
  private Messenger f = new Messenger(this.e);
  
  public a() {}
  
  public static a a(Context paramContext)
  {
    try
    {
      if (a == null)
      {
        a = new a();
        a.c = paramContext;
      }
      paramContext = a;
      return paramContext;
    }
    finally {}
  }
  
  private void c(String[] paramArrayOfString)
  {
    paramArrayOfString = b(paramArrayOfString);
    Intent localIntent = new Intent("com.google.android.c2dm.intent.REGISTER");
    localIntent.setPackage("com.google.android.gms");
    localIntent.putExtra("google.messenger", this.f);
    a(localIntent);
    localIntent.putExtra("sender", paramArrayOfString);
    this.c.startService(localIntent);
  }
  
  public String a(String paramString)
  {
    return a(new String[] { paramString });
  }
  
  public String a(String[] paramArrayOfString)
  {
    if (Looper.getMainLooper() == Looper.myLooper()) {
      throw new IOException("MAIN_THREAD");
    }
    this.b.clear();
    c(paramArrayOfString);
    try
    {
      paramArrayOfString = (Intent)this.b.poll(5000L, TimeUnit.MILLISECONDS);
      if (paramArrayOfString == null) {
        throw new IOException("SERVICE_NOT_AVAILABLE");
      }
    }
    catch (InterruptedException paramArrayOfString)
    {
      throw new IOException(paramArrayOfString.getMessage());
    }
    String str = paramArrayOfString.getStringExtra("registration_id");
    if (str != null) {
      return str;
    }
    paramArrayOfString = paramArrayOfString.getStringExtra("error");
    if (paramArrayOfString != null) {
      throw new IOException(paramArrayOfString);
    }
    throw new IOException("SERVICE_NOT_AVAILABLE");
  }
  
  void a(Intent paramIntent)
  {
    try
    {
      if (this.d == null) {
        this.d = PendingIntent.getBroadcast(this.c, 0, new Intent(), 0);
      }
      paramIntent.putExtra("app", this.d);
      return;
    }
    finally {}
  }
  
  String b(String[] paramArrayOfString)
  {
    if ((paramArrayOfString == null) || (paramArrayOfString.length == 0)) {
      throw new IllegalArgumentException("No senderIds");
    }
    StringBuilder localStringBuilder = new StringBuilder(paramArrayOfString[0]);
    int i = 1;
    for (;;)
    {
      if (i >= paramArrayOfString.length) {
        return localStringBuilder.toString();
      }
      localStringBuilder.append(',').append(paramArrayOfString[i]);
      i += 1;
    }
  }
}
