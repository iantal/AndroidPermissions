package com.ironsource.mobilcore;

import android.app.Activity;
import android.content.Context;
import android.content.Intent;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.graphics.NinePatch;
import android.graphics.Rect;
import android.graphics.drawable.AnimationDrawable;
import android.graphics.drawable.BitmapDrawable;
import android.graphics.drawable.Drawable;
import android.graphics.drawable.NinePatchDrawable;
import android.os.AsyncTask;
import android.os.Build.VERSION;
import android.os.Handler;
import android.text.TextUtils;
import android.view.Display;
import android.view.OrientationEventListener;
import android.view.ViewGroup;
import android.view.Window;
import android.view.WindowManager;
import android.webkit.WebView;
import java.io.File;
import java.util.Random;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

class aS
  extends l
{
  private static aS n;
  private b A = null;
  private JSONObject B;
  private OnReadyListener C;
  private boolean D;
  private boolean E;
  private OrientationEventListener F;
  private Activity G;
  private boolean H = false;
  aE.d e = new aE.d()
  {
    public final String a()
    {
      return aS.d(aS.this);
    }
    
    public final void a(boolean paramAnonymousBoolean)
    {
      boolean bool = true;
      aS.this.a("allComplete Stickeez");
      if (!paramAnonymousBoolean)
      {
        aS.this.f = aS.b(aS.this);
        localAS = aS.this;
        paramAnonymousBoolean = bool;
        if (aS.this.f == null) {
          paramAnonymousBoolean = false;
        }
        aS.b(localAS, paramAnonymousBoolean);
        aS.a(aS.this);
      }
      while ((aS.c(aS.this) == aS.b.c) || (aS.c(aS.this) == aS.b.d))
      {
        aS localAS;
        return;
      }
      aS.this.a("we are about to clean! state is: " + aS.c(aS.this).name());
      aS.b(aS.this, true);
      aS.a(aS.this);
    }
  };
  public JSONObject f;
  private Runnable g;
  private String h;
  private f i;
  private int j;
  private String k;
  private boolean l = false;
  private boolean m;
  private String o;
  private long p;
  private aR q;
  private WebView r;
  private AnimationDrawable s;
  private AnimationDrawable t;
  private AnimationDrawable u;
  private NinePatchDrawable v;
  private Drawable w;
  private aR.b x;
  private long y = -1L;
  private Drawable z;
  
  private aS() {}
  
  public static aS h()
  {
    if (n == null) {
      n = new aS();
    }
    return n;
  }
  
  private void q()
  {
    MobileCore.b().post(new Runnable()
    {
      public final void run()
      {
        if (aS.h(aS.this) != null)
        {
          MobileCore.b().removeCallbacks(aS.h(aS.this));
          aS.a(aS.this, null);
        }
        aS.g(aS.this).a(new aR.a()
        {
          public final void a()
          {
            aS.a(aS.this, aS.b.b);
            ((ViewGroup)aS.i(aS.this).getWindow().getDecorView()).removeViewInLayout(aS.g(aS.this));
            aS.this.a("animation finished");
            aS.j(aS.this).disable();
            aS.this.g();
          }
        });
      }
    });
    a("hideAll", "hideAll | Refresh handle animation and feed by downloading config file again");
  }
  
  /* Error */
  private void r()
  {
    // Byte code:
    //   0: iconst_1
    //   1: istore_3
    //   2: iconst_1
    //   3: istore_2
    //   4: aload_0
    //   5: monitorenter
    //   6: aload_0
    //   7: getfield 246	com/ironsource/mobilcore/aS:D	Z
    //   10: ifeq +43 -> 53
    //   13: aload_0
    //   14: getfield 249	com/ironsource/mobilcore/aS:E	Z
    //   17: istore 4
    //   19: iload 4
    //   21: ifeq +32 -> 53
    //   24: aload_0
    //   25: invokespecial 290	com/ironsource/mobilcore/aS:s	()Z
    //   28: istore 4
    //   30: iload 4
    //   32: ifne +24 -> 56
    //   35: aload_0
    //   36: ldc_w 292
    //   39: invokevirtual 133	com/ironsource/mobilcore/aS:a	(Ljava/lang/String;)V
    //   42: aload_0
    //   43: getfield 108	com/ironsource/mobilcore/aS:H	Z
    //   46: istore 4
    //   48: iload 4
    //   50: ifne +233 -> 283
    //   53: aload_0
    //   54: monitorexit
    //   55: return
    //   56: iload_3
    //   57: istore_1
    //   58: invokestatic 297	com/ironsource/mobilcore/w:a	()Lcom/ironsource/mobilcore/w;
    //   61: ldc_w 299
    //   64: aload_0
    //   65: getfield 301	com/ironsource/mobilcore/aS:f	Lorg/json/JSONObject;
    //   68: invokevirtual 302	org/json/JSONObject:toString	()Ljava/lang/String;
    //   71: invokevirtual 303	com/ironsource/mobilcore/w:a	(Ljava/lang/String;Ljava/lang/String;)V
    //   74: iload_3
    //   75: istore_1
    //   76: aload_0
    //   77: aload_0
    //   78: getfield 301	com/ironsource/mobilcore/aS:f	Lorg/json/JSONObject;
    //   81: putfield 211	com/ironsource/mobilcore/aS:B	Lorg/json/JSONObject;
    //   84: aload_0
    //   85: ldc_w 292
    //   88: invokevirtual 133	com/ironsource/mobilcore/aS:a	(Ljava/lang/String;)V
    //   91: aload_0
    //   92: getfield 108	com/ironsource/mobilcore/aS:H	Z
    //   95: ifne +3 -> 98
    //   98: aload_0
    //   99: getstatic 305	com/ironsource/mobilcore/aS$b:b	Lcom/ironsource/mobilcore/aS$b;
    //   102: putfield 101	com/ironsource/mobilcore/aS:A	Lcom/ironsource/mobilcore/aS$b;
    //   105: aload_0
    //   106: iconst_0
    //   107: putfield 246	com/ironsource/mobilcore/aS:D	Z
    //   110: aload_0
    //   111: iconst_0
    //   112: putfield 249	com/ironsource/mobilcore/aS:E	Z
    //   115: invokestatic 275	com/ironsource/mobilcore/MobileCore:b	()Landroid/os/Handler;
    //   118: new 20	com/ironsource/mobilcore/aS$6
    //   121: dup
    //   122: aload_0
    //   123: invokespecial 306	com/ironsource/mobilcore/aS$6:<init>	(Lcom/ironsource/mobilcore/aS;)V
    //   126: invokevirtual 282	android/os/Handler:post	(Ljava/lang/Runnable;)Z
    //   129: pop
    //   130: aload_0
    //   131: iconst_1
    //   132: putfield 108	com/ironsource/mobilcore/aS:H	Z
    //   135: goto -82 -> 53
    //   138: astore 5
    //   140: aload_0
    //   141: monitorexit
    //   142: aload 5
    //   144: athrow
    //   145: astore 5
    //   147: iconst_0
    //   148: istore_2
    //   149: iload_2
    //   150: istore_1
    //   151: aload_0
    //   152: getfield 174	com/ironsource/mobilcore/aS:a	Landroid/content/Context;
    //   155: aload_0
    //   156: invokevirtual 312	java/lang/Object:getClass	()Ljava/lang/Class;
    //   159: invokevirtual 317	java/lang/Class:getName	()Ljava/lang/String;
    //   162: aload 5
    //   164: invokestatic 322	com/ironsource/mobilcore/aE:a	(Landroid/content/Context;Ljava/lang/String;Ljava/lang/Exception;)V
    //   167: aload_0
    //   168: ldc_w 292
    //   171: invokevirtual 133	com/ironsource/mobilcore/aS:a	(Ljava/lang/String;)V
    //   174: aload_0
    //   175: getfield 108	com/ironsource/mobilcore/aS:H	Z
    //   178: ifne +7 -> 185
    //   181: iload_2
    //   182: ifeq -129 -> 53
    //   185: aload_0
    //   186: getstatic 305	com/ironsource/mobilcore/aS$b:b	Lcom/ironsource/mobilcore/aS$b;
    //   189: putfield 101	com/ironsource/mobilcore/aS:A	Lcom/ironsource/mobilcore/aS$b;
    //   192: aload_0
    //   193: iconst_0
    //   194: putfield 246	com/ironsource/mobilcore/aS:D	Z
    //   197: aload_0
    //   198: iconst_0
    //   199: putfield 249	com/ironsource/mobilcore/aS:E	Z
    //   202: invokestatic 275	com/ironsource/mobilcore/MobileCore:b	()Landroid/os/Handler;
    //   205: new 20	com/ironsource/mobilcore/aS$6
    //   208: dup
    //   209: aload_0
    //   210: invokespecial 306	com/ironsource/mobilcore/aS$6:<init>	(Lcom/ironsource/mobilcore/aS;)V
    //   213: invokevirtual 282	android/os/Handler:post	(Ljava/lang/Runnable;)Z
    //   216: pop
    //   217: aload_0
    //   218: iconst_1
    //   219: putfield 108	com/ironsource/mobilcore/aS:H	Z
    //   222: goto -169 -> 53
    //   225: aload_0
    //   226: ldc_w 292
    //   229: invokevirtual 133	com/ironsource/mobilcore/aS:a	(Ljava/lang/String;)V
    //   232: aload_0
    //   233: getfield 108	com/ironsource/mobilcore/aS:H	Z
    //   236: ifne +7 -> 243
    //   239: iload_1
    //   240: ifeq +40 -> 280
    //   243: aload_0
    //   244: getstatic 305	com/ironsource/mobilcore/aS$b:b	Lcom/ironsource/mobilcore/aS$b;
    //   247: putfield 101	com/ironsource/mobilcore/aS:A	Lcom/ironsource/mobilcore/aS$b;
    //   250: aload_0
    //   251: iconst_0
    //   252: putfield 246	com/ironsource/mobilcore/aS:D	Z
    //   255: aload_0
    //   256: iconst_0
    //   257: putfield 249	com/ironsource/mobilcore/aS:E	Z
    //   260: invokestatic 275	com/ironsource/mobilcore/MobileCore:b	()Landroid/os/Handler;
    //   263: new 20	com/ironsource/mobilcore/aS$6
    //   266: dup
    //   267: aload_0
    //   268: invokespecial 306	com/ironsource/mobilcore/aS$6:<init>	(Lcom/ironsource/mobilcore/aS;)V
    //   271: invokevirtual 282	android/os/Handler:post	(Ljava/lang/Runnable;)Z
    //   274: pop
    //   275: aload_0
    //   276: iconst_1
    //   277: putfield 108	com/ironsource/mobilcore/aS:H	Z
    //   280: aload 5
    //   282: athrow
    //   283: aload_0
    //   284: getstatic 305	com/ironsource/mobilcore/aS$b:b	Lcom/ironsource/mobilcore/aS$b;
    //   287: putfield 101	com/ironsource/mobilcore/aS:A	Lcom/ironsource/mobilcore/aS$b;
    //   290: aload_0
    //   291: iconst_0
    //   292: putfield 246	com/ironsource/mobilcore/aS:D	Z
    //   295: aload_0
    //   296: iconst_0
    //   297: putfield 249	com/ironsource/mobilcore/aS:E	Z
    //   300: invokestatic 275	com/ironsource/mobilcore/MobileCore:b	()Landroid/os/Handler;
    //   303: new 20	com/ironsource/mobilcore/aS$6
    //   306: dup
    //   307: aload_0
    //   308: invokespecial 306	com/ironsource/mobilcore/aS$6:<init>	(Lcom/ironsource/mobilcore/aS;)V
    //   311: invokevirtual 282	android/os/Handler:post	(Ljava/lang/Runnable;)Z
    //   314: pop
    //   315: aload_0
    //   316: iconst_1
    //   317: putfield 108	com/ironsource/mobilcore/aS:H	Z
    //   320: goto -267 -> 53
    //   323: astore 5
    //   325: goto -100 -> 225
    //   328: astore 5
    //   330: goto -181 -> 149
    //   333: astore 5
    //   335: iconst_0
    //   336: istore_1
    //   337: goto -112 -> 225
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	340	0	this	aS
    //   57	280	1	i1	int
    //   3	179	2	i2	int
    //   1	74	3	i3	int
    //   17	32	4	bool	boolean
    //   138	5	5	localObject1	Object
    //   145	136	5	localException1	Exception
    //   323	1	5	localObject2	Object
    //   328	1	5	localException2	Exception
    //   333	1	5	localObject3	Object
    // Exception table:
    //   from	to	target	type
    //   6	19	138	finally
    //   35	48	138	finally
    //   84	98	138	finally
    //   98	135	138	finally
    //   167	181	138	finally
    //   185	222	138	finally
    //   225	239	138	finally
    //   243	280	138	finally
    //   280	283	138	finally
    //   283	320	138	finally
    //   24	30	145	java/lang/Exception
    //   58	74	323	finally
    //   76	84	323	finally
    //   151	167	323	finally
    //   58	74	328	java/lang/Exception
    //   76	84	328	java/lang/Exception
    //   24	30	333	finally
  }
  
  private boolean s()
  {
    String str1 = "";
    Object localObject3;
    int i1;
    Object localObject2;
    String str2;
    long l1;
    boolean bool1;
    boolean bool2;
    try
    {
      localObject3 = new JSONObject(this.i.c());
      Object localObject4 = aO.a((JSONObject)localObject3, ((JSONObject)localObject3).getString("use-animation"));
      i1 = ((JSONObject)localObject4).getInt("animation-fps");
      localObject2 = ((JSONObject)localObject4).getString("id");
      str2 = ((JSONObject)localObject4).getString("filename").replace(".zip", "");
      l1 = ((JSONObject)localObject4).optLong("auto-show-delay", -1L);
      bool1 = ((JSONObject)localObject3).optBoolean("market-direct", false);
      bool2 = ((JSONObject)localObject4).optBoolean("reverse_anim", false);
      localObject3 = aO.a((JSONObject)localObject3, "handle-close");
      if (localObject3 != null) {
        str1 = ((JSONObject)localObject3).optString("filename", "");
      }
      localObject3 = new File(this.d + "/" + str2);
      localObject4 = ((File)localObject3).listFiles();
      if ((localObject4 == null) || (localObject4.length <= 0)) {
        return false;
      }
    }
    catch (Exception localException1)
    {
      aE.a(this.a, getClass().getName(), localException1);
      A.a("Stickeez: Error switching animation", 3);
      return false;
    }
    this.b = this.i.a();
    this.c = this.i.b();
    this.y = l1;
    this.m = bool2;
    this.l = bool1;
    this.h = localException1;
    this.j = i1;
    this.k = str2;
    this.c = (this.c + "_" + (String)localObject2);
    a("cleaning animation!!! state is: " + this.A.name());
    j.b(this.s);
    j.b(this.t);
    j.b(this.u);
    Object localObject1 = ((File)localObject3).getAbsolutePath();
    a("setupAnimations");
    try
    {
      this.s = j.a((String)localObject1 + "/idle", this.j);
      this.s.setOneShot(false);
      this.t = j.a((String)localObject1 + "/up", this.j);
      this.t.setOneShot(true);
      this.u = j.a((String)localObject1 + "/out", this.j);
      this.u.setOneShot(true);
      if (Build.VERSION.SDK_INT <= 10) {
        this.t.start();
      }
      localObject2 = BitmapFactory.decodeFile((String)localObject1 + "/arrow.png");
      this.w = new BitmapDrawable(MobileCore.c().getResources(), (Bitmap)localObject2);
      localObject2 = aE.c();
      localObject1 = BitmapFactory.decodeFile((String)localObject1 + "/drawable-" + (String)localObject2 + "/bg.9.png");
      localObject2 = ((Bitmap)localObject1).getNinePatchChunk();
      if (NinePatch.isNinePatchChunk((byte[])localObject2)) {
        this.v = new NinePatchDrawable(MobileCore.c().getResources(), (Bitmap)localObject1, (byte[])localObject2, new Rect(), null);
      }
    }
    catch (Exception localException2)
    {
      for (;;)
      {
        localException2.printStackTrace();
      }
    }
    return true;
  }
  
  public final void a(final Activity paramActivity)
  {
    for (;;)
    {
      try
      {
        if (!aK.b(MobileCore.c()))
        {
          b("show", "Stickeez is not ready, no internet connection detected.");
          return;
        }
        if (!i())
        {
          b("show", "Stickeez is not ready.");
          continue;
        }
        b("show", "Stickeez is ready. Trying to show...");
      }
      finally {}
      this.A = b.c;
      this.G = paramActivity;
      final ViewGroup localViewGroup = (ViewGroup)paramActivity.getWindow().getDecorView();
      this.x = new aR.b()
      {
        private boolean c = false;
        
        public final void a()
        {
          aS.this.a("onHandleClick");
          aS.a(aS.this, aS.b.d);
          long l = System.currentTimeMillis() - aS.f(aS.this);
          Object localObject = new JSONObject();
          try
          {
            ((JSONObject)localObject).put("timeSinceShow", l);
            localObject = aE.a(MobileCore.c(), aS.this.b + "_handle", aS.this.c, aJ.a.e, null, null);
            ((Intent)localObject).putExtra("com.ironsource.mobilecore.MobileCoreReport_extra_timer", l);
            aE.a(MobileCore.c(), (Intent)localObject);
            return;
          }
          catch (JSONException localJSONException)
          {
            for (;;) {}
          }
        }
        
        public final void a(JSONObject paramAnonymousJSONObject)
        {
          aS.this.a(paramActivity, paramAnonymousJSONObject, aS.this.c);
        }
        
        public final void b()
        {
          if (this.c) {
            return;
          }
          this.c = true;
          aE.a(MobileCore.c(), aS.this.b, aS.this.c, aJ.a.c, null, null);
          aS.e(aS.this);
        }
        
        public final void b(final JSONObject paramAnonymousJSONObject)
        {
          aE.a(new AsyncTask() {});
        }
        
        public final void c()
        {
          aS.this.m();
        }
      };
      MobileCore.b().post(new Runnable()
      {
        public final void run()
        {
          aS.a(aS.this, paramActivity);
          localViewGroup.addView(aS.g(aS.this));
          aS.this.a(aS.a.b);
        }
      });
    }
  }
  
  protected final void a(Activity paramActivity, JSONObject paramJSONObject, String paramString)
  {
    a("runOffer", "is called");
    if (paramJSONObject.optString("click") != null)
    {
      a("runOffer", "flowNameToReport=" + paramString);
      q();
      a(paramActivity, paramJSONObject, null);
    }
  }
  
  public final void a(OnReadyListener paramOnReadyListener)
  {
    try
    {
      this.C = paramOnReadyListener;
      return;
    }
    finally
    {
      paramOnReadyListener = finally;
      throw paramOnReadyListener;
    }
  }
  
  protected final boolean a()
  {
    return this.A == null;
  }
  
  protected final l.a b()
  {
    return new l.a("stickeez", "STICKEEZ_assets", "stickeez-feed", a.a, new d());
  }
  
  protected final void d()
  {
    super.d();
    this.A = b.a;
    a("Stickeez", "initMembers");
    this.r = new WebView(this.a);
    aE.a(this.r, null);
    this.B = w.a().b("stickeez-feed");
  }
  
  public final boolean i()
  {
    return this.A == b.b;
  }
  
  public final boolean j()
  {
    return this.A == b.d;
  }
  
  public final boolean k()
  {
    return this.A == b.c;
  }
  
  protected final void l()
  {
    a("onMarketDirectClick");
    try
    {
      Object localObject = this.B.optJSONArray("ads");
      localObject = ((JSONArray)localObject).getJSONObject(new Random().nextInt(((JSONArray)localObject).length()));
      a("runOffer", "Choose Offer Entity=" + localObject);
      a(this.G, (JSONObject)localObject, this.c);
      return;
    }
    catch (JSONException localJSONException)
    {
      localJSONException.printStackTrace();
    }
  }
  
  public final void m()
  {
    if ((this.A == b.d) || (this.A == b.c)) {}
    for (int i1 = 1;; i1 = 0)
    {
      if (i1 != 0)
      {
        aE.a(MobileCore.c(), this.b + "_handle", this.c, aJ.a.c, null, null);
        q();
      }
      return;
    }
  }
  
  public final boolean n()
  {
    return !TextUtils.isEmpty(this.h);
  }
  
  public final boolean o()
  {
    return this.l;
  }
  
  public final boolean p()
  {
    return this.m;
  }
  
  protected static enum a
    implements l.c
  {
    private String c;
    
    private a(String paramString)
    {
      this.c = paramString;
    }
    
    public final String a()
    {
      return this.c;
    }
  }
  
  public static enum b
  {
    private b() {}
  }
  
  final class c
    extends aE.e
  {
    c() {}
    
    public final void a(boolean paramBoolean)
    {
      aS.a(aS.this, paramBoolean);
      aS.a(aS.this);
    }
  }
  
  private final class d
    implements aF.a
  {
    private Integer b;
    
    public d() {}
    
    public final String getInstalledAppPackages()
    {
      return aE.b();
    }
    
    public final String getMobileParams()
    {
      return aE.k(MobileCore.c());
    }
    
    public final double getScreenSize()
    {
      return aE.e(MobileCore.c());
    }
    
    public final void loadResources(String paramString1, String paramString2, String paramString3)
    {
      aS.this.a("JSReportingBridge | loadResources", "flowType:" + paramString1 + " , flowName:" + paramString2 + " , configJsonStr=" + paramString3);
      aS.a(aS.this, new aS.f(aS.this, paramString1, paramString2, paramString3));
      int i = paramString3.hashCode();
      if ((this.b == null) || (this.b.intValue() != i))
      {
        aS.this.a("JSReportingBridge | loadResources", "New stickee config. parse and hanlde");
        this.b = Integer.valueOf(i);
        try
        {
          paramString1 = new JSONObject(paramString3);
          if (TextUtils.isEmpty(paramString1.optString("use-animation"))) {
            return;
          }
          aO.a(paramString1, aS.this.d, aS.this.d, aS.this.e);
          return;
        }
        catch (Exception paramString1)
        {
          aE.a(MobileCore.c(), getClass().getName(), paramString1);
          return;
        }
      }
      if (this.b.intValue() == i)
      {
        aS.this.a("JSReportingBridge | loadResources", "Got the same stickee. we are ready.");
        aS.b(aS.this, true);
        aS.a(aS.this);
      }
    }
    
    public final void openReportOffers(String paramString1, String paramString2)
    {
      try
      {
        paramString2 = aN.a(new JSONArray(paramString2));
        aE.a(MobileCore.c(), aS.this.b, aS.this.b, aJ.a.a(paramString1), "", paramString2);
        return;
      }
      catch (Exception paramString1)
      {
        paramString1.printStackTrace();
      }
    }
    
    public final void processFeed(String paramString)
    {
      try
      {
        aS.this.a("JSFlowBridge , processFeed, feedStr=" + paramString);
        paramString = new JSONObject(paramString);
        aS.this.f = paramString;
        w.a().a(paramString, new aS.c(aS.this));
        return;
      }
      catch (Exception paramString)
      {
        aE.a(aS.this.a, "StickeezManager", paramString);
      }
    }
    
    public final void reportFeedRequestError()
    {
      aE.b(aS.this.a, aS.class.getCanonicalName(), "Failed to bring stickeez feed");
      aS.this.b("reportFeedRequestError", "Failed to bring stickeez feed");
    }
    
    public final void setDataToReportOnFeed(String paramString)
    {
      aS.a(aS.this, paramString);
    }
    
    public final void showStickee()
    {
      MobileCore.b().post(new Runnable()
      {
        public final void run()
        {
          aS.g(aS.this).b();
          if (aS.k(aS.this) > -1L)
          {
            aS.a(aS.this, new Runnable()
            {
              public final void run()
              {
                if (aS.c(aS.this) == aS.b.c) {
                  aS.g(aS.this).d();
                }
                aS.a(aS.this, null);
              }
            });
            MobileCore.b().postDelayed(aS.h(aS.this), aS.k(aS.this));
          }
        }
      });
      aS.a(aS.this, System.currentTimeMillis());
      aE.a(MobileCore.c(), aS.this.b + "_handle", aS.this.c, aJ.a.b, null, null);
    }
  }
  
  final class e
  {
    e() {}
  }
  
  private final class f
  {
    private String b;
    private String c;
    private String d;
    
    public f(String paramString1, String paramString2, String paramString3)
    {
      this.c = paramString2;
      this.b = paramString1;
      this.d = paramString3;
    }
    
    public final String a()
    {
      return this.b;
    }
    
    public final String b()
    {
      return this.c;
    }
    
    public final String c()
    {
      return this.d;
    }
  }
}
