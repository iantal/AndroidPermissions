package com.unicom.wounipaysms.duandai;

import android.app.ProgressDialog;
import android.content.Context;
import android.os.Bundle;
import android.text.TextUtils;
import com.unicom.wounipaysms.bean.NoticeDialogBean;
import com.unicom.wounipaysms.delegate.RequestDelegate;
import com.unicom.wounipaysms.dialog.NoticeDialog;
import com.unicom.wounipaysms.dialog.OnBackKeyListener;

public class WoUniPay
{
  public static final int CANCEL_PAY = 9991;
  public static final int CPID_LENGTH_ERROR = 9997;
  public static final int ERROR_PARTNER_INFO = 9994;
  public static final int GET_ORDERID_FAILED = 9995;
  public static final int NON_UNICOM_CARD = 9992;
  public static final int PARSE_ERROR = 9981;
  public static final int REQUEST_MONEY_FAILED = 9999;
  public static final int REQUEST_PARAM_ERROR = 9996;
  public static final int SEND_SMS_FAILED = 9993;
  private static String TAG = "WoUniPay";
  public static final int UNKNOWN_ERROR = 9998;
  public static String baoyueFeeType = "13";
  public static String dianboFeeType = "1";
  private static WoUniPay instance;
  private static Context mContext;
  public static String tuidingFeeType = "14";
  private ProgressDialog dialog;
  private boolean hasSendOrderSMS;
  private LixianSMS lixianSMS;
  private Bundle mBundle;
  private NoticeDialog noticeDialog;
  private RequestDelegate reqDelegate;
  
  public WoUniPay() {}
  
  public static WoUniPay getInstance(Context paramContext)
  {
    mContext = paramContext;
    if (instance == null) {
      instance = new WoUniPay();
    }
    return instance;
  }
  
  private void sendSMSCallBack(boolean paramBoolean, WoUniPay.OrderType paramOrderType, int paramInt, String paramString)
  {
    if (paramBoolean)
    {
      if (WoUniPay.OrderType.SMS == paramOrderType)
      {
        this.reqDelegate.requestSuccessed("短信发送成功");
        return;
      }
      this.reqDelegate.requestSuccessed("支付成功");
      return;
    }
    if (WoUniPay.OrderType.SMS == paramOrderType)
    {
      if (2237 == paramInt)
      {
        this.reqDelegate.requestFailed(2237, "短信发送超时");
        return;
      }
      this.reqDelegate.requestFailed(9993, "短信发送失败");
      return;
    }
    this.reqDelegate.requestFailed(paramInt, paramString);
  }
  
  public void dismissProgressDialog()
  {
    if (this.dialog != null)
    {
      this.dialog.dismiss();
      this.dialog = null;
    }
  }
  
  public NoticeDialog getNoticeDialog()
  {
    return this.noticeDialog;
  }
  
  public ProgressDialog getProgressDialog()
  {
    return this.dialog;
  }
  
  public void payAsDuanDai(Bundle paramBundle, RequestDelegate paramRequestDelegate)
  {
    this.mBundle = paramBundle;
    this.reqDelegate = paramRequestDelegate;
    this.lixianSMS = new LixianSMS(this.mBundle, paramRequestDelegate, mContext);
    this.hasSendOrderSMS = true;
  }
  
  public void sendConfirmSMS()
  {
    if ((this.hasSendOrderSMS) && (this.lixianSMS != null))
    {
      this.hasSendOrderSMS = false;
      this.lixianSMS.sendConfirmSMSToServer();
    }
    while (this.reqDelegate == null) {
      return;
    }
    this.reqDelegate.requestFailed(2236, "订购短信尚未发送，不能发送验证短信");
  }
  
  public void setRestAddress(String paramString)
  {
    com.unicom.wounipaysms.tools.MultimodeConfig.REST_URL = paramString;
  }
  
  public void setServicesAddress(String paramString, int paramInt)
  {
    com.unicom.wounipaysms.tools.MultimodeConfig.URL = "http://" + paramString + ":" + paramInt + "/servicedata.do?";
  }
  
  public void showNoticeDialog(boolean paramBoolean, int paramInt, String paramString)
  {
    NoticeDialogBean localNoticeDialogBean = new NoticeDialogBean();
    localNoticeDialogBean.setIsSuccess(paramBoolean);
    if (TextUtils.equals(this.mBundle.getString("feetype"), tuidingFeeType)) {
      localNoticeDialogBean.setPayIndex(2);
    }
    for (;;)
    {
      localNoticeDialogBean.setSubject(paramString);
      this.noticeDialog = new NoticeDialog(mContext, localNoticeDialogBean, new WoUniPay.SMSNoticeDialogListener(this, paramBoolean, paramInt));
      this.noticeDialog.show();
      this.noticeDialog.setOnKeyListener(new OnBackKeyListener());
      this.noticeDialog.setCanceledOnTouchOutside(false);
      sendSMSCallBack(paramBoolean, WoUniPay.OrderType.SMS, paramInt, "");
      return;
      localNoticeDialogBean.setPayIndex(1);
    }
  }
  
  public void showOrderBackNoticeDialog(boolean paramBoolean, int paramInt, String paramString1, String paramString2)
  {
    NoticeDialogBean localNoticeDialogBean = new NoticeDialogBean();
    localNoticeDialogBean.setIsSuccess(paramBoolean);
    if (TextUtils.equals(this.mBundle.getString("feetype"), tuidingFeeType)) {
      localNoticeDialogBean.setPayIndex(2);
    }
    for (;;)
    {
      localNoticeDialogBean.setSubject(paramString1);
      this.noticeDialog = new NoticeDialog(mContext, localNoticeDialogBean, new WoUniPay.SMSNoticeDialogListener(this, paramBoolean, paramInt));
      this.noticeDialog.show();
      this.noticeDialog.setOnKeyListener(new OnBackKeyListener());
      this.noticeDialog.setCanceledOnTouchOutside(false);
      sendSMSCallBack(paramBoolean, WoUniPay.OrderType.HTTP, paramInt, paramString2);
      return;
      localNoticeDialogBean.setPayIndex(1);
    }
  }
  
  public void showProgressDialog(String paramString)
  {
    if (this.dialog == null)
    {
      this.dialog = new ProgressDialog(mContext);
      this.dialog.setMessage(paramString);
      this.dialog.setIndeterminate(true);
      this.dialog.show();
      this.dialog.setOnKeyListener(new OnBackKeyListener());
      this.dialog.setCanceledOnTouchOutside(false);
    }
  }
}
