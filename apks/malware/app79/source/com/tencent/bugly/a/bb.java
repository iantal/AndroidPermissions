package com.tencent.bugly.a;

import android.content.Context;
import com.tencent.bugly.crashreport.common.info.c;
import com.tencent.bugly.crashreport.common.info.e;
import com.tencent.bugly.crashreport.common.strategy.StrategyBean;
import com.tencent.bugly.crashreport.common.strategy.f;
import java.net.URLEncoder;
import java.util.HashMap;
import java.util.Map;

public class bb
  implements au, Runnable
{
  private final Context a;
  private final t b;
  private final c c;
  protected int d = 0;
  protected long e = 0L;
  protected long f = 0L;
  private final f g;
  private final as h;
  private final av i;
  
  public bb(Context paramContext, t paramT, c paramC, f paramF, as paramAs, av paramAv)
  {
    this.a = paramContext;
    this.c = paramC;
    this.b = paramT;
    this.g = paramF;
    this.h = paramAs;
    this.i = paramAv;
  }
  
  protected void a()
  {
    this.d = 0;
    this.e = 0L;
    this.f = 0L;
  }
  
  protected void a(int paramInt, String paramString)
  {
    bf.e("try upload fail! %d %s", new Object[] { Integer.valueOf(this.b.g), paramString });
  }
  
  public void a(long paramLong)
  {
    this.f += paramLong;
  }
  
  public void a(String paramString1, long paramLong, String paramString2)
  {
    this.d += 1;
    this.e += paramLong;
  }
  
  protected void a(boolean paramBoolean, int paramInt, String paramString)
  {
    if (paramBoolean) {
      bf.a("upload success! %d", new Object[] { Integer.valueOf(this.b.g) });
    }
    for (;;)
    {
      if (this.e + this.f > 0L)
      {
        long l1 = this.i.b();
        long l2 = this.e;
        long l3 = this.f;
        this.i.a(l1 + l2 + l3);
      }
      return;
      bf.e("upload fail! %d %d %s", new Object[] { Integer.valueOf(this.b.g), Integer.valueOf(paramInt), paramString });
      f.a().b(this.b.g + " end " + paramInt + " " + paramString);
    }
  }
  
  protected boolean a(u paramU, c paramC, f paramF)
  {
    if (paramU == null)
    {
      bf.d("resp == null!", new Object[0]);
      return false;
    }
    if (paramU.a != 0)
    {
      bf.e("resp result error %d", new Object[] { Byte.valueOf(paramU.a) });
      return false;
    }
    bf.c("sync remote server time %s , %d", new Object[] { paramU.d, Long.valueOf(paramC.n()) });
    paramC.f(paramU.d);
    paramC.a(paramC.n());
    boolean bool1;
    boolean bool2;
    boolean bool3;
    if (paramU.b == 510)
    {
      if (paramU.c == null)
      {
        bf.e("remote data is miss! %d", new Object[] { Integer.valueOf(paramU.b) });
        return false;
      }
      paramC = ar.a(paramU.c);
      if (paramC == null)
      {
        bf.e("remote data is error! %d", new Object[] { Integer.valueOf(paramU.b) });
        return false;
      }
      bool1 = paramC.a;
      bool2 = paramC.c;
      bool3 = paramC.b;
      if (paramC.g != null) {
        break label238;
      }
    }
    label238:
    for (int j = -1;; j = paramC.g.size())
    {
      bf.c("en:%b qu:%b uin:%b vm:%d", new Object[] { Boolean.valueOf(bool1), Boolean.valueOf(bool2), Boolean.valueOf(bool3), Integer.valueOf(j) });
      paramF.a(paramC);
      return true;
    }
  }
  
  public void run()
  {
    Object localObject1 = null;
    int m = 0;
    long l = this.i.b();
    if (l >= 2097152L) {
      bf.e("up too much wait to next time ! %d %d ", new Object[] { Long.valueOf(l), Long.valueOf(2097152L) });
    }
    Object localObject2;
    byte[] arrayOfByte1;
    do
    {
      return;
      for (;;)
      {
        try
        {
          if (this.b == null)
          {
            bf.c("do up task %d", new Object[] { localObject1 });
            a();
            if ((this.a != null) && (this.b != null) && (this.c != null) && (this.g != null) && (this.h != null)) {
              break;
            }
            bf.e("up task args error! " + this.a + "|" + this.b + "|" + this.c + "|" + this.g + "|" + this.h, new Object[0]);
            a(false, 0, "upload fail, illegal access error! ");
            return;
          }
        }
        catch (Throwable localThrowable)
        {
          if (!bf.a(localThrowable)) {
            localThrowable.printStackTrace();
          }
          localObject2 = localThrowable.getClass().getName() + ":" + localThrowable.getMessage();
          f.a().b(this.b.g + " throw " + (String)localObject2);
          return;
        }
        localObject2 = Integer.valueOf(this.b.g);
      }
      localObject2 = this.g.d();
      arrayOfByte1 = ar.a(this.b);
    } while (arrayOfByte1 == null);
    HashMap localHashMap = new HashMap();
    localHashMap.put("pid", URLEncoder.encode(this.c.d(), "utf-8"));
    localHashMap.put("bid", URLEncoder.encode(this.c.f(), "utf-8"));
    localHashMap.put("pver", URLEncoder.encode(this.c.e(), "utf-8"));
    int j = 0;
    int k = 0;
    while (k < 5)
    {
      if (k != 0) {
        d.a(60000L);
      }
      k += 1;
      if (e.e(this.a) == null)
      {
        a(0, "Network is not availiable!");
        j = 0;
      }
      else
      {
        bf.c("send %d", new Object[] { Integer.valueOf(arrayOfByte1.length) });
        byte[] arrayOfByte2 = this.h.a(((StrategyBean)localObject2).m, arrayOfByte1, this, localHashMap);
        if (arrayOfByte2 == null)
        {
          a(1, "upload fail, no response! ");
          j = 1;
        }
        else
        {
          bf.c("recv %d", new Object[] { Integer.valueOf(arrayOfByte2.length) });
          localObject2 = ar.a(arrayOfByte2, (StrategyBean)localObject2);
          if (localObject2 == null)
          {
            a(false, 1, "upload fail, resp error! ");
            return;
          }
          k = ((u)localObject2).b;
          if (((u)localObject2).c == null) {}
          for (j = m;; j = ((u)localObject2).c.length)
          {
            bf.c("response %d %d", new Object[] { Integer.valueOf(k), Integer.valueOf(j) });
            if (a((u)localObject2, this.c, this.g)) {
              break;
            }
            a(false, 2, "upload fail, resp error! ");
            return;
          }
          a(true, 2, null);
          return;
        }
      }
    }
    a(false, j, "try OT Fail! ");
  }
}
