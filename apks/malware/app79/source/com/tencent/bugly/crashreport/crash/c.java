package com.tencent.bugly.crashreport.crash;

import android.content.Context;
import com.tencent.bugly.a.ao;
import com.tencent.bugly.a.av;
import com.tencent.bugly.a.bf;
import com.tencent.bugly.a.d;
import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;

public class c
{
  protected final Context a;
  protected final av b;
  protected final ao c;
  protected final com.tencent.bugly.crashreport.common.strategy.f d;
  
  public c(Context paramContext, av paramAv, ao paramAo, com.tencent.bugly.crashreport.common.strategy.f paramF, com.tencent.bugly.crashreport.b paramB)
  {
    this.a = paramContext;
    this.b = paramAv;
    this.c = paramAo;
    this.d = paramF;
  }
  
  protected CrashDetailBean a(List<b> paramList, CrashDetailBean paramCrashDetailBean)
  {
    if ((paramList == null) || (paramList.size() == 0))
    {
      paramList = paramCrashDetailBean;
      return paramList;
    }
    Object localObject1 = null;
    Object localObject2 = new ArrayList(10);
    Object localObject3 = paramList.iterator();
    b localB;
    while (((Iterator)localObject3).hasNext())
    {
      localB = (b)((Iterator)localObject3).next();
      if (localB.e) {
        ((List)localObject2).add(localB);
      }
    }
    if (((List)localObject2).size() > 0)
    {
      localObject3 = this.c.b((List)localObject2);
      if ((localObject3 != null) && (((List)localObject3).size() > 0))
      {
        Collections.sort((List)localObject3);
        int i = 0;
        if (i < ((List)localObject3).size())
        {
          localObject2 = (CrashDetailBean)((List)localObject3).get(i);
          if (i == 0) {
            localObject1 = localObject2;
          }
          label157:
          do
          {
            do
            {
              i += 1;
              break;
            } while (((CrashDetailBean)localObject2).s == null);
            localObject2 = ((CrashDetailBean)localObject2).s.split("\n");
          } while (localObject2 == null);
          int k = localObject2.length;
          int j = 0;
          while (j < k)
          {
            localB = localObject2[j];
            if (!((CrashDetailBean)localObject1).s.contains("" + localB))
            {
              ((CrashDetailBean)localObject1).t += 1;
              ((CrashDetailBean)localObject1).s = (((CrashDetailBean)localObject1).s + localB + "\n");
            }
            j += 1;
          }
        }
      }
    }
    for (;;)
    {
      if (localObject1 == null)
      {
        paramCrashDetailBean.j = true;
        paramCrashDetailBean.t = 0;
        paramCrashDetailBean.s = "";
        localObject1 = paramCrashDetailBean;
      }
      for (;;)
      {
        paramList = paramList.iterator();
        while (paramList.hasNext())
        {
          localObject2 = (b)paramList.next();
          if ((!((b)localObject2).e) && (!((b)localObject2).d) && (!((CrashDetailBean)localObject1).s.contains("" + ((b)localObject2).b)))
          {
            ((CrashDetailBean)localObject1).t += 1;
            ((CrashDetailBean)localObject1).s = (((CrashDetailBean)localObject1).s + ((b)localObject2).b + "\n");
          }
        }
        paramList = (List<b>)localObject1;
        if (((CrashDetailBean)localObject1).r == paramCrashDetailBean.r) {
          break;
        }
        paramList = (List<b>)localObject1;
        if (((CrashDetailBean)localObject1).s.contains("" + paramCrashDetailBean.r)) {
          break;
        }
        ((CrashDetailBean)localObject1).t += 1;
        ((CrashDetailBean)localObject1).s = (((CrashDetailBean)localObject1).s + paramCrashDetailBean.r + "\n");
        return localObject1;
      }
      break label157;
      localObject1 = null;
    }
  }
  
  protected List<b> a(List<b> paramList)
  {
    if ((paramList == null) || (paramList.size() == 0)) {
      return null;
    }
    long l = d.b();
    ArrayList localArrayList = new ArrayList();
    paramList = paramList.iterator();
    while (paramList.hasNext())
    {
      b localB = (b)paramList.next();
      if ((localB.d) && (localB.b < l - 86400000L)) {
        localArrayList.add(localB);
      }
    }
    return localArrayList;
  }
  
  public void a(CrashDetailBean paramCrashDetailBean, long paramLong)
  {
    bf.a("try to upload right now", new Object[0]);
    ArrayList localArrayList = new ArrayList();
    localArrayList.add(paramCrashDetailBean);
    this.b.a(localArrayList, this.d, paramLong);
  }
  
  public void a(CrashDetailBean paramCrashDetailBean, com.tencent.bugly.crashreport.b paramB)
  {
    if ((paramCrashDetailBean == null) || (paramB == null))
    {
      bf.d("handle user callback args are null! %s %s", new Object[] { "" + paramCrashDetailBean, "" + paramB });
      label62:
      return;
    }
    for (;;)
    {
      Map.Entry localEntry;
      try
      {
        bf.a("start notify crashHandleCallback!", new Object[0]);
        if (paramCrashDetailBean.b != 0) {
          break label458;
        }
        i = 0;
        switch (paramCrashDetailBean.b)
        {
        case 3: 
          Object localObject = paramB.a(i, paramCrashDetailBean.n, paramCrashDetailBean.o, paramCrashDetailBean.q);
          if ((localObject == null) || (((Map)localObject).size() <= 0)) {
            break label532;
          }
          paramCrashDetailBean.O = new HashMap(((Map)localObject).size());
          Iterator localIterator = ((Map)localObject).entrySet().iterator();
          if (!localIterator.hasNext()) {
            break label532;
          }
          localEntry = (Map.Entry)localIterator.next();
          if (d.a((String)localEntry.getKey())) {
            continue;
          }
          str = (String)localEntry.getKey();
          localObject = str;
          if (str.length() > 100)
          {
            localObject = str.substring(0, 100);
            bf.d("setted key length is over limit %d substring to %s", new Object[] { Integer.valueOf(100), localObject });
          }
          if ((d.a((String)localEntry.getValue())) || (((String)localEntry.getValue()).length() <= 30000)) {
            break label499;
          }
          str = ((String)localEntry.getValue()).substring(((String)localEntry.getValue()).length() - 30000);
          bf.d("setted %s value length is over limit %d substring", new Object[] { localObject, Integer.valueOf(30000) });
          paramCrashDetailBean.O.put(localObject, str);
          bf.a("add setted key %s value size:%d", new Object[] { localObject, Integer.valueOf(str.length()) });
          continue;
          if (bf.a(paramCrashDetailBean)) {
            break label62;
          }
        }
      }
      catch (Throwable paramCrashDetailBean)
      {
        bf.d("crash handle callback somthing wrong! %s", new Object[] { paramCrashDetailBean.getClass().getName() });
      }
      paramCrashDetailBean.printStackTrace();
      return;
      label458:
      int i = 1;
      continue;
      i = 4;
      continue;
      i = 1;
      continue;
      i = 0;
      continue;
      i = 2;
      continue;
      i = 3;
      continue;
      i = 5;
      continue;
      i = 6;
      continue;
      label499:
      String str = "" + (String)localEntry.getValue();
      continue;
      label532:
      bf.a("start notify crashHandleCallback2GetBytes!", new Object[0]);
      paramCrashDetailBean.T = paramB.b(i, paramCrashDetailBean.n, paramCrashDetailBean.o, paramCrashDetailBean.q);
      if (paramCrashDetailBean.T == null) {
        break;
      }
      if (paramCrashDetailBean.T.length > 30000)
      {
        bf.d("extra bytes size %d is over limit %d will drop over part", new Object[] { Integer.valueOf(paramCrashDetailBean.T.length), Integer.valueOf(30000) });
        paramB = new byte['ç”°'];
        i = 0;
        while (i < 30000)
        {
          paramB[i] = paramCrashDetailBean.T[i];
          i += 1;
        }
      }
      bf.a("add extra bytes %d ", new Object[] { Integer.valueOf(paramCrashDetailBean.T.length) });
      return;
    }
  }
  
  public boolean a(CrashDetailBean paramCrashDetailBean)
  {
    this.d.a(paramCrashDetailBean);
    bf.b("[crash] a crash occur, handling...", new Object[0]);
    Object localObject = this.c.c();
    ArrayList localArrayList2 = null;
    ArrayList localArrayList1 = localArrayList2;
    if (localObject != null)
    {
      localArrayList1 = localArrayList2;
      if (((List)localObject).size() > 0)
      {
        localArrayList1 = new ArrayList(10);
        localArrayList2 = new ArrayList(10);
        localArrayList1.addAll(a((List)localObject));
        ((List)localObject).removeAll(localArrayList1);
        localObject = ((List)localObject).iterator();
        int j;
        for (int i = 0; ((Iterator)localObject).hasNext(); i = j)
        {
          b localB = (b)((Iterator)localObject).next();
          j = i;
          if (paramCrashDetailBean.u.equals(localB.c))
          {
            if (localB.e) {
              i = 1;
            }
            localArrayList2.add(localB);
            j = i;
          }
        }
        if ((i != 0) || (localArrayList2.size() + 1 >= 5))
        {
          bf.a("same crash occur too much do merged!", new Object[0]);
          paramCrashDetailBean = a(localArrayList2, paramCrashDetailBean);
          paramCrashDetailBean.a = -1L;
          this.c.b(paramCrashDetailBean);
          localArrayList1.addAll(localArrayList2);
          this.c.c(localArrayList1);
          bf.b("[crash] save crash success. this device crash many times, won't upload crashes immediately", new Object[0]);
          return true;
        }
      }
    }
    this.c.b(paramCrashDetailBean);
    this.c.c(localArrayList1);
    bf.b("[crash] save crash success", new Object[0]);
    com.tencent.bugly.crashreport.biz.f.a().a(paramCrashDetailBean.c);
    return false;
  }
}
