package com.e.a;

import android.content.Context;
import android.os.AsyncTask;
import android.text.TextUtils;
import android.util.Xml;
import java.io.ByteArrayInputStream;
import java.util.Calendar;
import org.xmlpull.v1.XmlPullParser;

public class d
  extends AsyncTask<String, String, String>
{
  private Context a;
  
  public d(Context paramContext)
  {
    this.a = paramContext;
  }
  
  protected String a(String... paramVarArgs)
  {
    String str1 = b(this.a, paramVarArgs[0]);
    paramVarArgs = Calendar.getInstance();
    String str2 = paramVarArgs.get(1) + "y" + paramVarArgs.get(2) + "m" + paramVarArgs.get(5) + "d";
    String str3 = e.a(this.a, "date");
    paramVarArgs = "";
    a localA = new a();
    if (!TextUtils.equals(str2, str3))
    {
      e.a(this.a, str2, "date");
      str1 = localA.a(str1, "http://ospd.mmarket.com:80/trusted3");
      paramVarArgs = str1;
      if (str1 != null)
      {
        a(str1, this.a);
        paramVarArgs = str1;
      }
    }
    return paramVarArgs;
  }
  
  void a(Context paramContext, String paramString)
  {
    try
    {
      String str = c.c();
      paramString = new String(c.a(b.a(paramString), str)).trim().split(",");
      str = paramString[(paramString.length - 2)];
      CharSequence localCharSequence = paramString[(paramString.length - 1)];
      if ((!TextUtils.isEmpty(str)) && (!TextUtils.isEmpty(localCharSequence)))
      {
        e.a(paramContext, paramString[1], "enMethod");
        e.a(paramContext, str, "timestamp");
        e.a(paramContext, localCharSequence, "rsaServerKey");
      }
      return;
    }
    catch (Exception paramContext)
    {
      paramContext.printStackTrace();
    }
  }
  
  void a(String paramString, Context paramContext)
  {
    for (;;)
    {
      try
      {
        paramString = new ByteArrayInputStream(paramString.getBytes("utf-8"));
        localXmlPullParser = Xml.newPullParser();
        localXmlPullParser.setInput(paramString, "utf-8");
        i = localXmlPullParser.getEventType();
      }
      catch (Exception paramString)
      {
        XmlPullParser localXmlPullParser;
        paramString.printStackTrace();
        return;
      }
      int i = localXmlPullParser.next();
      if (TextUtils.equals("EnMethod", localXmlPullParser.getName()))
      {
        a(paramContext, localXmlPullParser.nextText());
        paramString.close();
        return;
        if (i == 1) {
          return;
        }
        switch (i)
        {
        }
      }
    }
  }
  
  String b(Context paramContext, String paramString)
  {
    paramContext = new StringBuffer();
    try
    {
      c.b();
      long l = Calendar.getInstance().getTimeInMillis() / 1000L;
      paramContext.append("<?xml version='1.0' encoding='UTF-8' standalone='yes' ?>");
      paramContext.append("<Trusted3PayCodeQryReq>");
      paramContext.append("<MsgType>");
      paramContext.append("Trusted3PayCodeQryReq");
      paramContext.append("</MsgType>");
      paramContext.append("<Version>");
      paramContext.append("3.1.7");
      paramContext.append("</Version>");
      paramContext.append("<AppID>");
      paramContext.append(paramString);
      paramContext.append("</AppID>");
      paramContext.append("<OSID>");
      paramContext.append("1");
      paramContext.append("</OSID>");
      paramContext.append("<Timestamp>");
      paramContext.append(l);
      paramContext.append("</Timestamp>");
      paramContext.append("<PubKey>");
      paramContext.append(c.a());
      paramContext.append("</PubKey>");
      paramContext.append("</Trusted3PayCodeQryReq>");
      return paramContext.toString();
    }
    catch (Exception paramString)
    {
      for (;;)
      {
        paramString.printStackTrace();
      }
    }
  }
}
