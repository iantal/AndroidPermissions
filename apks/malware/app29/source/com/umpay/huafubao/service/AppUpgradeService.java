package com.umpay.huafubao.service;

import android.app.Application;
import android.app.Notification;
import android.app.NotificationManager;
import android.app.PendingIntent;
import android.app.Service;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.net.Uri;
import android.os.Environment;
import android.os.Handler;
import android.os.IBinder;
import android.widget.RemoteViews;
import java.io.File;
import java.net.URLEncoder;

public class AppUpgradeService
  extends Service
{
  private String a = null;
  private NotificationManager b = null;
  private Notification c = null;
  private PendingIntent d = null;
  private File e = null;
  private File f = null;
  private Handler g = new a(this);
  private d h = new b(this);
  
  public AppUpgradeService() {}
  
  /* Error */
  public static long a(String paramString, File paramFile, d paramD)
  {
    // Byte code:
    //   0: ldc2_w 50
    //   3: lstore 4
    //   5: aconst_null
    //   6: astore 10
    //   8: aconst_null
    //   9: astore 11
    //   11: aload_1
    //   12: invokevirtual 57	java/io/File:exists	()Z
    //   15: ifeq +15 -> 30
    //   18: aload_1
    //   19: invokevirtual 60	java/io/File:isFile	()Z
    //   22: ifeq +8 -> 30
    //   25: aload_1
    //   26: invokevirtual 63	java/io/File:delete	()Z
    //   29: pop
    //   30: new 65	org/apache/http/client/methods/HttpGet
    //   33: dup
    //   34: aload_0
    //   35: invokespecial 68	org/apache/http/client/methods/HttpGet:<init>	(Ljava/lang/String;)V
    //   38: astore 12
    //   40: new 70	org/apache/http/params/BasicHttpParams
    //   43: dup
    //   44: invokespecial 71	org/apache/http/params/BasicHttpParams:<init>	()V
    //   47: astore 13
    //   49: aload 13
    //   51: sipush 10000
    //   54: invokestatic 77	org/apache/http/params/HttpConnectionParams:setConnectionTimeout	(Lorg/apache/http/params/HttpParams;I)V
    //   57: aload 13
    //   59: ldc 78
    //   61: invokestatic 81	org/apache/http/params/HttpConnectionParams:setSoTimeout	(Lorg/apache/http/params/HttpParams;I)V
    //   64: new 83	org/apache/http/impl/client/DefaultHttpClient
    //   67: dup
    //   68: aload 13
    //   70: invokespecial 86	org/apache/http/impl/client/DefaultHttpClient:<init>	(Lorg/apache/http/params/HttpParams;)V
    //   73: astore 13
    //   75: aload 13
    //   77: aload 12
    //   79: invokeinterface 92 2 0
    //   84: astore 12
    //   86: aload 12
    //   88: invokeinterface 98 1 0
    //   93: invokeinterface 104 1 0
    //   98: sipush 200
    //   101: if_icmpne +279 -> 380
    //   104: aload 12
    //   106: invokeinterface 108 1 0
    //   111: invokeinterface 114 1 0
    //   116: astore 10
    //   118: aload 12
    //   120: invokeinterface 108 1 0
    //   125: invokeinterface 118 1 0
    //   130: lstore 8
    //   132: aload 12
    //   134: ldc 120
    //   136: invokeinterface 124 2 0
    //   141: astore 12
    //   143: aload 12
    //   145: ifnull +232 -> 377
    //   148: aload 12
    //   150: invokeinterface 130 1 0
    //   155: ldc -124
    //   157: invokevirtual 138	java/lang/String:equalsIgnoreCase	(Ljava/lang/String;)Z
    //   160: ifeq +217 -> 377
    //   163: new 140	java/util/zip/GZIPInputStream
    //   166: dup
    //   167: aload 10
    //   169: invokespecial 143	java/util/zip/GZIPInputStream:<init>	(Ljava/io/InputStream;)V
    //   172: astore 12
    //   174: aload 12
    //   176: astore 10
    //   178: new 145	java/io/FileOutputStream
    //   181: dup
    //   182: aload_1
    //   183: iconst_0
    //   184: invokespecial 148	java/io/FileOutputStream:<init>	(Ljava/io/File;Z)V
    //   187: astore_1
    //   188: sipush 8192
    //   191: newarray byte
    //   193: astore 11
    //   195: aload 10
    //   197: aload 11
    //   199: invokevirtual 154	java/io/InputStream:read	([B)I
    //   202: istore_3
    //   203: iload_3
    //   204: ifle +74 -> 278
    //   207: aload_1
    //   208: aload 11
    //   210: iconst_0
    //   211: iload_3
    //   212: invokevirtual 158	java/io/FileOutputStream:write	([BII)V
    //   215: aload_1
    //   216: invokevirtual 161	java/io/FileOutputStream:flush	()V
    //   219: lload 4
    //   221: iload_3
    //   222: i2l
    //   223: ladd
    //   224: lstore 6
    //   226: lload 6
    //   228: lstore 4
    //   230: aload_2
    //   231: ifnull -36 -> 195
    //   234: aload_2
    //   235: ldc2_w 162
    //   238: lload 6
    //   240: lmul
    //   241: lload 8
    //   243: ldiv
    //   244: l2i
    //   245: invokeinterface 168 2 0
    //   250: lload 6
    //   252: lstore 4
    //   254: goto -59 -> 195
    //   257: astore_0
    //   258: aload_1
    //   259: ifnull +7 -> 266
    //   262: aload_1
    //   263: invokevirtual 171	java/io/FileOutputStream:close	()V
    //   266: aload 10
    //   268: ifnull +8 -> 276
    //   271: aload 10
    //   273: invokevirtual 172	java/io/InputStream:close	()V
    //   276: aload_0
    //   277: athrow
    //   278: lload 4
    //   280: lconst_0
    //   281: lcmp
    //   282: ifge +110 -> 392
    //   285: aload 10
    //   287: astore 11
    //   289: lconst_0
    //   290: lstore 4
    //   292: aload_1
    //   293: astore 10
    //   295: aload 11
    //   297: astore_1
    //   298: aload 10
    //   300: ifnull +8 -> 308
    //   303: aload 10
    //   305: invokevirtual 171	java/io/FileOutputStream:close	()V
    //   308: aload_1
    //   309: ifnull +7 -> 316
    //   312: aload_1
    //   313: invokevirtual 172	java/io/InputStream:close	()V
    //   316: lload 4
    //   318: lconst_0
    //   319: lcmp
    //   320: ifge +27 -> 347
    //   323: new 174	java/lang/Exception
    //   326: dup
    //   327: new 176	java/lang/StringBuilder
    //   330: dup
    //   331: ldc -78
    //   333: invokespecial 179	java/lang/StringBuilder:<init>	(Ljava/lang/String;)V
    //   336: aload_0
    //   337: invokevirtual 183	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   340: invokevirtual 186	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   343: invokespecial 187	java/lang/Exception:<init>	(Ljava/lang/String;)V
    //   346: athrow
    //   347: aload_2
    //   348: ifnull +9 -> 357
    //   351: aload_2
    //   352: invokeinterface 189 1 0
    //   357: lload 4
    //   359: lreturn
    //   360: astore_0
    //   361: aconst_null
    //   362: astore 10
    //   364: aload 11
    //   366: astore_1
    //   367: goto -109 -> 258
    //   370: astore_0
    //   371: aload 11
    //   373: astore_1
    //   374: goto -116 -> 258
    //   377: goto -199 -> 178
    //   380: aconst_null
    //   381: astore_1
    //   382: goto -84 -> 298
    //   385: astore_0
    //   386: aload 11
    //   388: astore_1
    //   389: goto -131 -> 258
    //   392: aload_1
    //   393: astore 11
    //   395: aload 10
    //   397: astore_1
    //   398: aload 11
    //   400: astore 10
    //   402: goto -104 -> 298
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	405	0	paramString	String
    //   0	405	1	paramFile	File
    //   0	405	2	paramD	d
    //   202	20	3	i	int
    //   3	355	4	l1	long
    //   224	27	6	l2	long
    //   130	112	8	l3	long
    //   6	395	10	localObject1	Object
    //   9	390	11	localObject2	Object
    //   38	137	12	localObject3	Object
    //   47	29	13	localObject4	Object
    // Exception table:
    //   from	to	target	type
    //   188	195	257	finally
    //   195	203	257	finally
    //   207	219	257	finally
    //   234	250	257	finally
    //   75	118	360	finally
    //   118	143	370	finally
    //   148	174	370	finally
    //   178	188	385	finally
  }
  
  public final void a(File paramFile)
  {
    paramFile = Uri.fromFile(paramFile);
    Intent localIntent = new Intent("android.intent.action.VIEW");
    localIntent.setFlags(268435456);
    localIntent.setDataAndType(paramFile, "application/vnd.android.package-archive");
    startActivity(localIntent);
  }
  
  public final boolean a(String paramString)
  {
    try
    {
      paramString = getPackageManager().getPackageArchiveInfo(paramString, 1);
      return paramString != null;
    }
    catch (Exception paramString)
    {
      paramString.printStackTrace();
    }
    return false;
  }
  
  public IBinder onBind(Intent paramIntent)
  {
    return null;
  }
  
  public void onStart(Intent paramIntent, int paramInt)
  {
    this.a = paramIntent.getStringExtra("downloadUrl");
    if ((this.a == null) || ("".equals(this.a))) {
      this.a = "";
    }
    Object localObject;
    if (Environment.getExternalStorageState().equals("mounted"))
    {
      this.e = new File(Environment.getExternalStorageDirectory().getPath() + "/umpay/huafubao/download");
      if (this.e.exists())
      {
        localObject = new File(this.e.getPath() + "/" + URLEncoder.encode(this.a));
        if ((((File)localObject).exists()) && (((File)localObject).isFile()) && (a(((File)localObject).getPath())))
        {
          ((File)localObject).delete();
          stopSelf();
          super.onStart(paramIntent, paramInt);
        }
      }
    }
    for (;;)
    {
      this.b = ((NotificationManager)getSystemService("notification"));
      this.c = new Notification();
      this.c.contentView = new RemoteViews(getApplication().getPackageName(), com.umpay.huafubao.d.a.d(getApplicationContext(), "hfb_upgrade_notification"));
      localObject = new Intent();
      ((Intent)localObject).setFlags(536870912);
      ((Intent)localObject).setClass(getApplicationContext(), AppUpgradeService.class);
      this.d = PendingIntent.getActivity(this, 1, (Intent)localObject, 134217728);
      this.c.icon = com.umpay.huafubao.d.a.b(getApplicationContext(), "hfb_application");
      this.c.tickerText = "开始下载";
      this.c.contentIntent = this.d;
      this.c.contentView.setProgressBar(com.umpay.huafubao.d.a.c(getApplicationContext(), "app_upgrade_progressbar"), 100, 0, false);
      this.c.contentView.setTextViewText(com.umpay.huafubao.d.a.c(getApplicationContext(), "app_upgrade_progresstext"), "0%");
      this.b.cancel(100);
      this.b.notify(100, this.c);
      new c(this).start();
      super.onStart(paramIntent, paramInt);
      return;
      super.onStart(paramIntent, paramInt);
    }
  }
}
