package u.aly;

import android.content.Context;
import android.text.TextUtils;
import com.umeng.analytics.AnalyticsConfig;
import com.umeng.analytics.ReportPolicy.a;
import com.umeng.analytics.ReportPolicy.b;
import com.umeng.analytics.ReportPolicy.c;
import com.umeng.analytics.ReportPolicy.d;
import com.umeng.analytics.ReportPolicy.e;
import com.umeng.analytics.ReportPolicy.f;
import com.umeng.analytics.f;
import com.umeng.analytics.onlineconfig.c;
import java.util.Iterator;
import java.util.List;

public final class j
  implements c, hn
{
  private hp a = null;
  private hq b = null;
  private ReportPolicy.e c = null;
  private f d = null;
  private hv e = null;
  private gx f = null;
  private int g = 10;
  private Context h;
  
  public j(Context paramContext)
  {
    this.h = paramContext;
    this.a = new hp(paramContext);
    this.f = hg.a(paramContext);
    this.e = new hv(paramContext);
    this.b = new hq(paramContext);
    this.b.a(this.e);
    this.d = f.a(paramContext);
    paramContext = AnalyticsConfig.getReportPolicy(this.h);
    a(paramContext[0], paramContext[1]);
  }
  
  private bf a(byte[] paramArrayOfByte)
  {
    if (paramArrayOfByte == null) {
      return null;
    }
    try
    {
      bf localBf = new bf();
      new gi().a(localBf, paramArrayOfByte);
      return localBf;
    }
    catch (Exception paramArrayOfByte)
    {
      paramArrayOfByte.printStackTrace();
    }
    return null;
  }
  
  private void a(int paramInt1, int paramInt2)
  {
    switch (paramInt1)
    {
    case 2: 
    case 3: 
    default: 
      this.c = new ReportPolicy.a();
    }
    for (;;)
    {
      fv.c("MobclickAgent", "report policy:" + paramInt1 + " interval:" + paramInt2);
      return;
      this.c = new ReportPolicy.a();
      continue;
      this.c = new ReportPolicy.b(this.e, paramInt2);
      continue;
      this.c = new ReportPolicy.d(this.e);
      continue;
      this.c = new ReportPolicy.e();
      continue;
      this.c = new ReportPolicy.f(this.h);
      continue;
      this.c = new ReportPolicy.c(this.a, paramInt2);
    }
  }
  
  private boolean a(boolean paramBoolean)
  {
    boolean bool2 = true;
    boolean bool1;
    if (!fu.g(this.h))
    {
      if (fv.a) {
        fv.c("MobclickAgent", "network is unavailable");
      }
      bool1 = false;
    }
    do
    {
      do
      {
        return bool1;
        bool1 = bool2;
      } while (this.e.a());
      if (!fv.a) {
        break;
      }
      bool1 = bool2;
    } while (fu.q(this.h));
    return this.c.a(paramBoolean);
  }
  
  private byte[] a(bf paramBf)
  {
    try
    {
      paramBf = new gl().a(paramBf);
      return paramBf;
    }
    catch (Exception paramBf)
    {
      paramBf.printStackTrace();
    }
    return null;
  }
  
  private boolean d()
  {
    return this.a.a() > this.g;
  }
  
  private void e()
  {
    try
    {
      if (this.e.a()) {
        this.a.a(new ah(this.e.i()));
      }
      f();
      return;
    }
    catch (Throwable localThrowable)
    {
      while (((localThrowable instanceof OutOfMemoryError)) && (localThrowable == null)) {}
      localThrowable.printStackTrace();
    }
  }
  
  private void f()
  {
    f localF = f.a(this.h);
    boolean bool = localF.f();
    byte[] arrayOfByte;
    if (bool) {
      arrayOfByte = localF.d();
    }
    switch (this.b.a(arrayOfByte))
    {
    default: 
    case 2: 
    case 3: 
      do
      {
        do
        {
          return;
          this.f.a();
          arrayOfByte = c();
          if (arrayOfByte == null)
          {
            fv.d("MobclickAgent", "message is null");
            return;
          }
          arrayOfByte = ge.a(this.h, AnalyticsConfig.getAppkey(this.h), arrayOfByte).c();
          localF.c();
          break;
          if (this.e.h()) {
            this.e.g();
          }
          this.f.c();
          this.e.f();
        } while (!bool);
        localF.e();
        return;
        this.e.f();
      } while (!bool);
      localF.e();
      return;
    }
    if (!bool) {
      localF.b(arrayOfByte);
    }
    fv.b("MobclickAgent", "connection error");
  }
  
  public void a()
  {
    if (fu.g(this.h)) {
      e();
    }
    while (!fv.a) {
      return;
    }
    fv.c("MobclickAgent", "network is unavailable");
  }
  
  public void a(int paramInt, long paramLong)
  {
    AnalyticsConfig.setReportPolicy(paramInt, (int)paramLong);
    a(paramInt, (int)paramLong);
  }
  
  public void a(ho paramHo)
  {
    if (paramHo != null) {
      this.a.a(paramHo);
    }
    if (a(paramHo instanceof bd)) {
      e();
    }
    while (!d()) {
      return;
    }
    b();
  }
  
  public void b()
  {
    if (this.a.a() > 0) {}
    try
    {
      byte[] arrayOfByte = c();
      if (arrayOfByte != null) {
        this.d.a(arrayOfByte);
      }
      return;
    }
    catch (Throwable localThrowable)
    {
      do
      {
        if ((localThrowable instanceof OutOfMemoryError)) {
          this.d.c();
        }
      } while (localThrowable == null);
      localThrowable.printStackTrace();
    }
  }
  
  public void b(ho paramHo)
  {
    this.a.a(paramHo);
  }
  
  protected byte[] c()
  {
    label213:
    label216:
    label219:
    label221:
    for (;;)
    {
      Object localObject2;
      try
      {
        if (TextUtils.isEmpty(AnalyticsConfig.getAppkey(this.h)))
        {
          fv.b("MobclickAgent", "Appkey is missing ,Please check AndroidManifest.xml");
          return null;
        }
        localObject1 = f.a(this.h).b();
        if (localObject1 == null)
        {
          localObject1 = null;
          if ((localObject1 == null) && (this.a.a() == 0)) {
            return null;
          }
        }
        else
        {
          localObject1 = a((byte[])localObject1);
          continue;
        }
        if (localObject1 != null) {
          break label216;
        }
        localObject1 = new bf();
        this.a.a((bf)localObject1);
        if ((fv.a) && (((bf)localObject1).f()))
        {
          int i = 0;
          localObject2 = ((bf)localObject1).e().iterator();
          if (((Iterator)localObject2).hasNext())
          {
            if (((bd)((Iterator)localObject2).next()).d() <= 0) {
              break label213;
            }
            i = 1;
            break label221;
          }
          if (i == 0) {
            fv.d("MobclickAgent", "missing Activities or PageViews");
          }
        }
      }
      catch (Exception localException2)
      {
        Object localObject1;
        fv.b("MobclickAgent", "Fail to construct message ...", localException2);
        f.a(this.h).c();
        return null;
      }
      try
      {
        localObject2 = a((bf)localObject1);
      }
      catch (Exception localException3)
      {
        localObject2 = null;
        continue;
      }
      try
      {
        if (!fv.a) {
          break label219;
        }
        fv.c("MobclickAgent", ((bf)localObject1).toString());
        return localObject2;
      }
      catch (Exception localException1)
      {
        fv.b("MobclickAgent", "Fail to serialize log ...");
        return localObject2;
      }
      break label221;
      continue;
      return localObject2;
    }
  }
}
