package u.aly;

import android.content.Context;
import android.content.pm.PackageManager;
import android.net.ConnectivityManager;
import android.net.NetworkInfo;
import android.os.Build;
import android.os.Build.VERSION;
import com.umeng.analytics.AnalyticsConfig;
import com.umeng.analytics.a;
import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.net.URLEncoder;
import org.apache.http.HttpEntity;
import org.apache.http.HttpHost;
import org.apache.http.HttpResponse;
import org.apache.http.StatusLine;
import org.apache.http.client.ClientProtocolException;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.entity.InputStreamEntity;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.params.BasicHttpParams;
import org.apache.http.params.HttpConnectionParams;
import org.apache.http.params.HttpParams;

public class hq
{
  private final int a = 1;
  private String b;
  private String c = "10.0.0.172";
  private int d = 80;
  private Context e;
  private hv f;
  private hf g;
  
  public hq(Context paramContext)
  {
    this.e = paramContext;
    this.g = hg.b(paramContext);
    this.b = a(paramContext);
  }
  
  private String a(Context paramContext)
  {
    StringBuffer localStringBuffer1 = new StringBuffer();
    localStringBuffer1.append("Android");
    localStringBuffer1.append("/");
    localStringBuffer1.append("5.2.4");
    localStringBuffer1.append(" ");
    try
    {
      StringBuffer localStringBuffer2 = new StringBuffer();
      localStringBuffer2.append(fu.p(paramContext));
      localStringBuffer2.append("/");
      localStringBuffer2.append(fu.b(paramContext));
      localStringBuffer2.append(" ");
      localStringBuffer2.append(Build.MODEL);
      localStringBuffer2.append("/");
      localStringBuffer2.append(Build.VERSION.RELEASE);
      localStringBuffer2.append(" ");
      localStringBuffer2.append(ga.a(AnalyticsConfig.getAppkey(paramContext)));
      localStringBuffer1.append(URLEncoder.encode(localStringBuffer2.toString(), "UTF-8"));
      return localStringBuffer1.toString();
    }
    catch (Exception paramContext)
    {
      for (;;)
      {
        paramContext.printStackTrace();
      }
    }
  }
  
  private boolean a()
  {
    if (this.e.getPackageManager().checkPermission("android.permission.ACCESS_NETWORK_STATE", this.e.getPackageName()) != 0) {
      return false;
    }
    try
    {
      Object localObject = ((ConnectivityManager)this.e.getSystemService("connectivity")).getActiveNetworkInfo();
      if ((localObject != null) && (((NetworkInfo)localObject).getType() != 1))
      {
        localObject = ((NetworkInfo)localObject).getExtraInfo();
        if (localObject != null) {
          if ((!((String)localObject).equals("cmwap")) && (!((String)localObject).equals("3gwap")))
          {
            boolean bool = ((String)localObject).equals("uniwap");
            if (!bool) {}
          }
          else
          {
            return true;
          }
        }
      }
    }
    catch (Exception localException)
    {
      localException.printStackTrace();
    }
    return false;
  }
  
  private byte[] a(byte[] paramArrayOfByte, String paramString)
  {
    HttpPost localHttpPost = new HttpPost(paramString);
    Object localObject = new BasicHttpParams();
    HttpConnectionParams.setConnectionTimeout((HttpParams)localObject, 10000);
    HttpConnectionParams.setSoTimeout((HttpParams)localObject, 30000);
    localObject = new DefaultHttpClient((HttpParams)localObject);
    localHttpPost.addHeader("X-Umeng-Sdk", this.b);
    localHttpPost.addHeader("Msg-Type", "envelope");
    try
    {
      if (a())
      {
        HttpHost localHttpHost = new HttpHost(this.c, this.d);
        ((HttpClient)localObject).getParams().setParameter("http.route.default-proxy", localHttpHost);
      }
      localHttpPost.setEntity(new InputStreamEntity(new ByteArrayInputStream(paramArrayOfByte), paramArrayOfByte.length));
      if (this.f != null) {
        this.f.d();
      }
      paramArrayOfByte = ((HttpClient)localObject).execute(localHttpPost);
      if (this.f != null) {
        this.f.e();
      }
      int i = paramArrayOfByte.getStatusLine().getStatusCode();
      fv.a("MobclickAgent", "status code : " + i);
      if (paramArrayOfByte.getStatusLine().getStatusCode() == 200)
      {
        fv.a("MobclickAgent", "Sent message to " + paramString);
        paramArrayOfByte = paramArrayOfByte.getEntity();
        if (paramArrayOfByte != null)
        {
          paramArrayOfByte = paramArrayOfByte.getContent();
          try
          {
            paramString = ga.b(paramArrayOfByte);
            return paramString;
          }
          finally
          {
            ga.c(paramArrayOfByte);
          }
        }
      }
      return null;
    }
    catch (ClientProtocolException paramArrayOfByte)
    {
      fv.b("MobclickAgent", "ClientProtocolException,Failed to send message.", paramArrayOfByte);
      return null;
      return null;
      return null;
    }
    catch (IOException paramArrayOfByte)
    {
      fv.b("MobclickAgent", "IOException,Failed to send message.", paramArrayOfByte);
    }
  }
  
  private int b(byte[] paramArrayOfByte)
  {
    bb localBb = new bb();
    gi localGi = new gi(new cr.a());
    try
    {
      localGi.a(localBb, paramArrayOfByte);
      if (localBb.a == 1)
      {
        this.g.b(localBb.d());
        this.g.c();
      }
      fv.a("MobclickAgent", "send log:" + localBb.b());
    }
    catch (Exception paramArrayOfByte)
    {
      for (;;)
      {
        paramArrayOfByte.printStackTrace();
      }
    }
    if (localBb.a == 1) {
      return 2;
    }
    return 3;
  }
  
  public int a(byte[] paramArrayOfByte)
  {
    byte[] arrayOfByte1 = null;
    int i = 0;
    byte[] arrayOfByte2;
    for (;;)
    {
      arrayOfByte2 = arrayOfByte1;
      if (i < a.f.length)
      {
        arrayOfByte1 = a(paramArrayOfByte, a.f[i]);
        if (arrayOfByte1 == null) {
          break label57;
        }
        arrayOfByte2 = arrayOfByte1;
        if (this.f != null)
        {
          this.f.b();
          arrayOfByte2 = arrayOfByte1;
        }
      }
      if (arrayOfByte2 != null) {
        break;
      }
      return 1;
      label57:
      if (this.f != null) {
        this.f.c();
      }
      i += 1;
    }
    return b(arrayOfByte2);
  }
  
  public void a(hv paramHv)
  {
    this.f = paramHv;
  }
}
