package com.baidu.location;

import android.app.AlarmManager;
import android.app.PendingIntent;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.location.Location;
import java.util.ArrayList;
import java.util.Iterator;

public class x
  implements au, l
{
  public static final String f9 = "android.com.baidu.location.TIMER.NOTIFY";
  private int f5 = 0;
  private Context f6 = null;
  private AlarmManager f7 = null;
  private a f8 = new a();
  private PendingIntent ga = null;
  private ArrayList gb = null;
  private BDLocation gc = null;
  private long gd = 0L;
  private b ge = null;
  private float gf = Float.MAX_VALUE;
  private boolean gg = false;
  private boolean gh = false;
  private long gi = 0L;
  private boolean gj = false;
  private LocationClient gk = null;
  
  public x(Context paramContext, LocationClient paramLocationClient)
  {
    this.f6 = paramContext;
    this.gk = paramLocationClient;
    this.gk.registerNotifyLocationListener(this.f8);
    this.f7 = ((AlarmManager)this.f6.getSystemService("alarm"));
    this.ge = new b();
    this.gj = false;
  }
  
  private void a0()
  {
    int j = 10000;
    if (!a2()) {
      return;
    }
    int i;
    if (this.gf > 5000.0F)
    {
      i = 600000;
      if (!this.gg) {
        break label148;
      }
      this.gg = false;
      i = j;
    }
    label146:
    label148:
    for (;;)
    {
      if (this.f5 != 0)
      {
        long l1 = this.gd;
        long l2 = this.f5;
        long l3 = System.currentTimeMillis();
        if (i <= l1 + l2 - l3) {}
      }
      for (j = 0;; j = 1)
      {
        if (j == 0) {
          break label146;
        }
        this.f5 = i;
        this.gd = System.currentTimeMillis();
        jdMethod_if(this.f5);
        return;
        if (this.gf > 1000.0F)
        {
          i = 120000;
          break;
        }
        if (this.gf > 500.0F)
        {
          i = 60000;
          break;
        }
        i = 10000;
        break;
      }
      break;
    }
  }
  
  private boolean a2()
  {
    boolean bool2;
    if ((this.gb == null) || (this.gb.isEmpty())) {
      bool2 = false;
    }
    Iterator localIterator;
    boolean bool1;
    do
    {
      return bool2;
      localIterator = this.gb.iterator();
      bool1 = false;
      bool2 = bool1;
    } while (!localIterator.hasNext());
    if (((BDNotifyListener)localIterator.next()).Notified < 3) {
      bool1 = true;
    }
    for (;;)
    {
      break;
    }
  }
  
  private void jdMethod_if(long paramLong)
  {
    if (this.gh) {
      this.f7.cancel(this.ga);
    }
    this.ga = PendingIntent.getBroadcast(this.f6, 0, new Intent("android.com.baidu.location.TIMER.NOTIFY"), 134217728);
    this.f7.set(0, System.currentTimeMillis() + paramLong, this.ga);
  }
  
  private void jdMethod_int(BDLocation paramBDLocation)
  {
    this.gh = false;
    if ((paramBDLocation.getLocType() != 61) && (paramBDLocation.getLocType() != 161) && (paramBDLocation.getLocType() != 65)) {
      jdMethod_if(120000L);
    }
    while ((System.currentTimeMillis() - this.gi < 5000L) || (this.gb == null)) {
      return;
    }
    this.gc = paramBDLocation;
    this.gi = System.currentTimeMillis();
    float[] arrayOfFloat = new float[1];
    Iterator localIterator = this.gb.iterator();
    float f1 = Float.MAX_VALUE;
    if (localIterator.hasNext())
    {
      BDNotifyListener localBDNotifyListener = (BDNotifyListener)localIterator.next();
      Location.distanceBetween(paramBDLocation.getLatitude(), paramBDLocation.getLongitude(), localBDNotifyListener.mLatitudeC, localBDNotifyListener.mLongitudeC, arrayOfFloat);
      float f2 = arrayOfFloat[0] - localBDNotifyListener.mRadius - paramBDLocation.getRadius();
      if (f2 > 0.0F)
      {
        if (f2 >= f1) {
          break label215;
        }
        f1 = f2;
      }
      label215:
      for (;;)
      {
        break;
        if (localBDNotifyListener.Notified < 3)
        {
          localBDNotifyListener.Notified += 1;
          localBDNotifyListener.onNotify(paramBDLocation, arrayOfFloat[0]);
          if (localBDNotifyListener.Notified < 3) {
            this.gg = true;
          }
        }
      }
    }
    if (f1 < this.gf) {
      this.gf = f1;
    }
    this.f5 = 0;
    a0();
  }
  
  public void a1()
  {
    if (this.gh) {
      this.f7.cancel(this.ga);
    }
    this.gc = null;
    this.gi = 0L;
    if (this.gj) {
      this.f6.unregisterReceiver(this.ge);
    }
    this.gj = false;
  }
  
  public int jdMethod_do(BDNotifyListener paramBDNotifyListener)
  {
    if (this.gb == null) {
      this.gb = new ArrayList();
    }
    this.gb.add(paramBDNotifyListener);
    paramBDNotifyListener.isAdded = true;
    paramBDNotifyListener.mNotifyCache = this;
    if (!this.gj)
    {
      this.f6.registerReceiver(this.ge, new IntentFilter("android.com.baidu.location.TIMER.NOTIFY"));
      this.gj = true;
    }
    if (paramBDNotifyListener.mCoorType == null) {
      return 1;
    }
    Object localObject;
    if (!paramBDNotifyListener.mCoorType.equals("gcj02"))
    {
      localObject = Jni.jdMethod_if(paramBDNotifyListener.mLongitude, paramBDNotifyListener.mLatitude, paramBDNotifyListener.mCoorType + "2gcj");
      paramBDNotifyListener.mLongitudeC = localObject[0];
      paramBDNotifyListener.mLatitudeC = localObject[1];
    }
    if ((this.gc == null) || (System.currentTimeMillis() - this.gi > 30000L)) {
      this.gk.requestNotifyLocation();
    }
    for (;;)
    {
      a0();
      return 1;
      localObject = new float[1];
      Location.distanceBetween(this.gc.getLatitude(), this.gc.getLongitude(), paramBDNotifyListener.mLatitudeC, paramBDNotifyListener.mLongitudeC, (float[])localObject);
      float f = localObject[0] - paramBDNotifyListener.mRadius - this.gc.getRadius();
      if (f > 0.0F)
      {
        if (f < this.gf) {
          this.gf = f;
        }
      }
      else if (paramBDNotifyListener.Notified < 3)
      {
        paramBDNotifyListener.Notified += 1;
        paramBDNotifyListener.onNotify(this.gc, localObject[0]);
        if (paramBDNotifyListener.Notified < 3) {
          this.gg = true;
        }
      }
    }
  }
  
  public int jdMethod_for(BDNotifyListener paramBDNotifyListener)
  {
    if (this.gb == null) {
      return 0;
    }
    if (this.gb.contains(paramBDNotifyListener)) {
      this.gb.remove(paramBDNotifyListener);
    }
    if ((this.gb.size() == 0) && (this.gh)) {
      this.f7.cancel(this.ga);
    }
    return 1;
  }
  
  public void jdMethod_if(BDNotifyListener paramBDNotifyListener)
  {
    if (paramBDNotifyListener.mCoorType == null) {
      return;
    }
    Object localObject;
    if (!paramBDNotifyListener.mCoorType.equals("gcj02"))
    {
      localObject = Jni.jdMethod_if(paramBDNotifyListener.mLongitude, paramBDNotifyListener.mLatitude, paramBDNotifyListener.mCoorType + "2gcj");
      paramBDNotifyListener.mLongitudeC = localObject[0];
      paramBDNotifyListener.mLatitudeC = localObject[1];
    }
    if ((this.gc == null) || (System.currentTimeMillis() - this.gi > 300000L)) {
      this.gk.requestNotifyLocation();
    }
    for (;;)
    {
      a0();
      return;
      localObject = new float[1];
      Location.distanceBetween(this.gc.getLatitude(), this.gc.getLongitude(), paramBDNotifyListener.mLatitudeC, paramBDNotifyListener.mLongitudeC, (float[])localObject);
      float f = localObject[0] - paramBDNotifyListener.mRadius - this.gc.getRadius();
      if (f > 0.0F)
      {
        if (f < this.gf) {
          this.gf = f;
        }
      }
      else if (paramBDNotifyListener.Notified < 3)
      {
        paramBDNotifyListener.Notified += 1;
        paramBDNotifyListener.onNotify(this.gc, localObject[0]);
        if (paramBDNotifyListener.Notified < 3) {
          this.gg = true;
        }
      }
    }
  }
  
  public class a
    implements BDLocationListener
  {
    public a() {}
    
    public void onReceiveLocation(BDLocation paramBDLocation)
    {
      x.jdMethod_if(x.this, paramBDLocation);
    }
    
    public void onReceivePoi(BDLocation paramBDLocation) {}
  }
  
  public class b
    extends BroadcastReceiver
  {
    public b() {}
    
    public void onReceive(Context paramContext, Intent paramIntent)
    {
      if ((x.jdMethod_do(x.this) == null) || (x.jdMethod_do(x.this).isEmpty())) {
        return;
      }
      x.jdMethod_if(x.this).requestNotifyLocation();
    }
  }
}
