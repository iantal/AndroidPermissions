package oicq.wlogin_sdk.push;

import android.content.ComponentName;
import android.content.Context;
import android.content.Intent;
import android.content.ServiceConnection;
import android.os.Bundle;
import android.os.IBinder;
import android.os.Message;
import android.os.RemoteException;
import java.io.BufferedOutputStream;
import java.io.ByteArrayOutputStream;
import java.io.ObjectOutputStream;
import java.io.OutputStream;
import java.io.PrintWriter;
import java.io.StringWriter;
import java.io.Writer;
import oicq.wlogin_sdk.request.WtloginHelper.HelperHandler;
import oicq.wlogin_sdk.tools.util;

public class push_client
{
  public static String PUSH_GET_UINFO_RECEIVED = "oicq.wlogin_sdk.push.GET_UINFO_1_0";
  public static String PUSH_SET_UINFO_RECEIVED = "oicq.wlogin_sdk.push.SET_UINFO_1_0";
  static int _test = 0;
  static String _test_host = "";
  private static String _uinfo_file_name;
  private static String mName = "oicq.wlogin_sdk.push.push_service_1_0";
  private WtloginHelper.HelperHandler _hander;
  private int _msg_type = 0;
  private final push_service_callback.Stub mCallback = new push_service_callback.Stub()
  {
    public int push_callback(long paramAnonymousLong1, long paramAnonymousLong2, byte[] paramAnonymousArrayOfByte)
      throws RemoteException
    {
      util.LOGD("client push_callback");
      try
      {
        Object localObject1 = new ByteArrayOutputStream();
        Object localObject2 = new ObjectOutputStream((OutputStream)localObject1);
        ((ObjectOutputStream)localObject2).writeObject(new Long(paramAnonymousLong1));
        ((ObjectOutputStream)localObject2).writeObject(new Long(paramAnonymousLong2));
        ((ObjectOutputStream)localObject2).writeObject(paramAnonymousArrayOfByte);
        paramAnonymousArrayOfByte = ((ByteArrayOutputStream)localObject1).toByteArray();
        localObject1 = new Message();
        ((Message)localObject1).what = util.ASYN_TRANSPORT_PUSH;
        localObject2 = new Bundle();
        ((Bundle)localObject2).putByteArray("param", paramAnonymousArrayOfByte);
        ((Message)localObject1).setData((Bundle)localObject2);
        push_client.this._hander.sendMessage((Message)localObject1);
        return 0;
      }
      catch (Exception paramAnonymousArrayOfByte) {}
      return 0;
    }
  };
  private ServiceConnection mConnection = new ServiceConnection()
  {
    public void onServiceConnected(ComponentName paramAnonymousComponentName, IBinder paramAnonymousIBinder)
    {
      util.LOGD("", "onServiceConnected");
      push_client.this.mService = push_service_aidl.Stub.asInterface(paramAnonymousIBinder);
      push_client.this.set_push_test(push_client._test, push_client._test_host);
      try
      {
        paramAnonymousComponentName = new ByteArrayOutputStream();
        new ObjectOutputStream(paramAnonymousComponentName).write(new byte[4]);
        paramAnonymousIBinder = new Message();
        paramAnonymousIBinder.what = util.ASYN_PUSH_CONNECTED;
        Bundle localBundle = new Bundle();
        localBundle.putByteArray("param", paramAnonymousComponentName.toByteArray());
        paramAnonymousIBinder.setData(localBundle);
        push_client.this._hander.sendMessage(paramAnonymousIBinder);
        return;
      }
      catch (Exception paramAnonymousComponentName) {}
    }
    
    public void onServiceDisconnected(ComponentName paramAnonymousComponentName)
    {
      util.LOGD("", "disconnect service");
      push_client.this.mService = null;
      push_client.this.reInit();
      try
      {
        paramAnonymousComponentName = new ByteArrayOutputStream();
        new ObjectOutputStream(paramAnonymousComponentName).write(new byte[4]);
        Message localMessage = new Message();
        localMessage.what = util.ASYN_PUSH_DISCONNECTED;
        Bundle localBundle = new Bundle();
        localBundle.putByteArray("param", paramAnonymousComponentName.toByteArray());
        localMessage.setData(localBundle);
        push_client.this._hander.sendMessage(localMessage);
        return;
      }
      catch (Exception paramAnonymousComponentName) {}
    }
  };
  private Context mContext;
  private push_service_aidl mService;
  
  static
  {
    _uinfo_file_name = "push_uin_appid_info";
  }
  
  public push_client() {}
  
  /* Error */
  public static uin_app_info[] loadUinPush(Context paramContext)
  {
    // Byte code:
    //   0: new 79	java/io/ObjectInputStream
    //   3: dup
    //   4: new 81	java/io/BufferedInputStream
    //   7: dup
    //   8: aload_0
    //   9: getstatic 43	oicq/wlogin_sdk/push/push_client:_uinfo_file_name	Ljava/lang/String;
    //   12: invokevirtual 87	android/content/Context:openFileInput	(Ljava/lang/String;)Ljava/io/FileInputStream;
    //   15: invokespecial 90	java/io/BufferedInputStream:<init>	(Ljava/io/InputStream;)V
    //   18: invokespecial 91	java/io/ObjectInputStream:<init>	(Ljava/io/InputStream;)V
    //   21: astore_0
    //   22: aload_0
    //   23: invokevirtual 95	java/io/ObjectInputStream:readObject	()Ljava/lang/Object;
    //   26: checkcast 97	[Loicq/wlogin_sdk/push/uin_app_info;
    //   29: astore_1
    //   30: aload_0
    //   31: invokevirtual 100	java/io/ObjectInputStream:close	()V
    //   34: aload_1
    //   35: areturn
    //   36: astore_0
    //   37: aconst_null
    //   38: areturn
    //   39: astore_0
    //   40: new 102	java/io/StringWriter
    //   43: dup
    //   44: invokespecial 103	java/io/StringWriter:<init>	()V
    //   47: astore_1
    //   48: new 105	java/io/PrintWriter
    //   51: dup
    //   52: aload_1
    //   53: iconst_1
    //   54: invokespecial 108	java/io/PrintWriter:<init>	(Ljava/io/Writer;Z)V
    //   57: astore_2
    //   58: aload_0
    //   59: aload_2
    //   60: invokevirtual 112	java/lang/Exception:printStackTrace	(Ljava/io/PrintWriter;)V
    //   63: aload_2
    //   64: invokevirtual 115	java/io/PrintWriter:flush	()V
    //   67: aload_1
    //   68: invokevirtual 116	java/io/StringWriter:flush	()V
    //   71: ldc 118
    //   73: aload_1
    //   74: invokevirtual 122	java/io/StringWriter:toString	()Ljava/lang/String;
    //   77: invokestatic 128	oicq/wlogin_sdk/tools/util:LOGD	(Ljava/lang/String;Ljava/lang/String;)V
    //   80: aconst_null
    //   81: areturn
    //   82: astore_0
    //   83: new 102	java/io/StringWriter
    //   86: dup
    //   87: invokespecial 103	java/io/StringWriter:<init>	()V
    //   90: astore_1
    //   91: new 105	java/io/PrintWriter
    //   94: dup
    //   95: aload_1
    //   96: iconst_1
    //   97: invokespecial 108	java/io/PrintWriter:<init>	(Ljava/io/Writer;Z)V
    //   100: astore_2
    //   101: aload_0
    //   102: aload_2
    //   103: invokevirtual 112	java/lang/Exception:printStackTrace	(Ljava/io/PrintWriter;)V
    //   106: aload_2
    //   107: invokevirtual 115	java/io/PrintWriter:flush	()V
    //   110: aload_1
    //   111: invokevirtual 116	java/io/StringWriter:flush	()V
    //   114: ldc 118
    //   116: aload_1
    //   117: invokevirtual 122	java/io/StringWriter:toString	()Ljava/lang/String;
    //   120: invokestatic 128	oicq/wlogin_sdk/tools/util:LOGD	(Ljava/lang/String;Ljava/lang/String;)V
    //   123: aconst_null
    //   124: areturn
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	125	0	paramContext	Context
    //   29	88	1	localObject	Object
    //   57	50	2	localPrintWriter	PrintWriter
    // Exception table:
    //   from	to	target	type
    //   0	22	36	java/lang/Exception
    //   22	30	39	java/lang/Exception
    //   30	34	82	java/lang/Exception
  }
  
  public static void saveUinPush(Context paramContext, uin_app_info[] paramArrayOfUin_app_info)
  {
    localObject = null;
    for (;;)
    {
      try
      {
        paramContext = new ObjectOutputStream(new BufferedOutputStream(paramContext.openFileOutput(_uinfo_file_name, 0)));
        localObject = new StringWriter();
      }
      catch (Exception paramArrayOfUin_app_info)
      {
        for (;;)
        {
          try
          {
            paramContext.writeObject(paramArrayOfUin_app_info);
          }
          catch (Exception paramArrayOfUin_app_info)
          {
            PrintWriter localPrintWriter;
            continue;
          }
          try
          {
            paramContext.close();
            return;
          }
          catch (Exception paramContext)
          {
            paramArrayOfUin_app_info = new StringWriter();
            localObject = new PrintWriter(paramArrayOfUin_app_info, true);
            paramContext.printStackTrace((PrintWriter)localObject);
            ((PrintWriter)localObject).flush();
            paramArrayOfUin_app_info.flush();
            util.LOGD("exception", paramArrayOfUin_app_info.toString());
            return;
          }
        }
        paramArrayOfUin_app_info = paramArrayOfUin_app_info;
        paramContext = (Context)localObject;
      }
      localPrintWriter = new PrintWriter((Writer)localObject, true);
      paramArrayOfUin_app_info.printStackTrace(localPrintWriter);
      localPrintWriter.flush();
      ((StringWriter)localObject).flush();
      util.LOGD("exception", ((StringWriter)localObject).toString());
    }
  }
  
  public void addUinPush(uin_app_info paramUin_app_info)
  {
    int i = 0;
    uin_app_info[] arrayOfUin_app_info1 = loadUinPush(this.mContext);
    if (arrayOfUin_app_info1 != null) {
      i = arrayOfUin_app_info1.length;
    }
    int j = 0;
    uin_app_info[] arrayOfUin_app_info2;
    if (j >= i)
    {
      arrayOfUin_app_info2 = new uin_app_info[i + 1];
      j = 0;
    }
    for (;;)
    {
      if (j >= i)
      {
        arrayOfUin_app_info2[j] = paramUin_app_info;
        saveUinPush(this.mContext, arrayOfUin_app_info2);
        return;
        if ((arrayOfUin_app_info1[j]._uin == paramUin_app_info._uin) && (arrayOfUin_app_info1[j]._appid == paramUin_app_info._appid) && (arrayOfUin_app_info1[j]._sub_appid == paramUin_app_info._sub_appid))
        {
          arrayOfUin_app_info1[j] = paramUin_app_info;
          saveUinPush(this.mContext, arrayOfUin_app_info1);
          return;
        }
        j += 1;
        break;
      }
      arrayOfUin_app_info2[j] = arrayOfUin_app_info1[j];
      j += 1;
    }
  }
  
  public void deinit()
  {
    this.mContext.unbindService(this.mConnection);
  }
  
  public void deleteUinPush(long paramLong1, long paramLong2, long paramLong3)
  {
    uin_app_info[] arrayOfUin_app_info1 = loadUinPush(this.mContext);
    if (arrayOfUin_app_info1 == null) {
      return;
    }
    while (arrayOfUin_app_info1.length == 0) {}
    int n = arrayOfUin_app_info1.length;
    int j = 0;
    uin_app_info[] arrayOfUin_app_info2;
    int k;
    int i;
    for (;;)
    {
      if (j >= n)
      {
        if (j >= n) {
          break;
        }
        arrayOfUin_app_info2 = new uin_app_info[n - 1];
        k = 0;
        i = 0;
        if (j < n) {
          break label124;
        }
        saveUinPush(this.mContext, arrayOfUin_app_info2);
        return;
      }
      if ((arrayOfUin_app_info1[j]._uin == paramLong1) && (arrayOfUin_app_info1[j]._appid == paramLong2) && (arrayOfUin_app_info1[j]._sub_appid == paramLong3)) {
        break;
      }
      j += 1;
    }
    label124:
    if (k == j) {}
    for (;;)
    {
      k += 1;
      break;
      int m = i + 1;
      arrayOfUin_app_info2[i] = arrayOfUin_app_info1[k];
      i = m;
    }
  }
  
  public boolean init(Context paramContext, WtloginHelper.HelperHandler paramHelperHandler, int paramInt)
  {
    this.mContext = paramContext;
    this._hander = paramHelperHandler;
    this._msg_type = paramInt;
    paramContext = new Intent(mName);
    this.mContext.bindService(paramContext, this.mConnection, 1);
    return false;
  }
  
  void reInit()
  {
    if (this.mService != null) {
      return;
    }
    Intent localIntent = new Intent(mName);
    this.mContext.bindService(localIntent, this.mConnection, 1);
  }
  
  public int register(long paramLong1, long paramLong2, long paramLong3, String paramString1, String paramString2, String paramString3, byte[] paramArrayOfByte1, byte[] paramArrayOfByte2, int paramInt1, byte[] paramArrayOfByte3, int paramInt2)
  {
    int j = 0;
    int i = j;
    try
    {
      if (this.mService != null) {
        break label143;
      }
      i = j;
      reInit();
      return 0;
    }
    catch (Exception paramString1)
    {
      for (;;)
      {
        Object localObject;
        reInit();
        continue;
        long l = paramLong3;
        if (paramLong3 == 0L) {
          l = 1L;
        }
      }
    }
    i = j;
    paramString1 = new uin_app_info(paramLong1, paramLong2, localObject, paramArrayOfByte1, paramArrayOfByte2, paramInt1, paramArrayOfByte3, paramInt2, paramString2, paramString3, paramString1, this._msg_type);
    i = j;
    paramInt1 = this.mService.register(this.mCallback, paramLong1, paramLong2, paramString1);
    i = paramInt1;
    util.LOGD("ret=" + paramInt1);
    i = paramInt1;
    if (paramInt1 == 0)
    {
      i = paramInt1;
      addUinPush(paramString1);
      i = paramInt1;
    }
    return i;
  }
  
  public int set_push_test(int paramInt, String paramString)
  {
    int j = 0;
    _test = paramInt;
    _test_host = paramString;
    i = j;
    try
    {
      if (this.mService == null)
      {
        i = j;
        reInit();
        return 0;
      }
      i = j;
      paramInt = this.mService.set_push_test(paramInt, paramString);
      i = paramInt;
      util.LOGD("ret=" + paramInt);
    }
    catch (Exception paramString)
    {
      for (;;)
      {
        reInit();
        paramInt = i;
      }
    }
    return paramInt;
  }
  
  public int un_register(long paramLong1, long paramLong2, long paramLong3, int paramInt)
  {
    int j = 0;
    int i = j;
    try
    {
      if (this.mService != null) {
        break label106;
      }
      i = j;
      reInit();
      return 0;
    }
    catch (Exception localException)
    {
      for (;;)
      {
        Object localObject;
        reInit();
        continue;
        long l = paramLong3;
        if (paramLong3 == 0L) {
          l = 1L;
        }
      }
    }
    i = j;
    paramInt = this.mService.un_register(paramLong1, paramLong2, localObject, paramInt);
    i = paramInt;
    util.LOGD("ret=" + paramInt);
    i = paramInt;
    if (paramInt == 0)
    {
      i = paramInt;
      deleteUinPush(paramLong1, paramLong2, localObject);
      i = paramInt;
    }
    return i;
  }
}
