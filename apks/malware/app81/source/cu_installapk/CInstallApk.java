package cu_installapk;

import android.content.ActivityNotFoundException;
import android.content.Intent;
import android.net.Uri;
import android.os.Environment;
import com.tencent.tmgp.lucifer.UnityPlayerNativeActivity;
import java.io.File;
import java.io.IOException;

public class CInstallApk
{
  public CInstallApk() {}
  
  public int installAPK(String paramString, UnityPlayerNativeActivity paramUnityPlayerNativeActivity)
  {
    if ((paramString == null) || (paramString.length() == 0)) {}
    while (!isFileExist(paramString)) {
      return -1;
    }
    File localFile = new File(paramString);
    String str1;
    if (!paramString.startsWith(Environment.getExternalStorageDirectory().getPath()))
    {
      str1 = paramUnityPlayerNativeActivity.getFilesDir().getPath();
      paramString = localFile.getAbsolutePath();
    }
    for (;;)
    {
      if ((paramString == null) || (str1.equals(paramString)))
      {
        paramString = new Intent();
        paramString.addFlags(268435456);
        paramString.setAction("android.intent.action.VIEW");
        paramString.setDataAndType(Uri.fromFile(localFile), "application/vnd.android.package-archive");
      }
      for (;;)
      {
        try
        {
          paramUnityPlayerNativeActivity.startActivity(paramString);
          return 0;
        }
        catch (ActivityNotFoundException paramString)
        {
          String str2;
          paramString.printStackTrace();
        }
        try
        {
          str2 = "chmod 777 " + paramString;
          Runtime.getRuntime().exec(str2);
          paramString = new File(paramString).getParent();
        }
        catch (IOException paramString)
        {
          paramString.printStackTrace();
          return -2;
        }
      }
    }
    return -3;
  }
  
  public boolean isFileExist(String paramString)
  {
    paramString = new File(paramString);
    return (paramString.exists()) && (paramString.isFile());
  }
}
