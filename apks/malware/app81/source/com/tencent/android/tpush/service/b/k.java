package com.tencent.android.tpush.service.b;

import android.content.Context;
import com.tencent.android.tpush.encrypt.Rijndael;
import com.tencent.android.tpush.encrypt.a;
import com.tencent.android.tpush.logging.TLog;
import com.tencent.android.tpush.service.d.d;
import java.util.ArrayList;
import java.util.Collections;
import java.util.Iterator;
import java.util.List;
import org.json.JSONException;
import org.json.JSONObject;

public class k
{
  private static k a = new k();
  private static JSONObject b = new JSONObject();
  private static String c = a.a("com.tencent.tpush.multpkgs");
  
  private k() {}
  
  public static k a()
  {
    return a;
  }
  
  private JSONObject b(Context paramContext)
  {
    TLog.v("XGService", "@@ loadRegisterPkgs(" + paramContext + ")");
    Object localObject1 = d.e(paramContext, c);
    paramContext = new JSONObject();
    if ((localObject1 != null) && (((String)localObject1).length() != 0))
    {
      try
      {
        localObject1 = new JSONObject(Rijndael.decrypt((String)localObject1));
        TLog.e("XGService", localJSONException1.getMessage());
      }
      catch (JSONException localJSONException1)
      {
        try
        {
          TLog.i("XGService", ">> size:" + ((JSONObject)localObject1).length() + "," + ((JSONObject)localObject1).toString());
          return localObject1;
        }
        catch (JSONException localJSONException2)
        {
          for (;;)
          {
            paramContext = localJSONException1;
            Object localObject2 = localJSONException2;
          }
        }
        localJSONException1 = localJSONException1;
      }
      return paramContext;
    }
    return paramContext;
  }
  
  private void c(Context paramContext)
  {
    TLog.v("XGService", "@@ saveRegisterPkgs(" + paramContext + ")");
    if ((b == null) || (b.length() == 0)) {
      return;
    }
    d.a(paramContext, c, Rijndael.encrypt(b.toString()));
  }
  
  public List a(Context paramContext, long paramLong)
  {
    TLog.v("XGService", "@@ getPkgs(" + paramContext + "," + paramLong + ")");
    ArrayList localArrayList = new ArrayList();
    if (paramContext == null) {
      return localArrayList;
    }
    try
    {
      b = b(paramContext);
      paramContext = b.getString(paramLong + "");
      TLog.i("XGService", ">> accessId:" + paramLong + ",pkgstr:" + paramContext);
      Collections.addAll(localArrayList, paramContext.split(","));
      return localArrayList;
    }
    catch (JSONException paramContext)
    {
      TLog.e("XGService", paramContext.getMessage());
      return localArrayList;
    }
    catch (Exception paramContext)
    {
      TLog.e("XGService", paramContext.getMessage());
    }
    return localArrayList;
  }
  
  public void a(Context paramContext)
  {
    TLog.v("XGService", "@@ clearRegisterPkgs(" + paramContext + ")");
    d.a(paramContext, c, "");
  }
  
  public void a(Context paramContext, long paramLong, String paramString)
  {
    TLog.v("XGService", "@@ putPkg(" + paramContext + "," + paramLong + "," + paramString + ")");
    if ((paramContext == null) || (d.a(paramString))) {
      return;
    }
    for (;;)
    {
      try
      {
        localObject = a(paramContext, paramLong);
        if (localObject == null)
        {
          localObject = new ArrayList();
          ((List)localObject).add(paramString);
          paramString = localObject.toString().replace(" ", "").replace("\t", "");
          paramString = paramString.substring(1, paramString.length() - 1);
          b.put(paramLong + "", paramString);
          c(paramContext);
          return;
        }
      }
      catch (JSONException paramContext)
      {
        Object localObject;
        TLog.e("XGService", paramContext.getMessage());
        return;
        Iterator localIterator = ((List)localObject).iterator();
        if (localIterator.hasNext())
        {
          boolean bool = paramString.equals((String)localIterator.next());
          if (bool) {
            return;
          }
        }
      }
      catch (Exception paramContext)
      {
        TLog.e("XGService", paramContext.toString());
        return;
      }
    }
  }
  
  public void a(Context paramContext, String paramString)
  {
    TLog.v("XGService", "@@ delPkg(" + paramContext + "," + paramString + ")");
    if ((paramContext == null) || (paramString == null) || (paramString.length() == 0)) {
      return;
    }
    for (;;)
    {
      try
      {
        Iterator localIterator = b.keys();
        if (!localIterator.hasNext()) {
          break;
        }
        String str = (String)localIterator.next();
        Object localObject = a(paramContext, Long.valueOf(str).longValue());
        ArrayList localArrayList = new ArrayList();
        int i = 0;
        if (i < ((List)localObject).size())
        {
          if (paramString.equals(((List)localObject).get(i)))
          {
            TLog.i("XGService", ">>> pkgName:" + paramString + " deleted");
            localArrayList.add(((List)localObject).get(i));
          }
        }
        else
        {
          ((List)localObject).removeAll(localArrayList);
          localObject = localObject.toString().replace(" ", "").replace("\t", "");
          localObject = ((String)localObject).substring(1, ((String)localObject).length() - 1);
          b.put(str, localObject);
          c(paramContext);
          continue;
        }
        i += 1;
      }
      catch (JSONException paramContext)
      {
        TLog.e("TPush", paramContext.getMessage());
        return;
      }
      catch (Exception paramContext)
      {
        TLog.e("TPush", paramContext.toString());
        return;
      }
    }
  }
}
