package com.tencent.bugly.crashreport.common.strategy;

import android.content.Context;
import com.tencent.bugly.proguard.Q;
import com.tencent.bugly.proguard.R;
import com.tencent.bugly.proguard.l;
import com.tencent.bugly.proguard.n;
import com.tencent.bugly.proguard.r;
import com.tencent.bugly.proguard.t;
import com.tencent.bugly.proguard.u;
import com.tencent.bugly.proguard.w;
import com.tencent.bugly.proguard.x;
import java.util.ArrayList;
import java.util.Date;
import java.util.Iterator;
import java.util.List;

public final class c
{
  private static c a = null;
  private final n b;
  private final b c;
  private final l d;
  private final r e;
  private final t f;
  private b g = null;
  private Boolean h = null;
  private long i = -1L;
  private int j = 0;
  
  private c(Context paramContext, n paramN, b paramB, l paramL, r paramR, t paramT)
  {
    this.b = paramN;
    this.c = paramB;
    new ArrayList();
    this.d = paramL;
    this.e = paramR;
    this.f = paramT;
    this.i = (com.tencent.bugly.proguard.a.n() + 86400000L);
    this.f.a(new a(1), this.i - new Date().getTime() + 5000L);
  }
  
  public static c a()
  {
    try
    {
      c localC = a;
      return localC;
    }
    finally
    {
      localObject = finally;
      throw localObject;
    }
  }
  
  public static c a(Context paramContext, n paramN, b paramB, l paramL, r paramR, t paramT)
  {
    try
    {
      if (a == null) {
        a = new c(paramContext, paramN, paramB, paramL, paramR, paramT);
      }
      paramContext = a;
      return paramContext;
    }
    finally {}
  }
  
  private void a(final int paramInt, String paramString, boolean paramBoolean)
  {
    final d localD = new d();
    localD.b = paramInt;
    localD.c = this.b.B();
    localD.d = (this.b.k() + "|" + paramInt + "|" + paramString);
    localD.e = new Date().getTime();
    localD.f = -1L;
    if (paramBoolean)
    {
      u.b("to delay record!", new Object[0]);
      this.f.a(new Runnable()
      {
        public final void run()
        {
          u.b("to record! %d", new Object[] { Integer.valueOf(paramInt) });
          c.a(c.this).a(localD);
        }
      }, 60000L);
      return;
    }
    u.b("to record! %d", new Object[] { Integer.valueOf(paramInt) });
    this.d.a(localD);
  }
  
  private void a(Boolean paramBoolean)
  {
    try
    {
      this.h = paramBoolean;
      return;
    }
    finally
    {
      paramBoolean = finally;
      throw paramBoolean;
    }
  }
  
  private void b(int paramInt)
  {
    try
    {
      this.j = paramInt;
      return;
    }
    finally
    {
      localObject = finally;
      throw localObject;
    }
  }
  
  private void b(b paramB)
  {
    try
    {
      this.g = paramB;
      return;
    }
    finally
    {
      paramB = finally;
      throw paramB;
    }
  }
  
  private void c(b paramB)
  {
    try
    {
      b(paramB);
      this.d.b();
      this.d.a(paramB);
      return;
    }
    finally
    {
      paramB = finally;
      throw paramB;
    }
  }
  
  private List<d> d(b paramB)
  {
    Object localObject1 = null;
    if ((paramB == null) || (!paramB.e)) {
      u.b("userinfo close!", new Object[0]);
    }
    Object localObject2;
    String str;
    long l;
    ArrayList localArrayList;
    do
    {
      return localObject1;
      localObject2 = this.b.B();
      str = this.b.k();
      l = com.tencent.bugly.proguard.a.n();
      localArrayList = new ArrayList();
    } while (!paramB.e);
    paramB = this.d.a((String)localObject2);
    label90:
    int m;
    if (paramB != null)
    {
      localObject1 = paramB.iterator();
      int k = 1;
      for (;;)
      {
        m = k;
        if (!((Iterator)localObject1).hasNext()) {
          break label177;
        }
        localObject2 = (d)((Iterator)localObject1).next();
        if (((d)localObject2).f == -1L) {
          break label375;
        }
        ((Iterator)localObject1).remove();
        if (((d)localObject2).e >= l) {
          break;
        }
        localArrayList.add(localObject2);
      }
      if (!str.equals(((d)localObject2).d)) {
        break label375;
      }
      k = 0;
    }
    label177:
    label372:
    label375:
    for (;;)
    {
      break label90;
      m = 1;
      if (m != 0)
      {
        localObject1 = a(1);
        if (paramB != null) {
          break label372;
        }
        paramB = new ArrayList();
      }
      for (;;)
      {
        paramB.add(localObject1);
        for (;;)
        {
          localObject1 = paramB;
          if (localArrayList.size() <= 0) {
            break;
          }
          localObject1 = this.d;
          l.f(localArrayList);
          localObject1 = "dropOldUI count:" + localArrayList.size();
          a(11, (String)localObject1, true);
          u.b("inner record %s", new Object[] { localObject1 });
          return paramB;
          localObject1 = paramB.iterator();
          while (((Iterator)localObject1).hasNext())
          {
            localObject2 = (d)((Iterator)localObject1).next();
            if ((str.equals(((d)localObject2).d)) && (((d)localObject2).f == -1L) && (((d)localObject2).e >= l))
            {
              ((Iterator)localObject1).remove();
              localArrayList.add(localObject2);
            }
          }
        }
      }
    }
  }
  
  private Boolean k()
  {
    try
    {
      Boolean localBoolean = this.h;
      return localBoolean;
    }
    finally
    {
      localObject = finally;
      throw localObject;
    }
  }
  
  private int l()
  {
    try
    {
      int k = this.j;
      return k;
    }
    finally
    {
      localObject = finally;
      throw localObject;
    }
  }
  
  protected final d a(int paramInt)
  {
    d localD = new d();
    localD.b = paramInt;
    localD.c = this.b.B();
    localD.d = this.b.k();
    localD.e = new Date().getTime();
    localD.f = -1L;
    return localD;
  }
  
  protected final List<x> a(b paramB)
  {
    if (paramB == null)
    {
      u.b("have not synced remote!", new Object[0]);
      return null;
    }
    if (!paramB.d)
    {
      u.b("crashreport remote closed!", new Object[0]);
      return null;
    }
    long l1 = new Date().getTime();
    long l2 = com.tencent.bugly.proguard.a.n();
    paramB = this.d.c();
    if ((paramB != null) && (paramB.size() > 0))
    {
      Object localObject1 = new ArrayList();
      Object localObject2 = paramB.iterator();
      while (((Iterator)localObject2).hasNext())
      {
        w localW = (w)((Iterator)localObject2).next();
        if (localW.b < l2 - 604800000L)
        {
          ((Iterator)localObject2).remove();
          ((List)localObject1).add(localW);
        }
        else if (localW.d)
        {
          if (localW.b >= l1 - 86400000L)
          {
            ((Iterator)localObject2).remove();
          }
          else if (!localW.e)
          {
            ((Iterator)localObject2).remove();
            ((List)localObject1).add(localW);
          }
        }
        else if ((localW.f >= 3L) && (localW.b < l1 - 86400000L))
        {
          ((Iterator)localObject2).remove();
          ((List)localObject1).add(localW);
        }
      }
      if (((List)localObject1).size() > 0)
      {
        localObject2 = this.d;
        l.c((List)localObject1);
        localObject1 = "dropOldCrash count:" + ((List)localObject1).size();
        a(11, (String)localObject1, true);
        u.b("inner record %s", new Object[] { localObject1 });
      }
    }
    return this.d.b(paramB);
  }
  
  public final void a(long paramLong)
  {
    this.f.a(new a(2, paramLong));
  }
  
  public final void a(R paramR)
  {
    if (paramR == null) {
      return;
    }
    b localB = new b();
    localB.d = paramR.a;
    localB.f = paramR.c;
    localB.e = paramR.b;
    String str = paramR.d;
    if ((str != null) && (str.trim().length() > 0))
    {
      k = 0;
      if (k == 0) {
        localB.g = paramR.d;
      }
      str = paramR.e;
      if ((str == null) || (str.trim().length() <= 0)) {
        break label183;
      }
      k = 0;
      label97:
      if (k == 0) {
        localB.h = paramR.e;
      }
      if (paramR.f != null)
      {
        str = paramR.f.a;
        if ((str == null) || (str.trim().length() <= 0)) {
          break label188;
        }
      }
    }
    label183:
    label188:
    for (int k = 0;; k = 1)
    {
      if (k == 0) {
        localB.i = paramR.f.a;
      }
      c(localB);
      paramR = localB.i;
      paramR = localB.a;
      u.a();
      return;
      k = 1;
      break;
      k = 1;
      break label97;
    }
  }
  
  public final void a(x paramX)
  {
    if (paramX.b == 2) {
      return;
    }
    a localA = new a();
    localA.b = 1;
    localA.c = paramX.y;
    localA.d = paramX.z;
    localA.e = paramX.r;
    paramX = this.d;
    l.b(1);
    this.d.a(localA);
  }
  
  public final void a(String paramString)
  {
    u.b("on db access fail delay record ", new Object[0]);
    a(10, paramString, true);
  }
  
  public final void a(String paramString, boolean paramBoolean)
  {
    a(11, paramString, paramBoolean);
    u.b("inner record %s", new Object[] { paramString });
  }
  
  protected final void b(long paramLong)
  {
    b localB2 = c();
    b localB1 = localB2;
    if (localB2 == null)
    {
      localB2 = this.d.a();
      localB1 = localB2;
      if (localB2 != null)
      {
        b(localB2);
        localB1 = localB2;
      }
    }
    if (localB1 != null)
    {
      if (localB1.e) {
        this.d.a(a(1));
      }
      u.a();
      this.f.a(new a(0), paramLong);
      return;
    }
    u.a();
    new a(0).run();
  }
  
  public final void b(String paramString)
  {
    a(12, paramString, false);
    u.b("inner record %s", new Object[] { paramString });
  }
  
  /* Error */
  public final boolean b()
  {
    // Byte code:
    //   0: aload_0
    //   1: monitorenter
    //   2: aload_0
    //   3: getfield 40	com/tencent/bugly/crashreport/common/strategy/c:g	Lcom/tencent/bugly/crashreport/common/strategy/b;
    //   6: astore_2
    //   7: aload_2
    //   8: ifnull +9 -> 17
    //   11: iconst_1
    //   12: istore_1
    //   13: aload_0
    //   14: monitorexit
    //   15: iload_1
    //   16: ireturn
    //   17: iconst_0
    //   18: istore_1
    //   19: goto -6 -> 13
    //   22: astore_2
    //   23: aload_0
    //   24: monitorexit
    //   25: aload_2
    //   26: athrow
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	27	0	this	c
    //   12	7	1	bool	boolean
    //   6	2	2	localB	b
    //   22	4	2	localObject	Object
    // Exception table:
    //   from	to	target	type
    //   2	7	22	finally
  }
  
  protected final b c()
  {
    try
    {
      b localB = this.g;
      return localB;
    }
    finally
    {
      localObject = finally;
      throw localObject;
    }
  }
  
  public final b d()
  {
    b localB = c();
    if (localB != null) {
      return localB;
    }
    return this.c;
  }
  
  public final void e()
  {
    this.f.a(new a(2, 10000L));
  }
  
  public final void f()
  {
    this.f.a(new Runnable()
    {
      public final void run()
      {
        b localB = c.this.c();
        if ((localB != null) && (localB.e)) {
          c.a(c.this).a(c.this.a(2));
        }
      }
    });
  }
  
  public final boolean g()
  {
    Object localObject1 = k();
    if (localObject1 != null) {
      return ((Boolean)localObject1).booleanValue();
    }
    Object localObject2 = this.b.B();
    Object localObject3 = this.d.a(1);
    localObject1 = new ArrayList();
    if ((localObject3 != null) && (((List)localObject3).size() > 0))
    {
      localObject3 = ((List)localObject3).iterator();
      while (((Iterator)localObject3).hasNext())
      {
        a localA = (a)((Iterator)localObject3).next();
        if (((String)localObject2).equals(localA.c))
        {
          a(Boolean.valueOf(true));
          ((List)localObject1).add(localA);
        }
      }
      if (((List)localObject1).size() > 0)
      {
        localObject2 = this.d;
        l.g((List)localObject1);
      }
      return true;
    }
    a(Boolean.valueOf(false));
    return false;
  }
  
  protected final void h()
  {
    b(l() + 1);
    int k = l();
    if (k == 1) {}
    Object localObject2;
    long l;
    Object localObject1;
    for (k = 1;; k = 2)
    {
      u.a();
      if (g()) {
        u.a();
      }
      localObject2 = this.d.a();
      b localB = c();
      l = com.tencent.bugly.proguard.a.n();
      localObject1 = localB;
      if (localObject2 != null) {
        if (localB != null)
        {
          localObject1 = localB;
          if (localB.c >= ((b)localObject2).c) {}
        }
        else
        {
          c((b)localObject2);
          localObject1 = localObject2;
        }
      }
      if (localObject1 != null) {
        break;
      }
      localObject1 = a(1);
      localObject2 = new ArrayList();
      ((List)localObject2).add(localObject1);
      this.e.a((List)localObject2, this, k);
      return;
    }
    if (l - ((b)localObject1).c >= 604800000L)
    {
      new StringBuilder("step req by ovtime && ").append(((b)localObject1).f).toString();
      u.a();
    }
    for (boolean bool = ((b)localObject1).f;; bool = false)
    {
      localObject2 = d((b)localObject1);
      localObject1 = a((b)localObject1);
      if ((bool) && (localObject2 != null) && (((List)localObject2).size() > 0))
      {
        this.e.a((List)localObject2, this, k);
        if ((localObject1 != null) && (((List)localObject1).size() > 0)) {
          this.e.a((List)localObject1, this);
        }
        if (localObject2 == null) {
          break label366;
        }
        k = ((List)localObject2).size();
        label278:
        if (localObject1 == null) {
          break label371;
        }
      }
      label366:
      label371:
      for (k = ((List)localObject1).size();; k = 0)
      {
        u.a();
        if (!bool) {
          break label376;
        }
        this.f.a(new a(0), 600000L);
        return;
        if (bool)
        {
          this.e.a(this);
          break;
        }
        if ((localObject2 == null) || (((List)localObject2).size() <= 0)) {
          break;
        }
        this.e.b((List)localObject2, this, k);
        break;
        k = 0;
        break label278;
      }
      label376:
      this.f.a(new a(0), 21600000L);
      return;
    }
  }
  
  /* Error */
  protected final void i()
  {
    // Byte code:
    //   0: aload_0
    //   1: monitorenter
    //   2: new 74	java/util/Date
    //   5: dup
    //   6: invokespecial 75	java/util/Date:<init>	()V
    //   9: invokevirtual 78	java/util/Date:getTime	()J
    //   12: lstore_1
    //   13: lload_1
    //   14: aload_0
    //   15: getfield 46	com/tencent/bugly/crashreport/common/strategy/c:i	J
    //   18: lcmp
    //   19: ifge +33 -> 52
    //   22: aload_0
    //   23: getfield 61	com/tencent/bugly/crashreport/common/strategy/c:f	Lcom/tencent/bugly/proguard/t;
    //   26: new 10	com/tencent/bugly/crashreport/common/strategy/c$a
    //   29: dup
    //   30: aload_0
    //   31: iconst_1
    //   32: invokespecial 72	com/tencent/bugly/crashreport/common/strategy/c$a:<init>	(Lcom/tencent/bugly/crashreport/common/strategy/c;I)V
    //   35: aload_0
    //   36: getfield 46	com/tencent/bugly/crashreport/common/strategy/c:i	J
    //   39: lload_1
    //   40: lsub
    //   41: ldc2_w 79
    //   44: ladd
    //   45: invokevirtual 85	com/tencent/bugly/proguard/t:a	(Ljava/lang/Runnable;J)Z
    //   48: pop
    //   49: aload_0
    //   50: monitorexit
    //   51: return
    //   52: aload_0
    //   53: invokestatic 67	com/tencent/bugly/proguard/a:n	()J
    //   56: ldc2_w 68
    //   59: ladd
    //   60: putfield 46	com/tencent/bugly/crashreport/common/strategy/c:i	J
    //   63: aload_0
    //   64: getfield 57	com/tencent/bugly/crashreport/common/strategy/c:d	Lcom/tencent/bugly/proguard/l;
    //   67: aload_0
    //   68: iconst_3
    //   69: invokevirtual 205	com/tencent/bugly/crashreport/common/strategy/c:a	(I)Lcom/tencent/bugly/crashreport/common/strategy/d;
    //   72: invokevirtual 154	com/tencent/bugly/proguard/l:a	(Lcom/tencent/bugly/crashreport/common/strategy/d;)V
    //   75: aload_0
    //   76: getfield 61	com/tencent/bugly/crashreport/common/strategy/c:f	Lcom/tencent/bugly/proguard/t;
    //   79: new 10	com/tencent/bugly/crashreport/common/strategy/c$a
    //   82: dup
    //   83: aload_0
    //   84: iconst_0
    //   85: invokespecial 72	com/tencent/bugly/crashreport/common/strategy/c$a:<init>	(Lcom/tencent/bugly/crashreport/common/strategy/c;I)V
    //   88: aload_0
    //   89: getfield 46	com/tencent/bugly/crashreport/common/strategy/c:i	J
    //   92: lload_1
    //   93: lsub
    //   94: ldc2_w 79
    //   97: ladd
    //   98: invokevirtual 85	com/tencent/bugly/proguard/t:a	(Ljava/lang/Runnable;J)Z
    //   101: pop
    //   102: goto -53 -> 49
    //   105: astore_3
    //   106: aload_0
    //   107: monitorexit
    //   108: aload_3
    //   109: athrow
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	110	0	this	c
    //   12	81	1	l	long
    //   105	4	3	localObject	Object
    // Exception table:
    //   from	to	target	type
    //   2	49	105	finally
    //   52	102	105	finally
  }
  
  protected final void j()
  {
    b localB = c();
    if ((localB != null) && (localB.e)) {
      this.d.a(a(2));
    }
  }
  
  public final class a
    implements Runnable
  {
    private int a;
    private long b;
    
    public a(int paramInt)
    {
      this.a = paramInt;
      this.b = -1L;
    }
    
    public a(int paramInt, long paramLong)
    {
      this.a = 2;
      this.b = paramLong;
    }
    
    public final void run()
    {
      try
      {
        switch (this.a)
        {
        case 0: 
          u.c("unknown tasktype :%d", new Object[] { Integer.valueOf(this.a) });
          return;
          c.this.h();
          return;
        }
      }
      catch (Throwable localThrowable)
      {
        while (!u.a(localThrowable))
        {
          localThrowable.printStackTrace();
          return;
          c.this.i();
          return;
          c.this.b(this.b);
          return;
          c.this.j();
          return;
        }
      }
    }
  }
}
