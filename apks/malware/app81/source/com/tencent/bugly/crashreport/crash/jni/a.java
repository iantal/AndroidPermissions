package com.tencent.bugly.crashreport.crash.jni;

import android.content.Context;
import com.tencent.bugly.crashreport.CrashReport.CrashHandleCallback;
import com.tencent.bugly.crashreport.common.strategy.c;
import com.tencent.bugly.proguard.n;
import com.tencent.bugly.proguard.u;
import com.tencent.bugly.proguard.x;
import com.tencent.bugly.proguard.y;
import java.io.File;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Locale;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;

public final class a
  implements NativeExceptionHandler
{
  private final Context a;
  private final y b;
  private final n c;
  private final c d;
  private String e;
  private CrashReport.CrashHandleCallback f;
  
  public a(Context paramContext, n paramN, y paramY, c paramC, CrashReport.CrashHandleCallback paramCrashHandleCallback)
  {
    this.a = paramContext;
    this.b = paramY;
    this.c = paramN;
    this.d = paramC;
    this.f = paramCrashHandleCallback;
  }
  
  public final void a(String paramString)
  {
    try
    {
      this.e = paramString;
      return;
    }
    finally
    {
      paramString = finally;
      throw paramString;
    }
  }
  
  public final void handleNativeException(int paramInt1, int paramInt2, long paramLong1, long paramLong2, String paramString1, String paramString2, String paramString3, String paramString4, int paramInt3, String paramString5, int paramInt4, int paramInt5, int paramInt6, String paramString6, String paramString7)
  {
    u.a("Native Crash Happen", new Object[0]);
    for (;;)
    {
      try
      {
        this.d.d();
        if (!this.d.b())
        {
          u.c("waiting for remote sync", new Object[0]);
          paramInt1 = 0;
          boolean bool = this.d.b();
          if (bool) {}
        }
      }
      catch (Throwable paramString1)
      {
        String str;
        if (u.a(paramString1)) {
          return;
        }
        paramString1.printStackTrace();
        return;
        if (paramInt4 <= 0) {
          continue;
        }
        paramString6 = com.tencent.bugly.proguard.a.a(this.a, paramInt4);
        paramString3 = paramString5;
        paramString5 = paramString6;
        continue;
        paramString2 = packageCrashDatas(Thread.currentThread().getName(), paramLong2 + 1000L * paramLong1, paramString1, paramString2, str, paramString3, paramString5, paramString4, paramString7);
        if (paramString2 != null) {
          continue;
        }
        u.c("pkg crash datas fail!", new Object[0]);
        this.d.a("packageFail", false);
        return;
        paramString3 = n.a(this.a);
        u.c("#++++++++++Detail Record By Bugly++++++++++#", new Object[0]);
        u.c("# You can go to Bugly(http:\\\\bugly.qq.com) to see more detail of this Report!", new Object[0]);
        u.c("# CRASH REPORT CREATED BY NATIVE VERSION %s", new Object[] { paramString2.J });
        u.c("# REPORT ID: %s", new Object[] { paramString2.c });
        u.c("# PKG NAME: %s", new Object[] { paramString3.f() });
        u.c("# APP VER: %s", new Object[] { paramString3.e() });
        paramString1 = new Date(paramString2.K);
        if (paramString1 != null) {
          continue;
        }
        paramString1 = null;
        u.c("# LAUNCH TIME:%s", new Object[] { paramString1 });
        u.c("# CRASH TYPE: %s", new Object[] { "NATIVE_CRASH" });
        paramString1 = new Date(paramString2.r);
        if (paramString1 != null) {
          continue;
        }
        paramString1 = null;
        u.c("# CRASH TIME: %s", new Object[] { paramString1 });
        u.c("# CRASH PROCESS: %s", new Object[] { paramString3.B() });
        u.c("# CRASH THREAD: %s", new Object[] { paramString2.z });
        paramString4 = paramString3.i();
        if (!paramString3.z().booleanValue()) {
          continue;
        }
        paramString1 = "ROOTED";
        u.c("# CRASH DEVICE: %s %s", new Object[] { paramString4, paramString1 });
        u.c("# RUNTIME AVAIL RAM:%d ROM:%d SD:%d", new Object[] { Long.valueOf(paramString2.A), Long.valueOf(paramString2.B), Long.valueOf(paramString2.C) });
        u.c("# RUNTIME TOTAL RAM:%d ROM:%d SD:%d", new Object[] { Long.valueOf(paramString2.D), Long.valueOf(paramString2.E), Long.valueOf(paramString2.F) });
        u.c("# EXCEPTION FIRED BY %s %s", new Object[] { paramString2.I, paramString2.H });
        u.c("# EXCEPTION TYPE: %s", new Object[] { paramString2.n });
        u.c("# EXCEPTION MSG: %s", new Object[] { paramString2.o });
        u.c("# EXCEPTION STACK:\n %s", new Object[] { paramString2.q });
        u.c("#++++++++++++++++++++++++++++++++++++++++++#", new Object[0]);
        this.d.a(paramString2);
        this.b.a(paramString2);
        b.b(this.e);
        return;
        paramString1 = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss", Locale.US).format(paramString1);
        continue;
        paramString1 = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss", Locale.US).format(paramString1);
        continue;
        paramString1 = "UNROOT";
        continue;
        paramString3 = paramString5;
        paramString5 = paramString6;
        continue;
      }
      try
      {
        Thread.sleep(500L);
        paramInt2 = paramInt1 + 500;
        paramInt1 = paramInt2;
        if (paramInt2 >= 5000)
        {
          paramLong2 /= 1000L;
          str = b.a(paramString3);
          paramString6 = "UNKNOWN(" + paramInt4 + ")";
          if (paramInt3 > 0)
          {
            paramString1 = paramString1 + "(" + paramString5 + ")";
            paramString3 = "KERNEL";
            paramString5 = paramString6;
            if (!this.d.b()) {
              u.b("no remote but still store!", new Object[0]);
            }
            if ((this.d.d().d) || (!this.d.b())) {
              continue;
            }
            u.c("crash report was closed by remote , will not upload to Bugly , print local for helpful!", new Object[0]);
            paramString3 = Thread.currentThread().getName();
            paramString5 = n.a(this.a);
            u.c("#++++++++++Simple Record By Bugly++++++++++#", new Object[0]);
            u.c("# You can use Bugly(http:\\\\bugly.qq.com) to get more Crash Detail!", new Object[0]);
            u.c("# CRASH REPORT CREATED BY NATIVE VERSION %s", new Object[] { paramString7 });
            u.c("# PKG NAME: %s", new Object[] { paramString5.f() });
            u.c("# APP VER: %s", new Object[] { paramString5.e() });
            u.c("# CRASH TYPE: NATIVE_CRASH", new Object[0]);
            u.c("# CRASH TIME: %s", new Object[] { new SimpleDateFormat("yyyy-MM-dd HH:mm:ss", Locale.US).format(new Date()) });
            u.c("# CRASH PROCESS: %s", new Object[] { paramString5.B() });
            u.c("# CRASH THREAD: %s", new Object[] { paramString3 });
            u.c("# CRASH TYPE: %s", new Object[] { paramString1 });
            u.c("# CRASH ADDR: %s", new Object[] { paramString2 });
            u.c("# CRASH STACK:", new Object[0]);
            u.c(str, new Object[0]);
            u.c("#++++++++++++++++++++++++++++++++++++++++++#", new Object[0]);
            if (paramString4 != null)
            {
              paramString1 = new File(paramString4);
              if ((paramString1.isFile()) && (paramString1.exists()) && (paramString1.canWrite())) {
                paramString1.delete();
              }
            }
            this.d.a("remoteClose", false);
          }
        }
      }
      catch (InterruptedException paramString6)
      {
        paramString6.printStackTrace();
      }
    }
  }
  
  public final x packageCrashDatas(String paramString1, long paramLong, String paramString2, String paramString3, String paramString4, String paramString5, String paramString6, String paramString7, String paramString8)
  {
    x localX = new x();
    localX.A = com.tencent.bugly.proguard.a.i();
    localX.B = com.tencent.bugly.proguard.a.g();
    localX.C = com.tencent.bugly.proguard.a.k();
    localX.D = this.c.s();
    localX.E = this.c.r();
    localX.F = this.c.t();
    localX.w = com.tencent.bugly.proguard.a.b(this.a, 20000);
    localX.b = 1;
    localX.e = this.c.l();
    localX.f = this.c.e();
    localX.g = this.c.x();
    localX.m = this.c.k();
    localX.n = paramString2;
    localX.o = null;
    localX.p = paramString3;
    localX.q = paramString4;
    localX.r = paramLong;
    localX.u = com.tencent.bugly.proguard.a.c(localX.q.getBytes());
    localX.x = com.tencent.bugly.proguard.a.a(20000, true);
    localX.y = this.c.B();
    localX.z = paramString1;
    localX.G = this.c.A();
    localX.h = this.c.w();
    localX.v = paramString7;
    localX.H = paramString6;
    localX.I = paramString5;
    localX.J = paramString8;
    localX.K = this.c.b();
    localX.L = com.tencent.bugly.proguard.a.d(this.a).booleanValue();
    if (this.f != null) {}
    for (;;)
    {
      try
      {
        u.a("start notify crashHandleCallback!", new Object[0]);
        paramString3 = this.f.onCrashHandleStart(2, localX.n, localX.o, localX.q);
        if ((paramString3 != null) && (paramString3.size() > 0))
        {
          localX.M = new HashMap(paramString3.size());
          paramString4 = paramString3.entrySet().iterator();
          if (!paramString4.hasNext()) {
            break;
          }
          paramString5 = (Map.Entry)paramString4.next();
          paramString1 = (String)paramString5.getKey();
          if ((paramString1 != null) && (paramString1.trim().length() > 0))
          {
            i = 0;
            if (i != 0) {
              continue;
            }
            paramString2 = (String)paramString5.getKey();
            paramString1 = paramString2;
            if (paramString2.length() > 100)
            {
              paramString1 = paramString2.substring(0, 100);
              u.b("setted key length is over limit %d substring to %s", new Object[] { Integer.valueOf(100), paramString1 });
            }
            paramString2 = (String)paramString5.getValue();
            if ((paramString2 == null) || (paramString2.trim().length() <= 0)) {
              break label695;
            }
            i = 0;
            if ((i != 0) || (((String)paramString5.getValue()).length() <= 30000)) {
              break label701;
            }
            paramString2 = ((String)paramString5.getValue()).substring(((String)paramString5.getValue()).length() - 30000);
            u.b("setted %s value length is over limit %d substring", new Object[] { paramString1, Integer.valueOf(30000) });
            localX.M.put(paramString1, paramString2);
            u.a("add setted key %s value size:%d", new Object[] { paramString1, Integer.valueOf(paramString2.length()) });
            continue;
          }
        }
        else
        {
          return localX;
        }
      }
      catch (Throwable paramString1)
      {
        u.b("crash handle callback somthing wrong! %s", new Object[] { paramString1.getClass().getName() });
        if (!u.a(paramString1)) {
          paramString1.printStackTrace();
        }
      }
      int i = 1;
      continue;
      label695:
      i = 1;
      continue;
      label701:
      paramString2 = (String)paramString5.getValue();
    }
    paramString3.putAll(paramString3);
    return localX;
  }
}
