package com.tencent.midas.wx;

import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.os.Handler;
import android.os.Message;
import com.tencent.midas.comm.APLog;
import com.tencent.mm.sdk.modelbase.BaseReq;
import com.tencent.mm.sdk.modelbase.BaseResp;
import com.tencent.mm.sdk.modelpay.PayReq;
import com.tencent.mm.sdk.modelpay.PayReq.Options;
import com.tencent.mm.sdk.openapi.IWXAPI;
import com.tencent.mm.sdk.openapi.IWXAPIEventHandler;
import com.tencent.mm.sdk.openapi.WXAPIFactory;
import java.util.ArrayList;
import java.util.Iterator;

public class APMidasWXPayHelper
  implements IWXAPIEventHandler
{
  private static Object a = new Object();
  private static APMidasWXPayHelper b = null;
  private ArrayList c = new ArrayList(1);
  private IWXAPI d;
  
  private APMidasWXPayHelper(Context paramContext)
  {
    this.d = WXAPIFactory.createWXAPI(paramContext, null);
  }
  
  public static APMidasWXPayHelper getInstance(Context paramContext)
  {
    if (b == null) {}
    synchronized (a)
    {
      if (b == null) {
        b = new APMidasWXPayHelper(paramContext.getApplicationContext());
      }
      return b;
    }
  }
  
  public void addObserver(Handler paramHandler)
  {
    APLog.i("APMidawxPayHelper", "addObserver observer:" + paramHandler);
    synchronized (this.c)
    {
      if (!this.c.contains(paramHandler)) {
        this.c.add(paramHandler);
      }
      return;
    }
  }
  
  public int getWXAppSupportAPI()
  {
    return this.d.getWXAppSupportAPI();
  }
  
  public void handleIntent(Intent paramIntent)
  {
    APLog.i("APMidawxPayHelper", "handleIntent intent:" + paramIntent);
    if (this.d != null) {
      this.d.handleIntent(paramIntent, this);
    }
  }
  
  public boolean isWXinstalled()
  {
    if (this.d == null) {
      return false;
    }
    boolean bool = this.d.isWXAppInstalled();
    APLog.i("APMidaWXPayHelper", "isWXinstalled:" + bool);
    return bool;
  }
  
  public boolean isWXsupportApi()
  {
    if (this.d == null) {
      return false;
    }
    return this.d.isWXAppSupportAPI();
  }
  
  public boolean isWXsupportPayApi()
  {
    return this.d.getWXAppSupportAPI() >= 570425345;
  }
  
  public void onReq(BaseReq paramBaseReq) {}
  
  public void onResp(BaseResp paramBaseResp)
  {
    APLog.i("APMidawxPayHelper", "Helper onResp:" + paramBaseResp.getType());
    APLog.i("APMidawxPayHelper", "Helper onResp, errCode = " + paramBaseResp.errCode);
    synchronized (this.c)
    {
      Iterator localIterator = this.c.iterator();
      if (!localIterator.hasNext()) {
        return;
      }
      Handler localHandler = (Handler)localIterator.next();
      Message localMessage = new Message();
      localMessage.what = 10;
      Bundle localBundle = new Bundle();
      localBundle.putInt("errCode", paramBaseResp.errCode);
      localBundle.putString("errStr", paramBaseResp.errStr);
      localBundle.putString("openId", paramBaseResp.openId);
      localBundle.putString("transaction", paramBaseResp.transaction);
      localMessage.setData(localBundle);
      localHandler.sendMessage(localMessage);
    }
  }
  
  public void registerApp(String paramString)
  {
    if (this.d != null) {
      this.d.registerApp(paramString);
    }
  }
  
  public void removeObserver(Handler paramHandler)
  {
    APLog.i("APMidawxPayHelper", "removeObserver observer:" + paramHandler);
    synchronized (this.c)
    {
      if (this.c.contains(paramHandler)) {
        this.c.remove(paramHandler);
      }
      return;
    }
  }
  
  public void sendReq(Bundle paramBundle)
  {
    PayReq localPayReq = new PayReq();
    localPayReq.appId = paramBundle.getString("wxAppId");
    localPayReq.partnerId = paramBundle.getString("partnerId");
    localPayReq.prepayId = paramBundle.getString("prepayId");
    localPayReq.nonceStr = paramBundle.getString("nonceStr");
    localPayReq.timeStamp = paramBundle.getString("timeStamp");
    localPayReq.packageValue = paramBundle.getString("package");
    localPayReq.sign = paramBundle.getString("sign");
    localPayReq.options = new PayReq.Options();
    localPayReq.options.callbackClassName = "com.tencent.midas.wx.APMidasWXPayActivity";
    APLog.i("APMidawxPayHelper", "sendReq params:");
    APLog.i("APMidawxPayHelper", "appId:" + localPayReq.appId);
    APLog.i("APMidawxPayHelper", "partnerId:" + localPayReq.partnerId);
    APLog.i("APMidawxPayHelper", "prepayId:" + localPayReq.prepayId);
    APLog.i("APMidawxPayHelper", "nonceStr:" + localPayReq.nonceStr);
    APLog.i("APMidawxPayHelper", "timeStamp:" + localPayReq.timeStamp);
    APLog.i("APMidawxPayHelper", "packageValue:" + localPayReq.packageValue);
    APLog.i("APMidawxPayHelper", "sign:" + localPayReq.sign);
    this.d.registerApp(localPayReq.appId);
    this.d.sendReq(localPayReq);
  }
  
  public void unRegisterApp()
  {
    if (this.d != null) {
      this.d.unregisterApp();
    }
  }
}
