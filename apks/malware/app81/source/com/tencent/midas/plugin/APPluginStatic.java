package com.tencent.midas.plugin;

import android.app.ActivityManager;
import android.app.ActivityManager.RunningAppProcessInfo;
import android.content.Context;
import com.tencent.midas.comm.APLog;
import dalvik.system.DexClassLoader;
import java.io.File;
import java.lang.ref.WeakReference;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.concurrent.ConcurrentHashMap;

public abstract class APPluginStatic
{
  public static final String PARAM_CLASS_STATISTICS_UPLOADER = "clsUploader";
  public static final String PARAM_CLEAR_TOP = "cleartop";
  public static final String PARAM_LAUNCH_ACTIVITY = "pluginsdk_launchActivity";
  public static final String PARAM_PLUGIN_INTERNAL_ACTIVITIES_ONLY = "PARAM_PLUGIN_INTERNAL_ACTIVITIES_ONLY";
  public static final String PARAM_PLUGIN_LOCATION = "pluginsdk_pluginLocation";
  public static final String PARAM_PLUGIN_NAME = "pluginsdk_pluginName";
  public static final String PARAM_PLUGIN_PATH = "pluginsdk_pluginpath";
  public static final String PARAM_PLUGIN_RECEIVER_CLASS_NAME = "pluginsdk_launchReceiver";
  public static final int USER_QQ_RESOURCES_NO = -1;
  public static final int USER_QQ_RESOURCES_YES = 1;
  static final HashMap a = new HashMap();
  static final ConcurrentHashMap b = new ConcurrentHashMap();
  private static ArrayList c = new ArrayList();
  
  public APPluginStatic() {}
  
  static DexClassLoader a(Context paramContext, String paramString1, String paramString2)
  {
    try
    {
      String str2 = APPluginUtils.getMD5FromPath(paramString2);
      String str1 = paramString1 + "_" + str2;
      Object localObject = (DexClassLoader)a.get(str1);
      APLog.d("APPluginStatic", "getOrCreateClassLoader apkFilePath: " + paramString2);
      APLog.d("APPluginStatic", "getOrCreateClassLoader MD5: " + str2);
      APLog.d("APPluginStatic", "getOrCreateClassLoader key: " + str1);
      APLog.d("APPluginStatic", "getOrCreateClassLoader dexClassLoader: " + localObject);
      paramString1 = (String)localObject;
      if (localObject == null)
      {
        localObject = APPluginUtils.getOptimizedDexPath(paramContext).getCanonicalPath();
        APPluginUtils.extractLibs(paramString2, APPluginUtils.getLibPath(paramContext).getCanonicalPath());
        str2 = APPluginUtils.getLibPath(paramContext).getCanonicalPath();
        paramString1 = new DexClassLoader(paramString2, (String)localObject, str2, paramContext.getClassLoader());
        APLog.d("APPluginStatic", "getOrCreateClassLoader new DexClassLoader cache: " + (String)localObject + " libDir: " + str2);
        a.put(str1, paramString1);
      }
      APLog.d("APPluginStatic", "getOrCreateClassLoader midasClassLoader: " + paramString1.hashCode());
      return paramString1;
    }
    finally {}
  }
  
  static ClassLoader a(String paramString1, String paramString2)
  {
    try
    {
      paramString2 = (DexClassLoader)a.get(paramString1 + "_" + paramString2);
      APLog.d("APPluginStatic", "getClassLoader pluginName: " + paramString1);
      APLog.d("APPluginStatic", "getClassLoader midasClassLoader: " + paramString2);
      return paramString2;
    }
    finally
    {
      paramString1 = finally;
      throw paramString1;
    }
  }
  
  static void a()
  {
    ArrayList localArrayList = c;
    int i = 0;
    for (;;)
    {
      try
      {
        if (i >= c.size()) {
          return;
        }
        if (((WeakReference)c.get(i)).get() == null)
        {
          c.remove(i);
          i -= 1;
        }
      }
      finally {}
      i += 1;
    }
  }
  
  static void a(IAPPluginActivity paramIAPPluginActivity)
  {
    
    synchronized (c)
    {
      c.add(new WeakReference(paramIAPPluginActivity));
      return;
    }
  }
  
  static void b(IAPPluginActivity paramIAPPluginActivity)
  {
    a();
    c(paramIAPPluginActivity);
  }
  
  public static String byteArrayToHex(byte[] paramArrayOfByte)
  {
    int i = 0;
    char[] arrayOfChar1 = new char[16];
    char[] tmp10_8 = arrayOfChar1;
    tmp10_8[0] = 48;
    char[] tmp15_10 = tmp10_8;
    tmp15_10[1] = 49;
    char[] tmp20_15 = tmp15_10;
    tmp20_15[2] = 50;
    char[] tmp25_20 = tmp20_15;
    tmp25_20[3] = 51;
    char[] tmp30_25 = tmp25_20;
    tmp30_25[4] = 52;
    char[] tmp35_30 = tmp30_25;
    tmp35_30[5] = 53;
    char[] tmp40_35 = tmp35_30;
    tmp40_35[6] = 54;
    char[] tmp46_40 = tmp40_35;
    tmp46_40[7] = 55;
    char[] tmp52_46 = tmp46_40;
    tmp52_46[8] = 56;
    char[] tmp58_52 = tmp52_46;
    tmp58_52[9] = 57;
    char[] tmp64_58 = tmp58_52;
    tmp64_58[10] = 65;
    char[] tmp70_64 = tmp64_58;
    tmp70_64[11] = 66;
    char[] tmp76_70 = tmp70_64;
    tmp76_70[12] = 67;
    char[] tmp82_76 = tmp76_70;
    tmp82_76[13] = 68;
    char[] tmp88_82 = tmp82_76;
    tmp88_82[14] = 69;
    char[] tmp94_88 = tmp88_82;
    tmp94_88[15] = 70;
    tmp94_88;
    char[] arrayOfChar2 = new char[paramArrayOfByte.length * 2];
    int k = paramArrayOfByte.length;
    int j = 0;
    for (;;)
    {
      if (i >= k) {
        return new String(arrayOfChar2);
      }
      int m = paramArrayOfByte[i];
      int n = j + 1;
      arrayOfChar2[j] = arrayOfChar1[(m >>> 4 & 0xF)];
      j = n + 1;
      arrayOfChar2[n] = arrayOfChar1[(m & 0xF)];
      i += 1;
    }
  }
  
  private static boolean c(IAPPluginActivity paramIAPPluginActivity)
  {
    ArrayList localArrayList = c;
    int i = 0;
    for (;;)
    {
      try
      {
        if (i >= c.size()) {
          return false;
        }
        if (((WeakReference)c.get(i)).get() == paramIAPPluginActivity)
        {
          c.remove(i);
          return true;
        }
      }
      finally {}
      i += 1;
    }
  }
  
  /* Error */
  public static String encodeFile(String paramString)
  {
    // Byte code:
    //   0: new 119	java/io/File
    //   3: dup
    //   4: aload_0
    //   5: invokespecial 214	java/io/File:<init>	(Ljava/lang/String;)V
    //   8: astore_0
    //   9: aload_0
    //   10: invokevirtual 218	java/io/File:exists	()Z
    //   13: ifeq +10 -> 23
    //   16: aload_0
    //   17: invokevirtual 221	java/io/File:isFile	()Z
    //   20: ifne +6 -> 26
    //   23: ldc -33
    //   25: areturn
    //   26: ldc -31
    //   28: invokestatic 231	java/security/MessageDigest:getInstance	(Ljava/lang/String;)Ljava/security/MessageDigest;
    //   31: astore_2
    //   32: new 233	java/io/FileInputStream
    //   35: dup
    //   36: aload_0
    //   37: invokespecial 236	java/io/FileInputStream:<init>	(Ljava/io/File;)V
    //   40: astore_3
    //   41: sipush 1024
    //   44: newarray byte
    //   46: astore 4
    //   48: aconst_null
    //   49: checkcast 238	[B
    //   52: astore_0
    //   53: aload_3
    //   54: aload 4
    //   56: invokevirtual 242	java/io/FileInputStream:read	([B)I
    //   59: istore_1
    //   60: iload_1
    //   61: iconst_m1
    //   62: if_icmpne +21 -> 83
    //   65: aload_2
    //   66: invokevirtual 246	java/security/MessageDigest:digest	()[B
    //   69: astore_2
    //   70: aload_2
    //   71: astore_0
    //   72: aload_3
    //   73: invokevirtual 249	java/io/FileInputStream:close	()V
    //   76: aload_0
    //   77: invokestatic 251	com/tencent/midas/plugin/APPluginStatic:byteArrayToHex	([B)Ljava/lang/String;
    //   80: astore_0
    //   81: aload_0
    //   82: areturn
    //   83: aload_2
    //   84: aload 4
    //   86: iconst_0
    //   87: iload_1
    //   88: invokevirtual 255	java/security/MessageDigest:update	([BII)V
    //   91: goto -38 -> 53
    //   94: astore_2
    //   95: aload_3
    //   96: invokevirtual 249	java/io/FileInputStream:close	()V
    //   99: goto -23 -> 76
    //   102: astore_2
    //   103: aload_2
    //   104: invokevirtual 258	java/io/IOException:printStackTrace	()V
    //   107: goto -31 -> 76
    //   110: astore_0
    //   111: ldc -33
    //   113: areturn
    //   114: astore_0
    //   115: aload_3
    //   116: invokevirtual 249	java/io/FileInputStream:close	()V
    //   119: aload_0
    //   120: athrow
    //   121: astore_2
    //   122: aload_2
    //   123: invokevirtual 258	java/io/IOException:printStackTrace	()V
    //   126: goto -7 -> 119
    //   129: astore_2
    //   130: aload_2
    //   131: invokevirtual 258	java/io/IOException:printStackTrace	()V
    //   134: goto -58 -> 76
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	137	0	paramString	String
    //   59	29	1	i	int
    //   31	53	2	localObject	Object
    //   94	1	2	localIOException1	java.io.IOException
    //   102	2	2	localIOException2	java.io.IOException
    //   121	2	2	localIOException3	java.io.IOException
    //   129	2	2	localIOException4	java.io.IOException
    //   40	76	3	localFileInputStream	java.io.FileInputStream
    //   46	39	4	arrayOfByte	byte[]
    // Exception table:
    //   from	to	target	type
    //   53	60	94	java/io/IOException
    //   65	70	94	java/io/IOException
    //   83	91	94	java/io/IOException
    //   95	99	102	java/io/IOException
    //   26	53	110	java/lang/Exception
    //   72	76	110	java/lang/Exception
    //   76	81	110	java/lang/Exception
    //   95	99	110	java/lang/Exception
    //   103	107	110	java/lang/Exception
    //   115	119	110	java/lang/Exception
    //   119	121	110	java/lang/Exception
    //   122	126	110	java/lang/Exception
    //   130	134	110	java/lang/Exception
    //   53	60	114	finally
    //   65	70	114	finally
    //   83	91	114	finally
    //   115	119	121	java/io/IOException
    //   72	76	129	java/io/IOException
  }
  
  public static ClassLoader getOrCreateClassLoader(Context paramContext, String paramString)
  {
    try
    {
      paramContext = a(paramContext, paramString, APPluginUtils.getInstallPath(paramContext, paramString).getCanonicalPath());
      APLog.d("APPluginStatic", "getClassLoader getOrCreateClassLoader midasClassLoader: " + paramContext.hashCode());
      return paramContext;
    }
    finally
    {
      paramContext = finally;
      throw paramContext;
    }
  }
  
  public static List isProcessesExist(Context paramContext, List paramList)
  {
    ArrayList localArrayList = null;
    int i;
    if (paramList != null)
    {
      localArrayList = new ArrayList();
      paramContext = ((ActivityManager)paramContext.getSystemService("activity")).getRunningAppProcesses();
      if (paramContext == null) {
        i = 0;
      }
    }
    else
    {
      for (;;)
      {
        if (i >= paramList.size()) {
          return localArrayList;
        }
        localArrayList.add(Boolean.FALSE);
        i += 1;
      }
    }
    paramList = paramList.iterator();
    if (!paramList.hasNext()) {
      return localArrayList;
    }
    String str = (String)paramList.next();
    Iterator localIterator = paramContext.iterator();
    label105:
    if (!localIterator.hasNext()) {}
    for (boolean bool = false;; bool = true)
    {
      localArrayList.add(Boolean.valueOf(bool));
      break;
      if (!str.equalsIgnoreCase(((ActivityManager.RunningAppProcessInfo)localIterator.next()).processName)) {
        break label105;
      }
    }
  }
  
  /* Error */
  public static void preCreateClassLoaderByPath(Context paramContext)
  {
    // Byte code:
    //   0: ldc 2
    //   2: monitorenter
    //   3: ldc -33
    //   5: astore 4
    //   7: ldc -33
    //   9: astore 5
    //   11: aload_0
    //   12: invokestatic 320	com/tencent/midas/plugin/APPluginUtils:a	(Landroid/content/Context;)Ljava/io/File;
    //   15: astore 6
    //   17: aload 5
    //   19: astore_2
    //   20: aload 4
    //   22: astore_3
    //   23: aload 6
    //   25: ifnull +23 -> 48
    //   28: aload 6
    //   30: invokevirtual 324	java/io/File:listFiles	()[Ljava/io/File;
    //   33: astore_3
    //   34: iconst_0
    //   35: istore_1
    //   36: iload_1
    //   37: aload_3
    //   38: arraylength
    //   39: if_icmplt +34 -> 73
    //   42: aload 4
    //   44: astore_3
    //   45: aload 5
    //   47: astore_2
    //   48: aload_3
    //   49: invokestatic 330	android/text/TextUtils:isEmpty	(Ljava/lang/CharSequence;)Z
    //   52: ifne +17 -> 69
    //   55: aload_2
    //   56: invokestatic 330	android/text/TextUtils:isEmpty	(Ljava/lang/CharSequence;)Z
    //   59: ifne +10 -> 69
    //   62: aload_0
    //   63: aload_3
    //   64: aload_2
    //   65: invokestatic 266	com/tencent/midas/plugin/APPluginStatic:a	(Landroid/content/Context;Ljava/lang/String;Ljava/lang/String;)Ldalvik/system/DexClassLoader;
    //   68: pop
    //   69: ldc 2
    //   71: monitorexit
    //   72: return
    //   73: aload_3
    //   74: iload_1
    //   75: aaload
    //   76: astore_2
    //   77: aload_2
    //   78: invokevirtual 333	java/io/File:getName	()Ljava/lang/String;
    //   81: ldc_w 335
    //   84: invokevirtual 338	java/lang/String:startsWith	(Ljava/lang/String;)Z
    //   87: ifeq +15 -> 102
    //   90: ldc_w 335
    //   93: astore_3
    //   94: aload_2
    //   95: invokevirtual 122	java/io/File:getCanonicalPath	()Ljava/lang/String;
    //   98: astore_2
    //   99: goto -51 -> 48
    //   102: iload_1
    //   103: iconst_1
    //   104: iadd
    //   105: istore_1
    //   106: goto -70 -> 36
    //   109: astore_0
    //   110: ldc 2
    //   112: monitorexit
    //   113: aload_0
    //   114: athrow
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	115	0	paramContext	Context
    //   35	71	1	i	int
    //   19	80	2	str1	String
    //   22	72	3	localObject	Object
    //   5	38	4	str2	String
    //   9	37	5	str3	String
    //   15	14	6	localFile	File
    // Exception table:
    //   from	to	target	type
    //   11	17	109	finally
    //   28	34	109	finally
    //   36	42	109	finally
    //   48	69	109	finally
    //   77	90	109	finally
    //   94	99	109	finally
  }
  
  public static void release()
  {
    a.clear();
    b.clear();
    APLog.d("APPluginStatic", "release sInstances size: " + c.size());
  }
  
  public static void removeAll()
  {
    a();
    ArrayList localArrayList = c;
    int i = 0;
    for (;;)
    {
      try
      {
        if (i >= c.size()) {
          return;
        }
        IAPPluginActivity localIAPPluginActivity = (IAPPluginActivity)((WeakReference)c.get(i)).get();
        if (localIAPPluginActivity != null)
        {
          localIAPPluginActivity.IFinish();
          c.remove(i);
        }
      }
      finally {}
      i += 1;
    }
  }
}
