package com.tencent.msdk.tools;

import android.os.Handler;
import android.os.Message;
import java.io.File;
import java.net.URL;
import java.util.LinkedList;
import java.util.Queue;
import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantLock;

public class DownloadThread
  extends Thread
{
  public static final int THREAD_BEGIN = 1;
  public static final int THREAD_FINISHED_FAIL = 3;
  public static final int THREAD_FINISHED_SUCC = 2;
  private static Queue<DownloadItem> downloadList = new LinkedList();
  private static Handler myHandler = new Handler()
  {
    public void handleMessage(Message paramAnonymousMessage)
    {
      Object localObject = new Message();
      new DownloadItem();
      switch (paramAnonymousMessage.what)
      {
      default: 
        return;
      case 1: 
        DownloadThread.sLock.lock();
        if (!DownloadThread.needDownloadLists.isEmpty()) {
          do
          {
            paramAnonymousMessage = (DownloadItem)DownloadThread.needDownloadLists.poll();
            if (!DownloadThread.downloadList.contains(paramAnonymousMessage))
            {
              localObject = new DownloadThread(paramAnonymousMessage);
              if (!((DownloadThread)localObject).isStarted()) {
                ((DownloadThread)localObject).start();
              }
              DownloadThread.downloadList.add(paramAnonymousMessage);
            }
          } while (!DownloadThread.downloadList.contains(paramAnonymousMessage));
        }
        for (;;)
        {
          DownloadThread.sLock.unlock();
          return;
          if (!DownloadThread.downloadList.isEmpty())
          {
            Logger.d("no new task");
          }
          else if (DownloadThread.access$400())
          {
            Logger.d("all task finished have been notified");
          }
          else
          {
            DownloadThread.setFinished(true);
            Logger.d("all task finished");
          }
        }
      case 2: 
        DownloadThread.sLock.lock();
        paramAnonymousMessage = (DownloadItem)paramAnonymousMessage.obj;
        if (DownloadThread.downloadList.contains(paramAnonymousMessage)) {
          DownloadThread.downloadList.remove(paramAnonymousMessage);
        }
        ((Message)localObject).what = 1;
        sendMessage((Message)localObject);
        DownloadThread.sLock.unlock();
        return;
      }
      DownloadThread.sLock.lock();
      paramAnonymousMessage = (DownloadItem)paramAnonymousMessage.obj;
      if (DownloadThread.downloadList.contains(paramAnonymousMessage)) {
        DownloadThread.downloadList.remove(paramAnonymousMessage);
      }
      ((Message)localObject).what = 1;
      sendMessage((Message)localObject);
      DownloadThread.sLock.unlock();
    }
  };
  private static Queue<DownloadItem> needDownloadLists;
  private static boolean sIsFinished = false;
  private static Lock sLock = new ReentrantLock();
  private DownloadItem mDownloadItem = null;
  private boolean mIsStarted = false;
  
  static
  {
    needDownloadLists = new LinkedList();
  }
  
  public DownloadThread(DownloadItem paramDownloadItem)
  {
    this.mDownloadItem = paramDownloadItem;
  }
  
  public static void addToDownloadQueue(URL paramURL, String paramString1, String paramString2)
  {
    if ((paramURL == null) || (T.ckIsEmpty(paramString1)) || (T.ckIsEmpty(paramString2)))
    {
      Logger.w("url or filePath or hashValue is null");
      return;
    }
    sLock.lock();
    try
    {
      paramURL = new DownloadItem(paramURL, paramString1, paramString2);
      if (!needDownloadLists.contains(paramURL)) {
        needDownloadLists.add(paramURL);
      }
      setFinished(false);
    }
    catch (Exception paramURL)
    {
      for (;;)
      {
        paramURL.printStackTrace();
        sLock.unlock();
      }
    }
    finally
    {
      sLock.unlock();
    }
    paramURL = new Message();
    paramURL.what = 1;
    myHandler.sendMessage(paramURL);
  }
  
  public static void delFileByPath(String paramString)
  {
    if (T.ckIsEmpty(paramString)) {}
    do
    {
      return;
      paramString = new File(paramString);
    } while (paramString == null);
    paramString.delete();
  }
  
  private static boolean isFinished()
  {
    return sIsFinished;
  }
  
  private boolean isStarted()
  {
    return this.mIsStarted;
  }
  
  private static void setFinished(boolean paramBoolean)
  {
    sIsFinished = paramBoolean;
  }
  
  /* Error */
  public void run()
  {
    // Byte code:
    //   0: aload_0
    //   1: iconst_1
    //   2: putfield 52	com/tencent/msdk/tools/DownloadThread:mIsStarted	Z
    //   5: aconst_null
    //   6: astore 4
    //   8: aconst_null
    //   9: astore 9
    //   11: aconst_null
    //   12: astore 8
    //   14: aconst_null
    //   15: astore 10
    //   17: aconst_null
    //   18: astore 7
    //   20: aload 4
    //   22: astore 6
    //   24: aload 10
    //   26: astore 5
    //   28: aload_0
    //   29: getfield 54	com/tencent/msdk/tools/DownloadThread:mDownloadItem	Lcom/tencent/msdk/tools/DownloadItem;
    //   32: getfield 143	com/tencent/msdk/tools/DownloadItem:mFileUrl	Ljava/net/URL;
    //   35: invokevirtual 149	java/net/URL:openConnection	()Ljava/net/URLConnection;
    //   38: checkcast 151	java/net/HttpURLConnection
    //   41: astore 12
    //   43: aload 4
    //   45: astore 6
    //   47: aload 10
    //   49: astore 5
    //   51: aload 12
    //   53: sipush 5000
    //   56: invokevirtual 155	java/net/HttpURLConnection:setConnectTimeout	(I)V
    //   59: aload 4
    //   61: astore 6
    //   63: aload 10
    //   65: astore 5
    //   67: aload 12
    //   69: ldc -99
    //   71: invokevirtual 160	java/net/HttpURLConnection:setRequestMethod	(Ljava/lang/String;)V
    //   74: aload 4
    //   76: astore 6
    //   78: aload 10
    //   80: astore 5
    //   82: aload 12
    //   84: ldc -94
    //   86: ldc -92
    //   88: invokevirtual 168	java/net/HttpURLConnection:setRequestProperty	(Ljava/lang/String;Ljava/lang/String;)V
    //   91: aload 4
    //   93: astore 6
    //   95: aload 10
    //   97: astore 5
    //   99: aload 12
    //   101: ldc -86
    //   103: ldc -84
    //   105: invokevirtual 168	java/net/HttpURLConnection:setRequestProperty	(Ljava/lang/String;Ljava/lang/String;)V
    //   108: aload 4
    //   110: astore 6
    //   112: aload 10
    //   114: astore 5
    //   116: aload 12
    //   118: ldc -82
    //   120: ldc -80
    //   122: invokevirtual 168	java/net/HttpURLConnection:setRequestProperty	(Ljava/lang/String;Ljava/lang/String;)V
    //   125: aload 4
    //   127: astore 6
    //   129: aload 10
    //   131: astore 5
    //   133: aload 12
    //   135: ldc -78
    //   137: ldc -76
    //   139: invokevirtual 168	java/net/HttpURLConnection:setRequestProperty	(Ljava/lang/String;Ljava/lang/String;)V
    //   142: aload 4
    //   144: astore 6
    //   146: aload 10
    //   148: astore 5
    //   150: aload 12
    //   152: invokevirtual 183	java/net/HttpURLConnection:connect	()V
    //   155: aload 4
    //   157: astore 6
    //   159: aload 10
    //   161: astore 5
    //   163: aload_0
    //   164: getfield 54	com/tencent/msdk/tools/DownloadThread:mDownloadItem	Lcom/tencent/msdk/tools/DownloadItem;
    //   167: aload 12
    //   169: invokevirtual 187	java/net/HttpURLConnection:getContentLength	()I
    //   172: i2l
    //   173: putfield 191	com/tencent/msdk/tools/DownloadItem:mFileLength	J
    //   176: aload 4
    //   178: astore 6
    //   180: aload 10
    //   182: astore 5
    //   184: sipush 4096
    //   187: newarray byte
    //   189: astore 11
    //   191: aload 4
    //   193: astore 6
    //   195: aload 10
    //   197: astore 5
    //   199: new 193	java/io/BufferedInputStream
    //   202: dup
    //   203: aload 12
    //   205: invokevirtual 197	java/net/HttpURLConnection:getInputStream	()Ljava/io/InputStream;
    //   208: invokespecial 200	java/io/BufferedInputStream:<init>	(Ljava/io/InputStream;)V
    //   211: astore 4
    //   213: new 131	java/io/File
    //   216: dup
    //   217: new 202	java/lang/StringBuilder
    //   220: dup
    //   221: invokespecial 203	java/lang/StringBuilder:<init>	()V
    //   224: aload_0
    //   225: getfield 54	com/tencent/msdk/tools/DownloadThread:mDownloadItem	Lcom/tencent/msdk/tools/DownloadItem;
    //   228: getfield 207	com/tencent/msdk/tools/DownloadItem:mLocalFilePath	Ljava/lang/String;
    //   231: invokevirtual 211	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   234: ldc -43
    //   236: invokevirtual 211	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   239: invokevirtual 217	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   242: invokespecial 133	java/io/File:<init>	(Ljava/lang/String;)V
    //   245: astore 6
    //   247: new 219	java/io/BufferedOutputStream
    //   250: dup
    //   251: new 221	java/io/FileOutputStream
    //   254: dup
    //   255: aload 6
    //   257: invokespecial 224	java/io/FileOutputStream:<init>	(Ljava/io/File;)V
    //   260: invokespecial 227	java/io/BufferedOutputStream:<init>	(Ljava/io/OutputStream;)V
    //   263: astore 5
    //   265: lconst_0
    //   266: lstore_2
    //   267: ldc -27
    //   269: invokestatic 235	java/security/MessageDigest:getInstance	(Ljava/lang/String;)Ljava/security/MessageDigest;
    //   272: astore 7
    //   274: aload 4
    //   276: aload 11
    //   278: invokevirtual 239	java/io/BufferedInputStream:read	([B)I
    //   281: istore_1
    //   282: iload_1
    //   283: iconst_m1
    //   284: if_icmpeq +91 -> 375
    //   287: aload 5
    //   289: aload 11
    //   291: iconst_0
    //   292: iload_1
    //   293: invokevirtual 243	java/io/BufferedOutputStream:write	([BII)V
    //   296: aload 7
    //   298: aload 11
    //   300: iconst_0
    //   301: iload_1
    //   302: invokevirtual 246	java/security/MessageDigest:update	([BII)V
    //   305: aload 5
    //   307: invokevirtual 249	java/io/BufferedOutputStream:flush	()V
    //   310: lload_2
    //   311: iload_1
    //   312: i2l
    //   313: ladd
    //   314: lstore_2
    //   315: aload_0
    //   316: getfield 54	com/tencent/msdk/tools/DownloadThread:mDownloadItem	Lcom/tencent/msdk/tools/DownloadItem;
    //   319: lload_2
    //   320: aload_0
    //   321: getfield 54	com/tencent/msdk/tools/DownloadThread:mDownloadItem	Lcom/tencent/msdk/tools/DownloadItem;
    //   324: getfield 191	com/tencent/msdk/tools/DownloadItem:mFileLength	J
    //   327: ldiv
    //   328: l2f
    //   329: putfield 253	com/tencent/msdk/tools/DownloadItem:mPercent	F
    //   332: goto -58 -> 274
    //   335: astore 8
    //   337: aload 5
    //   339: astore 7
    //   341: aload 4
    //   343: astore 6
    //   345: aload 7
    //   347: astore 5
    //   349: aload 8
    //   351: invokevirtual 128	java/lang/Exception:printStackTrace	()V
    //   354: aload 4
    //   356: ifnull +8 -> 364
    //   359: aload 4
    //   361: invokevirtual 256	java/io/BufferedInputStream:close	()V
    //   364: aload 7
    //   366: ifnull +8 -> 374
    //   369: aload 7
    //   371: invokevirtual 257	java/io/BufferedOutputStream:close	()V
    //   374: return
    //   375: aload 7
    //   377: invokevirtual 261	java/security/MessageDigest:digest	()[B
    //   380: invokestatic 267	com/tencent/msdk/tools/HexUtil:bytes2HexStr	([B)Ljava/lang/String;
    //   383: getstatic 273	java/util/Locale:CHINA	Ljava/util/Locale;
    //   386: invokevirtual 279	java/lang/String:toLowerCase	(Ljava/util/Locale;)Ljava/lang/String;
    //   389: astore 7
    //   391: new 115	android/os/Message
    //   394: dup
    //   395: invokespecial 116	android/os/Message:<init>	()V
    //   398: astore 8
    //   400: aload 8
    //   402: aload_0
    //   403: getfield 54	com/tencent/msdk/tools/DownloadThread:mDownloadItem	Lcom/tencent/msdk/tools/DownloadItem;
    //   406: putfield 283	android/os/Message:obj	Ljava/lang/Object;
    //   409: aload 7
    //   411: aload_0
    //   412: getfield 54	com/tencent/msdk/tools/DownloadThread:mDownloadItem	Lcom/tencent/msdk/tools/DownloadItem;
    //   415: getfield 286	com/tencent/msdk/tools/DownloadItem:mHashValue	Ljava/lang/String;
    //   418: invokevirtual 289	java/lang/String:equalsIgnoreCase	(Ljava/lang/String;)Z
    //   421: ifeq +161 -> 582
    //   424: aload 6
    //   426: new 131	java/io/File
    //   429: dup
    //   430: aload_0
    //   431: getfield 54	com/tencent/msdk/tools/DownloadThread:mDownloadItem	Lcom/tencent/msdk/tools/DownloadItem;
    //   434: getfield 207	com/tencent/msdk/tools/DownloadItem:mLocalFilePath	Ljava/lang/String;
    //   437: invokespecial 133	java/io/File:<init>	(Ljava/lang/String;)V
    //   440: invokevirtual 293	java/io/File:renameTo	(Ljava/io/File;)Z
    //   443: ifeq +68 -> 511
    //   446: aload 8
    //   448: iconst_2
    //   449: putfield 119	android/os/Message:what	I
    //   452: new 202	java/lang/StringBuilder
    //   455: dup
    //   456: invokespecial 203	java/lang/StringBuilder:<init>	()V
    //   459: ldc_w 295
    //   462: invokevirtual 211	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   465: aload_0
    //   466: getfield 54	com/tencent/msdk/tools/DownloadThread:mDownloadItem	Lcom/tencent/msdk/tools/DownloadItem;
    //   469: getfield 207	com/tencent/msdk/tools/DownloadItem:mLocalFilePath	Ljava/lang/String;
    //   472: invokevirtual 211	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   475: invokevirtual 217	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   478: invokestatic 298	com/tencent/msdk/tools/Logger:d	(Ljava/lang/String;)V
    //   481: getstatic 47	com/tencent/msdk/tools/DownloadThread:myHandler	Landroid/os/Handler;
    //   484: aload 8
    //   486: invokevirtual 125	android/os/Handler:sendMessage	(Landroid/os/Message;)Z
    //   489: pop
    //   490: aload 4
    //   492: ifnull +8 -> 500
    //   495: aload 4
    //   497: invokevirtual 256	java/io/BufferedInputStream:close	()V
    //   500: aload 5
    //   502: ifnull +8 -> 510
    //   505: aload 5
    //   507: invokevirtual 257	java/io/BufferedOutputStream:close	()V
    //   510: return
    //   511: aload 8
    //   513: iconst_3
    //   514: putfield 119	android/os/Message:what	I
    //   517: new 202	java/lang/StringBuilder
    //   520: dup
    //   521: invokespecial 203	java/lang/StringBuilder:<init>	()V
    //   524: ldc_w 300
    //   527: invokevirtual 211	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   530: aload_0
    //   531: getfield 54	com/tencent/msdk/tools/DownloadThread:mDownloadItem	Lcom/tencent/msdk/tools/DownloadItem;
    //   534: getfield 207	com/tencent/msdk/tools/DownloadItem:mLocalFilePath	Ljava/lang/String;
    //   537: invokevirtual 211	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   540: invokevirtual 217	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   543: invokestatic 298	com/tencent/msdk/tools/Logger:d	(Ljava/lang/String;)V
    //   546: goto -65 -> 481
    //   549: astore 7
    //   551: aload 4
    //   553: astore 6
    //   555: aload 7
    //   557: astore 4
    //   559: aload 6
    //   561: ifnull +8 -> 569
    //   564: aload 6
    //   566: invokevirtual 256	java/io/BufferedInputStream:close	()V
    //   569: aload 5
    //   571: ifnull +8 -> 579
    //   574: aload 5
    //   576: invokevirtual 257	java/io/BufferedOutputStream:close	()V
    //   579: aload 4
    //   581: athrow
    //   582: aload 8
    //   584: iconst_3
    //   585: putfield 119	android/os/Message:what	I
    //   588: new 202	java/lang/StringBuilder
    //   591: dup
    //   592: invokespecial 203	java/lang/StringBuilder:<init>	()V
    //   595: ldc_w 302
    //   598: invokevirtual 211	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   601: aload 7
    //   603: invokevirtual 211	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   606: ldc_w 304
    //   609: invokevirtual 211	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   612: aload_0
    //   613: getfield 54	com/tencent/msdk/tools/DownloadThread:mDownloadItem	Lcom/tencent/msdk/tools/DownloadItem;
    //   616: getfield 286	com/tencent/msdk/tools/DownloadItem:mHashValue	Ljava/lang/String;
    //   619: invokevirtual 211	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   622: invokevirtual 217	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   625: invokestatic 92	com/tencent/msdk/tools/Logger:w	(Ljava/lang/String;)V
    //   628: aload_0
    //   629: getfield 54	com/tencent/msdk/tools/DownloadThread:mDownloadItem	Lcom/tencent/msdk/tools/DownloadItem;
    //   632: getfield 207	com/tencent/msdk/tools/DownloadItem:mLocalFilePath	Ljava/lang/String;
    //   635: invokestatic 306	com/tencent/msdk/tools/DownloadThread:delFileByPath	(Ljava/lang/String;)V
    //   638: goto -157 -> 481
    //   641: astore 4
    //   643: aload 4
    //   645: invokevirtual 307	java/io/IOException:printStackTrace	()V
    //   648: return
    //   649: astore 4
    //   651: aload 4
    //   653: invokevirtual 307	java/io/IOException:printStackTrace	()V
    //   656: return
    //   657: astore 5
    //   659: aload 5
    //   661: invokevirtual 307	java/io/IOException:printStackTrace	()V
    //   664: goto -85 -> 579
    //   667: astore 4
    //   669: goto -110 -> 559
    //   672: astore 7
    //   674: aload 4
    //   676: astore 6
    //   678: aload 8
    //   680: astore 5
    //   682: aload 7
    //   684: astore 4
    //   686: goto -127 -> 559
    //   689: astore 8
    //   691: aload 9
    //   693: astore 4
    //   695: goto -354 -> 341
    //   698: astore 8
    //   700: goto -359 -> 341
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	703	0	this	DownloadThread
    //   281	31	1	i	int
    //   266	54	2	l	long
    //   6	574	4	localObject1	Object
    //   641	3	4	localIOException1	java.io.IOException
    //   649	3	4	localIOException2	java.io.IOException
    //   667	8	4	localObject2	Object
    //   684	10	4	localObject3	Object
    //   26	549	5	localObject4	Object
    //   657	3	5	localIOException3	java.io.IOException
    //   680	1	5	localMessage1	Message
    //   22	655	6	localObject5	Object
    //   18	392	7	localObject6	Object
    //   549	53	7	str	String
    //   672	11	7	localObject7	Object
    //   12	1	8	localObject8	Object
    //   335	15	8	localException1	Exception
    //   398	281	8	localMessage2	Message
    //   689	1	8	localException2	Exception
    //   698	1	8	localException3	Exception
    //   9	683	9	localObject9	Object
    //   15	181	10	localObject10	Object
    //   189	110	11	arrayOfByte	byte[]
    //   41	163	12	localHttpURLConnection	java.net.HttpURLConnection
    // Exception table:
    //   from	to	target	type
    //   267	274	335	java/lang/Exception
    //   274	282	335	java/lang/Exception
    //   287	310	335	java/lang/Exception
    //   315	332	335	java/lang/Exception
    //   375	481	335	java/lang/Exception
    //   481	490	335	java/lang/Exception
    //   511	546	335	java/lang/Exception
    //   582	638	335	java/lang/Exception
    //   267	274	549	finally
    //   274	282	549	finally
    //   287	310	549	finally
    //   315	332	549	finally
    //   375	481	549	finally
    //   481	490	549	finally
    //   511	546	549	finally
    //   582	638	549	finally
    //   495	500	641	java/io/IOException
    //   505	510	641	java/io/IOException
    //   359	364	649	java/io/IOException
    //   369	374	649	java/io/IOException
    //   564	569	657	java/io/IOException
    //   574	579	657	java/io/IOException
    //   28	43	667	finally
    //   51	59	667	finally
    //   67	74	667	finally
    //   82	91	667	finally
    //   99	108	667	finally
    //   116	125	667	finally
    //   133	142	667	finally
    //   150	155	667	finally
    //   163	176	667	finally
    //   184	191	667	finally
    //   199	213	667	finally
    //   349	354	667	finally
    //   213	265	672	finally
    //   28	43	689	java/lang/Exception
    //   51	59	689	java/lang/Exception
    //   67	74	689	java/lang/Exception
    //   82	91	689	java/lang/Exception
    //   99	108	689	java/lang/Exception
    //   116	125	689	java/lang/Exception
    //   133	142	689	java/lang/Exception
    //   150	155	689	java/lang/Exception
    //   163	176	689	java/lang/Exception
    //   184	191	689	java/lang/Exception
    //   199	213	689	java/lang/Exception
    //   213	265	698	java/lang/Exception
  }
}
