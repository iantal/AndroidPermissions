package com.tencent.msdk.push.req;

import com.tencent.msdk.SimpleCallback;
import com.tencent.msdk.WeGame;
import com.tencent.msdk.api.WGPlatform;
import com.tencent.msdk.config.ConfigManager;
import com.tencent.msdk.push.PushHelper;
import com.tencent.msdk.push.PushHelper.MatIdCallback;
import com.tencent.msdk.push.db.PushClientDbModel;
import com.tencent.msdk.push.db.PushClientDbModel.Entry;
import com.tencent.msdk.remote.api.SafeJSONObject;
import com.tencent.msdk.tools.DeviceUtils;
import com.tencent.msdk.tools.Logger;
import org.json.JSONException;

public class ClientRegReq
  extends BaseReq
  implements SimpleCallback
{
  private static final int sRegSuccess = 0;
  private SimpleCallback mCallback;
  private String mMatId = "";
  private String mOpenId = "";
  private String mPushAppId = "";
  
  public ClientRegReq(String paramString)
  {
    this.mPushAppId = paramString;
  }
  
  public ClientRegReq(String paramString1, String paramString2)
  {
    this.mPushAppId = paramString1;
    this.mOpenId = paramString2;
  }
  
  private void initJsonBody(String paramString)
  {
    SafeJSONObject localSafeJSONObject = new SafeJSONObject();
    try
    {
      localSafeJSONObject.put("62", "20005");
      localSafeJSONObject.put("1", this.mPushAppId);
      localSafeJSONObject.put("2", this.mOpenId);
      localSafeJSONObject.put("3", paramString);
      localSafeJSONObject.put("4", "a");
      localSafeJSONObject.put("5", DeviceUtils.getVersionRelease());
      localSafeJSONObject.put("6", DeviceUtils.getBrand());
      localSafeJSONObject.put("7", DeviceUtils.getScreenResolution(WeGame.getInstance().getActivity()));
      localSafeJSONObject.put("8", "" + DeviceUtils.getNetworkType(PushHelper.getContext()));
      localSafeJSONObject.put("9", WGPlatform.WGGetVersion());
      localSafeJSONObject.put("10", "");
      localSafeJSONObject.put("60", "1.0");
      this.jsonBody = localSafeJSONObject;
      return;
    }
    catch (JSONException paramString)
    {
      paramString.printStackTrace();
    }
  }
  
  private void superSendProxy()
  {
    super.send();
  }
  
  protected String getCustomDomain()
  {
    return ConfigManager.getPushMsgDomain();
  }
  
  protected int getMyId()
  {
    return MsgId.ClientRegReq.ordinal();
  }
  
  public void onFail()
  {
    if (this.mCallback != null) {
      this.mCallback.onFail();
    }
  }
  
  public void onFailure(String paramString, int paramInt1, int paramInt2)
  {
    Logger.d("onFailure");
    onFail();
  }
  
  public void onSuccess()
  {
    if (this.mCallback != null) {
      this.mCallback.onSuccess();
    }
  }
  
  public void onSuccess(String paramString, int paramInt1, int paramInt2)
  {
    Logger.d("onSuccess");
    try
    {
      Object localObject2 = new SafeJSONObject(paramString);
      paramInt1 = ((SafeJSONObject)localObject2).getInt("51");
      Object localObject1 = ((SafeJSONObject)localObject2).getString("52");
      paramString = ((SafeJSONObject)localObject2).getString("37");
      localObject2 = ((SafeJSONObject)localObject2).getString("40");
      Logger.d((String)localObject1);
      Logger.d(paramString);
      Logger.d((String)localObject2);
      if (paramInt1 == 0)
      {
        localObject1 = new PushClientDbModel();
        ((PushClientDbModel)localObject1).deleteAll();
        ((PushClientDbModel)localObject1).mData.setmMatId(this.mMatId);
        ((PushClientDbModel)localObject1).mData.setmMatKey(paramString);
        ((PushClientDbModel)localObject1).mData.setmMatKeyVersion((String)localObject2);
        ((PushClientDbModel)localObject1).mData.setmMatKeyCreateAt(System.currentTimeMillis());
        ((PushClientDbModel)localObject1).mData.setmLastMsgId("0");
        ((PushClientDbModel)localObject1).mData.setmResolution(DeviceUtils.getScreenResolution(WeGame.getInstance().getActivity()));
        ((PushClientDbModel)localObject1).create();
        onSuccess();
        return;
      }
      onFail();
      return;
    }
    catch (JSONException paramString)
    {
      Logger.w("decode json from server failed!");
      paramString.printStackTrace();
      onFail();
    }
  }
  
  public void send()
  {
    PushHelper.reqMatid(new PushHelper.MatIdCallback()
    {
      public void onSuccess(String paramAnonymousString)
      {
        Logger.d("onSuccess");
        ClientRegReq.access$002(ClientRegReq.this, paramAnonymousString);
        ClientRegReq.this.initJsonBody(ClientRegReq.this.mMatId);
        ClientRegReq.this.superSendProxy();
      }
      
      public void onTimeout()
      {
        Logger.d("onTimeout");
        ClientRegReq.access$002(ClientRegReq.this, "");
        ClientRegReq.this.initJsonBody(ClientRegReq.this.mMatId);
        ClientRegReq.this.superSendProxy();
      }
    });
  }
  
  public void setmCallback(SimpleCallback paramSimpleCallback)
  {
    this.mCallback = paramSimpleCallback;
  }
}
