package com.tencent.map.b;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.location.Location;
import android.net.ConnectivityManager;
import android.net.NetworkInfo;
import android.os.Handler;
import android.os.Looper;
import android.os.Message;
import android.telephony.TelephonyManager;
import java.util.ArrayList;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import org.json.JSONArray;
import org.json.JSONObject;

public final class f
  implements b.a, d.c, e.c, g.c
{
  private static boolean t = false;
  private static f u = null;
  private com.tencent.map.a.a.d A = null;
  private int B = 0;
  private int C = 0;
  private int D = 1;
  private String E = "";
  private String F = "";
  private String G = "";
  private String H = "";
  private String I = "";
  private String J = "";
  private boolean K = false;
  private boolean L = false;
  private long M = 0L;
  private Handler N = null;
  private Runnable O = new Runnable()
  {
    public final void run()
    {
      if (System.currentTimeMillis() - f.a(f.this) < 8000L) {
        return;
      }
      if ((f.b(f.this).b()) && (f.b(f.this).c()))
      {
        f.b(f.this).a(0L);
        return;
      }
      f.c(f.this);
    }
  };
  private final BroadcastReceiver P = new BroadcastReceiver()
  {
    public final void onReceive(Context paramAnonymousContext, Intent paramAnonymousIntent)
    {
      if ((!paramAnonymousIntent.getBooleanExtra("noConnectivity", false)) && (f.d(f.this) != null)) {
        f.d(f.this).sendEmptyMessage(256);
      }
    }
  };
  private long a = 5000L;
  private Context b = null;
  private e c = null;
  private d d = null;
  private g e = null;
  private int f = 1024;
  private int g = 4;
  private c h = null;
  private b i = null;
  private com.tencent.map.a.a.b j = null;
  private int k;
  private int l;
  private int m;
  private byte[] n = new byte[0];
  private byte[] o = new byte[0];
  private boolean p = false;
  private c q = null;
  private b r = null;
  private a s = null;
  private long v = -1L;
  private e.b w = null;
  private d.b x = null;
  private g.b y = null;
  private com.tencent.map.a.a.d z = null;
  
  private f() {}
  
  public static f a()
  {
    try
    {
      if (u == null) {
        u = new f();
      }
      f localF = u;
      return localF;
    }
    finally {}
  }
  
  private static ArrayList<com.tencent.map.a.a.c> a(JSONArray paramJSONArray)
    throws Exception
  {
    int i2 = paramJSONArray.length();
    ArrayList localArrayList = new ArrayList();
    int i1 = 0;
    while (i1 < i2)
    {
      JSONObject localJSONObject = paramJSONArray.getJSONObject(i1);
      localArrayList.add(new com.tencent.map.a.a.c(localJSONObject.getString("name"), localJSONObject.getString("addr"), localJSONObject.getString("catalog"), localJSONObject.getDouble("dist"), Double.parseDouble(localJSONObject.getString("latitude")), Double.parseDouble(localJSONObject.getString("longitude"))));
      i1 += 1;
    }
    return localArrayList;
  }
  
  private void a(String paramString)
  {
    int i3 = 0;
    for (;;)
    {
      try
      {
        this.z = new com.tencent.map.a.a.d();
        localJSONObject = new JSONObject(paramString);
        Object localObject = localJSONObject.getJSONObject("location");
        this.z.a = 1;
        this.z.b = i.a(((JSONObject)localObject).getDouble("latitude"), 6);
        this.z.c = i.a(((JSONObject)localObject).getDouble("longitude"), 6);
        this.z.d = i.a(((JSONObject)localObject).getDouble("altitude"), 1);
        this.z.e = i.a(((JSONObject)localObject).getDouble("accuracy"), 1);
        localObject = this.z;
        if (this.m != 1) {
          continue;
        }
        bool = true;
        ((com.tencent.map.a.a.d)localObject).x = bool;
        localObject = localJSONObject.getString("bearing");
        i2 = -100;
        i1 = i3;
        if (localObject != null)
        {
          i1 = i3;
          if (((String)localObject).split(",").length > 1) {
            i1 = Integer.parseInt(localObject.split(",")[1]);
          }
        }
        if (this.x != null) {
          i2 = this.x.f;
        }
        localObject = this.z;
        d1 = this.z.e;
        if (i1 < 6) {
          continue;
        }
        d1 = 40.0D;
        ((com.tencent.map.a.a.d)localObject).e = d1;
        this.z.z = 0;
        if (((this.l == 3) || (this.l == 4)) && (this.m == 1))
        {
          localObject = localJSONObject.getJSONObject("details").getJSONObject("subnation");
          this.z.a(((JSONObject)localObject).getString("name"));
          this.z.m = ((JSONObject)localObject).getString("town");
          this.z.n = ((JSONObject)localObject).getString("village");
          this.z.o = ((JSONObject)localObject).getString("street");
          this.z.p = ((JSONObject)localObject).getString("street_no");
          this.z.z = 3;
          this.z.h = 0;
        }
        if ((this.l == 4) && (this.m == 1))
        {
          localObject = localJSONObject.getJSONObject("details").getJSONArray("poilist");
          this.z.w = a((JSONArray)localObject);
          this.z.z = 4;
        }
        if ((this.l == 7) && (this.m == 1))
        {
          localJSONObject = localJSONObject.getJSONObject("details");
          i1 = localJSONObject.getInt("stat");
          localJSONObject = localJSONObject.getJSONObject("subnation");
          if (i1 != 0) {
            continue;
          }
          this.z.a(localJSONObject.getString("name"));
          this.z.m = localJSONObject.getString("town");
          this.z.n = localJSONObject.getString("village");
          this.z.o = localJSONObject.getString("street");
          this.z.p = localJSONObject.getString("street_no");
          this.z.h = i1;
          this.z.z = 7;
        }
        this.z.y = 0;
        this.A = new com.tencent.map.a.a.d(this.z);
        this.B = 0;
        if (this.h != null) {
          this.h.a(paramString);
        }
      }
      catch (Exception paramString)
      {
        JSONObject localJSONObject;
        boolean bool;
        int i2;
        int i1;
        double d1;
        this.z = new com.tencent.map.a.a.d();
        this.z.z = -1;
        this.z.y = 2;
        this.B = 2;
        continue;
      }
      if ((this.j != null) && (this.k == 1) && ((this.w == null) || (!this.w.a())))
      {
        this.j.a(this.z);
        this.v = System.currentTimeMillis();
      }
      return;
      bool = false;
      continue;
      if (i1 == 5)
      {
        d1 = 60.0D;
      }
      else if (i1 == 4)
      {
        d1 = 70.0D;
      }
      else if (i1 == 3)
      {
        d1 = 90.0D;
      }
      else if (i1 == 2)
      {
        d1 = 110.0D;
      }
      else if ((i2 >= -72) && (i1 == 0))
      {
        i1 = (int)(0.45D * d1 / 10.0D) * 10;
        d1 = i1;
      }
      else if (d1 <= 100.0D)
      {
        i1 = (int)((d1 - 1.0D) / 10.0D + 1.0D) * 10;
      }
      else if ((d1 > 100.0D) && (d1 <= 800.0D))
      {
        i1 = (int)(0.85D * d1 / 10.0D) * 10;
      }
      else
      {
        i1 = (int)(0.8D * d1 / 10.0D) * 10;
        continue;
        if (i1 == 1)
        {
          this.z.i = localJSONObject.getString("nation");
          this.z.q = localJSONObject.getString("admin_level_1");
          this.z.r = localJSONObject.getString("admin_level_2");
          this.z.s = localJSONObject.getString("admin_level_3");
          this.z.t = localJSONObject.getString("locality");
          this.z.u = localJSONObject.getString("sublocality");
          this.z.v = localJSONObject.getString("route");
        }
      }
    }
  }
  
  private void b(boolean paramBoolean)
  {
    if ((this.w != null) && (this.w.a()))
    {
      Location localLocation = this.w.b();
      this.z = new com.tencent.map.a.a.d();
      this.z.b = i.a(localLocation.getLatitude(), 6);
      this.z.c = i.a(localLocation.getLongitude(), 6);
      this.z.d = i.a(localLocation.getAltitude(), 1);
      this.z.e = i.a(localLocation.getAccuracy(), 1);
      this.z.f = i.a(localLocation.getSpeed(), 1);
      this.z.g = i.a(localLocation.getBearing(), 1);
      this.z.a = 0;
      this.z.x = false;
      if (paramBoolean) {
        break label237;
      }
    }
    label237:
    for (this.z.y = 0;; this.z.y = 1)
    {
      this.z.z = 0;
      this.A = new com.tencent.map.a.a.d(this.z);
      this.B = 0;
      if ((System.currentTimeMillis() - this.v >= this.a) && (this.j != null) && (this.k == 1))
      {
        this.j.a(this.z);
        this.v = System.currentTimeMillis();
      }
      return;
    }
  }
  
  private void d()
  {
    if (this.s != null) {
      return;
    }
    this.s = new a(this.w, this.x, this.y);
    this.s.start();
  }
  
  private void e()
  {
    this.z = new com.tencent.map.a.a.d();
    this.B = 1;
    this.z.y = 1;
    this.z.z = -1;
    this.z.a = 1;
    if ((this.j != null) && (this.k == 1)) {
      this.j.a(this.z);
    }
  }
  
  public final void a(double paramDouble1, double paramDouble2)
  {
    synchronized (this.o)
    {
      Message localMessage = this.q.obtainMessage(6);
      Location localLocation = new Location("Deflect");
      localLocation.setLatitude(paramDouble1);
      localLocation.setLongitude(paramDouble2);
      localMessage.obj = localLocation;
      this.q.sendMessage(localMessage);
      return;
    }
  }
  
  public final void a(int paramInt)
  {
    synchronized (this.o)
    {
      Message localMessage = this.q.obtainMessage(4, paramInt, 0);
      this.q.sendMessage(localMessage);
      return;
    }
  }
  
  public final void a(d.b paramB)
  {
    synchronized (this.o)
    {
      paramB = this.q.obtainMessage(2, paramB);
      this.q.sendMessage(paramB);
      return;
    }
  }
  
  public final void a(e.b paramB)
  {
    synchronized (this.o)
    {
      paramB = this.q.obtainMessage(1, paramB);
      this.q.sendMessage(paramB);
      return;
    }
  }
  
  public final void a(g.b paramB)
  {
    synchronized (this.o)
    {
      paramB = this.q.obtainMessage(3, paramB);
      this.q.sendMessage(paramB);
      return;
    }
  }
  
  public final boolean a(Context paramContext, com.tencent.map.a.a.b paramB)
  {
    arrayOfByte = this.n;
    if ((paramContext == null) || (paramB == null)) {
      return false;
    }
    for (;;)
    {
      boolean bool1;
      boolean bool2;
      boolean bool3;
      try
      {
        if (!i.a(this.J)) {
          return false;
        }
        this.q = new c();
        this.N = new Handler(Looper.getMainLooper());
        this.b = paramContext;
        this.j = paramB;
        l.a().a(this.b.getApplicationContext());
      }
      finally {}
      try
      {
        paramContext = (ConnectivityManager)paramContext.getSystemService("connectivity");
        if ((paramContext != null) && (paramContext.getActiveNetworkInfo() != null)) {
          this.K = paramContext.getActiveNetworkInfo().isRoaming();
        }
        this.b.registerReceiver(this.P, new IntentFilter("android.net.conn.CONNECTIVITY_CHANGE"));
      }
      catch (Exception paramContext) {}
    }
    this.k = this.j.a();
    this.l = this.j.b();
    this.m = this.j.c();
    this.v = -1L;
    if (this.l == 7) {
      this.l = 0;
    }
    this.L = false;
    this.D = 1;
    bool1 = this.c.a(this, this.b);
    bool2 = this.d.a(this.b, this);
    bool3 = this.e.a(this.b, this, 1);
    this.h = c.a();
    this.i = b.a();
    this.w = null;
    this.x = null;
    this.y = null;
    this.z = null;
    this.A = null;
    this.B = 0;
    if (this.h != null) {
      this.h.b();
    }
    this.C = 1;
    if ((bool1) && (this.m == 0)) {
      return true;
    }
    return (bool2) || (bool3);
  }
  
  public final boolean a(String paramString1, String paramString2)
  {
    synchronized (this.n)
    {
      if (a.a().a(paramString1, paramString2))
      {
        this.J = paramString1;
        return true;
      }
      return false;
    }
  }
  
  public final void b()
  {
    try
    {
      synchronized (this.n)
      {
        if (this.j != null)
        {
          this.j = null;
          this.N.removeCallbacks(this.O);
          this.b.unregisterReceiver(this.P);
          this.c.a();
          this.d.a();
          this.e.a();
        }
        return;
      }
    }
    catch (Exception localException)
    {
      for (;;) {}
    }
  }
  
  public final void b(int paramInt)
  {
    synchronized (this.o)
    {
      Message localMessage = this.q.obtainMessage(5, paramInt, 0);
      this.q.sendMessage(localMessage);
      return;
    }
  }
  
  final class a
    extends Thread
  {
    private e.b a = null;
    private d.b b = null;
    private g.b c = null;
    
    a(e.b paramB, d.b paramB1, g.b paramB2)
    {
      if (paramB != null) {
        this.a = ((e.b)paramB.clone());
      }
      if (paramB1 != null) {
        this.b = ((d.b)paramB1.clone());
      }
      if (paramB2 != null) {
        this.c = ((g.b)paramB2.clone());
      }
    }
    
    public final void run()
    {
      if (!f.c()) {}
      try
      {
        localObject1 = (TelephonyManager)f.k(f.this).getSystemService("phone");
        f.c(f.this, ((TelephonyManager)localObject1).getDeviceId());
        f.d(f.this, ((TelephonyManager)localObject1).getSubscriberId());
        f.e(f.this, ((TelephonyManager)localObject1).getLine1Number());
        localObject2 = Pattern.compile("[0-9a-zA-Z+-]*");
        localObject3 = f.this;
        if (f.l(f.this) != null) {
          break label631;
        }
        localObject1 = "";
        f.c((f)localObject3, (String)localObject1);
        if (!((Pattern)localObject2).matcher(f.l(f.this)).matches()) {
          break label653;
        }
        localObject3 = f.this;
        if (f.l(f.this) != null) {
          break label642;
        }
        localObject1 = "";
        label123:
        f.c((f)localObject3, (String)localObject1);
        label129:
        localObject3 = f.this;
        if (f.m(f.this) != null) {
          break label666;
        }
        localObject1 = "";
        label147:
        f.d((f)localObject3, (String)localObject1);
        if (!((Pattern)localObject2).matcher(f.m(f.this)).matches()) {
          break label688;
        }
        localObject3 = f.this;
        if (f.m(f.this) != null) {
          break label677;
        }
        localObject1 = "";
        label188:
        f.d((f)localObject3, (String)localObject1);
        label194:
        localObject3 = f.this;
        if (f.n(f.this) != null) {
          break label701;
        }
        localObject1 = "";
        label212:
        f.e((f)localObject3, (String)localObject1);
        if (!((Pattern)localObject2).matcher(f.n(f.this)).matches()) {
          break label723;
        }
        localObject2 = f.this;
        if (f.n(f.this) != null) {
          break label712;
        }
        localObject1 = "";
        label253:
        f.e((f)localObject2, (String)localObject1);
      }
      catch (Exception localException)
      {
        Object localObject1;
        Object localObject2;
        Object localObject3;
        label259:
        String str1;
        for (;;) {}
      }
      f.a(true);
      localObject2 = f.this;
      if (f.l(f.this) == null)
      {
        localObject1 = "";
        label282:
        f.c((f)localObject2, (String)localObject1);
        localObject2 = f.this;
        if (f.m(f.this) != null) {
          break label747;
        }
        localObject1 = "";
        label306:
        f.d((f)localObject2, (String)localObject1);
        localObject2 = f.this;
        if (f.n(f.this) != null) {
          break label758;
        }
        localObject1 = "";
        label330:
        f.e((f)localObject2, (String)localObject1);
        localObject2 = f.this;
        if (f.l(f.this) != null) {
          break label769;
        }
        localObject1 = "0123456789ABCDEF";
        label354:
        f.f((f)localObject2, j.a((String)localObject1));
        if (f.o(f.this) != 4) {
          break label780;
        }
        localObject1 = i.a(this.c);
        label382:
        localObject3 = i.a(this.b, f.p(f.this).b());
        str1 = i.a(f.l(f.this), f.m(f.this), f.n(f.this), f.q(f.this), f.r(f.this));
        if ((this.a == null) || (!this.a.a())) {
          break label786;
        }
      }
      label631:
      label642:
      label653:
      label666:
      label677:
      label688:
      label701:
      label712:
      label723:
      label747:
      label758:
      label769:
      label780:
      label786:
      for (localObject2 = i.a(this.a);; localObject2 = "{}")
      {
        String str2 = "{\"version\":\"1.1.8\",\"address\":" + f.s(f.this);
        str2 = str2 + ",\"source\":203,\"access_token\":\"" + f.t(f.this) + "\",\"app_name\":" + "\"" + f.u(f.this) + "\",\"bearing\":1";
        localObject1 = str2 + ",\"attribute\":" + str1 + ",\"location\":" + (String)localObject2 + ",\"cells\":" + (String)localObject3 + ",\"wifis\":" + (String)localObject1 + "}";
        localObject1 = f.d(f.this).obtainMessage(16, localObject1);
        f.d(f.this).sendMessage((Message)localObject1);
        return;
        localObject1 = f.l(f.this);
        break;
        localObject1 = f.l(f.this);
        break label123;
        f.c(f.this, "");
        break label129;
        localObject1 = f.m(f.this);
        break label147;
        localObject1 = f.m(f.this);
        break label188;
        f.d(f.this, "");
        break label194;
        localObject1 = f.n(f.this);
        break label212;
        localObject1 = f.n(f.this);
        break label253;
        f.e(f.this, "");
        break label259;
        localObject1 = f.l(f.this);
        break label282;
        localObject1 = f.m(f.this);
        break label306;
        localObject1 = f.n(f.this);
        break label330;
        localObject1 = f.l(f.this);
        break label354;
        localObject1 = "[]";
        break label382;
      }
    }
  }
  
  final class b
    extends Thread
  {
    private String a = null;
    private String b = null;
    private String c = null;
    
    public b(String paramString)
    {
      this.a = paramString;
      StringBuilder localStringBuilder = new StringBuilder();
      if (f.h(f.this) == 0) {}
      for (paramString = "http://lstest.map.soso.com/loc?c=1";; paramString = "http://lbs.map.qq.com/loc?c=1")
      {
        this.b = (paramString + "&mars=" + f.i(f.this));
        return;
      }
    }
    
    private String a(byte[] paramArrayOfByte, String paramString)
    {
      f.a(f.this, System.currentTimeMillis());
      StringBuffer localStringBuffer = new StringBuffer();
      try
      {
        localStringBuffer.append(new String(paramArrayOfByte, paramString));
        return localStringBuffer.toString();
      }
      catch (Exception paramArrayOfByte) {}
      return null;
    }
    
    public final void run()
    {
      Message localMessage = new Message();
      localMessage.what = 8;
      int i;
      try
      {
        Object localObject1 = j.a(this.a.getBytes());
        f.a(f.this, true);
        localObject1 = b.a(this.b, "SOSO MAP LBS SDK", (byte[])localObject1);
        f.a(f.this, false);
        this.c = a(j.b(((n)localObject1).a), ((n)localObject1).b);
        if (this.c != null)
        {
          localMessage.arg1 = 0;
          localMessage.obj = this.c;
        }
        for (;;)
        {
          f.j(f.this);
          f.d(f.this).sendMessage(localMessage);
          return;
          localMessage.arg1 = 1;
        }
        i += 1;
      }
      catch (Exception localException1)
      {
        i = 0;
      }
      for (;;)
      {
        if (i <= 3) {}
        try
        {
          sleep(1000L);
          Object localObject2 = j.a(this.a.getBytes());
          f.a(f.this, true);
          localObject2 = b.a(this.b, "SOSO MAP LBS SDK", (byte[])localObject2);
          f.a(f.this, false);
          this.c = a(j.b(((n)localObject2).a), ((n)localObject2).b);
          if (this.c != null)
          {
            localMessage.arg1 = 0;
            localMessage.obj = this.c;
            continue;
          }
          localMessage.arg1 = 1;
        }
        catch (Exception localException2) {}
        f.a(f.this, false);
        localMessage.arg1 = 1;
        break;
      }
    }
  }
  
  final class c
    extends Handler
  {
    public c()
    {
      super();
    }
    
    public final void handleMessage(Message paramMessage)
    {
      switch (paramMessage.what)
      {
      }
      do
      {
        do
        {
          do
          {
            return;
            f.a(f.this, (e.b)paramMessage.obj);
            return;
            f.a(f.this, (d.b)paramMessage.obj);
            return;
            f.a(f.this, (g.b)paramMessage.obj);
            return;
            f.a(f.this, paramMessage.arg1);
            return;
            f.b(f.this, paramMessage.arg1);
            return;
            f.a(f.this, (Location)paramMessage.obj);
            return;
          } while (f.e(f.this) != 1);
          f.c(f.this);
          return;
        } while (paramMessage.obj == null);
        f.a(f.this, (String)paramMessage.obj);
        f.a(f.this, null);
        return;
        if (paramMessage.arg1 == 0)
        {
          f.b(f.this, (String)paramMessage.obj);
          return;
        }
      } while ((f.f(f.this) != null) && (f.f(f.this).a()));
      f.g(f.this);
    }
  }
}
