package com.tencent.tmassistantsdk.internal.b;

import android.content.Context;
import android.content.Intent;
import android.os.IBinder;
import android.text.TextUtils;
import com.tencent.assistant.sdk.remote.BaseService;
import com.tencent.assistant.sdk.remote.BaseService.Stub;
import com.tencent.assistant.sdk.remote.SDKActionCallback;
import com.tencent.tmassistant.d;
import com.tencent.tmassistantbase.util.Base64;
import com.tencent.tmassistantbase.util.Cryptor;
import com.tencent.tmassistantbase.util.TMLog;
import java.util.ArrayList;
import java.util.Iterator;

public class b
  extends d
{
  ArrayList a = new ArrayList();
  
  public b(Context paramContext, String paramString1, String paramString2)
  {
    super(paramContext, paramString1, paramString2);
    this.h = new c(this);
  }
  
  protected void a()
  {
    if ((this.a != null) && (this.a.size() > 0))
    {
      Iterator localIterator = this.a.iterator();
      while (localIterator.hasNext())
      {
        a localA = (a)localIterator.next();
        if (localA != null) {
          localA.a();
        }
      }
    }
  }
  
  protected void a(IBinder paramIBinder)
  {
    this.g = BaseService.Stub.asInterface(paramIBinder);
  }
  
  public void a(a paramA)
  {
    TMLog.i("TMAssistantDownloadOpenSDKClient", "addAssistantOnActionListener");
    if ((paramA != null) && (!this.a.contains(paramA))) {
      this.a.add(paramA);
    }
  }
  
  public byte[] a(byte[] paramArrayOfByte)
  {
    if (!TextUtils.isEmpty(this.d))
    {
      BaseService localBaseService = (BaseService)super.g();
      if (localBaseService != null) {
        return localBaseService.sendSyncData(this.d, paramArrayOfByte);
      }
      super.e();
      TMLog.i("TMAssistantDownloadOpenSDKClient", "initTMAssistantDownloadSDK");
    }
    return null;
  }
  
  protected void b()
  {
    Object localObject = String.valueOf(System.currentTimeMillis()).getBytes();
    localObject = Base64.encodeToString(new Cryptor().encrypt((byte[])localObject, this.d.getBytes()), 0);
    int i = ((BaseService)this.g).registerActionCallback(this.d, (String)localObject, (SDKActionCallback)this.h);
    TMLog.i("TMAssistantDownloadOpenSDKClient", "onServiceConnected,registerActionCallback:" + this.d + ",tokenString:" + (String)localObject + ",threadId:" + Thread.currentThread().getId() + ",mServiceCallback:" + this.h + ",registed result:" + i);
    if (i == 2) {
      a();
    }
  }
  
  public void b(byte[] paramArrayOfByte)
  {
    TMLog.i("TMAssistantDownloadOpenSDKClient", "sendAsyncData");
    if (!TextUtils.isEmpty(this.d))
    {
      BaseService localBaseService = (BaseService)super.g();
      TMLog.i("TMAssistantDownloadOpenSDKClient", "sendAsyncData baseService:" + localBaseService);
      if (localBaseService != null)
      {
        TMLog.i("TMAssistantDownloadOpenSDKClient", "baseService sendAsyncData");
        localBaseService.sendAsyncData(this.d, paramArrayOfByte);
      }
    }
    else
    {
      return;
    }
    super.e();
    TMLog.i("TMAssistantDownloadOpenSDKClient", "initTMAssistantDownloadSDK");
  }
  
  protected Intent c()
  {
    return new Intent(this.e).setClassName("com.tencent.android.qqdownloader", "com.tencent.assistant.sdk.SDKSupportService");
  }
  
  protected void d()
  {
    if (((BaseService)this.g).unregisterActionCallback((SDKActionCallback)this.h) == 2) {
      a();
    }
  }
}
