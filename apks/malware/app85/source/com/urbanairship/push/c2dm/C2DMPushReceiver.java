package com.urbanairship.push.c2dm;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import com.urbanairship.AirshipConfigOptions;
import com.urbanairship.AirshipConfigOptions.TransportType;
import com.urbanairship.Logger;
import com.urbanairship.UAirship;
import com.urbanairship.push.PushManager;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Set;

public class C2DMPushReceiver
  extends BroadcastReceiver
{
  public static final String INTENT_RECEIVE = "com.google.android.c2dm.intent.RECEIVE";
  public static final String INTENT_REGISTRATION = "com.google.android.c2dm.intent.REGISTRATION";
  
  public C2DMPushReceiver() {}
  
  private void handleRegistrationIntent(Context paramContext, Intent paramIntent)
  {
    if (UAirship.shared().getAirshipConfigOptions().getTransport() == AirshipConfigOptions.TransportType.HELIUM) {}
    do
    {
      return;
      paramContext = paramIntent.getStringExtra("registration_id");
      String str = paramIntent.getStringExtra("error");
      paramIntent = paramIntent.getStringExtra("unregistered");
      if (str != null)
      {
        Logger.error("Got error:" + str);
        PushManager.shared().c2dmRegistrationFailed(str);
        return;
      }
      if (paramIntent != null)
      {
        Logger.info("Unregistered from C2DM: " + paramIntent);
        return;
      }
    } while (paramContext == null);
    Logger.info("Got C2DM registration id:" + paramContext);
    PushManager.shared().c2dmRegistrationResponseReceived(paramContext);
  }
  
  protected void handleMessage(Context paramContext, Intent paramIntent)
  {
    paramContext = new HashMap();
    Object localObject = paramIntent.getExtras().keySet().iterator();
    while (((Iterator)localObject).hasNext())
    {
      String str = (String)((Iterator)localObject).next();
      paramContext.put(str, paramIntent.getStringExtra(str));
    }
    paramIntent = (String)paramContext.remove("com.urbanairship.push.ALERT");
    localObject = (String)paramContext.remove("com.urbanairship.push.PUSH_ID");
    Logger.info("Got C2DM push: " + (String)localObject);
    PushManager.deliverPush(paramIntent, (String)localObject, paramContext);
  }
  
  public void onReceive(Context paramContext, Intent paramIntent)
  {
    String str = paramIntent.getAction();
    if (str.equals("com.google.android.c2dm.intent.REGISTRATION"))
    {
      handleRegistrationIntent(paramContext, paramIntent);
      setResult(-1, null, null);
      return;
    }
    if (str.equals("com.google.android.c2dm.intent.RECEIVE"))
    {
      handleMessage(paramContext, paramIntent);
      setResult(-1, null, null);
      return;
    }
    Logger.warn("Received unknown action: " + str);
  }
}
