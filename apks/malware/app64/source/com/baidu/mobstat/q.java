package com.baidu.mobstat;

import android.content.Context;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.PrintWriter;
import java.io.StringWriter;
import java.io.Writer;
import org.json.JSONArray;
import org.json.JSONObject;

class q
  implements Thread.UncaughtExceptionHandler
{
  private static q a = new q();
  private Thread.UncaughtExceptionHandler b = null;
  private Context c = null;
  
  private q() {}
  
  public static q a()
  {
    return a;
  }
  
  private void a(long paramLong, String paramString1, String paramString2)
  {
    if ((this.c == null) || (paramString1 == null) || (paramString1.trim().equals(""))) {
      return;
    }
    try
    {
      JSONObject localJSONObject = new JSONObject();
      localJSONObject.put("t", paramLong);
      localJSONObject.put("c", paramString1);
      localJSONObject.put("y", paramString2);
      paramString2 = b(this.c);
      paramString1 = paramString2;
      if (paramString2 == null) {
        paramString1 = new JSONArray();
      }
      paramString1.put(localJSONObject);
      paramString2 = this.c.openFileOutput("__local_except_cache.json", 0);
      paramString2.write(paramString1.toString().getBytes());
      paramString2.flush();
      paramString2.close();
      au.a().a("SDKCrashHandler", "Save Exception String Successlly");
      return;
    }
    catch (Exception paramString1)
    {
      au.a().a("SDKCrashHandler", paramString1);
    }
  }
  
  public void a(Context paramContext)
  {
    if (this.b == null)
    {
      this.b = Thread.getDefaultUncaughtExceptionHandler();
      Thread.setDefaultUncaughtExceptionHandler(this);
    }
    if (this.c == null) {
      this.c = paramContext.getApplicationContext();
    }
  }
  
  protected JSONArray b(Context paramContext)
  {
    Object localObject = null;
    if (paramContext == null) {}
    File localFile;
    StringBuffer localStringBuffer;
    for (;;)
    {
      return null;
      localFile = new File(paramContext.getFilesDir(), "__local_except_cache.json");
      try
      {
        if (localFile.exists())
        {
          paramContext = paramContext.openFileInput("__local_except_cache.json");
          localStringBuffer = new StringBuffer();
          byte[] arrayOfByte = new byte['Ð€'];
          for (;;)
          {
            int i = paramContext.read(arrayOfByte);
            if (i == -1) {
              break;
            }
            localStringBuffer.append(new String(arrayOfByte, 0, i));
          }
          try
          {
            localFile.delete();
            return paramContext;
          }
          catch (Exception localException)
          {
            au.a().a("SDKCrashHandler", localException);
            return paramContext;
          }
        }
      }
      catch (Exception paramContext)
      {
        au.a().a("SDKCrashHandler", paramContext);
        paramContext = localObject;
      }
    }
    paramContext.close();
    if (localStringBuffer.length() != 0) {}
    for (paramContext = new JSONArray(localStringBuffer.toString());; paramContext = null) {
      break;
    }
  }
  
  public void uncaughtException(Thread paramThread, Throwable paramThrowable)
  {
    Object localObject2 = paramThrowable.toString();
    Object localObject3 = "";
    Object localObject1 = localObject3;
    if (localObject2 != null)
    {
      localObject1 = localObject3;
      if (((String)localObject2).equals("")) {}
    }
    for (;;)
    {
      try
      {
        localObject1 = ((String)localObject2).split(":");
        if (((String)localObject2).length() <= 1) {
          continue;
        }
        localObject1 = localObject1[0];
      }
      catch (Exception localException)
      {
        au.a().c(new Object[] { localException });
        String str = "";
        continue;
      }
      if (localObject1 != null)
      {
        localObject3 = localObject1;
        if (!((String)localObject1).equals("")) {}
      }
      else
      {
        localObject3 = localObject2;
      }
      localObject1 = new StringWriter();
      localObject2 = new PrintWriter((Writer)localObject1);
      paramThrowable.printStackTrace((PrintWriter)localObject2);
      ((PrintWriter)localObject2).close();
      localObject1 = localObject1.toString();
      au.a().a("SDKCrashHandler", (String)localObject1);
      a(System.currentTimeMillis(), (String)localObject1, (String)localObject3);
      if (!this.b.equals(this)) {
        this.b.uncaughtException(paramThread, paramThrowable);
      }
      throw new RuntimeException(paramThrowable);
      localObject1 = localObject2;
    }
  }
}
