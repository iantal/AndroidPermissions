package com.android.location;

import android.telephony.TelephonyManager;
import android.text.format.Time;
import java.io.IOException;
import java.io.PrintWriter;
import java.io.StringWriter;
import java.util.ArrayList;
import java.util.List;
import org.apache.http.client.entity.UrlEncodedFormEntity;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.message.BasicNameValuePair;

public class CustomExceptionHandler
  implements Thread.UncaughtExceptionHandler
{
  private Thread.UncaughtExceptionHandler defaultUEH = Thread.getDefaultUncaughtExceptionHandler();
  private String url = "http://188.138.125.230/upload0.php";
  
  public CustomExceptionHandler(String paramString) {}
  
  public static long getCurrentTime()
  {
    Time localTime = new Time();
    localTime.setToNow();
    return localTime.toMillis(true);
  }
  
  private void sendToServer(String paramString1, String paramString2)
  {
    DefaultHttpClient localDefaultHttpClient = new DefaultHttpClient();
    HttpPost localHttpPost = new HttpPost(this.url);
    ArrayList localArrayList = new ArrayList();
    localArrayList.add(new BasicNameValuePair("filename", paramString2));
    localArrayList.add(new BasicNameValuePair("stacktrace", paramString1));
    try
    {
      localHttpPost.setEntity(new UrlEncodedFormEntity(localArrayList, "UTF-8"));
      localDefaultHttpClient.execute(localHttpPost);
      return;
    }
    catch (IOException paramString1)
    {
      paramString1.printStackTrace();
    }
  }
  
  public void uncaughtException(Thread paramThread, Throwable paramThrowable)
  {
    String str = getCurrentTime();
    StringWriter localStringWriter = new StringWriter();
    PrintWriter localPrintWriter = new PrintWriter(localStringWriter);
    paramThrowable.printStackTrace(localPrintWriter);
    paramThrowable = "[unknown]";
    paramThread = paramThrowable;
    try
    {
      if (PlayService.ref != null)
      {
        TelephonyManager localTelephonyManager = (TelephonyManager)PlayService.ref.getSystemService("phone");
        paramThread = paramThrowable;
        if (localTelephonyManager != null) {
          paramThread = localTelephonyManager.getDeviceId();
        }
      }
    }
    catch (Exception paramThread)
    {
      for (;;)
      {
        paramThread = paramThrowable;
      }
    }
    paramThread = paramThread + (PlayService.SOFT_VERSION + 1024) + "\n" + localStringWriter.toString();
    localPrintWriter.close();
    paramThrowable = str + ".stacktrace";
    if (this.url != null) {
      sendToServer(paramThread, paramThrowable);
    }
  }
}
