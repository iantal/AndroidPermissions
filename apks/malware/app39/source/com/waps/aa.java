package com.waps;

import android.content.Context;
import android.os.Process;
import android.util.Log;
import java.io.PrintWriter;
import java.io.StringWriter;
import java.text.SimpleDateFormat;
import java.util.Date;

public class aa
  implements Thread.UncaughtExceptionHandler
{
  private static aa b;
  private static Context c;
  private static z e = null;
  private Thread.UncaughtExceptionHandler a;
  private ac d;
  private String f = "";
  private String g = "";
  private String h = "errorLog.txt";
  
  private aa(Context paramContext, z paramZ, String paramString)
  {
    c = paramContext;
    e = paramZ;
    this.f = paramString;
  }
  
  public static aa a(Context paramContext, z paramZ, String paramString)
  {
    if (b == null) {
      b = new aa(paramContext, paramZ, paramString);
    }
    return b;
  }
  
  private boolean a(Throwable paramThrowable)
  {
    if (paramThrowable == null) {}
    do
    {
      return true;
      new ab(this, paramThrowable.getLocalizedMessage()).start();
      b(paramThrowable);
    } while (e == null);
    a(c);
    return true;
  }
  
  private void b(Throwable paramThrowable)
  {
    String str = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss").format(new Date(System.currentTimeMillis()));
    StringWriter localStringWriter = new StringWriter();
    PrintWriter localPrintWriter = new PrintWriter(localStringWriter);
    paramThrowable.printStackTrace(localPrintWriter);
    for (paramThrowable = paramThrowable.getCause(); paramThrowable != null; paramThrowable = paramThrowable.getCause()) {
      paramThrowable.printStackTrace(localPrintWriter);
    }
    this.g = localStringWriter.toString();
    Log.v("Exception", this.g);
    localPrintWriter.close();
    try
    {
      if (this.g.length() > 5000) {
        this.g = this.g.substring(0, 5000);
      }
      this.g = (this.g + "[" + str + "]");
      new SDKUtils(c).saveDataToLocal(this.g, this.h, "/Android/data/cache", true);
      return;
    }
    catch (Exception paramThrowable) {}
  }
  
  private String d()
  {
    try
    {
      String str = new SDKUtils(c).loadStringFromLocal(this.h, "/Android/data/cache");
      return str;
    }
    catch (Exception localException) {}
    return "";
  }
  
  public void a()
  {
    this.a = Thread.getDefaultUncaughtExceptionHandler();
    Thread.setDefaultUncaughtExceptionHandler(this);
    if (e != null)
    {
      AppConnect.a(c, e);
      a(c);
    }
  }
  
  protected void a(Context paramContext)
  {
    this.d = new ac(this, null);
    this.d.execute(new Void[0]);
  }
  
  public void uncaughtException(Thread paramThread, Throwable paramThrowable)
  {
    if ((!a(paramThrowable)) && (this.a != null))
    {
      this.a.uncaughtException(paramThread, paramThrowable);
      return;
    }
    try
    {
      Thread.sleep(3000L);
      Process.killProcess(Process.myPid());
      System.exit(10);
      return;
    }
    catch (InterruptedException paramThread)
    {
      for (;;) {}
    }
  }
}
