package com.umeng.analytics.onlineconfig;

import android.content.Context;
import android.content.SharedPreferences;
import android.content.SharedPreferences.Editor;
import android.text.TextUtils;
import com.umeng.analytics.j;
import com.umeng.common.Log;
import com.umeng.common.util.h;
import java.util.Iterator;
import org.json.JSONObject;

public class a
{
  private final String a = "last_config_time";
  private final String b = "report_policy";
  private final String c = "online_config";
  private String d = null;
  private String e = null;
  private UmengOnlineConfigureListener f = null;
  private c g = null;
  
  public a() {}
  
  private void a(Context paramContext, b paramB)
  {
    paramContext = j.b(paramContext).edit();
    if (!TextUtils.isEmpty(paramB.e)) {
      paramContext.putString("umeng_last_config_time", paramB.e);
    }
    if (paramB.c != -1)
    {
      paramContext.putInt("umeng_net_report_policy", paramB.c);
      paramContext.putLong("umeng_net_report_interval", paramB.d);
    }
    paramContext.commit();
  }
  
  private void a(JSONObject paramJSONObject)
  {
    if (this.f != null) {
      this.f.onDataReceived(paramJSONObject);
    }
  }
  
  private String b(Context paramContext)
  {
    String str2 = this.d;
    String str1 = str2;
    if (str2 == null) {
      str1 = com.umeng.common.b.q(paramContext);
    }
    if (str1 == null) {
      throw new Exception("none appkey exception");
    }
    return str1;
  }
  
  private void b(Context paramContext, b paramB)
  {
    if ((paramB.a == null) || (paramB.a.length() == 0)) {
      return;
    }
    paramContext = j.b(paramContext).edit();
    try
    {
      paramB = paramB.a;
      Iterator localIterator = paramB.keys();
      while (localIterator.hasNext())
      {
        String str = (String)localIterator.next();
        paramContext.putString(str, paramB.getString(str));
      }
      paramContext.commit();
    }
    catch (Exception paramContext)
    {
      Log.c("MobclickAgent", "save online config params", paramContext);
      return;
    }
    Log.a("MobclickAgent", "get online setting params: " + paramB);
  }
  
  private String c(Context paramContext)
  {
    if (this.e == null) {
      return com.umeng.common.b.u(paramContext);
    }
    return this.e;
  }
  
  private JSONObject d(Context paramContext)
  {
    JSONObject localJSONObject = new JSONObject();
    try
    {
      getClass();
      localJSONObject.put("type", "online_config");
      localJSONObject.put("appkey", b(paramContext));
      localJSONObject.put("version_code", com.umeng.common.b.d(paramContext));
      localJSONObject.put("package", com.umeng.common.b.v(paramContext));
      localJSONObject.put("sdk_version", "4.6.3");
      localJSONObject.put("idmd5", h.b(com.umeng.common.b.g(paramContext)));
      localJSONObject.put("channel", c(paramContext));
      localJSONObject.put("report_policy", j.i(paramContext)[0]);
      localJSONObject.put("last_config_time", e(paramContext));
      return localJSONObject;
    }
    catch (Exception paramContext)
    {
      Log.b("MobclickAgent", "exception in onlineConfigInternal");
    }
    return null;
  }
  
  private String e(Context paramContext)
  {
    return j.b(paramContext).getString("umeng_last_config_time", "");
  }
  
  public void a()
  {
    this.f = null;
  }
  
  public void a(Context paramContext)
  {
    if (paramContext == null) {}
    try
    {
      Log.b("MobclickAgent", "unexpected null context in updateOnlineConfig");
      return;
    }
    catch (Exception paramContext)
    {
      Log.b("MobclickAgent", "exception in updateOnlineConfig");
    }
    new Thread(new a.b(this, paramContext)).start();
    return;
  }
  
  public void a(Context paramContext, String paramString1, String paramString2)
  {
    this.d = paramString1;
    this.e = paramString2;
    a(paramContext);
  }
  
  public void a(UmengOnlineConfigureListener paramUmengOnlineConfigureListener)
  {
    this.f = paramUmengOnlineConfigureListener;
  }
  
  public void a(c paramC)
  {
    this.g = paramC;
  }
  
  public void b()
  {
    this.g = null;
  }
}
