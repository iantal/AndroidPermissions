package com.umeng.common.net;

import android.app.Notification;
import android.app.NotificationManager;
import android.app.PendingIntent;
import android.content.Context;
import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;
import android.os.Handler;
import android.os.Message;
import com.umeng.common.Log;
import com.umeng.common.a.c;
import com.umeng.common.b;
import com.umeng.common.util.DeltaUpdate;
import java.io.File;

class f
  extends Handler
{
  f(DownloadingService paramDownloadingService) {}
  
  public void handleMessage(Message paramMessage)
  {
    switch (paramMessage.what)
    {
    default: 
      return;
    case 5: 
      localA = (a.a)paramMessage.obj;
      i = paramMessage.arg2;
      try
      {
        paramMessage = paramMessage.getData().getString("filename");
        Log.c(DownloadingService.a(), "Cancel old notification....");
        localObject1 = new Notification(17301634, DownloadingService.b(this.a).getString(c.j(DownloadingService.b(this.a))), System.currentTimeMillis());
        localObject2 = new Intent("android.intent.action.VIEW");
        ((Intent)localObject2).addFlags(268435456);
        ((Intent)localObject2).setDataAndType(Uri.fromFile(new File(paramMessage)), "application/vnd.android.package-archive");
        localObject3 = PendingIntent.getActivity(DownloadingService.b(this.a), 0, (Intent)localObject2, 134217728);
        ((Notification)localObject1).setLatestEventInfo(DownloadingService.b(this.a), localA.b, DownloadingService.b(this.a).getString(c.j(DownloadingService.b(this.a))), (PendingIntent)localObject3);
        ((Notification)localObject1).flags = 16;
        DownloadingService.a(this.a, (NotificationManager)this.a.getSystemService("notification"));
        DownloadingService.c(this.a).notify(i + 1, (Notification)localObject1);
        Log.c(DownloadingService.a(), "Show new  notification....");
        boolean bool = DownloadingService.a(this.a).a(DownloadingService.b(this.a));
        Log.c(DownloadingService.a(), String.format("isAppOnForeground = %1$B", new Object[] { Boolean.valueOf(bool) }));
        if ((bool) && (!localA.h))
        {
          DownloadingService.c(this.a).cancel(i + 1);
          DownloadingService.b(this.a).startActivity((Intent)localObject2);
        }
        Log.a(DownloadingService.a(), String.format("%1$10s downloaded. Saved to: %2$s", new Object[] { localA.b, paramMessage }));
        return;
      }
      catch (Exception paramMessage)
      {
        Log.b(DownloadingService.a(), "can not install. " + paramMessage.getMessage());
        DownloadingService.c(this.a).cancel(i + 1);
        return;
      }
    }
    a.a localA = (a.a)paramMessage.obj;
    int i = paramMessage.arg2;
    paramMessage = paramMessage.getData().getString("filename");
    DownloadingService.c(this.a).cancel(i);
    Object localObject1 = new Notification(17301633, DownloadingService.b(this.a).getString(c.l(DownloadingService.b(this.a))), System.currentTimeMillis());
    Object localObject2 = PendingIntent.getActivity(DownloadingService.b(this.a), 0, new Intent(), 134217728);
    ((Notification)localObject1).setLatestEventInfo(DownloadingService.b(this.a), b.w(DownloadingService.b(this.a)), DownloadingService.b(this.a).getString(c.l(DownloadingService.b(this.a))), (PendingIntent)localObject2);
    DownloadingService.c(this.a).notify(i + 1, (Notification)localObject1);
    localObject1 = paramMessage.replace(".patch", ".apk");
    localObject2 = DeltaUpdate.a(this.a);
    Object localObject3 = DownloadingService.a(this.a);
    localObject3.getClass();
    new d.c((d)localObject3, DownloadingService.b(this.a), i, localA, (String)localObject1, DownloadingService.c(), DownloadingService.b()).execute(new String[] { localObject2, localObject1, paramMessage });
  }
}
