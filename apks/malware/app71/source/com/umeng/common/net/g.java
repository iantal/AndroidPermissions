package com.umeng.common.net;

import android.app.NotificationManager;
import android.os.Bundle;
import android.os.Handler;
import android.os.Message;
import android.os.Messenger;
import android.os.RemoteException;
import android.util.SparseArray;
import com.umeng.common.Log;
import java.util.Map;

class g
  implements DownloadingService.a
{
  SparseArray a = new SparseArray();
  
  g(DownloadingService paramDownloadingService) {}
  
  public void a(int paramInt)
  {
    int j = 0;
    if (DownloadingService.c().indexOfKey(paramInt) >= 0)
    {
      d.b localB = (d.b)DownloadingService.c().get(paramInt);
      Object localObject = localB.f;
      int i = j;
      if (localObject != null)
      {
        i = j;
        if (localObject[1] > 0L)
        {
          j = (int)((float)localObject[0] / (float)localObject[1] * 100.0F);
          i = j;
          if (j > 100) {
            i = 99;
          }
        }
      }
      if (!localB.e.h)
      {
        this.a.put(paramInt, Long.valueOf(-1L));
        localObject = DownloadingService.a(this.b).a(this.b, localB.e, paramInt, i);
        localB.b = ((d.a)localObject);
        DownloadingService.c(this.b).notify(paramInt, ((d.a)localObject).d());
      }
    }
  }
  
  public void a(int paramInt1, int paramInt2)
  {
    if (DownloadingService.c().indexOfKey(paramInt1) >= 0)
    {
      Object localObject = (d.b)DownloadingService.c().get(paramInt1);
      a.a localA = ((d.b)localObject).e;
      long l = System.currentTimeMillis();
      if ((!localA.h) && (l - ((Long)this.a.get(paramInt1)).longValue() > 500L))
      {
        this.a.put(paramInt1, Long.valueOf(l));
        localObject = ((d.b)localObject).b;
        ((d.a)localObject).a(100, paramInt2, false).a(String.valueOf(paramInt2) + "%");
        DownloadingService.c(this.b).notify(paramInt1, ((d.a)localObject).d());
      }
      Log.c(DownloadingService.a(), String.format("%3$10s Notification: mNotificationId = %1$15s\t|\tprogress = %2$15s", new Object[] { Integer.valueOf(paramInt1), Integer.valueOf(paramInt2), localA.b }));
    }
  }
  
  public void a(int paramInt, Exception paramException)
  {
    if (DownloadingService.c().indexOfKey(paramInt) >= 0) {
      DownloadingService.a(this.b).a(DownloadingService.b(this.b), DownloadingService.c(), DownloadingService.b(), paramInt);
    }
  }
  
  public void a(int paramInt, String paramString)
  {
    Object localObject;
    Bundle localBundle;
    if (DownloadingService.c().indexOfKey(paramInt) >= 0)
    {
      localObject = (d.b)DownloadingService.c().get(paramInt);
      if (localObject != null)
      {
        localObject = ((d.b)localObject).e;
        c.a(DownloadingService.b(this.b)).a(((a.a)localObject).a, ((a.a)localObject).c, 100);
        localBundle = new Bundle();
        localBundle.putString("filename", paramString);
        if (!((a.a)localObject).a.equalsIgnoreCase("delta_update")) {
          break label126;
        }
        paramString = Message.obtain();
        paramString.what = 6;
        paramString.arg1 = 1;
        paramString.obj = localObject;
        paramString.arg2 = paramInt;
        paramString.setData(localBundle);
        DownloadingService.d(this.b).sendMessage(paramString);
      }
    }
    return;
    label126:
    paramString = Message.obtain();
    paramString.what = 5;
    paramString.arg1 = 1;
    paramString.obj = localObject;
    paramString.arg2 = paramInt;
    paramString.setData(localBundle);
    DownloadingService.d(this.b).sendMessage(paramString);
    paramString = Message.obtain();
    paramString.what = 5;
    paramString.arg1 = 1;
    paramString.arg2 = paramInt;
    paramString.setData(localBundle);
    try
    {
      if (DownloadingService.b().get(localObject) != null) {
        ((Messenger)DownloadingService.b().get(localObject)).send(paramString);
      }
      DownloadingService.a(this.b).a(DownloadingService.b(this.b), DownloadingService.c(), DownloadingService.b(), paramInt);
      return;
    }
    catch (RemoteException paramString)
    {
      DownloadingService.a(this.b).a(DownloadingService.b(this.b), DownloadingService.c(), DownloadingService.b(), paramInt);
    }
  }
}
