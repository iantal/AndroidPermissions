package com.upay.billing.engine.alipay;

import android.app.Activity;
import android.webkit.WebView;
import android.widget.RelativeLayout;
import com.upay.billing.Engine;
import com.upay.billing.UpayActivity;
import com.upay.billing.UpayCore;
import com.upay.billing.bean.Op;
import com.upay.billing.bean.PriceType;
import com.upay.billing.bean.Trade;
import com.upay.billing.engine.UpayMResource;
import com.upay.billing.utils.Json;
import com.upay.billing.utils.Util;
import java.util.List;
import org.json.JSONObject;

public class Main
  extends Engine
{
  private static final String TAG = "Alipay-Main";
  private static final String payUrl = "http://121.52.218.66:8009/alipayto_v2.php";
  private int PAY_CODE = 121;
  private RelativeLayout container;
  private String layout = "{\"window-no-title\":true,\"window-full-screen\":false,\"content-view\":{\"type\":\"relative-layout\",\"width\":\"fill\",\"height\":\"fill\"}}";
  private Trade mTrade;
  private int result;
  private int result_charge;
  private WebView webView;
  
  public Main() {}
  
  private void exit(Activity paramActivity)
  {
    if (this.PAY_CODE == 200)
    {
      this.core.paymentCompleted(this.mTrade, this.PAY_CODE);
      this.core.tradeUpdated(this.mTrade, "alipay", 1, this.PAY_CODE);
      this.result = this.PAY_CODE;
    }
    for (this.result_charge = this.PAY_CODE;; this.result_charge = 146)
    {
      logPay(this.result, "alipay-pay-success");
      if (this.result_charge == 200) {
        logCharge(this.result_charge, "alipay-charge-success");
      }
      if (this.webView != null)
      {
        this.container.removeView(this.webView);
        this.webView.removeAllViews();
        this.webView.destroy();
      }
      paramActivity.finish();
      return;
      this.core.paymentCompleted(this.mTrade, this.PAY_CODE);
      this.result = this.PAY_CODE;
    }
  }
  
  private void logCharge(int paramInt, String paramString)
  {
    this.core.logEvent(this.mTrade.appKey, "charge_handle", Json.createObject(new Object[] { "trade_id", this.mTrade.id, "goods_key", this.mTrade.goodsKey, "cmd_key", "alipay", "bt_key", "alipay", "description", paramString, "mt_msg", "", "mt_num", "", "result", Integer.valueOf(paramInt), "sn", this.mTrade.id + "01", "ts", Long.valueOf(Util.getTs()), "price", Integer.valueOf(this.mTrade.price) }).asObject().toString());
  }
  
  private void logPay(int paramInt, String paramString)
  {
    this.core.logEvent(this.mTrade.appKey, "exec_pay", Json.createObject(new Object[] { "trade_id", this.mTrade.id, "goods_key", this.mTrade.goodsKey, "cmd_key", "alipay", "bt_key", "alipay", "target", "", "sn", this.mTrade.id + "01", "request", "", "response", paramString, "result", Integer.valueOf(paramInt), "ts", Long.valueOf(Util.getTs()), "price", Integer.valueOf(this.mTrade.price) }).asObject().toString());
  }
  
  public void cancelPay()
  {
    if (this.webView != null)
    {
      this.container.removeView(this.webView);
      this.webView.removeAllViews();
      this.webView.destroy();
    }
    this.core.paymentCompleted(this.mTrade, 110);
    logPay(110, "alipay-pay-cancel");
  }
  
  public Op getOp()
  {
    return Op.NONE;
  }
  
  public PriceType getPriceType()
  {
    return PriceType.ANY;
  }
  
  public boolean hasCustomConfirmUi()
  {
    return true;
  }
  
  public boolean isAvailable(Op paramOp, boolean paramBoolean1, boolean paramBoolean2, boolean paramBoolean3, boolean paramBoolean4)
  {
    return paramBoolean2;
  }
  
  public boolean judgeAlipayUrl(String paramString)
  {
    boolean bool2 = paramString.contains("asyn_payment_result.htm");
    boolean bool1 = false;
    if (bool2) {
      bool1 = true;
    }
    return bool1;
  }
  
  public void pay(Trade paramTrade, List paramList)
  {
    this.mTrade = paramTrade;
    if (Util.isNetworkAvailable(this.core.getContext()))
    {
      new UpayMResource(this.core.getContext());
      this.PAY_CODE = 200;
      UpayActivity.start(this.core.getContext(), "upay_alipay_ui", this.layout, 0, new Main.1(this, paramTrade));
      return;
    }
    this.core.paymentCompleted(paramTrade, 105);
    logPay(121, "alipay-no-network");
  }
}
