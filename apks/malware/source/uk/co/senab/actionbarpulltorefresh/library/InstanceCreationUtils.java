package uk.co.senab.actionbarpulltorefresh.library;

import android.content.Context;
import android.util.Log;
import android.view.View;
import java.lang.reflect.Constructor;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map.Entry;
import java.util.Set;
import uk.co.senab.actionbarpulltorefresh.library.viewdelegates.AbsListViewDelegate;
import uk.co.senab.actionbarpulltorefresh.library.viewdelegates.ScrollYDelegate;
import uk.co.senab.actionbarpulltorefresh.library.viewdelegates.ViewDelegate;
import uk.co.senab.actionbarpulltorefresh.library.viewdelegates.WebViewDelegate;

class InstanceCreationUtils
{
  private static final HashMap<Class, Class> BUILT_IN_DELEGATES;
  private static final String LOG_TAG = "InstanceCreationUtils";
  private static final Class<?>[] TRANSFORMER_CONSTRUCTOR_SIGNATURE;
  private static final Class<?>[] VIEW_DELEGATE_CONSTRUCTOR_SIGNATURE = new Class[0];
  
  static
  {
    TRANSFORMER_CONSTRUCTOR_SIGNATURE = new Class[0];
    BUILT_IN_DELEGATES = new HashMap();
    addBuiltinDelegates(AbsListViewDelegate.SUPPORTED_VIEW_CLASSES, AbsListViewDelegate.class);
    addBuiltinDelegates(ScrollYDelegate.SUPPORTED_VIEW_CLASSES, ScrollYDelegate.class);
    addBuiltinDelegates(WebViewDelegate.SUPPORTED_VIEW_CLASSES, WebViewDelegate.class);
  }
  
  InstanceCreationUtils() {}
  
  private static void addBuiltinDelegates(Class[] paramArrayOfClass, Class<?> paramClass)
  {
    int i = 0;
    int j = paramArrayOfClass.length;
    while (i < j)
    {
      BUILT_IN_DELEGATES.put(paramArrayOfClass[i], paramClass);
      i += 1;
    }
  }
  
  static ViewDelegate getBuiltInViewDelegate(View paramView)
  {
    Iterator localIterator = BUILT_IN_DELEGATES.entrySet().iterator();
    while (localIterator.hasNext())
    {
      Map.Entry localEntry = (Map.Entry)localIterator.next();
      if (((Class)localEntry.getKey()).isInstance(paramView)) {
        return (ViewDelegate)newInstance(paramView.getContext(), (Class)localEntry.getValue(), VIEW_DELEGATE_CONSTRUCTOR_SIGNATURE, new Object[0]);
      }
    }
    return null;
  }
  
  static <T> T instantiateTransformer(Context paramContext, String paramString)
  {
    try
    {
      paramContext = newInstance(paramContext, paramContext.getClassLoader().loadClass(paramString), TRANSFORMER_CONSTRUCTOR_SIGNATURE, new Object[0]);
      return paramContext;
    }
    catch (Exception paramContext)
    {
      Log.w("InstanceCreationUtils", "Cannot instantiate class: " + paramString, paramContext);
    }
    return null;
  }
  
  static <T> T instantiateViewDelegate(Context paramContext, String paramString)
  {
    try
    {
      paramContext = newInstance(paramContext, paramContext.getClassLoader().loadClass(paramString), VIEW_DELEGATE_CONSTRUCTOR_SIGNATURE, new Object[0]);
      return paramContext;
    }
    catch (Exception paramContext)
    {
      Log.w("InstanceCreationUtils", "Cannot instantiate class: " + paramString, paramContext);
    }
    return null;
  }
  
  private static <T> T newInstance(Context paramContext, Class paramClass, Class[] paramArrayOfClass, Object... paramVarArgs)
  {
    try
    {
      paramContext = paramClass.getConstructor(paramArrayOfClass).newInstance(paramVarArgs);
      return paramContext;
    }
    catch (Exception paramContext)
    {
      Log.w("InstanceCreationUtils", "Cannot instantiate class: " + paramClass.getName(), paramContext);
    }
    return null;
  }
}
