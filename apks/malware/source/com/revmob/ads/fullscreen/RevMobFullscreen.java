package com.revmob.ads.fullscreen;

import android.app.Activity;
import android.content.Intent;
import com.revmob.RevMobAdsListener;
import com.revmob.ads.fullscreen.client.FullscreenClientListener;
import com.revmob.ads.fullscreen.client.FullscreenData;
import com.revmob.ads.internal.Ad;
import com.revmob.ads.internal.AdState;
import com.revmob.android.RevMobContext;
import com.revmob.client.AdData;
import com.revmob.client.RevMobClient;
import com.revmob.internal.RMLog;

public class RevMobFullscreen
  implements Ad
{
  private Activity activity;
  public boolean autoshow = false;
  private FullscreenData data;
  private RevMobAdsListener publisherListener;
  private AdState state;
  
  public RevMobFullscreen(Activity paramActivity, RevMobAdsListener paramRevMobAdsListener)
  {
    this.activity = paramActivity;
    this.publisherListener = paramRevMobAdsListener;
    this.state = AdState.CREATED;
  }
  
  private boolean isLoaded()
  {
    return this.data != null;
  }
  
  public void hide()
  {
    this.autoshow = false;
    this.activity.finishActivity(0);
  }
  
  public void load()
  {
    load(null);
  }
  
  public void load(String paramString)
  {
    if ((this.state == AdState.CREATED) || (this.state == AdState.CLOSED))
    {
      this.state = AdState.LOADING;
      if (paramString == null) {
        break label82;
      }
    }
    label82:
    for (String str = "Loading Fullscreen " + paramString;; str = "Loading Fullscreen")
    {
      RMLog.i(str);
      RevMobClient.getInstance().fetchFullscreen(paramString, RevMobContext.toPayload(this.activity), new FullscreenClientListener(this, this.publisherListener));
      return;
    }
  }
  
  public void show()
  {
    this.autoshow = true;
    if ((isLoaded()) && (this.state != AdState.DISPLAYED)) {
      if (FullscreenActivity.isFullscreenActivityAvailable(this.activity).booleanValue())
      {
        this.state = AdState.DISPLAYED;
        localIntent = new Intent(this.activity, FullscreenActivity.class);
        localIntent.putExtra("com.revmob.ads.fullscreen.adUrl", this.data.getClickUrl());
        this.activity.startActivityForResult(localIntent, 0);
        if (this.publisherListener != null) {
          this.publisherListener.onRevMobAdDisplayed();
        }
        RevMobClient.getInstance().reportImpression(this.data.getImpressionUrl(), RevMobContext.toPayload(this.activity));
      }
    }
    while ((this.state == AdState.CREATED) || (this.state == AdState.CLOSED))
    {
      Intent localIntent;
      return;
      this.state = AdState.CLOSED;
      RMLog.e("You must declare the RevMob FullscreenActivity in the AndroidManifest.xml file");
      return;
    }
    RMLog.i("The ad is not completely loaded yet. As soon as it is loaded, it is going to be displayed automatically.");
  }
  
  public void updateWithData(AdData paramAdData)
  {
    this.state = AdState.LOADED;
    this.data = ((FullscreenData)paramAdData);
    FullscreenData.addLoadedFullscreen(this.data);
    if (this.publisherListener != null) {
      this.publisherListener.onRevMobAdReceived();
    }
    if (this.autoshow) {
      show();
    }
  }
}
