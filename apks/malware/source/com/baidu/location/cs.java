package com.baidu.location;

import android.app.AlarmManager;
import android.app.PendingIntent;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.location.Location;
import java.util.ArrayList;
import java.util.Iterator;

public class cs
  implements bb
{
  private ArrayList a = null;
  private float b = Float.MAX_VALUE;
  private BDLocation c = null;
  private long d = 0L;
  private k e = null;
  private Context f = null;
  private int g = 0;
  private long h = 0L;
  private boolean j = false;
  private boolean k = false;
  private PendingIntent l = null;
  private AlarmManager m = null;
  private cu n = null;
  private ct o = new ct(this);
  private boolean p = false;
  
  public cs(Context paramContext, k paramK)
  {
    this.f = paramContext;
    this.e = paramK;
    this.e.a(this.o);
    this.m = ((AlarmManager)this.f.getSystemService("alarm"));
    this.n = new cu(this);
    this.p = false;
  }
  
  private void a(long paramLong)
  {
    if (this.j) {
      this.m.cancel(this.l);
    }
    this.l = PendingIntent.getBroadcast(this.f, 0, new Intent("android.com.baidu.location.TIMER.NOTIFY"), 134217728);
    this.m.set(0, System.currentTimeMillis() + paramLong, this.l);
  }
  
  private void a(BDLocation paramBDLocation)
  {
    this.j = false;
    if ((paramBDLocation.e() != 61) && (paramBDLocation.e() != 161) && (paramBDLocation.e() != 65)) {
      a(120000L);
    }
    while ((System.currentTimeMillis() - this.d < 5000L) || (this.a == null)) {
      return;
    }
    this.c = paramBDLocation;
    this.d = System.currentTimeMillis();
    float[] arrayOfFloat = new float[1];
    Iterator localIterator = this.a.iterator();
    float f1 = Float.MAX_VALUE;
    if (localIterator.hasNext())
    {
      e localE = (e)localIterator.next();
      Location.distanceBetween(paramBDLocation.b(), paramBDLocation.c(), localE.f, localE.g, arrayOfFloat);
      float f2 = arrayOfFloat[0] - localE.c - paramBDLocation.d();
      if (f2 > 0.0F)
      {
        if (f2 >= f1) {
          break label215;
        }
        f1 = f2;
      }
      label215:
      for (;;)
      {
        break;
        if (localE.h < 3)
        {
          localE.h += 1;
          localE.a(paramBDLocation, arrayOfFloat[0]);
          if (localE.h < 3) {
            this.k = true;
          }
        }
      }
    }
    if (f1 < this.b) {
      this.b = f1;
    }
    this.g = 0;
    c();
  }
  
  private boolean b()
  {
    boolean bool2;
    if ((this.a == null) || (this.a.isEmpty())) {
      bool2 = false;
    }
    Iterator localIterator;
    boolean bool1;
    do
    {
      return bool2;
      localIterator = this.a.iterator();
      bool1 = false;
      bool2 = bool1;
    } while (!localIterator.hasNext());
    if (((e)localIterator.next()).h < 3) {
      bool1 = true;
    }
    for (;;)
    {
      break;
    }
  }
  
  private void c()
  {
    int i1 = 10000;
    if (!b()) {
      return;
    }
    int i;
    if (this.b > 5000.0F)
    {
      i = 600000;
      if (!this.k) {
        break label148;
      }
      this.k = false;
      i = i1;
    }
    label146:
    label148:
    for (;;)
    {
      if (this.g != 0)
      {
        long l1 = this.h;
        long l2 = this.g;
        long l3 = System.currentTimeMillis();
        if (i <= l1 + l2 - l3) {}
      }
      for (i1 = 0;; i1 = 1)
      {
        if (i1 == 0) {
          break label146;
        }
        this.g = i;
        this.h = System.currentTimeMillis();
        a(this.g);
        return;
        if (this.b > 1000.0F)
        {
          i = 120000;
          break;
        }
        if (this.b > 500.0F)
        {
          i = 60000;
          break;
        }
        i = 10000;
        break;
      }
      break;
    }
  }
  
  public int a(e paramE)
  {
    if (this.a == null) {
      this.a = new ArrayList();
    }
    this.a.add(paramE);
    paramE.i = true;
    paramE.j = this;
    if (!this.p)
    {
      this.f.registerReceiver(this.n, new IntentFilter("android.com.baidu.location.TIMER.NOTIFY"));
      this.p = true;
    }
    if (paramE.e == null) {
      return 1;
    }
    Object localObject;
    if (!paramE.e.equals("gcj02"))
    {
      localObject = Jni.a(paramE.b, paramE.a, paramE.e + "2gcj");
      paramE.g = localObject[0];
      paramE.f = localObject[1];
    }
    if ((this.c == null) || (System.currentTimeMillis() - this.d > 30000L)) {
      this.e.a();
    }
    for (;;)
    {
      c();
      return 1;
      localObject = new float[1];
      Location.distanceBetween(this.c.b(), this.c.c(), paramE.f, paramE.g, (float[])localObject);
      float f1 = localObject[0] - paramE.c - this.c.d();
      if (f1 > 0.0F)
      {
        if (f1 < this.b) {
          this.b = f1;
        }
      }
      else if (paramE.h < 3)
      {
        paramE.h += 1;
        paramE.a(this.c, localObject[0]);
        if (paramE.h < 3) {
          this.k = true;
        }
      }
    }
  }
  
  public void a()
  {
    if (this.j) {
      this.m.cancel(this.l);
    }
    this.c = null;
    this.d = 0L;
    if (this.p) {
      this.f.unregisterReceiver(this.n);
    }
    this.p = false;
  }
  
  public int b(e paramE)
  {
    if (this.a == null) {
      return 0;
    }
    if (this.a.contains(paramE)) {
      this.a.remove(paramE);
    }
    if ((this.a.size() == 0) && (this.j)) {
      this.m.cancel(this.l);
    }
    return 1;
  }
}
