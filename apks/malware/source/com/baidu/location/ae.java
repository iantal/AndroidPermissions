package com.baidu.location;

import android.location.Location;
import android.os.Handler;
import android.os.Message;
import android.text.TextUtils;
import java.util.ArrayList;
import java.util.List;
import java.util.Locale;
import org.apache.http.message.BasicNameValuePair;
import org.apache.http.util.EntityUtils;

abstract class ae
  implements au, l
{
  public static String d5 = null;
  private boolean d4 = false;
  private boolean d6 = true;
  final Handler d7 = new b();
  public r.a d8 = null;
  private boolean d9 = false;
  private boolean ea = false;
  public ao.b eb = null;
  
  ae() {}
  
  abstract void ag();
  
  abstract void jdMethod_byte(Message paramMessage);
  
  public String d(String paramString)
  {
    if ((this.d8 == null) || (!this.d8.jdMethod_do())) {
      this.d8 = r.aa().X();
    }
    label92:
    Location localLocation;
    String str;
    Object localObject1;
    label129:
    Object localObject3;
    if (this.d8 != null)
    {
      c.jdMethod_if("baidu_location_service", this.d8.jdMethod_if());
      if ((this.eb == null) || (!this.eb.jdMethod_for())) {
        this.eb = ao.bC().bH();
      }
      if (this.eb == null) {
        break label216;
      }
      c.jdMethod_if("baidu_location_service", this.eb.jdMethod_else());
      localLocation = null;
      if (v.aR().aE()) {
        localLocation = v.aR().aF();
      }
      str = i.m().l();
      if (!ao.bA()) {
        break label226;
      }
      localObject1 = "&cn=32";
      if (!this.d6) {
        break label254;
      }
      this.d6 = false;
      localObject3 = localObject1;
    }
    for (;;)
    {
      Object localObject2 = (String)localObject3 + str;
      localObject1 = localObject2;
      if (paramString != null) {
        localObject1 = paramString + (String)localObject2;
      }
      return c.jdMethod_if(this.d8, this.eb, localLocation, (String)localObject1, 0);
      c.jdMethod_if("baidu_location_service", "cellInfo null...");
      break;
      label216:
      c.jdMethod_if("baidu_location_service", "wifi list null");
      break label92;
      label226:
      localObject1 = String.format(Locale.CHINA, "&cn=%d", new Object[] { Integer.valueOf(r.aa().ac()) });
      break label129;
      label254:
      localObject3 = localObject1;
      if (!this.d4)
      {
        localObject3 = o.v();
        localObject2 = localObject1;
        if (localObject3 != null) {
          localObject2 = (String)localObject1 + (String)localObject3;
        }
        localObject1 = ao.bC().bG();
        localObject3 = localObject2;
        if (!TextUtils.isEmpty((CharSequence)localObject1))
        {
          localObject1 = ((String)localObject1).replace(":", "");
          localObject3 = String.format(Locale.CHINA, "%s&mac=%s", new Object[] { localObject2, localObject1 });
          this.d4 = true;
        }
      }
    }
  }
  
  class a
    extends q
  {
    String dn = null;
    String dp = null;
    
    public a()
    {
      this.cP = new ArrayList();
    }
    
    void O()
    {
      this.cN = c.jdMethod_for();
      Object localObject1 = Jni.h(this.dn);
      ah.a().a((String)localObject1);
      this.dn = null;
      if (this.dp == null) {
        this.dp = o.x();
      }
      this.cP.add(new BasicNameValuePair("bloc", (String)localObject1));
      if (this.dp != null) {
        this.cP.add(new BasicNameValuePair("up", this.dp));
      }
      localObject1 = new StringBuffer(512);
      Object localObject2 = Locale.CHINA;
      aw.b6();
      String str = aw.iu;
      aw.b6();
      ((StringBuffer)localObject1).append(String.format((Locale)localObject2, "&ki=%s&sn=%s", new Object[] { str, aw.iA }));
      localObject2 = h.cK().cJ();
      if (localObject2 != null) {
        ((StringBuffer)localObject1).append((String)localObject2);
      }
      if (((StringBuffer)localObject1).length() > 0) {
        this.cP.add(new BasicNameValuePair("ext", Jni.h(((StringBuffer)localObject1).toString())));
      }
      localObject1 = String.format(Locale.CHINA, "%d", new Object[] { Long.valueOf(System.currentTimeMillis()) });
      this.cP.add(new BasicNameValuePair("trtm", (String)localObject1));
      d.jdMethod_long().jdMethod_void();
    }
    
    void jdMethod_do(boolean paramBoolean)
    {
      if ((paramBoolean) && (this.cO != null))
      {
        for (;;)
        {
          try
          {
            localObject1 = EntityUtils.toString(this.cO, "utf-8");
            ae.d5 = (String)localObject1;
            ah.a().jdMethod_if((String)localObject1);
          }
          catch (Exception localException2)
          {
            Object localObject1;
            Object localObject2;
            localMessage = ae.this.d7.obtainMessage(63);
            localMessage.obj = "HttpStatus error";
            localMessage.sendToTarget();
            continue;
          }
          try
          {
            localObject2 = new BDLocation((String)localObject1);
            localObject1 = localObject2;
            if (((BDLocation)localObject2).getLocType() == 161)
            {
              d.jdMethod_long().jdMethod_new(((BDLocation)localObject2).getTime());
              ((BDLocation)localObject2).jdMethod_byte(r.aa().ad());
              localObject1 = localObject2;
              if (ac.bc().be())
              {
                ((BDLocation)localObject2).setDirection(ac.bc().ba());
                localObject1 = localObject2;
              }
            }
          }
          catch (Exception localException1)
          {
            localBDLocation = new BDLocation();
            localBDLocation.setLocType(63);
          }
        }
        localObject2 = ae.this.d7.obtainMessage(21);
        ((Message)localObject2).obj = localObject1;
        ((Message)localObject2).sendToTarget();
        this.dp = null;
      }
      for (;;)
      {
        if (this.cP != null) {
          this.cP.clear();
        }
        return;
        BDLocation localBDLocation;
        ah.a().jdMethod_if("network exception");
        Message localMessage = ae.this.d7.obtainMessage(63);
        localMessage.obj = "HttpStatus error";
        localMessage.sendToTarget();
      }
    }
    
    public void jdMethod_void(String paramString)
    {
      this.dn = paramString;
      J();
    }
  }
  
  public class b
    extends Handler
  {
    public b() {}
    
    public void handleMessage(Message paramMessage)
    {
      if (!f.isServing) {
        return;
      }
      switch (paramMessage.what)
      {
      default: 
        return;
      case 21: 
        ae.this.jdMethod_byte(paramMessage);
        return;
      }
      ae.this.ag();
    }
  }
}
