package com.google.android.bitmapfun;

import android.annotation.TargetApi;
import android.content.Context;
import android.graphics.Bitmap;
import android.graphics.Bitmap.CompressFormat;
import android.graphics.BitmapFactory.Options;
import android.graphics.drawable.BitmapDrawable;
import android.os.Bundle;
import android.os.Environment;
import android.os.StatFs;
import android.support.v4.app.Fragment;
import android.support.v4.app.FragmentManager;
import android.support.v4.app.FragmentTransaction;
import android.support.v4.util.LruCache;
import android.util.Log;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.lang.ref.SoftReference;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.util.HashSet;
import java.util.Iterator;

public class ImageCache
{
  private static final Bitmap.CompressFormat DEFAULT_COMPRESS_FORMAT = Bitmap.CompressFormat.JPEG;
  private static final int DEFAULT_COMPRESS_QUALITY = 70;
  private static final boolean DEFAULT_DISK_CACHE_ENABLED = true;
  private static final int DEFAULT_DISK_CACHE_SIZE = 10485760;
  private static final boolean DEFAULT_INIT_DISK_CACHE_ON_CREATE = false;
  private static final boolean DEFAULT_MEM_CACHE_ENABLED = true;
  private static final int DEFAULT_MEM_CACHE_SIZE = 5120;
  private static final int DISK_CACHE_INDEX = 0;
  private static final String TAG = "ImageCache";
  private ImageCacheParams mCacheParams;
  private final Object mDiskCacheLock = new Object();
  private boolean mDiskCacheStarting = true;
  private DiskLruCache mDiskLruCache;
  private LruCache<String, BitmapDrawable> mMemoryCache;
  private HashSet<SoftReference<Bitmap>> mReusableBitmaps;
  
  public ImageCache(ImageCacheParams paramImageCacheParams)
  {
    init(paramImageCacheParams);
  }
  
  private static String bytesToHexString(byte[] paramArrayOfByte)
  {
    StringBuilder localStringBuilder = new StringBuilder();
    int i = 0;
    while (i < paramArrayOfByte.length)
    {
      String str = Integer.toHexString(paramArrayOfByte[i] & 0xFF);
      if (str.length() == 1) {
        localStringBuilder.append('0');
      }
      localStringBuilder.append(str);
      i += 1;
    }
    return localStringBuilder.toString();
  }
  
  private static boolean canUseForInBitmap(Bitmap paramBitmap, BitmapFactory.Options paramOptions)
  {
    int i = paramOptions.outWidth / paramOptions.inSampleSize;
    int j = paramOptions.outHeight / paramOptions.inSampleSize;
    return (paramBitmap.getWidth() == i) && (paramBitmap.getHeight() == j);
  }
  
  private static RetainFragment findOrCreateRetainFragment(FragmentManager paramFragmentManager)
  {
    RetainFragment localRetainFragment2 = (RetainFragment)paramFragmentManager.findFragmentByTag("ImageCache");
    RetainFragment localRetainFragment1 = localRetainFragment2;
    if (localRetainFragment2 == null)
    {
      localRetainFragment1 = new RetainFragment();
      paramFragmentManager.beginTransaction().add(localRetainFragment1, "ImageCache").commitAllowingStateLoss();
    }
    return localRetainFragment1;
  }
  
  @TargetApi(12)
  public static int getBitmapSize(BitmapDrawable paramBitmapDrawable)
  {
    paramBitmapDrawable = paramBitmapDrawable.getBitmap();
    if (Utils.hasHoneycombMR1()) {
      return paramBitmapDrawable.getByteCount();
    }
    return paramBitmapDrawable.getRowBytes() * paramBitmapDrawable.getHeight();
  }
  
  public static File getDiskCacheDir(Context paramContext, String paramString)
  {
    File localFile;
    if (!isExternalStorageRemovable())
    {
      localFile = getExternalCacheDir(paramContext);
      if (localFile == null) {}
    }
    for (paramContext = localFile.getPath();; paramContext = paramContext.getCacheDir().getPath()) {
      return new File(paramContext + File.separator + paramString);
    }
  }
  
  @TargetApi(8)
  public static File getExternalCacheDir(Context paramContext)
  {
    if (Utils.hasFroyo()) {
      return paramContext.getExternalCacheDir();
    }
    paramContext = "/Android/data/" + paramContext.getPackageName() + "/cache/";
    return new File(Environment.getExternalStorageDirectory().getPath() + paramContext);
  }
  
  public static ImageCache getInstance(FragmentManager paramFragmentManager, ImageCacheParams paramImageCacheParams)
  {
    RetainFragment localRetainFragment = findOrCreateRetainFragment(paramFragmentManager);
    ImageCache localImageCache = (ImageCache)localRetainFragment.getObject();
    paramFragmentManager = localImageCache;
    if (localImageCache == null)
    {
      paramFragmentManager = new ImageCache(paramImageCacheParams);
      localRetainFragment.setObject(paramFragmentManager);
    }
    return paramFragmentManager;
  }
  
  @TargetApi(9)
  public static long getUsableSpace(File paramFile)
  {
    if (Utils.hasGingerbread()) {
      return paramFile.getUsableSpace();
    }
    paramFile = new StatFs(paramFile.getPath());
    return paramFile.getBlockSize() * paramFile.getAvailableBlocks();
  }
  
  public static String hashKeyForDisk(String paramString)
  {
    try
    {
      Object localObject = MessageDigest.getInstance("MD5");
      ((MessageDigest)localObject).update(paramString.getBytes());
      localObject = bytesToHexString(((MessageDigest)localObject).digest());
      return localObject;
    }
    catch (NoSuchAlgorithmException localNoSuchAlgorithmException) {}
    return String.valueOf(paramString.hashCode());
  }
  
  private void init(ImageCacheParams paramImageCacheParams)
  {
    this.mCacheParams = paramImageCacheParams;
    if (this.mCacheParams.memoryCacheEnabled)
    {
      if (Utils.hasHoneycomb()) {
        this.mReusableBitmaps = new HashSet();
      }
      this.mMemoryCache = new LruCache(this.mCacheParams.memCacheSize)
      {
        protected void entryRemoved(boolean paramAnonymousBoolean, String paramAnonymousString, BitmapDrawable paramAnonymousBitmapDrawable1, BitmapDrawable paramAnonymousBitmapDrawable2)
        {
          if (RecyclingBitmapDrawable.class.isInstance(paramAnonymousBitmapDrawable1)) {
            ((RecyclingBitmapDrawable)paramAnonymousBitmapDrawable1).setIsCached(false);
          }
          while (!Utils.hasHoneycomb()) {
            return;
          }
          ImageCache.this.mReusableBitmaps.add(new SoftReference(paramAnonymousBitmapDrawable1.getBitmap()));
        }
        
        protected int sizeOf(String paramAnonymousString, BitmapDrawable paramAnonymousBitmapDrawable)
        {
          int j = ImageCache.getBitmapSize(paramAnonymousBitmapDrawable) / 1024;
          int i = j;
          if (j == 0) {
            i = 1;
          }
          return i;
        }
      };
    }
    if (paramImageCacheParams.initDiskCacheOnCreate) {
      initDiskCache();
    }
  }
  
  @TargetApi(9)
  public static boolean isExternalStorageRemovable()
  {
    if (Utils.hasGingerbread()) {
      return Environment.isExternalStorageRemovable();
    }
    return true;
  }
  
  /* Error */
  public void addBitmapToCache(String paramString, BitmapDrawable paramBitmapDrawable)
  {
    // Byte code:
    //   0: aload_1
    //   1: ifnull +7 -> 8
    //   4: aload_2
    //   5: ifnonnull +4 -> 9
    //   8: return
    //   9: aload_0
    //   10: getfield 292	com/google/android/bitmapfun/ImageCache:mMemoryCache	Landroid/support/v4/util/LruCache;
    //   13: ifnull +31 -> 44
    //   16: ldc_w 307
    //   19: aload_2
    //   20: invokevirtual 313	java/lang/Class:isInstance	(Ljava/lang/Object;)Z
    //   23: ifeq +11 -> 34
    //   26: aload_2
    //   27: checkcast 307	com/google/android/bitmapfun/RecyclingBitmapDrawable
    //   30: iconst_1
    //   31: invokevirtual 317	com/google/android/bitmapfun/RecyclingBitmapDrawable:setIsCached	(Z)V
    //   34: aload_0
    //   35: getfield 292	com/google/android/bitmapfun/ImageCache:mMemoryCache	Landroid/support/v4/util/LruCache;
    //   38: aload_1
    //   39: aload_2
    //   40: invokevirtual 323	android/support/v4/util/LruCache:put	(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
    //   43: pop
    //   44: aload_0
    //   45: getfield 61	com/google/android/bitmapfun/ImageCache:mDiskCacheLock	Ljava/lang/Object;
    //   48: astore 9
    //   50: aload 9
    //   52: monitorenter
    //   53: aload_0
    //   54: getfield 325	com/google/android/bitmapfun/ImageCache:mDiskLruCache	Lcom/google/android/bitmapfun/DiskLruCache;
    //   57: ifnull +156 -> 213
    //   60: aload_1
    //   61: invokestatic 327	com/google/android/bitmapfun/ImageCache:hashKeyForDisk	(Ljava/lang/String;)Ljava/lang/String;
    //   64: astore 10
    //   66: aconst_null
    //   67: astore 6
    //   69: aconst_null
    //   70: astore 7
    //   72: aconst_null
    //   73: astore 8
    //   75: aconst_null
    //   76: astore_3
    //   77: aload 6
    //   79: astore 4
    //   81: aload 7
    //   83: astore 5
    //   85: aload 8
    //   87: astore_1
    //   88: aload_0
    //   89: getfield 325	com/google/android/bitmapfun/ImageCache:mDiskLruCache	Lcom/google/android/bitmapfun/DiskLruCache;
    //   92: aload 10
    //   94: invokevirtual 333	com/google/android/bitmapfun/DiskLruCache:get	(Ljava/lang/String;)Lcom/google/android/bitmapfun/DiskLruCache$Snapshot;
    //   97: astore 11
    //   99: aload 11
    //   101: ifnonnull +122 -> 223
    //   104: aload 6
    //   106: astore 4
    //   108: aload 7
    //   110: astore 5
    //   112: aload 8
    //   114: astore_1
    //   115: aload_0
    //   116: getfield 325	com/google/android/bitmapfun/ImageCache:mDiskLruCache	Lcom/google/android/bitmapfun/DiskLruCache;
    //   119: aload 10
    //   121: invokevirtual 337	com/google/android/bitmapfun/DiskLruCache:edit	(Ljava/lang/String;)Lcom/google/android/bitmapfun/DiskLruCache$Editor;
    //   124: astore 10
    //   126: aload 10
    //   128: ifnull +77 -> 205
    //   131: aload 6
    //   133: astore 4
    //   135: aload 7
    //   137: astore 5
    //   139: aload 8
    //   141: astore_1
    //   142: aload 10
    //   144: iconst_0
    //   145: invokevirtual 343	com/google/android/bitmapfun/DiskLruCache$Editor:newOutputStream	(I)Ljava/io/OutputStream;
    //   148: astore_3
    //   149: aload_3
    //   150: astore 4
    //   152: aload_3
    //   153: astore 5
    //   155: aload_3
    //   156: astore_1
    //   157: aload_2
    //   158: invokevirtual 154	android/graphics/drawable/BitmapDrawable:getBitmap	()Landroid/graphics/Bitmap;
    //   161: aload_0
    //   162: getfield 275	com/google/android/bitmapfun/ImageCache:mCacheParams	Lcom/google/android/bitmapfun/ImageCache$ImageCacheParams;
    //   165: getfield 346	com/google/android/bitmapfun/ImageCache$ImageCacheParams:compressFormat	Landroid/graphics/Bitmap$CompressFormat;
    //   168: aload_0
    //   169: getfield 275	com/google/android/bitmapfun/ImageCache:mCacheParams	Lcom/google/android/bitmapfun/ImageCache$ImageCacheParams;
    //   172: getfield 349	com/google/android/bitmapfun/ImageCache$ImageCacheParams:compressQuality	I
    //   175: aload_3
    //   176: invokevirtual 353	android/graphics/Bitmap:compress	(Landroid/graphics/Bitmap$CompressFormat;ILjava/io/OutputStream;)Z
    //   179: pop
    //   180: aload_3
    //   181: astore 4
    //   183: aload_3
    //   184: astore 5
    //   186: aload_3
    //   187: astore_1
    //   188: aload 10
    //   190: invokevirtual 356	com/google/android/bitmapfun/DiskLruCache$Editor:commit	()V
    //   193: aload_3
    //   194: astore 4
    //   196: aload_3
    //   197: astore 5
    //   199: aload_3
    //   200: astore_1
    //   201: aload_3
    //   202: invokevirtual 361	java/io/OutputStream:close	()V
    //   205: aload_3
    //   206: ifnull +7 -> 213
    //   209: aload_3
    //   210: invokevirtual 361	java/io/OutputStream:close	()V
    //   213: aload 9
    //   215: monitorexit
    //   216: return
    //   217: astore_1
    //   218: aload 9
    //   220: monitorexit
    //   221: aload_1
    //   222: athrow
    //   223: aload 6
    //   225: astore 4
    //   227: aload 7
    //   229: astore 5
    //   231: aload 8
    //   233: astore_1
    //   234: aload 11
    //   236: iconst_0
    //   237: invokevirtual 367	com/google/android/bitmapfun/DiskLruCache$Snapshot:getInputStream	(I)Ljava/io/InputStream;
    //   240: invokevirtual 370	java/io/InputStream:close	()V
    //   243: goto -38 -> 205
    //   246: astore_2
    //   247: aload 4
    //   249: astore_1
    //   250: ldc 32
    //   252: new 76	java/lang/StringBuilder
    //   255: dup
    //   256: invokespecial 77	java/lang/StringBuilder:<init>	()V
    //   259: ldc_w 372
    //   262: invokevirtual 96	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   265: aload_2
    //   266: invokevirtual 375	java/lang/StringBuilder:append	(Ljava/lang/Object;)Ljava/lang/StringBuilder;
    //   269: invokevirtual 100	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   272: invokestatic 381	android/util/Log:e	(Ljava/lang/String;Ljava/lang/String;)I
    //   275: pop
    //   276: aload 4
    //   278: ifnull -65 -> 213
    //   281: aload 4
    //   283: invokevirtual 361	java/io/OutputStream:close	()V
    //   286: goto -73 -> 213
    //   289: astore_1
    //   290: goto -77 -> 213
    //   293: astore_2
    //   294: aload 5
    //   296: astore_1
    //   297: ldc 32
    //   299: new 76	java/lang/StringBuilder
    //   302: dup
    //   303: invokespecial 77	java/lang/StringBuilder:<init>	()V
    //   306: ldc_w 372
    //   309: invokevirtual 96	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   312: aload_2
    //   313: invokevirtual 375	java/lang/StringBuilder:append	(Ljava/lang/Object;)Ljava/lang/StringBuilder;
    //   316: invokevirtual 100	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   319: invokestatic 381	android/util/Log:e	(Ljava/lang/String;Ljava/lang/String;)I
    //   322: pop
    //   323: aload 5
    //   325: ifnull -112 -> 213
    //   328: aload 5
    //   330: invokevirtual 361	java/io/OutputStream:close	()V
    //   333: goto -120 -> 213
    //   336: astore_1
    //   337: goto -124 -> 213
    //   340: astore_2
    //   341: aload_1
    //   342: ifnull +7 -> 349
    //   345: aload_1
    //   346: invokevirtual 361	java/io/OutputStream:close	()V
    //   349: aload_2
    //   350: athrow
    //   351: astore_1
    //   352: goto -139 -> 213
    //   355: astore_1
    //   356: goto -7 -> 349
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	359	0	this	ImageCache
    //   0	359	1	paramString	String
    //   0	359	2	paramBitmapDrawable	BitmapDrawable
    //   76	134	3	localOutputStream	java.io.OutputStream
    //   79	203	4	localObject1	Object
    //   83	246	5	localObject2	Object
    //   67	157	6	localObject3	Object
    //   70	158	7	localObject4	Object
    //   73	159	8	localObject5	Object
    //   48	171	9	localObject6	Object
    //   64	125	10	localObject7	Object
    //   97	138	11	localSnapshot	DiskLruCache.Snapshot
    // Exception table:
    //   from	to	target	type
    //   53	66	217	finally
    //   209	213	217	finally
    //   213	216	217	finally
    //   218	221	217	finally
    //   281	286	217	finally
    //   328	333	217	finally
    //   345	349	217	finally
    //   349	351	217	finally
    //   88	99	246	java/io/IOException
    //   115	126	246	java/io/IOException
    //   142	149	246	java/io/IOException
    //   157	180	246	java/io/IOException
    //   188	193	246	java/io/IOException
    //   201	205	246	java/io/IOException
    //   234	243	246	java/io/IOException
    //   281	286	289	java/io/IOException
    //   88	99	293	java/lang/Exception
    //   115	126	293	java/lang/Exception
    //   142	149	293	java/lang/Exception
    //   157	180	293	java/lang/Exception
    //   188	193	293	java/lang/Exception
    //   201	205	293	java/lang/Exception
    //   234	243	293	java/lang/Exception
    //   328	333	336	java/io/IOException
    //   88	99	340	finally
    //   115	126	340	finally
    //   142	149	340	finally
    //   157	180	340	finally
    //   188	193	340	finally
    //   201	205	340	finally
    //   234	243	340	finally
    //   250	276	340	finally
    //   297	323	340	finally
    //   209	213	351	java/io/IOException
    //   345	349	355	java/io/IOException
  }
  
  public void addBitmapToMemoryCache(String paramString, BitmapDrawable paramBitmapDrawable)
  {
    if ((paramString == null) || (paramBitmapDrawable == null)) {}
    while ((this.mMemoryCache == null) || (this.mMemoryCache.get(paramString) != null)) {
      return;
    }
    this.mMemoryCache.put(paramString, paramBitmapDrawable);
  }
  
  public void clearCache()
  {
    if (this.mMemoryCache != null)
    {
      this.mMemoryCache.evictAll();
      if (this.mCacheParams.clearReusableBitmapsOnClearCache) {
        clearReusableBitmaps();
      }
    }
    synchronized (this.mDiskCacheLock)
    {
      this.mDiskCacheStarting = true;
      if (this.mDiskLruCache != null)
      {
        boolean bool = this.mDiskLruCache.isClosed();
        if (bool) {}
      }
      try
      {
        this.mDiskLruCache.delete();
        this.mDiskLruCache = null;
        initDiskCache();
        return;
      }
      catch (IOException localIOException)
      {
        for (;;)
        {
          Log.e("ImageCache", "clearCache - " + localIOException);
        }
      }
    }
  }
  
  public void clearMemoryCache()
  {
    if (this.mMemoryCache != null) {
      this.mMemoryCache.evictAll();
    }
  }
  
  public void clearReusableBitmaps()
  {
    if (Utils.hasHoneycomb()) {
      this.mReusableBitmaps = new HashSet();
    }
  }
  
  public void close()
  {
    synchronized (this.mDiskCacheLock)
    {
      DiskLruCache localDiskLruCache = this.mDiskLruCache;
      if (localDiskLruCache != null) {}
      try
      {
        if (!this.mDiskLruCache.isClosed())
        {
          this.mDiskLruCache.close();
          this.mDiskLruCache = null;
        }
        return;
      }
      catch (IOException localIOException)
      {
        for (;;)
        {
          Log.e("ImageCache", "close - " + localIOException);
        }
      }
    }
  }
  
  public void flush()
  {
    synchronized (this.mDiskCacheLock)
    {
      DiskLruCache localDiskLruCache = this.mDiskLruCache;
      if (localDiskLruCache != null) {}
      try
      {
        this.mDiskLruCache.flush();
        return;
      }
      catch (IOException localIOException)
      {
        for (;;)
        {
          Log.e("ImageCache", "flush - " + localIOException);
        }
      }
    }
  }
  
  public Bitmap getBitmapFromDiskCache(String paramString)
  {
    Object localObject8 = hashKeyForDisk(paramString);
    localObject4 = null;
    Bitmap localBitmap = null;
    synchronized (this.mDiskCacheLock)
    {
      for (;;)
      {
        boolean bool = this.mDiskCacheStarting;
        if (!bool) {
          break;
        }
        try
        {
          this.mDiskCacheLock.wait();
        }
        catch (InterruptedException paramString) {}
      }
      paramString = this.mDiskLruCache;
      Object localObject2 = localObject4;
      Object localObject5;
      Object localObject6;
      if (paramString != null)
      {
        localObject2 = null;
        localObject5 = null;
        localObject6 = null;
        paramString = (String)localObject2;
        localObject1 = localObject5;
      }
      try
      {
        localObject8 = this.mDiskLruCache.get((String)localObject8);
        paramString = localBitmap;
        localObject1 = localObject6;
        if (localObject8 != null)
        {
          paramString = (String)localObject2;
          localObject1 = localObject5;
          localObject2 = ((DiskLruCache.Snapshot)localObject8).getInputStream(0);
          paramString = localBitmap;
          localObject1 = localObject2;
          if (localObject2 != null)
          {
            paramString = (String)localObject2;
            localObject1 = localObject2;
            localBitmap = ImageResizer.decodeSampledBitmapFromDescriptor(((FileInputStream)localObject2).getFD(), Integer.MAX_VALUE, Integer.MAX_VALUE, this);
            paramString = localBitmap;
            localObject1 = localObject2;
          }
        }
        localObject2 = paramString;
      }
      catch (IOException localIOException3)
      {
        for (;;)
        {
          localObject1 = paramString;
          Log.e("ImageCache", "getBitmapFromDiskCache - " + localIOException3);
          localObject3 = localObject4;
          if (paramString != null) {
            try
            {
              paramString.close();
              localObject3 = localObject4;
            }
            catch (IOException paramString)
            {
              localObject3 = localObject4;
            }
          }
        }
      }
      finally
      {
        if (localObject1 == null) {}
      }
      try
      {
        ((InputStream)localObject1).close();
        localObject2 = paramString;
      }
      catch (IOException localIOException1)
      {
        try
        {
          ((InputStream)localObject1).close();
          throw paramString;
          paramString = finally;
          throw paramString;
          localIOException1 = localIOException1;
          localObject3 = paramString;
        }
        catch (IOException localIOException2)
        {
          for (;;) {}
        }
      }
      return localObject2;
    }
  }
  
  public BitmapDrawable getBitmapFromMemCache(String paramString)
  {
    BitmapDrawable localBitmapDrawable = null;
    if (this.mMemoryCache != null) {
      localBitmapDrawable = (BitmapDrawable)this.mMemoryCache.get(paramString);
    }
    return localBitmapDrawable;
  }
  
  protected Bitmap getBitmapFromReusableSet(BitmapFactory.Options paramOptions)
  {
    Object localObject2 = null;
    Object localObject1 = localObject2;
    Iterator localIterator;
    if (this.mReusableBitmaps != null)
    {
      localObject1 = localObject2;
      if (!this.mReusableBitmaps.isEmpty()) {
        localIterator = this.mReusableBitmaps.iterator();
      }
    }
    for (;;)
    {
      localObject1 = localObject2;
      if (localIterator.hasNext())
      {
        localObject1 = (Bitmap)((SoftReference)localIterator.next()).get();
        if ((localObject1 != null) && (((Bitmap)localObject1).isMutable()))
        {
          if (!canUseForInBitmap((Bitmap)localObject1, paramOptions)) {
            continue;
          }
          localIterator.remove();
        }
      }
      else
      {
        return localObject1;
      }
      localIterator.remove();
    }
  }
  
  public ImageCacheParams getCacheParams()
  {
    return this.mCacheParams;
  }
  
  public void initDiskCache()
  {
    synchronized (this.mDiskCacheLock)
    {
      File localFile;
      if ((this.mDiskLruCache == null) || (this.mDiskLruCache.isClosed()))
      {
        localFile = this.mCacheParams.diskCacheDir;
        if ((this.mCacheParams.diskCacheEnabled) && (localFile != null))
        {
          if (!localFile.exists()) {
            localFile.mkdirs();
          }
          long l = getUsableSpace(localFile);
          int i = this.mCacheParams.diskCacheSize;
          if (l <= i) {}
        }
      }
      try
      {
        this.mDiskLruCache = DiskLruCache.open(localFile, 1, 1, this.mCacheParams.diskCacheSize);
        this.mDiskCacheStarting = false;
        this.mDiskCacheLock.notifyAll();
        return;
      }
      catch (IOException localIOException)
      {
        for (;;)
        {
          this.mCacheParams.diskCacheDir = null;
          Log.e("ImageCache", "initDiskCache - " + localIOException);
        }
      }
    }
  }
  
  public static class ImageCacheParams
  {
    public boolean clearReusableBitmapsOnClearCache = false;
    public Bitmap.CompressFormat compressFormat = ImageCache.DEFAULT_COMPRESS_FORMAT;
    public int compressQuality = 70;
    public File diskCacheDir;
    public boolean diskCacheEnabled = true;
    public int diskCacheSize = 10485760;
    public boolean initDiskCacheOnCreate = false;
    public int memCacheSize = 5120;
    public boolean memoryCacheEnabled = true;
    
    public ImageCacheParams(Context paramContext, String paramString)
    {
      this.diskCacheDir = ImageCache.getDiskCacheDir(paramContext, paramString);
    }
    
    public void setMemCacheSizePercent(float paramFloat)
    {
      if ((paramFloat < 0.05F) || (paramFloat > 0.8F)) {
        throw new IllegalArgumentException("setMemCacheSizePercent - percent must be between 0.05 and 0.8 (inclusive)");
      }
      this.memCacheSize = Math.round((float)Runtime.getRuntime().maxMemory() * paramFloat / 1024.0F);
    }
  }
  
  public static class RetainFragment
    extends Fragment
  {
    private Object mObject;
    
    public RetainFragment() {}
    
    public Object getObject()
    {
      return this.mObject;
    }
    
    public void onCreate(Bundle paramBundle)
    {
      super.onCreate(paramBundle);
      setRetainInstance(true);
    }
    
    public void setObject(Object paramObject)
    {
      this.mObject = paramObject;
    }
  }
}
