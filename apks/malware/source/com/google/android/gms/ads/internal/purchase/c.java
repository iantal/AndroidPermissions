package com.google.android.gms.ads.internal.purchase;

import android.content.ComponentName;
import android.content.Context;
import android.content.Intent;
import android.content.ServiceConnection;
import android.os.Bundle;
import android.os.Handler;
import android.os.IBinder;
import android.os.SystemClock;
import com.google.android.gms.ads.internal.w;
import com.google.android.gms.b.jy;
import com.google.android.gms.b.mu;
import com.google.android.gms.b.nj;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Set;

public final class c
  extends mu
  implements ServiceConnection
{
  private final Object a = new Object();
  private boolean b = false;
  private Context c;
  private jy d;
  private b e;
  private i f;
  private List<g> g = null;
  private m h;
  
  public c(Context paramContext, jy paramJy, m paramM)
  {
    this(paramContext, paramJy, paramM, new b(paramContext), i.a(paramContext.getApplicationContext()));
  }
  
  private c(Context paramContext, jy paramJy, m paramM, b paramB, i paramI)
  {
    this.c = paramContext;
    this.d = paramJy;
    this.h = paramM;
    this.e = paramB;
    this.f = paramI;
    this.g = this.f.a();
  }
  
  private void a(long paramLong)
  {
    do
    {
      if (!b(paramLong)) {
        com.google.android.gms.ads.internal.util.client.b.d("Timeout waiting for pending transaction to be processed.");
      }
    } while (!this.b);
  }
  
  private boolean b(long paramLong)
  {
    paramLong = 60000L - (SystemClock.elapsedRealtime() - paramLong);
    if (paramLong <= 0L) {
      return false;
    }
    try
    {
      this.a.wait(paramLong);
      return true;
    }
    catch (InterruptedException localInterruptedException)
    {
      for (;;)
      {
        com.google.android.gms.ads.internal.util.client.b.e("waitWithTimeout_lock interrupted");
      }
    }
  }
  
  public final void a()
  {
    synchronized (this.a)
    {
      Intent localIntent = new Intent("com.android.vending.billing.InAppBillingService.BIND");
      localIntent.setPackage("com.android.vending");
      com.google.android.gms.common.stats.b.a().a(this.c, localIntent, this, 1);
      a(SystemClock.elapsedRealtime());
      com.google.android.gms.common.stats.b.a().a(this.c, this);
      this.e.a = null;
      return;
    }
  }
  
  public final void b()
  {
    synchronized (this.a)
    {
      com.google.android.gms.common.stats.b.a().a(this.c, this);
      this.e.a = null;
      return;
    }
  }
  
  public final void onServiceConnected(ComponentName paramComponentName, IBinder paramIBinder)
  {
    Object localObject2;
    synchronized (this.a)
    {
      this.e.a(paramIBinder);
      if (this.g.isEmpty()) {
        break label383;
      }
      paramIBinder = new HashMap();
      paramComponentName = this.g.iterator();
      if (paramComponentName.hasNext())
      {
        localObject2 = (g)paramComponentName.next();
        paramIBinder.put(((g)localObject2).c, localObject2);
      }
    }
    paramComponentName = null;
    paramComponentName = this.e.b(this.c.getPackageName(), paramComponentName);
    ArrayList localArrayList1;
    ArrayList localArrayList2;
    int i;
    if (paramComponentName != null)
    {
      w.o();
      if (k.a(paramComponentName) == 0)
      {
        localObject2 = paramComponentName.getStringArrayList("INAPP_PURCHASE_ITEM_LIST");
        localArrayList1 = paramComponentName.getStringArrayList("INAPP_PURCHASE_DATA_LIST");
        localArrayList2 = paramComponentName.getStringArrayList("INAPP_DATA_SIGNATURE_LIST");
        paramComponentName = paramComponentName.getString("INAPP_CONTINUATION_TOKEN");
        i = 0;
      }
    }
    for (;;)
    {
      if (i < ((ArrayList)localObject2).size())
      {
        if (paramIBinder.containsKey(((ArrayList)localObject2).get(i)))
        {
          String str1 = (String)((ArrayList)localObject2).get(i);
          String str2 = (String)localArrayList1.get(i);
          String str3 = (String)localArrayList2.get(i);
          g localG = (g)paramIBinder.get(str1);
          w.o();
          Object localObject3 = k.a(str2);
          if (localG.b.equals(localObject3))
          {
            localObject3 = new Intent();
            w.o();
            ((Intent)localObject3).putExtra("RESPONSE_CODE", 0);
            w.o();
            ((Intent)localObject3).putExtra("INAPP_PURCHASE_DATA", str2);
            w.o();
            ((Intent)localObject3).putExtra("INAPP_DATA_SIGNATURE", str3);
            nj.a.post(new d(this, localG, (Intent)localObject3));
            paramIBinder.remove(str1);
          }
        }
      }
      else
      {
        if ((paramComponentName == null) || (paramIBinder.isEmpty()))
        {
          paramComponentName = paramIBinder.keySet().iterator();
          while (paramComponentName.hasNext())
          {
            localObject2 = (String)paramComponentName.next();
            this.f.a((g)paramIBinder.get(localObject2));
          }
          label383:
          this.b = true;
          this.a.notify();
          return;
        }
        break;
      }
      i += 1;
    }
  }
  
  public final void onServiceDisconnected(ComponentName paramComponentName)
  {
    com.google.android.gms.ads.internal.util.client.b.c("In-app billing service disconnected.");
    this.e.a = null;
  }
}
