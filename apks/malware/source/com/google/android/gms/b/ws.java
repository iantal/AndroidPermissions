package com.google.android.gms.b;

import android.content.Context;
import android.content.res.Resources;
import android.content.res.Resources.NotFoundException;
import com.google.android.gms.common.api.Status;
import com.google.android.gms.tagmanager.bj;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStream;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

public final class ws
{
  public static final Integer a = Integer.valueOf(0);
  public static final Integer b = Integer.valueOf(1);
  private final Context c;
  private final ExecutorService d;
  
  public ws(Context paramContext)
  {
    this(paramContext, Executors.newSingleThreadExecutor());
  }
  
  private ws(Context paramContext, ExecutorService paramExecutorService)
  {
    this.c = paramContext;
    this.d = paramExecutorService;
  }
  
  private static byte[] a(InputStream paramInputStream)
  {
    ByteArrayOutputStream localByteArrayOutputStream = new ByteArrayOutputStream();
    for (;;)
    {
      try
      {
        rf.a(paramInputStream, localByteArrayOutputStream, false);
      }
      catch (IOException localIOException)
      {
        bj.b("Failed to read the resource from disk");
        try
        {
          paramInputStream.close();
        }
        catch (IOException paramInputStream)
        {
          bj.b("Error closing stream for reading resource from disk");
          return null;
        }
      }
      finally
      {
        try
        {
          paramInputStream.close();
          throw localObject;
        }
        catch (IOException paramInputStream)
        {
          bj.b("Error closing stream for reading resource from disk");
        }
      }
      try
      {
        paramInputStream.close();
        return localByteArrayOutputStream.toByteArray();
      }
      catch (IOException paramInputStream)
      {
        bj.b("Error closing stream for reading resource from disk");
        return null;
      }
    }
    return null;
  }
  
  private File b(String paramString)
  {
    return new File(this.c.getDir("google_tagmanager", 0), c(paramString));
  }
  
  private static String c(String paramString)
  {
    return "resource_" + paramString;
  }
  
  public final long a(String paramString)
  {
    paramString = b(paramString);
    if (paramString.exists()) {
      return paramString.lastModified();
    }
    return 0L;
  }
  
  public final void a(String paramString, Integer paramInteger, wc paramWc, wr paramWr)
  {
    this.d.execute(new wt(this, paramString, paramInteger, paramWc, paramWr));
  }
  
  public final void a(String paramString, byte[] paramArrayOfByte)
  {
    this.d.execute(new wu(this, paramString, paramArrayOfByte));
  }
  
  final void b(String paramString, Integer paramInteger, wc paramWc, wr paramWr)
  {
    bj.e("DiskLoader: Starting to load resource from Disk.");
    try
    {
      Object localObject = paramWc.a(a(new FileInputStream(b(paramString))));
      if (localObject != null)
      {
        bj.e("Saved resource loaded: " + c(paramString));
        paramWr.a(Status.a, localObject, b, a(paramString));
        return;
      }
    }
    catch (FileNotFoundException localFileNotFoundException)
    {
      bj.a("Saved resource not found: " + c(paramString));
      if (paramInteger == null)
      {
        paramWr.a(Status.c, null, null, 0L);
        return;
      }
    }
    catch (wq localWq)
    {
      for (;;)
      {
        bj.a("Saved resource is corrupted: " + c(paramString));
      }
    }
    try
    {
      paramString = this.c.getResources().openRawResource(paramInteger.intValue());
      if (paramString != null)
      {
        paramString = paramWc.a(a(paramString));
        if (paramString != null)
        {
          bj.e("Default resource loaded: " + this.c.getResources().getResourceEntryName(paramInteger.intValue()));
          paramWr.a(Status.a, paramString, a, 0L);
          return;
        }
      }
    }
    catch (Resources.NotFoundException paramString)
    {
      bj.a("Default resource not found. ID: " + paramInteger);
      paramWr.a(Status.c, null, null, 0L);
      return;
    }
    catch (wq paramString)
    {
      for (;;)
      {
        bj.a("Default resource resource is corrupted: " + paramInteger);
      }
    }
  }
  
  /* Error */
  final void b(String paramString, byte[] paramArrayOfByte)
  {
    // Byte code:
    //   0: aload_0
    //   1: aload_1
    //   2: invokespecial 104	com/google/android/gms/b/ws:b	(Ljava/lang/String;)Ljava/io/File;
    //   5: astore 4
    //   7: new 204	java/io/FileOutputStream
    //   10: dup
    //   11: aload 4
    //   13: invokespecial 205	java/io/FileOutputStream:<init>	(Ljava/io/File;)V
    //   16: astore_3
    //   17: aload_3
    //   18: aload_2
    //   19: invokevirtual 209	java/io/FileOutputStream:write	([B)V
    //   22: aload_3
    //   23: invokevirtual 210	java/io/FileOutputStream:close	()V
    //   26: new 89	java/lang/StringBuilder
    //   29: dup
    //   30: ldc -44
    //   32: invokespecial 93	java/lang/StringBuilder:<init>	(Ljava/lang/String;)V
    //   35: aload_1
    //   36: invokevirtual 97	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   39: ldc -42
    //   41: invokevirtual 97	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   44: invokevirtual 101	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   47: invokestatic 141	com/google/android/gms/tagmanager/bj:e	(Ljava/lang/String;)V
    //   50: return
    //   51: astore_1
    //   52: ldc -40
    //   54: invokestatic 171	com/google/android/gms/tagmanager/bj:a	(Ljava/lang/String;)V
    //   57: return
    //   58: astore_1
    //   59: ldc -38
    //   61: invokestatic 171	com/google/android/gms/tagmanager/bj:a	(Ljava/lang/String;)V
    //   64: return
    //   65: astore_2
    //   66: ldc -36
    //   68: invokestatic 171	com/google/android/gms/tagmanager/bj:a	(Ljava/lang/String;)V
    //   71: aload 4
    //   73: invokevirtual 223	java/io/File:delete	()Z
    //   76: pop
    //   77: aload_3
    //   78: invokevirtual 210	java/io/FileOutputStream:close	()V
    //   81: new 89	java/lang/StringBuilder
    //   84: dup
    //   85: ldc -44
    //   87: invokespecial 93	java/lang/StringBuilder:<init>	(Ljava/lang/String;)V
    //   90: aload_1
    //   91: invokevirtual 97	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   94: ldc -42
    //   96: invokevirtual 97	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   99: invokevirtual 101	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   102: invokestatic 141	com/google/android/gms/tagmanager/bj:e	(Ljava/lang/String;)V
    //   105: return
    //   106: astore_1
    //   107: ldc -38
    //   109: invokestatic 171	com/google/android/gms/tagmanager/bj:a	(Ljava/lang/String;)V
    //   112: return
    //   113: astore_2
    //   114: aload_3
    //   115: invokevirtual 210	java/io/FileOutputStream:close	()V
    //   118: new 89	java/lang/StringBuilder
    //   121: dup
    //   122: ldc -44
    //   124: invokespecial 93	java/lang/StringBuilder:<init>	(Ljava/lang/String;)V
    //   127: aload_1
    //   128: invokevirtual 97	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   131: ldc -42
    //   133: invokevirtual 97	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   136: invokevirtual 101	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   139: invokestatic 141	com/google/android/gms/tagmanager/bj:e	(Ljava/lang/String;)V
    //   142: aload_2
    //   143: athrow
    //   144: astore_1
    //   145: ldc -38
    //   147: invokestatic 171	com/google/android/gms/tagmanager/bj:a	(Ljava/lang/String;)V
    //   150: goto -8 -> 142
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	153	0	this	ws
    //   0	153	1	paramString	String
    //   0	153	2	paramArrayOfByte	byte[]
    //   16	99	3	localFileOutputStream	java.io.FileOutputStream
    //   5	67	4	localFile	File
    // Exception table:
    //   from	to	target	type
    //   7	17	51	java/io/FileNotFoundException
    //   22	50	58	java/io/IOException
    //   17	22	65	java/io/IOException
    //   77	105	106	java/io/IOException
    //   17	22	113	finally
    //   66	77	113	finally
    //   114	142	144	java/io/IOException
  }
}
