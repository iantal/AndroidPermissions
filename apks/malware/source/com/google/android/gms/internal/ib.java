package com.google.android.gms.internal;

import android.content.Context;
import android.net.Uri.Builder;
import android.os.Build;
import android.os.Build.VERSION;
import android.os.Bundle;
import android.os.Looper;
import android.text.TextUtils;
import android.util.Log;
import java.io.PrintWriter;
import java.io.StringWriter;
import java.io.Writer;
import java.util.ArrayList;
import java.util.LinkedList;
import java.util.List;

public final class ib
  implements Thread.UncaughtExceptionHandler
{
  private Thread.UncaughtExceptionHandler a;
  private Thread.UncaughtExceptionHandler b;
  private Context c;
  private gt d;
  
  public ib(Context paramContext, gt paramGt, Thread.UncaughtExceptionHandler paramUncaughtExceptionHandler1, Thread.UncaughtExceptionHandler paramUncaughtExceptionHandler2)
  {
    this.a = paramUncaughtExceptionHandler1;
    this.b = paramUncaughtExceptionHandler2;
    this.c = paramContext;
    this.d = paramGt;
  }
  
  public static ib a(Context paramContext, Thread paramThread, gt paramGt)
  {
    if ((paramContext == null) || (paramThread == null) || (paramGt == null)) {
      return null;
    }
    lb.g();
    if (!a()) {
      return null;
    }
    Thread.UncaughtExceptionHandler localUncaughtExceptionHandler = paramThread.getUncaughtExceptionHandler();
    paramContext = new ib(paramContext, paramGt, localUncaughtExceptionHandler, Thread.getDefaultUncaughtExceptionHandler());
    if ((localUncaughtExceptionHandler == null) || (!(localUncaughtExceptionHandler instanceof ib))) {
      try
      {
        paramThread.setUncaughtExceptionHandler(paramContext);
        return paramContext;
      }
      catch (SecurityException paramContext)
      {
        if (mi.a(4)) {
          Log.i("Ads", "Fail to set UncaughtExceptionHandler.", paramContext);
        }
        return null;
      }
    }
    return (ib)localUncaughtExceptionHandler;
  }
  
  private static boolean a()
  {
    Bundle localBundle = lb.g();
    if (localBundle == null) {}
    while (!localBundle.getBoolean("gads:sdk_crash_report_enabled", false)) {
      return false;
    }
    return true;
  }
  
  private static boolean a(String paramString)
  {
    if (TextUtils.isEmpty(paramString)) {
      return false;
    }
    if (paramString.startsWith("com.google.android.gms.ads")) {
      return true;
    }
    if (paramString.startsWith("com.google.ads")) {
      return true;
    }
    try
    {
      boolean bool = Class.forName(paramString).isAnnotationPresent(ic.class);
      return bool;
    }
    catch (Exception localException)
    {
      mi.a("Fail to check class type for class " + paramString, localException);
    }
    return false;
  }
  
  public final void a(Throwable paramThrowable)
  {
    Object localObject1 = this.c;
    if (!a()) {
      return;
    }
    Object localObject2 = lb.g();
    label66:
    Object localObject3;
    Object localObject4;
    if (localObject2 != null)
    {
      localObject1 = paramThrowable;
      if (((Bundle)localObject2).getBoolean("gads:sdk_crash_report_full_stacktrace", false)) {}
    }
    else
    {
      localObject1 = new LinkedList();
      while (paramThrowable != null)
      {
        ((LinkedList)localObject1).push(paramThrowable);
        paramThrowable = paramThrowable.getCause();
      }
      paramThrowable = null;
      if (!((LinkedList)localObject1).isEmpty())
      {
        localObject3 = (Throwable)((LinkedList)localObject1).pop();
        localObject4 = ((Throwable)localObject3).getStackTrace();
        localObject2 = new ArrayList();
        ((ArrayList)localObject2).add(new StackTraceElement(localObject3.getClass().getName(), "<filtered>", "<filtered>", 1));
        int m = localObject4.length;
        int i = 0;
        int j = 0;
        if (i < m)
        {
          Object localObject5 = localObject4[i];
          if (a(localObject5.getClassName()))
          {
            ((ArrayList)localObject2).add(localObject5);
            j = 1;
          }
          for (;;)
          {
            i += 1;
            break;
            String str = localObject5.getClassName();
            if ((!TextUtils.isEmpty(str)) && ((str.startsWith("android.")) || (str.startsWith("java.")))) {}
            for (int k = 1;; k = 0)
            {
              if (k == 0) {
                break label235;
              }
              ((ArrayList)localObject2).add(localObject5);
              break;
            }
            label235:
            ((ArrayList)localObject2).add(new StackTraceElement("<filtered>", "<filtered>", "<filtered>", 1));
          }
        }
        if (j == 0) {
          break label525;
        }
        if (paramThrowable == null)
        {
          paramThrowable = new Throwable(((Throwable)localObject3).getMessage());
          label279:
          paramThrowable.setStackTrace((StackTraceElement[])((ArrayList)localObject2).toArray(new StackTraceElement[0]));
        }
      }
    }
    label525:
    for (;;)
    {
      break label66;
      paramThrowable = new Throwable(((Throwable)localObject3).getMessage(), paramThrowable);
      break label279;
      localObject1 = paramThrowable;
      if (localObject1 == null) {
        break;
      }
      localObject2 = new ArrayList();
      localObject3 = new StringWriter();
      ((Throwable)localObject1).printStackTrace(new PrintWriter((Writer)localObject3));
      localObject1 = new Uri.Builder().scheme("https").path("//pagead2.googlesyndication.com/pagead/gen_204").appendQueryParameter("id", "gmob-apps-report-exception").appendQueryParameter("os", Build.VERSION.RELEASE).appendQueryParameter("api", String.valueOf(Build.VERSION.SDK_INT));
      localObject4 = Build.MANUFACTURER;
      paramThrowable = Build.MODEL;
      if (paramThrowable.startsWith((String)localObject4)) {}
      for (;;)
      {
        ((ArrayList)localObject2).add(((Uri.Builder)localObject1).appendQueryParameter("device", paramThrowable).appendQueryParameter("js", this.d.c).appendQueryParameter("appid", this.c.getApplicationContext().getPackageName()).appendQueryParameter("stacktrace", ((StringWriter)localObject3).toString()).toString());
        lo.a(this.c, this.d.c, (List)localObject2, lb.f());
        return;
        paramThrowable = (String)localObject4 + " " + paramThrowable;
      }
    }
  }
  
  public final void uncaughtException(Thread paramThread, Throwable paramThrowable)
  {
    int m = 1;
    int i;
    if (paramThrowable != null)
    {
      int j = 0;
      int k = 0;
      for (Throwable localThrowable = paramThrowable; localThrowable != null; localThrowable = localThrowable.getCause())
      {
        StackTraceElement[] arrayOfStackTraceElement = localThrowable.getStackTrace();
        int n = arrayOfStackTraceElement.length;
        i = 0;
        while (i < n)
        {
          StackTraceElement localStackTraceElement = arrayOfStackTraceElement[i];
          if (a(localStackTraceElement.getClassName())) {
            k = 1;
          }
          if (getClass().getName().equals(localStackTraceElement.getClassName())) {
            j = 1;
          }
          i += 1;
        }
      }
      if ((k != 0) && (j == 0))
      {
        i = m;
        if (i == 0) {
          break label137;
        }
        a(paramThrowable);
        if (Looper.getMainLooper().getThread() == paramThread) {
          break label137;
        }
      }
    }
    label137:
    do
    {
      return;
      i = 0;
      break;
      if (this.a != null)
      {
        this.a.uncaughtException(paramThread, paramThrowable);
        return;
      }
    } while (this.b == null);
    this.b.uncaughtException(paramThread, paramThrowable);
  }
}
