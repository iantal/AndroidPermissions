package com.google.android.gms.internal;

import android.app.Activity;
import android.app.PendingIntent;
import android.content.ComponentName;
import android.content.Context;
import android.content.Intent;
import android.content.IntentSender.SendIntentException;
import android.content.ServiceConnection;
import android.os.Bundle;
import android.os.IBinder;
import android.os.RemoteException;

public final class fy
  extends go
  implements ServiceConnection
{
  private final Activity a;
  private final gc b;
  private Context c;
  private gx d;
  private gh e;
  private fu f;
  private ga g;
  private gf h;
  private String i = null;
  
  public fy(Activity paramActivity)
  {
    this.a = paramActivity;
    this.b = gc.a(this.a.getApplicationContext());
  }
  
  public static void a(Context paramContext, boolean paramBoolean, dv paramDv)
  {
    Intent localIntent = new Intent();
    localIntent.setClassName(paramContext, "com.google.android.gms.ads.purchase.InAppPurchaseActivity");
    localIntent.putExtra("com.google.android.gms.ads.internal.purchase.useClientJar", paramBoolean);
    dv.a(localIntent, paramDv);
    paramContext.startActivity(localIntent);
  }
  
  private void a(String paramString, boolean paramBoolean, int paramInt, Intent paramIntent)
  {
    try
    {
      this.d.a(new gb(this.c, paramString, paramBoolean, paramInt, paramIntent, this.g));
      return;
    }
    catch (RemoteException paramString)
    {
      mi.e("Fail to invoke PlayStorePurchaseListener.");
    }
  }
  
  public final void a()
  {
    Object localObject = dv.a(this.a.getIntent());
    this.d = ((dv)localObject).c;
    this.h = ((dv)localObject).d;
    this.e = ((dv)localObject).e;
    this.f = new fu(this.a.getApplicationContext());
    this.c = ((dv)localObject).f;
    localObject = new Intent("com.android.vending.billing.InAppBillingService.BIND");
    ((Intent)localObject).setPackage("com.android.vending");
    this.a.bindService((Intent)localObject, this, 1);
  }
  
  public final void a(int paramInt1, int paramInt2, Intent paramIntent)
  {
    if (paramInt1 == 1001) {}
    for (;;)
    {
      try
      {
        paramInt1 = ge.a(paramIntent);
        if ((paramInt2 != -1) || (paramInt1 != 0)) {
          continue;
        }
        if (!this.h.a(this.i, paramIntent)) {
          continue;
        }
        a(this.e.a(), true, paramInt2, paramIntent);
      }
      catch (RemoteException paramIntent)
      {
        mi.e("Fail to process purchase result.");
        return;
        this.b.a(this.g);
        a(this.e.a(), false, paramInt2, paramIntent);
        continue;
      }
      finally
      {
        this.i = null;
        this.a.finish();
      }
      this.e.b(paramInt1);
      this.i = null;
      this.a.finish();
      return;
      a(this.e.a(), false, paramInt2, paramIntent);
    }
  }
  
  public final void b()
  {
    this.a.unbindService(this);
    this.f.a();
  }
  
  public final void onServiceConnected(ComponentName paramComponentName, IBinder paramIBinder)
  {
    this.f.a(paramIBinder);
    try
    {
      paramComponentName = this.h;
      this.i = lo.d();
      paramComponentName = this.f.a(this.a.getPackageName(), this.e.a(), this.i);
      paramIBinder = (PendingIntent)paramComponentName.getParcelable("BUY_INTENT");
      if (paramIBinder == null)
      {
        int j = ge.a(paramComponentName);
        this.e.b(j);
        a(this.e.a(), false, j, null);
        this.a.finish();
        return;
      }
      this.g = new ga(this.e.a(), this.i);
      this.b.b(this.g);
      this.a.startIntentSenderForResult(paramIBinder.getIntentSender(), 1001, new Intent(), Integer.valueOf(0).intValue(), Integer.valueOf(0).intValue(), Integer.valueOf(0).intValue());
      return;
    }
    catch (RemoteException paramComponentName)
    {
      mi.c("Error when connecting in-app billing service", paramComponentName);
      this.a.finish();
      return;
    }
    catch (IntentSender.SendIntentException paramComponentName)
    {
      for (;;) {}
    }
  }
  
  public final void onServiceDisconnected(ComponentName paramComponentName)
  {
    mi.c("In-app billing service disconnected.");
    this.f.a();
  }
}
