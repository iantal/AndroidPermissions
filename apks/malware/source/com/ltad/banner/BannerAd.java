package com.ltad.banner;

import android.app.Activity;
import android.content.Context;
import android.content.res.Resources;
import android.util.DisplayMetrics;
import android.util.Log;
import android.view.View;
import android.view.ViewGroup.LayoutParams;
import android.view.WindowManager;
import android.view.WindowManager.LayoutParams;
import android.widget.FrameLayout;
import android.widget.FrameLayout.LayoutParams;
import com.ltad.a.g;
import com.ltad.a.i;
import com.ltad.util.BannerUtil;
import com.ltad.util.CommonUtil;
import com.ltad.util.PropertyUtil;
import java.lang.ref.SoftReference;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Set;

public class BannerAd
{
  public static final int POS_BOTTOM_LEFT = 6;
  public static final int POS_BOTTOM_MID = 7;
  public static final int POS_BOTTOM_RIGHT = 8;
  public static final int POS_MID_LEFT = 3;
  public static final int POS_MID_MID = 4;
  public static final int POS_MID_RIGHT = 5;
  public static final int POS_TOP_LEFT = 0;
  public static final int POS_TOP_MID = 1;
  public static final int POS_TOP_RIGHT = 2;
  private static final String TAG = "Joy_BannerAd";
  private static BannerAd mInstance = new BannerAd();
  private final int ID_BANNER = 1015808;
  private final int ID_FRAMELAYOUT = 1019904;
  private String bannerViewType = i.a(262145);
  private Set failedTag = null;
  private boolean isNew = true;
  private SoftReference mActivityRef = null;
  private BannerAd.CommonAdListener mAdListener = null;
  private View mAdView = null;
  private ArrayList mAdapterList = null;
  private Context mAppContext;
  private HashMap mViewMap = null;
  
  private BannerAd() {}
  
  private void addBanner(int paramInt, View paramView)
  {
    if (paramView == null) {
      return;
    }
    if (i.a(262146).equals(this.bannerViewType))
    {
      localObject1 = (WindowManager)((Activity)this.mActivityRef.get()).getSystemService("window");
      localObject2 = new WindowManager.LayoutParams();
      ((WindowManager.LayoutParams)localObject2).type = 2;
      ((WindowManager.LayoutParams)localObject2).flags = 8;
      ((WindowManager.LayoutParams)localObject2).format = 1;
      ((WindowManager.LayoutParams)localObject2).gravity = getGravity(paramInt);
      ((WindowManager.LayoutParams)localObject2).width = -2;
      ((WindowManager.LayoutParams)localObject2).height = -2;
      ((WindowManager.LayoutParams)localObject2).x = 0;
      ((WindowManager.LayoutParams)localObject2).y = 0;
      if (this.mViewMap == null) {
        this.mViewMap = new HashMap();
      }
      SoftReference localSoftReference = (SoftReference)this.mViewMap.get(localObject1.toString());
      if ((localSoftReference != null) && (localSoftReference.get() != null))
      {
        paramView = (View)localSoftReference.get();
        localObject2 = (WindowManager.LayoutParams)paramView.getLayoutParams();
        ((WindowManager.LayoutParams)localObject2).gravity = getGravity(paramInt);
        ((WindowManager)localObject1).updateViewLayout(paramView, (ViewGroup.LayoutParams)localObject2);
      }
      for (;;)
      {
        paramView.setVisibility(0);
        return;
        ((WindowManager)localObject1).addView(paramView, (ViewGroup.LayoutParams)localObject2);
        this.mViewMap.put(localObject1.toString(), new SoftReference(paramView));
      }
    }
    Object localObject2 = (FrameLayout)((Activity)this.mActivityRef.get()).findViewById(1019904);
    Object localObject1 = localObject2;
    if (localObject2 == null)
    {
      localObject1 = new FrameLayout(this.mAppContext);
      ((FrameLayout)localObject1).setId(1019904);
      ((FrameLayout)localObject1).setBackgroundColor(0);
      localObject2 = new FrameLayout.LayoutParams(-1, -1);
      ((FrameLayout.LayoutParams)localObject2).gravity = getGravity(0);
      ((Activity)this.mActivityRef.get()).addContentView((View)localObject1, (ViewGroup.LayoutParams)localObject2);
    }
    ((FrameLayout)localObject1).setVisibility(0);
    localObject2 = ((FrameLayout)localObject1).findViewById(1015808);
    if (localObject2 == null)
    {
      paramView.setId(1015808);
      paramView.setBackgroundColor(0);
      float f = this.mAppContext.getResources().getDisplayMetrics().density;
      localObject2 = new FrameLayout.LayoutParams((int)(320.0F * f), (int)(f * 50.0F));
      ((FrameLayout.LayoutParams)localObject2).gravity = getGravity(paramInt);
      ((FrameLayout)localObject1).addView(paramView, (ViewGroup.LayoutParams)localObject2);
      return;
    }
    paramView = (FrameLayout.LayoutParams)((View)localObject2).getLayoutParams();
    paramView.gravity = getGravity(paramInt);
    ((View)localObject2).setLayoutParams(paramView);
  }
  
  private int getGravity(int paramInt)
  {
    switch (paramInt)
    {
    case 0: 
    default: 
      return 51;
    case 1: 
      return 49;
    case 2: 
      return 53;
    case 3: 
      return 19;
    case 4: 
      return 17;
    case 5: 
      return 21;
    case 6: 
      return 83;
    case 7: 
      return 81;
    }
    return 85;
  }
  
  public static BannerAd getInstance(Activity paramActivity)
  {
    if ((mInstance.mActivityRef == null) || (mInstance.mActivityRef.get() == null) || (mInstance.mActivityRef.get() != paramActivity))
    {
      mInstance.mActivityRef = new SoftReference(paramActivity);
      mInstance.mAppContext = paramActivity.getApplicationContext();
      mInstance.isNew = true;
      g.a(paramActivity.getPackageName());
    }
    return mInstance;
  }
  
  private BannerAdapter getSupportBanner()
  {
    Object localObject = PropertyUtil.getPropertyDefault(this.mAppContext, i.a(262149), i.a(262150));
    Log.i("Joy_BannerAd", i.a(262149) + ":" + (String)localObject);
    BannerAdapter localBannerAdapter = BannerUtil.getInstance(this.mAppContext).getSupportBanner((String)localObject);
    localObject = localBannerAdapter;
    if (localBannerAdapter == null)
    {
      Log.e("Joy_BannerAd", "Have not support banner ad");
      localObject = null;
    }
    return localObject;
  }
  
  private void realShow(int paramInt)
  {
    CommonUtil.loadDefault(this.mAppContext);
    if (this.isNew)
    {
      BannerUtil.getInstance((Context)this.mActivityRef.get()).initAd();
      this.isNew = false;
    }
    this.mAdListener = new BannerAd.CommonAdListener(this);
    this.failedTag = new HashSet();
    this.mAdapterList = BannerUtil.getInstance((Context)this.mActivityRef.get()).getSupportAdapterList();
    g.b();
    try
    {
      j = Integer.parseInt(PropertyUtil.getPropertyDefault(this.mAppContext, i.a(262147), i.a(262148)));
      i = paramInt;
      if (j >= 0)
      {
        i = paramInt;
        if (j >= 9) {}
      }
    }
    catch (Exception localException1)
    {
      for (;;)
      {
        label144:
        i = paramInt;
      }
    }
    try
    {
      Log.w("Joy_BannerAd", "use config banner pos:" + j);
      i = j;
    }
    catch (Exception localException2)
    {
      i = j;
      break label144;
    }
    showMainLayout(i);
  }
  
  private void showMainLayout(int paramInt)
  {
    ((Activity)this.mActivityRef.get()).runOnUiThread(new BannerAd.3(this, paramInt));
  }
  
  public void close()
  {
    if ((this.mActivityRef == null) || (this.mActivityRef.get() == null)) {
      return;
    }
    ((Activity)this.mActivityRef.get()).runOnUiThread(new BannerAd.4(this));
  }
  
  public void destroy()
  {
    if (getSupportBanner() == null)
    {
      Log.e("Joy_BannerAd", "Have not support banner ad");
      return;
    }
    Object localObject;
    if ((this.mActivityRef != null) && (this.mActivityRef.get() != null))
    {
      BannerUtil.getInstance((Context)this.mActivityRef.get()).destroy();
      if (!i.a(262146).equals(this.bannerViewType)) {
        break label178;
      }
      localObject = (WindowManager)((Activity)this.mActivityRef.get()).getSystemService("window");
      if (this.mViewMap != null)
      {
        SoftReference localSoftReference = (SoftReference)this.mViewMap.get(localObject.toString());
        if ((localSoftReference != null) && (localSoftReference.get() != null)) {
          ((WindowManager)localObject).removeView((View)localSoftReference.get());
        }
        this.mViewMap.remove(localObject.toString());
      }
    }
    for (;;)
    {
      this.mActivityRef.clear();
      this.mAppContext = null;
      this.isNew = true;
      this.bannerViewType = i.a(262145);
      Log.i("Joy_BannerAd", "destroy complete");
      return;
      label178:
      localObject = (FrameLayout)((Activity)this.mActivityRef.get()).findViewById(1019904);
      if (localObject != null) {
        ((FrameLayout)localObject).removeAllViews();
      }
    }
  }
  
  public void preload()
  {
    try
    {
      CommonUtil.loadDefault(this.mAppContext);
      if (this.isNew)
      {
        BannerUtil.getInstance((Context)this.mActivityRef.get()).initAd();
        this.isNew = false;
      }
      BannerAdapter localBannerAdapter = getSupportBanner();
      if (localBannerAdapter != null) {
        ((Activity)this.mActivityRef.get()).runOnUiThread(new BannerAd.1(this, localBannerAdapter));
      }
      return;
    }
    finally {}
  }
  
  public void show(int paramInt)
  {
    try
    {
      new Thread(new BannerAd.2(this, paramInt)).start();
      return;
    }
    finally
    {
      localObject = finally;
      throw localObject;
    }
  }
}
