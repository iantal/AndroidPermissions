package com.ltad.interstitial;

import android.app.Activity;
import android.content.Context;
import android.content.SharedPreferences;
import android.content.SharedPreferences.Editor;
import android.preference.PreferenceManager;
import android.text.TextUtils;
import android.util.Log;
import com.ltad.a.g;
import com.ltad.a.i;
import com.ltad.dialog.AdDialog;
import com.ltad.util.CommonUtil;
import com.ltad.util.InterstitialUtil;
import com.ltad.util.PropertyUtil;
import java.lang.ref.SoftReference;
import java.util.ArrayList;
import java.util.HashSet;
import java.util.Set;
import org.json.JSONArray;

public class InterstitialAd
{
  private static final String TAG = "Joy_InterstitialAd";
  private static InterstitialAd mInstance = new InterstitialAd();
  private Set failedTag = null;
  private boolean isNew = false;
  private SoftReference mActivityRef;
  private InterstitialAd.CommonAdListener mAdListener = null;
  private ArrayList mAdapterList = null;
  private Context mAppContext;
  private UnityAdListener mUnityAdListener = null;
  
  private InterstitialAd() {}
  
  public static InterstitialAd getInstance(Activity paramActivity)
  {
    if ((mInstance.mActivityRef == null) || (mInstance.mActivityRef.get() == null) || (mInstance.mActivityRef.get() != paramActivity))
    {
      mInstance.init(paramActivity);
      g.a(paramActivity.getPackageName());
    }
    return mInstance;
  }
  
  private InterstitialAdapter getNewSupportInterstitial(String paramString)
  {
    String str2 = PropertyUtil.getPropertyDefault(this.mAppContext, "interstitial", "");
    String str1 = "";
    Object localObject = str1;
    if (!TextUtils.isEmpty(str2))
    {
      localObject = str1;
      if (TextUtils.isEmpty("point")) {}
    }
    for (;;)
    {
      try
      {
        localObject = new JSONArray(str2);
        if ((localObject == null) || (((JSONArray)localObject).length() < Integer.parseInt(paramString))) {
          continue;
        }
        localObject = ((JSONArray)localObject).get(Integer.parseInt(paramString) - 1).toString();
      }
      catch (Exception paramString)
      {
        localObject = str1;
        continue;
      }
      Log.i("Joy_InterstitialAd", "set ad Type: " + (String)localObject);
      if ((!TextUtils.isEmpty((CharSequence)localObject)) && (((String)localObject).contains(":"))) {
        break;
      }
      return null;
      Log.i("Joy_InterstitialAd", "no property for this point: " + paramString);
      localObject = str1;
    }
    try
    {
      paramString = ((String)localObject).split(":");
      if ((paramString == null) || (paramString.length != 2)) {
        break label284;
      }
      i = Integer.parseInt(paramString[1]);
    }
    catch (Exception paramString)
    {
      for (;;)
      {
        int i = -1;
        continue;
        i = -1;
      }
    }
    paramString = (String)localObject;
    if (PropertyUtil.getPropertyDefault(this.mAppContext, i.a(458755), "").toLowerCase().contains(i.a(458756)))
    {
      localObject = i.a(458756);
      paramString = (String)localObject;
      if (i != -1) {
        paramString = localObject + ":" + i;
      }
      Log.w("Joy_InterstitialAd", "real ad type: " + paramString);
    }
    return InterstitialUtil.getInstance(this.mAppContext).getNewSupportInterstitial(paramString);
  }
  
  @Deprecated
  private InterstitialAdapter getSupportInterstitial(String paramString)
  {
    paramString = PropertyUtil.getPropertyDefault(this.mAppContext, paramString, "").toLowerCase();
    Log.i("Joy_InterstitialAd", "set ad type: " + paramString);
    if (PropertyUtil.getPropertyDefault(this.mAppContext, i.a(458755), "").toLowerCase().contains(i.a(458756)))
    {
      paramString = i.a(458756);
      Log.w("Joy_InterstitialAd", "real ad type: " + paramString);
    }
    return InterstitialUtil.getInstance(this.mAppContext).getSupportInterstitial(paramString);
  }
  
  @Deprecated
  private Set getUsedInterstitialAdapters()
  {
    HashSet localHashSet = new HashSet();
    Object localObject3 = i.a(327680);
    Object localObject2 = i.a(327681);
    Object localObject1 = i.a(327682);
    String str = i.a(327683);
    i.a(458754);
    InterstitialAdapter localInterstitialAdapter = getSupportInterstitial((String)localObject3);
    if ((localInterstitialAdapter != null) && (Integer.parseInt(PropertyUtil.getPropertyDefault(this.mAppContext, i.a(458753) + (String)localObject3, i.a(458754))) > 0)) {
      localHashSet.add(localInterstitialAdapter);
    }
    localObject3 = getSupportInterstitial((String)localObject2);
    if ((localObject3 != null) && (Integer.parseInt(PropertyUtil.getPropertyDefault(this.mAppContext, i.a(458753) + (String)localObject2, i.a(458754))) > 0)) {
      localHashSet.add(localObject3);
    }
    localObject2 = getSupportInterstitial((String)localObject1);
    if ((localObject2 != null) && (Integer.parseInt(PropertyUtil.getPropertyDefault(this.mAppContext, i.a(458753) + (String)localObject1, i.a(458754))) > 0)) {
      localHashSet.add(localObject2);
    }
    localObject1 = getSupportInterstitial(str);
    if ((localObject1 != null) && (Integer.parseInt(PropertyUtil.getPropertyDefault(this.mAppContext, i.a(458753) + str, i.a(458754))) > 0)) {
      localHashSet.add(localObject1);
    }
    return localHashSet;
  }
  
  private void init(Activity paramActivity)
  {
    this.mActivityRef = new SoftReference(paramActivity);
    this.mAppContext = paramActivity.getApplicationContext();
    this.isNew = true;
  }
  
  @Deprecated
  private void preShow(Activity paramActivity, String paramString)
  {
    InterstitialAdapter localInterstitialAdapter = getSupportInterstitial(paramString);
    if (localInterstitialAdapter == null)
    {
      Log.e("Joy_InterstitialAd", "have not support interstitial ad");
      return;
    }
    paramActivity.runOnUiThread(new InterstitialAd.4(this, localInterstitialAdapter, paramString, paramActivity));
  }
  
  private void preShowInterstitial(Activity paramActivity, String paramString)
  {
    InterstitialAdapter localInterstitialAdapter = getNewSupportInterstitial(paramString);
    if (localInterstitialAdapter == null)
    {
      Log.e("Joy_InterstitialAd", "have not support interstitial ad");
      return;
    }
    g.b(paramString);
    this.mAdListener = new InterstitialAd.CommonAdListener(this);
    this.failedTag = new HashSet();
    this.mAdapterList = InterstitialUtil.getInstance(this.mAppContext).getSupportAdapterList();
    localInterstitialAdapter.mAdListener = this.mAdListener;
    this.mAdListener.setAdapter(localInterstitialAdapter);
    this.mAdListener.setPoint(paramString);
    paramActivity.runOnUiThread(new InterstitialAd.9(this, localInterstitialAdapter, paramActivity));
  }
  
  @Deprecated
  private void realShow(String paramString)
  {
    Log.i("Joy_InterstitialAd", "show type: " + paramString);
    PreferenceManager.getDefaultSharedPreferences(this.mAppContext).edit().putString("showType", paramString).commit();
    CommonUtil.loadDefault(this.mAppContext);
    if (this.isNew)
    {
      InterstitialUtil.getInstance(this.mAppContext).initAd();
      this.isNew = false;
    }
    AdDialog.getInstance(this.mAppContext).init();
    AdDialog.getInstance(this.mAppContext).setAdListener(new InterstitialAd.3(this, paramString));
  }
  
  private void realShowInterstitial(String paramString)
  {
    Log.i("Joy_InterstitialAd", "show point: " + paramString);
    try
    {
      if (Integer.parseInt(paramString) < 1)
      {
        ((Activity)this.mActivityRef.get()).runOnUiThread(new InterstitialAd.6(this));
        Log.e("Joy_InterstitialAd", "point is an integer greater than 0.");
        return;
      }
    }
    catch (Exception paramString)
    {
      ((Activity)this.mActivityRef.get()).runOnUiThread(new InterstitialAd.7(this));
      Log.e("Joy_InterstitialAd", "point is an integer greater than 0.");
      return;
    }
    PreferenceManager.getDefaultSharedPreferences(this.mAppContext).edit().putString("showType", paramString).commit();
    CommonUtil.loadDefault(this.mAppContext);
    if (this.isNew)
    {
      InterstitialUtil.getInstance(this.mAppContext).initAd();
      this.isNew = false;
    }
    AdDialog.getInstance(this.mAppContext).init();
    AdDialog.getInstance(this.mAppContext).setAdListener(new InterstitialAd.8(this, paramString));
  }
  
  private void traverseOtherAdapter(Activity paramActivity, InterstitialAdapter paramInterstitialAdapter, String paramString)
  {
    if ((paramActivity == null) || (paramInterstitialAdapter == null)) {
      return;
    }
    paramInterstitialAdapter.mAdListener = this.mAdListener;
    this.mAdListener.setAdapter(paramInterstitialAdapter);
    this.mAdListener.setPoint(paramString);
    paramActivity.runOnUiThread(new InterstitialAd.10(this, paramInterstitialAdapter, paramActivity));
  }
  
  public void destroy()
  {
    InterstitialUtil.getInstance(this.mAppContext).destroy();
    this.mActivityRef.clear();
    this.mAppContext = null;
    Log.i("Joy_InterstitialAd", "Destroy Complete");
  }
  
  /* Error */
  public void preload()
  {
    // Byte code:
    //   0: aload_0
    //   1: monitorenter
    //   2: aload_0
    //   3: getfield 69	com/ltad/interstitial/InterstitialAd:mAppContext	Landroid/content/Context;
    //   6: invokestatic 315	com/ltad/util/CommonUtil:loadDefault	(Landroid/content/Context;)V
    //   9: aload_0
    //   10: getfield 35	com/ltad/interstitial/InterstitialAd:isNew	Z
    //   13: ifeq +18 -> 31
    //   16: aload_0
    //   17: getfield 69	com/ltad/interstitial/InterstitialAd:mAppContext	Landroid/content/Context;
    //   20: invokestatic 204	com/ltad/util/InterstitialUtil:getInstance	(Landroid/content/Context;)Lcom/ltad/util/InterstitialUtil;
    //   23: invokevirtual 318	com/ltad/util/InterstitialUtil:initAd	()V
    //   26: aload_0
    //   27: iconst_0
    //   28: putfield 35	com/ltad/interstitial/InterstitialAd:isNew	Z
    //   31: aload_0
    //   32: invokespecial 360	com/ltad/interstitial/InterstitialAd:getUsedInterstitialAdapters	()Ljava/util/Set;
    //   35: invokeinterface 364 1 0
    //   40: astore_2
    //   41: aload_2
    //   42: invokeinterface 369 1 0
    //   47: istore_1
    //   48: iload_1
    //   49: ifne +6 -> 55
    //   52: aload_0
    //   53: monitorexit
    //   54: return
    //   55: aload_2
    //   56: invokeinterface 372 1 0
    //   61: checkcast 268	com/ltad/interstitial/InterstitialAdapter
    //   64: astore_3
    //   65: aload_0
    //   66: getfield 51	com/ltad/interstitial/InterstitialAd:mActivityRef	Ljava/lang/ref/SoftReference;
    //   69: invokevirtual 91	java/lang/ref/SoftReference:get	()Ljava/lang/Object;
    //   72: checkcast 97	android/app/Activity
    //   75: new 374	com/ltad/interstitial/InterstitialAd$1
    //   78: dup
    //   79: aload_0
    //   80: aload_3
    //   81: invokespecial 377	com/ltad/interstitial/InterstitialAd$1:<init>	(Lcom/ltad/interstitial/InterstitialAd;Lcom/ltad/interstitial/InterstitialAdapter;)V
    //   84: invokevirtual 252	android/app/Activity:runOnUiThread	(Ljava/lang/Runnable;)V
    //   87: goto -46 -> 41
    //   90: astore_2
    //   91: aload_0
    //   92: monitorexit
    //   93: aload_2
    //   94: athrow
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	95	0	this	InterstitialAd
    //   47	2	1	bool	boolean
    //   40	16	2	localIterator	java.util.Iterator
    //   90	4	2	localObject	Object
    //   64	17	3	localInterstitialAdapter	InterstitialAdapter
    // Exception table:
    //   from	to	target	type
    //   2	31	90	finally
    //   31	41	90	finally
    //   41	48	90	finally
    //   55	87	90	finally
  }
  
  public void setUnityAdListener(UnityAdListener paramUnityAdListener)
  {
    this.mUnityAdListener = paramUnityAdListener;
  }
  
  @Deprecated
  public void show(String paramString)
  {
    try
    {
      new Thread(new InterstitialAd.2(this, paramString)).start();
      return;
    }
    finally
    {
      paramString = finally;
      throw paramString;
    }
  }
  
  public void showInterstitial(String paramString)
  {
    try
    {
      new Thread(new InterstitialAd.5(this, paramString)).start();
      return;
    }
    finally
    {
      paramString = finally;
      throw paramString;
    }
  }
  
  public void stopLoading()
  {
    InterstitialUtil.getInstance(this.mAppContext).stopLoading();
    Log.i("Joy_InterstitialAd", "stop loading!");
  }
}
