package com.ltad.util;

import android.content.Context;
import android.os.Environment;
import android.provider.Settings.Secure;
import android.telephony.TelephonyManager;
import java.io.DataOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.util.UUID;
import org.apache.http.util.EncodingUtils;

public class UUIDRetriever
{
  private static String uidCache = null;
  
  public UUIDRetriever() {}
  
  private static String GetUuid(Context paramContext)
  {
    try
    {
      Object localObject = (TelephonyManager)paramContext.getSystemService("phone");
      String str = ((TelephonyManager)localObject).getDeviceId();
      localObject = ((TelephonyManager)localObject).getSimSerialNumber();
      paramContext = new UUID(Settings.Secure.getString(paramContext.getContentResolver(), "android_id").hashCode(), str.hashCode() << 32 | ((String)localObject).hashCode()).toString();
      return paramContext;
    }
    catch (Exception paramContext) {}
    return "";
  }
  
  public static String get(Context paramContext)
  {
    if ((uidCache != null) && (uidCache.matches("\\S{8}-\\S{4}-\\S{4}-\\S{4}-\\S{12}"))) {
      return uidCache;
    }
    if ("mounted".equals(Environment.getExternalStorageState())) {}
    for (String str1 = Environment.getExternalStorageDirectory() + "/.android/juuid.bk";; str1 = paramContext.getFilesDir().getAbsolutePath() + "/temp/juuid.bk")
    {
      String str3 = readFile(new File(str1));
      String str2;
      if (str3 != null)
      {
        str2 = str3;
        if (str3.matches("\\S{8}-\\S{4}-\\S{4}-\\S{4}-\\S{12}")) {}
      }
      else
      {
        str2 = GetUuid(paramContext);
        writeStr2File(str1, str2);
      }
      uidCache = str2;
      return str2;
    }
  }
  
  private static String readFile(File paramFile)
  {
    Object localObject3 = null;
    Object localObject2 = null;
    Object localObject1 = localObject3;
    try
    {
      if (paramFile.exists())
      {
        localObject1 = localObject3;
        paramFile = new FileInputStream(paramFile);
        localObject1 = localObject3;
        localObject2 = new byte[paramFile.available()];
        localObject1 = localObject3;
        paramFile.read((byte[])localObject2);
        localObject1 = localObject3;
        localObject2 = EncodingUtils.getString((byte[])localObject2, "UTF-8");
        localObject1 = localObject2;
        paramFile.close();
      }
      return localObject2;
    }
    catch (Exception paramFile)
    {
      paramFile.printStackTrace();
    }
    return localObject1;
  }
  
  private static boolean writeStr2File(String paramString1, String paramString2)
  {
    try
    {
      paramString1 = new File(paramString1);
      if (!paramString1.exists())
      {
        paramString1.getParentFile().mkdirs();
        paramString1.createNewFile();
      }
      paramString1 = new DataOutputStream(new FileOutputStream(paramString1));
      paramString1.write(paramString2.getBytes("utf-8"));
      paramString1.close();
      return true;
    }
    catch (Exception paramString1)
    {
      paramString1.printStackTrace();
    }
    return false;
  }
}
