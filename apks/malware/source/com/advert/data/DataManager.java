package com.advert.data;

import android.app.NotificationManager;
import android.app.PendingIntent;
import android.bluetooth.BluetoothAdapter;
import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.content.SharedPreferences.Editor;
import android.content.pm.PackageInfo;
import android.content.pm.PackageManager;
import android.content.pm.PackageManager.NameNotFoundException;
import android.content.res.Resources;
import android.graphics.drawable.BitmapDrawable;
import android.graphics.drawable.Drawable;
import android.net.wifi.WifiInfo;
import android.net.wifi.WifiManager;
import android.os.Build;
import android.provider.Settings.Secure;
import android.support.v4.app.NotificationCompat.Builder;
import android.telephony.TelephonyManager;
import android.util.Log;
import android.widget.RemoteViews;
import com.advert.Constants;
import com.advert.R.drawable;
import com.advert.R.id;
import com.advert.R.layout;
import com.advert.R.string;
import com.advert.TransparentActivity;
import com.advert.object.AdObject;
import com.advert.task.DataConsumer;
import com.advert.task.DataEvent;
import java.io.IOException;
import java.io.InputStream;
import java.net.HttpURLConnection;
import java.net.MalformedURLException;
import java.net.URL;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.util.List;
import java.util.Timer;
import java.util.TimerTask;

public class DataManager
  implements DataConsumer, Constants
{
  public static final String TAG = DataManager.class.getName();
  static String applicationType;
  private static DataManager instance;
  static boolean isFirstTimeLaunched = true;
  private static Context mContext;
  static String releaseVersion;
  private AdObject addObject = null;
  private String currentAdId;
  private String mDeviceId;
  
  private DataManager()
  {
    checkContext();
    this.mDeviceId = getId();
  }
  
  private DataManager(Context paramContext)
  {
    if (paramContext != null) {
      mContext = paramContext;
    }
    checkContext();
    this.mDeviceId = getId();
  }
  
  private void checkContext()
  {
    if (mContext == null) {
      throw new RuntimeException("Can not perform this operation. You must call start method before getting instance.");
    }
  }
  
  /* Error */
  private void drawShortcut(AdObject paramAdObject)
  {
    // Byte code:
    //   0: ldc 75
    //   2: ldc 77
    //   4: invokestatic 83	android/util/Log:d	(Ljava/lang/String;Ljava/lang/String;)I
    //   7: pop
    //   8: new 85	android/content/Intent
    //   11: dup
    //   12: invokespecial 86	android/content/Intent:<init>	()V
    //   15: astore 5
    //   17: ldc 88
    //   19: new 90	java/lang/StringBuilder
    //   22: dup
    //   23: ldc 92
    //   25: invokespecial 93	java/lang/StringBuilder:<init>	(Ljava/lang/String;)V
    //   28: aload_1
    //   29: invokevirtual 98	com/advert/object/AdObject:getIconId	()Ljava/lang/String;
    //   32: invokevirtual 102	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   35: invokevirtual 105	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   38: invokevirtual 109	java/lang/Class:getField	(Ljava/lang/String;)Ljava/lang/reflect/Field;
    //   41: aconst_null
    //   42: invokevirtual 115	java/lang/reflect/Field:getInt	(Ljava/lang/Object;)I
    //   45: istore_2
    //   46: ldc 75
    //   48: new 90	java/lang/StringBuilder
    //   51: dup
    //   52: ldc 117
    //   54: invokespecial 93	java/lang/StringBuilder:<init>	(Ljava/lang/String;)V
    //   57: iload_2
    //   58: invokevirtual 120	java/lang/StringBuilder:append	(I)Ljava/lang/StringBuilder;
    //   61: invokevirtual 105	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   64: invokestatic 83	android/util/Log:d	(Ljava/lang/String;Ljava/lang/String;)I
    //   67: pop
    //   68: iload_2
    //   69: ifne +330 -> 399
    //   72: aconst_null
    //   73: astore_3
    //   74: new 122	java/net/URL
    //   77: dup
    //   78: new 90	java/lang/StringBuilder
    //   81: dup
    //   82: ldc 124
    //   84: invokespecial 93	java/lang/StringBuilder:<init>	(Ljava/lang/String;)V
    //   87: aload_1
    //   88: invokevirtual 98	com/advert/object/AdObject:getIconId	()Ljava/lang/String;
    //   91: invokevirtual 102	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   94: ldc 126
    //   96: invokevirtual 102	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   99: invokevirtual 105	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   102: invokespecial 127	java/net/URL:<init>	(Ljava/lang/String;)V
    //   105: invokevirtual 131	java/net/URL:openConnection	()Ljava/net/URLConnection;
    //   108: checkcast 133	java/net/HttpURLConnection
    //   111: astore 4
    //   113: aload 4
    //   115: iconst_1
    //   116: invokevirtual 137	java/net/HttpURLConnection:setDoInput	(Z)V
    //   119: aload 4
    //   121: invokevirtual 140	java/net/HttpURLConnection:connect	()V
    //   124: aload 4
    //   126: invokevirtual 144	java/net/HttpURLConnection:getInputStream	()Ljava/io/InputStream;
    //   129: astore 4
    //   131: aload 4
    //   133: astore_3
    //   134: aload_3
    //   135: ldc -110
    //   137: invokestatic 152	android/graphics/drawable/Drawable:createFromStream	(Ljava/io/InputStream;Ljava/lang/String;)Landroid/graphics/drawable/Drawable;
    //   140: checkcast 154	android/graphics/drawable/BitmapDrawable
    //   143: astore_3
    //   144: aload 5
    //   146: ldc -100
    //   148: new 85	android/content/Intent
    //   151: dup
    //   152: ldc -98
    //   154: aload_1
    //   155: invokevirtual 161	com/advert/object/AdObject:getUrl	()Ljava/lang/String;
    //   158: invokestatic 167	android/net/Uri:parse	(Ljava/lang/String;)Landroid/net/Uri;
    //   161: invokespecial 170	android/content/Intent:<init>	(Ljava/lang/String;Landroid/net/Uri;)V
    //   164: invokevirtual 174	android/content/Intent:putExtra	(Ljava/lang/String;Landroid/os/Parcelable;)Landroid/content/Intent;
    //   167: pop
    //   168: aload 5
    //   170: ldc -80
    //   172: aload_1
    //   173: invokevirtual 179	com/advert/object/AdObject:getTitle	()Ljava/lang/String;
    //   176: invokevirtual 182	android/content/Intent:putExtra	(Ljava/lang/String;Ljava/lang/String;)Landroid/content/Intent;
    //   179: pop
    //   180: aload 5
    //   182: ldc -72
    //   184: aload_3
    //   185: invokevirtual 188	android/graphics/drawable/BitmapDrawable:getBitmap	()Landroid/graphics/Bitmap;
    //   188: invokevirtual 174	android/content/Intent:putExtra	(Ljava/lang/String;Landroid/os/Parcelable;)Landroid/content/Intent;
    //   191: pop
    //   192: aload 5
    //   194: ldc -66
    //   196: invokevirtual 194	android/content/Intent:setAction	(Ljava/lang/String;)Landroid/content/Intent;
    //   199: pop
    //   200: getstatic 53	com/advert/data/DataManager:mContext	Landroid/content/Context;
    //   203: aload 5
    //   205: invokevirtual 200	android/content/Context:sendBroadcast	(Landroid/content/Intent;)V
    //   208: return
    //   209: astore 4
    //   211: aload 4
    //   213: invokevirtual 203	java/net/MalformedURLException:printStackTrace	()V
    //   216: goto -82 -> 134
    //   219: astore_3
    //   220: ldc 75
    //   222: ldc -51
    //   224: invokestatic 83	android/util/Log:d	(Ljava/lang/String;Ljava/lang/String;)I
    //   227: pop
    //   228: aload_3
    //   229: invokevirtual 206	java/lang/Exception:printStackTrace	()V
    //   232: aconst_null
    //   233: astore_3
    //   234: new 122	java/net/URL
    //   237: dup
    //   238: new 90	java/lang/StringBuilder
    //   241: dup
    //   242: ldc 124
    //   244: invokespecial 93	java/lang/StringBuilder:<init>	(Ljava/lang/String;)V
    //   247: aload_1
    //   248: invokevirtual 98	com/advert/object/AdObject:getIconId	()Ljava/lang/String;
    //   251: invokevirtual 102	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   254: ldc 126
    //   256: invokevirtual 102	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   259: invokevirtual 105	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   262: invokespecial 127	java/net/URL:<init>	(Ljava/lang/String;)V
    //   265: invokevirtual 131	java/net/URL:openConnection	()Ljava/net/URLConnection;
    //   268: checkcast 133	java/net/HttpURLConnection
    //   271: astore 4
    //   273: aload 4
    //   275: iconst_1
    //   276: invokevirtual 137	java/net/HttpURLConnection:setDoInput	(Z)V
    //   279: aload 4
    //   281: invokevirtual 140	java/net/HttpURLConnection:connect	()V
    //   284: aload 4
    //   286: invokevirtual 144	java/net/HttpURLConnection:getInputStream	()Ljava/io/InputStream;
    //   289: astore 4
    //   291: aload 4
    //   293: astore_3
    //   294: aload_3
    //   295: ldc -110
    //   297: invokestatic 152	android/graphics/drawable/Drawable:createFromStream	(Ljava/io/InputStream;Ljava/lang/String;)Landroid/graphics/drawable/Drawable;
    //   300: checkcast 154	android/graphics/drawable/BitmapDrawable
    //   303: astore_3
    //   304: aload 5
    //   306: ldc -100
    //   308: new 85	android/content/Intent
    //   311: dup
    //   312: ldc -98
    //   314: aload_1
    //   315: invokevirtual 161	com/advert/object/AdObject:getUrl	()Ljava/lang/String;
    //   318: invokestatic 167	android/net/Uri:parse	(Ljava/lang/String;)Landroid/net/Uri;
    //   321: invokespecial 170	android/content/Intent:<init>	(Ljava/lang/String;Landroid/net/Uri;)V
    //   324: invokevirtual 174	android/content/Intent:putExtra	(Ljava/lang/String;Landroid/os/Parcelable;)Landroid/content/Intent;
    //   327: pop
    //   328: aload 5
    //   330: ldc -80
    //   332: aload_1
    //   333: invokevirtual 179	com/advert/object/AdObject:getTitle	()Ljava/lang/String;
    //   336: invokevirtual 182	android/content/Intent:putExtra	(Ljava/lang/String;Ljava/lang/String;)Landroid/content/Intent;
    //   339: pop
    //   340: aload 5
    //   342: ldc -72
    //   344: aload_3
    //   345: invokevirtual 188	android/graphics/drawable/BitmapDrawable:getBitmap	()Landroid/graphics/Bitmap;
    //   348: invokevirtual 174	android/content/Intent:putExtra	(Ljava/lang/String;Landroid/os/Parcelable;)Landroid/content/Intent;
    //   351: pop
    //   352: aload 5
    //   354: ldc -66
    //   356: invokevirtual 194	android/content/Intent:setAction	(Ljava/lang/String;)Landroid/content/Intent;
    //   359: pop
    //   360: getstatic 53	com/advert/data/DataManager:mContext	Landroid/content/Context;
    //   363: aload 5
    //   365: invokevirtual 200	android/content/Context:sendBroadcast	(Landroid/content/Intent;)V
    //   368: return
    //   369: astore 4
    //   371: aload 4
    //   373: invokevirtual 207	java/io/IOException:printStackTrace	()V
    //   376: goto -242 -> 134
    //   379: astore 4
    //   381: aload 4
    //   383: invokevirtual 203	java/net/MalformedURLException:printStackTrace	()V
    //   386: goto -92 -> 294
    //   389: astore 4
    //   391: aload 4
    //   393: invokevirtual 207	java/io/IOException:printStackTrace	()V
    //   396: goto -102 -> 294
    //   399: getstatic 53	com/advert/data/DataManager:mContext	Landroid/content/Context;
    //   402: iload_2
    //   403: invokestatic 213	android/content/Intent$ShortcutIconResource:fromContext	(Landroid/content/Context;I)Landroid/content/Intent$ShortcutIconResource;
    //   406: astore_3
    //   407: aload 5
    //   409: ldc -100
    //   411: new 85	android/content/Intent
    //   414: dup
    //   415: ldc -98
    //   417: aload_1
    //   418: invokevirtual 161	com/advert/object/AdObject:getUrl	()Ljava/lang/String;
    //   421: invokestatic 167	android/net/Uri:parse	(Ljava/lang/String;)Landroid/net/Uri;
    //   424: invokespecial 170	android/content/Intent:<init>	(Ljava/lang/String;Landroid/net/Uri;)V
    //   427: invokevirtual 174	android/content/Intent:putExtra	(Ljava/lang/String;Landroid/os/Parcelable;)Landroid/content/Intent;
    //   430: pop
    //   431: aload 5
    //   433: ldc -80
    //   435: aload_1
    //   436: invokevirtual 179	com/advert/object/AdObject:getTitle	()Ljava/lang/String;
    //   439: invokevirtual 182	android/content/Intent:putExtra	(Ljava/lang/String;Ljava/lang/String;)Landroid/content/Intent;
    //   442: pop
    //   443: aload 5
    //   445: ldc -41
    //   447: aload_3
    //   448: invokevirtual 174	android/content/Intent:putExtra	(Ljava/lang/String;Landroid/os/Parcelable;)Landroid/content/Intent;
    //   451: pop
    //   452: aload 5
    //   454: ldc -66
    //   456: invokevirtual 194	android/content/Intent:setAction	(Ljava/lang/String;)Landroid/content/Intent;
    //   459: pop
    //   460: getstatic 53	com/advert/data/DataManager:mContext	Landroid/content/Context;
    //   463: aload 5
    //   465: invokevirtual 200	android/content/Context:sendBroadcast	(Landroid/content/Intent;)V
    //   468: return
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	469	0	this	DataManager
    //   0	469	1	paramAdObject	AdObject
    //   45	358	2	i	int
    //   73	112	3	localObject1	Object
    //   219	10	3	localException	Exception
    //   233	215	3	localObject2	Object
    //   111	21	4	localObject3	Object
    //   209	3	4	localMalformedURLException1	MalformedURLException
    //   271	21	4	localObject4	Object
    //   369	3	4	localIOException1	IOException
    //   379	3	4	localMalformedURLException2	MalformedURLException
    //   389	3	4	localIOException2	IOException
    //   15	449	5	localIntent	Intent
    // Exception table:
    //   from	to	target	type
    //   74	131	209	java/net/MalformedURLException
    //   17	68	219	java/lang/Exception
    //   74	131	219	java/lang/Exception
    //   134	208	219	java/lang/Exception
    //   211	216	219	java/lang/Exception
    //   371	376	219	java/lang/Exception
    //   74	131	369	java/io/IOException
    //   234	291	379	java/net/MalformedURLException
    //   234	291	389	java/io/IOException
  }
  
  private void getData()
  {
    Log.d("!!!", "in get data ");
    ConnectionDataManager.postDataToUrl(instance, 0);
  }
  
  public static DataManager getInstance()
  {
    if (instance == null) {
      instance = new DataManager();
    }
    return instance;
  }
  
  private void showNotification(AdObject paramAdObject)
  {
    Log.d("!!!", "Im in showNotification");
    mContext.getResources().getIdentifier("ad" + paramAdObject.getIconId(), "drawable", mContext.getPackageName());
    NotificationCompat.Builder localBuilder = new NotificationCompat.Builder(mContext);
    RemoteViews localRemoteViews = new RemoteViews(mContext.getPackageName(), R.layout.notification);
    localRemoteViews.setTextViewText(R.id.title_text, paramAdObject.getTitle());
    localRemoteViews.setTextViewText(R.id.subtitle_text, paramAdObject.getText());
    Object localObject1 = null;
    try
    {
      Object localObject2 = new URL("http://188.240.34.210/ICON.H1/" + paramAdObject.getIconId() + ".png");
      Log.d("!!!", "dObject.getIconId() is " + paramAdObject.getIconId());
      localObject2 = (HttpURLConnection)((URL)localObject2).openConnection();
      ((HttpURLConnection)localObject2).setDoInput(true);
      ((HttpURLConnection)localObject2).connect();
      localObject2 = ((HttpURLConnection)localObject2).getInputStream();
      localObject1 = localObject2;
    }
    catch (MalformedURLException localMalformedURLException)
    {
      for (;;)
      {
        localMalformedURLException.printStackTrace();
      }
    }
    catch (IOException localIOException)
    {
      for (;;)
      {
        localIOException.printStackTrace();
      }
    }
    localObject1 = (BitmapDrawable)Drawable.createFromStream((InputStream)localObject1, "src");
    localRemoteViews.setImageViewBitmap(R.id.notify_image, ((BitmapDrawable)localObject1).getBitmap());
    localBuilder.setContent(localRemoteViews);
    localBuilder.setSmallIcon(R.drawable.ic_launcher_wallpaper);
    localObject1 = new Intent(mContext, TransparentActivity.class);
    ((Intent)localObject1).putExtra("notify_key", "open_key");
    ((Intent)localObject1).putExtra("url_key", paramAdObject.getUrl());
    ((Intent)localObject1).putExtra("ad_id_key", paramAdObject.getAdId());
    localBuilder.setContentIntent(PendingIntent.getActivity(mContext, 0, (Intent)localObject1, 1073741824));
    localObject1 = new Intent(mContext, TransparentActivity.class);
    ((Intent)localObject1).putExtra("notify_key", "close_key");
    ((Intent)localObject1).putExtra("ad_id_key", paramAdObject.getAdId());
    localBuilder.setDeleteIntent(PendingIntent.getActivity(mContext, 0, (Intent)localObject1, 0));
    ((NotificationManager)mContext.getSystemService("notification")).notify(1, localBuilder.build());
  }
  
  public static void start(Context paramContext, String paramString)
  {
    Log.d("!!!", "Im in DataManager start");
    Object localObject;
    if (!paramContext.getSharedPreferences("PREFS_NAME", 0).getBoolean("FIRST_RUN", false))
    {
      localObject = paramContext.getSharedPreferences("PREFS_NAME", 0).edit();
      ((SharedPreferences.Editor)localObject).putBoolean("FIRST_RUN", true);
      ((SharedPreferences.Editor)localObject).commit();
      Log.d("!!!", "First run appeared");
    }
    for (;;)
    {
      localObject = null;
      try
      {
        PackageInfo localPackageInfo = paramContext.getApplicationContext().getPackageManager().getPackageInfo(paramContext.getApplicationContext().getPackageName(), 0);
        localObject = localPackageInfo;
      }
      catch (PackageManager.NameNotFoundException localNameNotFoundException)
      {
        for (;;)
        {
          localNameNotFoundException.printStackTrace();
        }
      }
      Log.d("!!!", "releaseVersion :" + releaseVersion);
      releaseVersion = ((PackageInfo)localObject).versionName;
      applicationType = paramString;
      if (instance == null) {
        instance = new DataManager(paramContext);
      }
      instance.getData();
      return;
      Log.d("!!!", "More then first run appeared");
      isFirstTimeLaunched = false;
    }
  }
  
  public Context getContext()
  {
    checkContext();
    return mContext;
  }
  
  public String getCurrentAdId()
  {
    return this.currentAdId;
  }
  
  public String getDeviceId()
  {
    return this.mDeviceId;
  }
  
  public String getId()
  {
    localObject1 = ((TelephonyManager)mContext.getSystemService("phone")).getDeviceId();
    Object localObject2 = "35" + Build.BOARD.length() % 10 + Build.BRAND.length() % 10 + Build.CPU_ABI.length() % 10 + Build.DEVICE.length() % 10 + Build.DISPLAY.length() % 10 + Build.HOST.length() % 10 + Build.ID.length() % 10 + Build.MANUFACTURER.length() % 10 + Build.MODEL.length() % 10 + Build.PRODUCT.length() % 10 + Build.TAGS.length() % 10 + Build.TYPE.length() % 10 + Build.USER.length() % 10;
    localObject4 = Settings.Secure.getString(mContext.getContentResolver(), "android_id");
    String str1 = ((WifiManager)mContext.getSystemService("wifi")).getConnectionInfo().getMacAddress();
    String str2 = BluetoothAdapter.getDefaultAdapter().getAddress();
    localObject4 = localObject1 + (String)localObject2 + (String)localObject4 + str1 + str2;
    localObject1 = null;
    try
    {
      localObject2 = MessageDigest.getInstance("MD5");
      localObject1 = localObject2;
    }
    catch (NoSuchAlgorithmException localNoSuchAlgorithmException)
    {
      for (;;)
      {
        int i;
        localNoSuchAlgorithmException.printStackTrace();
        continue;
        int j = localObject4[i] & 0xFF;
        Object localObject3 = localObject1;
        if (j <= 15) {
          localObject3 = localObject1 + "0";
        }
        localObject1 = localObject3 + Integer.toHexString(j);
        i += 1;
      }
    }
    ((MessageDigest)localObject1).update(((String)localObject4).getBytes(), 0, ((String)localObject4).length());
    localObject4 = ((MessageDigest)localObject1).digest();
    localObject1 = new String();
    i = 0;
    if (i >= localObject4.length) {
      return ((String)localObject1).toUpperCase();
    }
  }
  
  public void handleEvent(DataEvent paramDataEvent)
  {
    if (paramDataEvent.getType() == 0)
    {
      paramDataEvent = (List)paramDataEvent.getData();
      if (paramDataEvent.size() == 1) {
        showNotification((AdObject)paramDataEvent.get(0));
      }
    }
    else
    {
      return;
    }
    if (paramDataEvent.size() == 2)
    {
      showNotification((AdObject)paramDataEvent.get(0));
      drawShortcut((AdObject)paramDataEvent.get(1));
      return;
    }
    Log.e(TAG, "No objects server returned from!");
    startTimer();
  }
  
  public void handleExeption(Exception paramException)
  {
    Log.e(TAG, "Error was occures when loading data!");
    startTimer();
  }
  
  public boolean isTablet()
  {
    return Boolean.parseBoolean(getInstance().getContext().getString(R.string.isTablet));
  }
  
  public void setCurrentAdId(String paramString)
  {
    this.currentAdId = paramString;
  }
  
  public void startTimer()
  {
    int i = mContext.getSharedPreferences("ads_prefs", 0).getInt("next_show_time", 10);
    new Timer().schedule(new TimerTask()
    {
      public void run()
      {
        DataManager.this.getData();
      }
    }, i * 60 * 1000);
  }
}
