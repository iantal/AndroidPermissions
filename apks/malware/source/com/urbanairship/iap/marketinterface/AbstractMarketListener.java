package com.urbanairship.iap.marketinterface;

import android.app.Activity;
import android.app.PendingIntent;
import android.app.PendingIntent.CanceledException;
import android.content.Intent;
import android.content.IntentSender;
import android.os.Handler;
import com.urbanairship.Logger;
import java.lang.reflect.Method;

public abstract class AbstractMarketListener
{
  private static final Class<?>[] START_INTENT_SENDER_SIG = { IntentSender.class, Intent.class, Integer.TYPE, Integer.TYPE, Integer.TYPE };
  private final Handler mHandler;
  private Method mStartIntentSender;
  private Object[] mStartIntentSenderArgs = new Object[5];
  
  public AbstractMarketListener(Handler paramHandler)
  {
    this.mHandler = paramHandler;
  }
  
  private void initCompatibilityLayer(Activity paramActivity)
  {
    try
    {
      this.mStartIntentSender = paramActivity.getClass().getMethod("startIntentSender", START_INTENT_SENDER_SIG);
      return;
    }
    catch (SecurityException paramActivity)
    {
      this.mStartIntentSender = null;
      return;
    }
    catch (NoSuchMethodException paramActivity)
    {
      this.mStartIntentSender = null;
    }
  }
  
  public abstract void onBillingSupported(boolean paramBoolean);
  
  public abstract void onPurchaseStateChange(Consts.PurchaseState paramPurchaseState, String paramString1, int paramInt, long paramLong, String paramString2);
  
  public abstract void onRequestPurchaseResponse(BillingService.RequestPurchase paramRequestPurchase, Consts.ResponseCode paramResponseCode);
  
  public abstract void onRestoreTransactionsResponse(BillingService.RestoreTransactions paramRestoreTransactions, Consts.ResponseCode paramResponseCode);
  
  public void postPurchaseStateChange(final Consts.PurchaseState paramPurchaseState, final String paramString1, final int paramInt, final long paramLong, String paramString2)
  {
    this.mHandler.post(new Runnable()
    {
      public void run()
      {
        AbstractMarketListener.this.onPurchaseStateChange(paramPurchaseState, paramString1, paramInt, paramLong, this.val$developerPayload);
      }
    });
  }
  
  public void startBuyPageActivity(Activity paramActivity, PendingIntent paramPendingIntent, Intent paramIntent)
  {
    initCompatibilityLayer(paramActivity);
    if (this.mStartIntentSender != null) {
      try
      {
        this.mStartIntentSenderArgs[0] = paramPendingIntent.getIntentSender();
        this.mStartIntentSenderArgs[1] = paramIntent;
        this.mStartIntentSenderArgs[2] = Integer.valueOf(0);
        this.mStartIntentSenderArgs[3] = Integer.valueOf(0);
        this.mStartIntentSenderArgs[4] = Integer.valueOf(0);
        this.mStartIntentSender.invoke(paramActivity, this.mStartIntentSenderArgs);
        return;
      }
      catch (Exception paramActivity)
      {
        Logger.error("error starting buy page activity", paramActivity);
        return;
      }
    }
    try
    {
      paramPendingIntent.send(paramActivity, 0, paramIntent);
      return;
    }
    catch (PendingIntent.CanceledException paramActivity)
    {
      Logger.error("error starting buy page activity", paramActivity);
    }
  }
}
