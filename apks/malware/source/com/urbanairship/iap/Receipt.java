package com.urbanairship.iap;

import android.content.Context;
import android.content.SharedPreferences;
import com.urbanairship.Logger;
import com.urbanairship.UAirship;
import java.util.Map;
import org.json.JSONException;
import org.json.JSONObject;
import org.json.JSONTokener;

class Receipt
{
  private static final String RECEIPT_STORE = "com.urbanairship.iap.receipts";
  private String downloadPathString;
  private String orderId;
  private String productId;
  private Integer productRevision;
  private Long purchaseTime;
  private String signature;
  private String signedData;
  
  Receipt(Integer paramInteger, String paramString)
  {
    this(paramInteger, paramString, null, null, null, null, null);
  }
  
  Receipt(Integer paramInteger, String paramString1, String paramString2, Long paramLong, String paramString3, String paramString4)
  {
    this(paramInteger, paramString1, paramString2, paramLong, paramString3, paramString4, null);
  }
  
  Receipt(Integer paramInteger, String paramString1, String paramString2, Long paramLong, String paramString3, String paramString4, String paramString5)
  {
    this.productId = paramString1;
    this.productRevision = paramInteger;
    this.orderId = paramString2;
    this.purchaseTime = paramLong;
    this.signedData = paramString3;
    this.signature = paramString4;
    this.downloadPathString = paramString5;
  }
  
  Receipt(String paramString)
  {
    try
    {
      paramString = (JSONObject)new JSONTokener(paramString).nextValue();
      this.productId = paramString.getString("productId");
      this.productRevision = Integer.valueOf(paramString.getInt("productRevision"));
      this.orderId = paramString.optString("orderId", null);
      this.purchaseTime = Long.valueOf(paramString.optLong("purchaseTime"));
      this.signedData = paramString.optString("data", null);
      this.signature = paramString.optString("signature", null);
      this.downloadPathString = paramString.optString("downloadPathString", null);
      return;
    }
    catch (JSONException paramString)
    {
      Logger.error("Error parsing receipt");
    }
  }
  
  static boolean contains(String paramString)
  {
    return getReceiptStore().contains(paramString);
  }
  
  static Receipt fetch(String paramString)
  {
    Receipt localReceipt = null;
    Object localObject = getReceiptStore();
    try
    {
      localObject = ((SharedPreferences)localObject).getString(paramString, null);
      paramString = (String)localObject;
    }
    catch (ClassCastException localClassCastException)
    {
      for (;;)
      {
        Logger.error("receipt not found for " + paramString);
        paramString = null;
      }
    }
    if (paramString != null) {
      localReceipt = new Receipt(paramString);
    }
    return localReceipt;
  }
  
  static SharedPreferences getReceiptStore()
  {
    return UAirship.shared().getApplicationContext().getSharedPreferences("com.urbanairship.iap.receipts", 0);
  }
  
  static boolean hasReceipts()
  {
    return !getReceiptStore().getAll().isEmpty();
  }
  
  String getDownloadPathString()
  {
    return this.downloadPathString;
  }
  
  String getOrderId()
  {
    return this.orderId;
  }
  
  String getProductId()
  {
    return this.productId;
  }
  
  Integer getProductRevision()
  {
    return this.productRevision;
  }
  
  Long getPurchaseTime()
  {
    return this.purchaseTime;
  }
  
  String getSignature()
  {
    return this.signature;
  }
  
  String getSignedData()
  {
    return this.signedData;
  }
  
  /* Error */
  boolean serialize()
  {
    // Byte code:
    //   0: new 54	org/json/JSONObject
    //   3: dup
    //   4: invokespecial 166	org/json/JSONObject:<init>	()V
    //   7: astore_1
    //   8: aload_1
    //   9: ldc 60
    //   11: aload_0
    //   12: getfield 31	com/urbanairship/iap/Receipt:productRevision	Ljava/lang/Integer;
    //   15: invokevirtual 170	org/json/JSONObject:put	(Ljava/lang/String;Ljava/lang/Object;)Lorg/json/JSONObject;
    //   18: pop
    //   19: aload_1
    //   20: ldc 55
    //   22: aload_0
    //   23: getfield 29	com/urbanairship/iap/Receipt:productId	Ljava/lang/String;
    //   26: invokevirtual 170	org/json/JSONObject:put	(Ljava/lang/String;Ljava/lang/Object;)Lorg/json/JSONObject;
    //   29: pop
    //   30: aload_0
    //   31: getfield 33	com/urbanairship/iap/Receipt:orderId	Ljava/lang/String;
    //   34: ifnull +14 -> 48
    //   37: aload_1
    //   38: ldc 71
    //   40: aload_0
    //   41: getfield 33	com/urbanairship/iap/Receipt:orderId	Ljava/lang/String;
    //   44: invokevirtual 170	org/json/JSONObject:put	(Ljava/lang/String;Ljava/lang/Object;)Lorg/json/JSONObject;
    //   47: pop
    //   48: aload_0
    //   49: getfield 35	com/urbanairship/iap/Receipt:purchaseTime	Ljava/lang/Long;
    //   52: ifnull +14 -> 66
    //   55: aload_1
    //   56: ldc 76
    //   58: aload_0
    //   59: getfield 35	com/urbanairship/iap/Receipt:purchaseTime	Ljava/lang/Long;
    //   62: invokevirtual 170	org/json/JSONObject:put	(Ljava/lang/String;Ljava/lang/Object;)Lorg/json/JSONObject;
    //   65: pop
    //   66: aload_0
    //   67: getfield 37	com/urbanairship/iap/Receipt:signedData	Ljava/lang/String;
    //   70: ifnull +14 -> 84
    //   73: aload_1
    //   74: ldc 87
    //   76: aload_0
    //   77: getfield 37	com/urbanairship/iap/Receipt:signedData	Ljava/lang/String;
    //   80: invokevirtual 170	org/json/JSONObject:put	(Ljava/lang/String;Ljava/lang/Object;)Lorg/json/JSONObject;
    //   83: pop
    //   84: aload_0
    //   85: getfield 39	com/urbanairship/iap/Receipt:signature	Ljava/lang/String;
    //   88: ifnull +14 -> 102
    //   91: aload_1
    //   92: ldc 88
    //   94: aload_0
    //   95: getfield 39	com/urbanairship/iap/Receipt:signature	Ljava/lang/String;
    //   98: invokevirtual 170	org/json/JSONObject:put	(Ljava/lang/String;Ljava/lang/Object;)Lorg/json/JSONObject;
    //   101: pop
    //   102: aload_0
    //   103: getfield 41	com/urbanairship/iap/Receipt:downloadPathString	Ljava/lang/String;
    //   106: ifnull +14 -> 120
    //   109: aload_1
    //   110: ldc 89
    //   112: aload_0
    //   113: getfield 41	com/urbanairship/iap/Receipt:downloadPathString	Ljava/lang/String;
    //   116: invokevirtual 170	org/json/JSONObject:put	(Ljava/lang/String;Ljava/lang/Object;)Lorg/json/JSONObject;
    //   119: pop
    //   120: invokestatic 102	com/urbanairship/iap/Receipt:getReceiptStore	()Landroid/content/SharedPreferences;
    //   123: invokeinterface 174 1 0
    //   128: astore_2
    //   129: aload_2
    //   130: aload_0
    //   131: getfield 29	com/urbanairship/iap/Receipt:productId	Ljava/lang/String;
    //   134: aload_1
    //   135: invokevirtual 175	org/json/JSONObject:toString	()Ljava/lang/String;
    //   138: invokeinterface 181 3 0
    //   143: pop
    //   144: aload_2
    //   145: invokeinterface 184 1 0
    //   150: pop
    //   151: iconst_1
    //   152: ireturn
    //   153: astore_1
    //   154: ldc -70
    //   156: invokestatic 96	com/urbanairship/Logger:error	(Ljava/lang/String;)V
    //   159: iconst_0
    //   160: ireturn
    //   161: astore_1
    //   162: ldc -68
    //   164: invokestatic 96	com/urbanairship/Logger:error	(Ljava/lang/String;)V
    //   167: iconst_0
    //   168: ireturn
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	169	0	this	Receipt
    //   7	128	1	localJSONObject	JSONObject
    //   153	1	1	localJSONException	JSONException
    //   161	1	1	localException	Exception
    //   128	17	2	localEditor	android.content.SharedPreferences.Editor
    // Exception table:
    //   from	to	target	type
    //   8	48	153	org/json/JSONException
    //   48	66	153	org/json/JSONException
    //   66	84	153	org/json/JSONException
    //   84	102	153	org/json/JSONException
    //   102	120	153	org/json/JSONException
    //   120	151	161	java/lang/Exception
  }
  
  void setDownloadPathString(String paramString)
  {
    this.downloadPathString = paramString;
  }
  
  void setProductRevision(Integer paramInteger)
  {
    this.productRevision = paramInteger;
  }
}
