package com.chartboost.sdk;

import android.content.Context;
import android.content.Intent;
import android.net.Uri;
import android.util.Log;
import android.view.ViewManager;
import android.webkit.WebView;
import android.webkit.WebViewClient;
import android.widget.RelativeLayout;
import java.net.URI;
import java.net.URLDecoder;
import org.json.JSONObject;

public class CBWebViewClient
  extends WebViewClient
{
  public static final String TAG = "ChartBoost AdView";
  private ChartBoost cb = null;
  private RelativeLayout cbContainer;
  private Context context = null;
  private CBDialogActivity dialogActivity = null;
  
  public CBWebViewClient(CBDialogActivity paramCBDialogActivity)
  {
    this.dialogActivity = paramCBDialogActivity;
    this.context = paramCBDialogActivity;
    this.cbContainer = paramCBDialogActivity.cbContainer;
    this.cb = ChartBoost.getSharedChartBoost(paramCBDialogActivity);
  }
  
  private void closeView()
  {
    if (this.cbContainer == null) {
      return;
    }
    ViewManager localViewManager = (ViewManager)this.cbContainer.getParent();
    if (localViewManager != null) {
      localViewManager.removeView(this.cbContainer);
    }
    this.cbContainer = null;
    this.dialogActivity.close();
  }
  
  private void handleChartBoostRequestForInterstitial(String paramString)
  {
    Log.w("cb", "handleChartBoostRequestForInterstitial");
    paramString = paramString.split("/");
    Object localObject = paramString[2];
    Log.w("cb", "function: " + (String)localObject);
    if (((String)localObject).equals("close"))
    {
      if (this.cb.getDelegate() != null) {
        this.cb.getDelegate().didCloseInterstitial(this.dialogActivity.webView);
      }
      closeView();
    }
    while (!((String)localObject).equals("link")) {
      return;
    }
    if (this.cb.getDelegate() != null) {
      this.cb.getDelegate().didClickInterstitial(this.dialogActivity.webView);
    }
    try
    {
      localObject = new CBAPIRequest(this.context, "api", "click");
      ((CBAPIRequest)localObject).appendDeviceInfoParams();
      ((CBAPIRequest)localObject).appendBodyArgument("to", this.dialogActivity.webView.getResponseContext().getString("to"));
      ((CBAPIRequest)localObject).appendBodyArgument("cgn", this.dialogActivity.webView.getResponseContext().getString("cgn"));
      ((CBAPIRequest)localObject).appendBodyArgument("creative", this.dialogActivity.webView.getResponseContext().getString("creative"));
      ((CBAPIRequest)localObject).sign(this.cb.getAppId(), this.cb.getAppSignature());
      Log.w("cb", "decoding: " + paramString[3]);
      RegisterClickConnection localRegisterClickConnection = new RegisterClickConnection(this.context);
      localRegisterClickConnection.shouldShowProgress = true;
      localRegisterClickConnection.data = URLDecoder.decode(paramString[3], "UTF-8");
      localRegisterClickConnection.execute(new CBAPIRequest[] { localObject });
      Log.w("cb", "sending request click request");
      return;
    }
    catch (Exception paramString)
    {
      paramString.printStackTrace();
    }
  }
  
  /* Error */
  private void handleChartBoostRequestForMoreApps(String paramString)
  {
    // Byte code:
    //   0: aload_1
    //   1: ldc 83
    //   3: invokevirtual 89	java/lang/String:split	(Ljava/lang/String;)[Ljava/lang/String;
    //   6: astore_1
    //   7: aload_1
    //   8: iconst_2
    //   9: aaload
    //   10: astore_2
    //   11: aload_2
    //   12: ldc 104
    //   14: invokevirtual 108	java/lang/String:equals	(Ljava/lang/Object;)Z
    //   17: ifeq +35 -> 52
    //   20: aload_0
    //   21: getfield 30	com/chartboost/sdk/CBWebViewClient:cb	Lcom/chartboost/sdk/ChartBoost;
    //   24: invokevirtual 112	com/chartboost/sdk/ChartBoost:getDelegate	()Lcom/chartboost/sdk/ChartBoostDelegate;
    //   27: ifnull +20 -> 47
    //   30: aload_0
    //   31: getfield 30	com/chartboost/sdk/CBWebViewClient:cb	Lcom/chartboost/sdk/ChartBoost;
    //   34: invokevirtual 112	com/chartboost/sdk/ChartBoost:getDelegate	()Lcom/chartboost/sdk/ChartBoostDelegate;
    //   37: aload_0
    //   38: getfield 28	com/chartboost/sdk/CBWebViewClient:dialogActivity	Lcom/chartboost/sdk/CBDialogActivity;
    //   41: getfield 116	com/chartboost/sdk/CBDialogActivity:webView	Lcom/chartboost/sdk/CBWebView;
    //   44: invokevirtual 205	com/chartboost/sdk/ChartBoostDelegate:didCloseMoreApps	(Landroid/view/View;)V
    //   47: aload_0
    //   48: invokespecial 55	com/chartboost/sdk/CBWebViewClient:closeView	()V
    //   51: return
    //   52: aload_2
    //   53: ldc 123
    //   55: invokevirtual 108	java/lang/String:equals	(Ljava/lang/Object;)Z
    //   58: ifeq -7 -> 51
    //   61: aload_0
    //   62: getfield 30	com/chartboost/sdk/CBWebViewClient:cb	Lcom/chartboost/sdk/ChartBoost;
    //   65: invokevirtual 112	com/chartboost/sdk/ChartBoost:getDelegate	()Lcom/chartboost/sdk/ChartBoostDelegate;
    //   68: ifnull +20 -> 88
    //   71: aload_0
    //   72: getfield 30	com/chartboost/sdk/CBWebViewClient:cb	Lcom/chartboost/sdk/ChartBoost;
    //   75: invokevirtual 112	com/chartboost/sdk/ChartBoost:getDelegate	()Lcom/chartboost/sdk/ChartBoostDelegate;
    //   78: aload_0
    //   79: getfield 28	com/chartboost/sdk/CBWebViewClient:dialogActivity	Lcom/chartboost/sdk/CBDialogActivity;
    //   82: getfield 116	com/chartboost/sdk/CBDialogActivity:webView	Lcom/chartboost/sdk/CBWebView;
    //   85: invokevirtual 208	com/chartboost/sdk/ChartBoostDelegate:didClickMoreApps	(Landroid/view/View;)V
    //   88: new 128	com/chartboost/sdk/CBAPIRequest
    //   91: dup
    //   92: aload_0
    //   93: getfield 26	com/chartboost/sdk/CBWebViewClient:context	Landroid/content/Context;
    //   96: ldc -126
    //   98: ldc -124
    //   100: invokespecial 135	com/chartboost/sdk/CBAPIRequest:<init>	(Landroid/content/Context;Ljava/lang/String;Ljava/lang/String;)V
    //   103: astore_2
    //   104: aload_2
    //   105: invokevirtual 138	com/chartboost/sdk/CBAPIRequest:appendDeviceInfoParams	()V
    //   108: new 148	org/json/JSONObject
    //   111: dup
    //   112: new 210	org/json/JSONTokener
    //   115: dup
    //   116: aload_1
    //   117: iconst_4
    //   118: aaload
    //   119: ldc -76
    //   121: invokestatic 186	java/net/URLDecoder:decode	(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
    //   124: invokespecial 211	org/json/JSONTokener:<init>	(Ljava/lang/String;)V
    //   127: invokespecial 214	org/json/JSONObject:<init>	(Lorg/json/JSONTokener;)V
    //   130: astore_3
    //   131: aload_2
    //   132: ldc -116
    //   134: aload_3
    //   135: ldc -116
    //   137: invokevirtual 152	org/json/JSONObject:getString	(Ljava/lang/String;)Ljava/lang/String;
    //   140: invokevirtual 156	com/chartboost/sdk/CBAPIRequest:appendBodyArgument	(Ljava/lang/String;Ljava/lang/String;)V
    //   143: aload_2
    //   144: ldc -98
    //   146: aload_3
    //   147: ldc -98
    //   149: invokevirtual 152	org/json/JSONObject:getString	(Ljava/lang/String;)Ljava/lang/String;
    //   152: invokevirtual 156	com/chartboost/sdk/CBAPIRequest:appendBodyArgument	(Ljava/lang/String;Ljava/lang/String;)V
    //   155: aload_2
    //   156: ldc -96
    //   158: aload_3
    //   159: ldc -96
    //   161: invokevirtual 152	org/json/JSONObject:getString	(Ljava/lang/String;)Ljava/lang/String;
    //   164: invokevirtual 156	com/chartboost/sdk/CBAPIRequest:appendBodyArgument	(Ljava/lang/String;Ljava/lang/String;)V
    //   167: aload_2
    //   168: ldc -40
    //   170: aload_3
    //   171: ldc -40
    //   173: invokevirtual 152	org/json/JSONObject:getString	(Ljava/lang/String;)Ljava/lang/String;
    //   176: invokevirtual 156	com/chartboost/sdk/CBAPIRequest:appendBodyArgument	(Ljava/lang/String;Ljava/lang/String;)V
    //   179: aload_2
    //   180: ldc -38
    //   182: aload_3
    //   183: ldc -38
    //   185: invokevirtual 152	org/json/JSONObject:getString	(Ljava/lang/String;)Ljava/lang/String;
    //   188: invokevirtual 156	com/chartboost/sdk/CBAPIRequest:appendBodyArgument	(Ljava/lang/String;Ljava/lang/String;)V
    //   191: aload_2
    //   192: aload_0
    //   193: getfield 30	com/chartboost/sdk/CBWebViewClient:cb	Lcom/chartboost/sdk/ChartBoost;
    //   196: invokevirtual 163	com/chartboost/sdk/ChartBoost:getAppId	()Ljava/lang/String;
    //   199: aload_0
    //   200: getfield 30	com/chartboost/sdk/CBWebViewClient:cb	Lcom/chartboost/sdk/ChartBoost;
    //   203: invokevirtual 166	com/chartboost/sdk/ChartBoost:getAppSignature	()Ljava/lang/String;
    //   206: invokevirtual 169	com/chartboost/sdk/CBAPIRequest:sign	(Ljava/lang/String;Ljava/lang/String;)V
    //   209: new 6	com/chartboost/sdk/CBWebViewClient$RegisterClickConnection
    //   212: dup
    //   213: aload_0
    //   214: aload_0
    //   215: getfield 26	com/chartboost/sdk/CBWebViewClient:context	Landroid/content/Context;
    //   218: invokespecial 174	com/chartboost/sdk/CBWebViewClient$RegisterClickConnection:<init>	(Lcom/chartboost/sdk/CBWebViewClient;Landroid/content/Context;)V
    //   221: astore_3
    //   222: aload_3
    //   223: iconst_1
    //   224: putfield 178	com/chartboost/sdk/CBWebViewClient$RegisterClickConnection:shouldShowProgress	Z
    //   227: aload_3
    //   228: aload_1
    //   229: iconst_3
    //   230: aaload
    //   231: ldc -76
    //   233: invokestatic 186	java/net/URLDecoder:decode	(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
    //   236: putfield 190	com/chartboost/sdk/CBWebViewClient$RegisterClickConnection:data	Ljava/lang/Object;
    //   239: aload_3
    //   240: iconst_1
    //   241: anewarray 128	com/chartboost/sdk/CBAPIRequest
    //   244: dup
    //   245: iconst_0
    //   246: aload_2
    //   247: aastore
    //   248: invokevirtual 194	com/chartboost/sdk/CBWebViewClient$RegisterClickConnection:execute	([Ljava/lang/Object;)Landroid/os/AsyncTask;
    //   251: pop
    //   252: return
    //   253: astore_1
    //   254: aload_1
    //   255: invokevirtual 199	java/lang/Exception:printStackTrace	()V
    //   258: return
    //   259: astore_3
    //   260: goto -69 -> 191
    //   263: astore 4
    //   265: goto -86 -> 179
    //   268: astore 4
    //   270: goto -103 -> 167
    //   273: astore 4
    //   275: goto -120 -> 155
    //   278: astore 4
    //   280: goto -137 -> 143
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	283	0	this	CBWebViewClient
    //   0	283	1	paramString	String
    //   10	237	2	localCBAPIRequest	CBAPIRequest
    //   130	110	3	localObject	Object
    //   259	1	3	localJSONException1	org.json.JSONException
    //   263	1	4	localJSONException2	org.json.JSONException
    //   268	1	4	localJSONException3	org.json.JSONException
    //   273	1	4	localJSONException4	org.json.JSONException
    //   278	1	4	localJSONException5	org.json.JSONException
    // Exception table:
    //   from	to	target	type
    //   88	131	253	java/lang/Exception
    //   131	143	253	java/lang/Exception
    //   143	155	253	java/lang/Exception
    //   155	167	253	java/lang/Exception
    //   167	179	253	java/lang/Exception
    //   179	191	253	java/lang/Exception
    //   191	252	253	java/lang/Exception
    //   179	191	259	org/json/JSONException
    //   167	179	263	org/json/JSONException
    //   155	167	268	org/json/JSONException
    //   143	155	273	org/json/JSONException
    //   131	143	278	org/json/JSONException
  }
  
  private void openUrl(String paramString)
  {
    Intent localIntent = new Intent("android.intent.action.VIEW");
    localIntent.setData(Uri.parse(paramString));
    Log.i("ChartBoost AdView", "Sideloading URL: " + paramString);
    this.context.startActivity(localIntent);
  }
  
  protected void handleChartBoostRequest(String paramString)
  {
    Log.i("ChartBoost AdView", "Handling chartboost:// request: " + paramString);
    if (this.dialogActivity.webView.getType() == CBWebView.CBViewType.CBViewTypeInterstitial) {
      handleChartBoostRequestForInterstitial(paramString);
    }
    while (this.dialogActivity.webView.getType() != CBWebView.CBViewType.CBViewTypeMoreApps) {
      return;
    }
    handleChartBoostRequestForMoreApps(paramString);
  }
  
  public void onPageFinished(WebView paramWebView, String paramString)
  {
    super.onPageFinished(paramWebView, paramString);
    paramWebView = (CBWebView)paramWebView;
    if (paramWebView.getState() == CBWebView.CBViewState.CBViewStateWaitingForDisplay)
    {
      paramWebView.setState(CBWebView.CBViewState.CBViewStateOther);
      if (paramWebView.getType() != CBWebView.CBViewType.CBViewTypeInterstitial) {
        break label113;
      }
      if ((this.cb.getDelegate() != null) && (!this.cb.getDelegate().shouldDisplayInterstitial(paramWebView))) {
        closeView();
      }
    }
    else
    {
      return;
    }
    if (this.cbContainer != null)
    {
      Log.i("ChartBoost AdView", "Got an interstitial, adding to view!");
      this.cbContainer.removeAllViews();
      this.cbContainer.addView(paramWebView);
      this.cbContainer.invalidate();
    }
    for (;;)
    {
      paramWebView.setState(CBWebView.CBViewState.CBViewStateDisplayedByDefaultController);
      return;
      label113:
      if (paramWebView.getType() == CBWebView.CBViewType.CBViewTypeMoreApps)
      {
        if ((this.cb.getDelegate() != null) && (!this.cb.getDelegate().shouldDisplayMoreApps(paramWebView)))
        {
          closeView();
          return;
        }
        if (this.cbContainer != null)
        {
          Log.i("ChartBoost AdView", "Got More Apps, adding to view!");
          this.cbContainer.removeAllViews();
          this.cbContainer.addView(paramWebView);
          this.cbContainer.invalidate();
        }
      }
    }
  }
  
  public void onReceivedError(WebView paramWebView, int paramInt, String paramString1, String paramString2)
  {
    super.onReceivedError(paramWebView, paramInt, paramString1, paramString2);
  }
  
  public boolean shouldOverrideUrlLoading(WebView paramWebView, String paramString)
  {
    try
    {
      paramWebView = new URI(paramString);
      if (paramWebView.getScheme().equals("file")) {
        return false;
      }
      if (paramWebView.getScheme().equals("chartboost"))
      {
        handleChartBoostRequest(paramString);
        return true;
      }
    }
    catch (Exception paramWebView) {}
    return false;
  }
  
  private class RegisterClickConnection
    extends CBAPIConnection
  {
    public RegisterClickConnection(Context paramContext)
    {
      super();
    }
    
    protected void onPostExecute(JSONObject paramJSONObject)
    {
      try
      {
        validateJson(paramJSONObject);
        if ((this.data != null) && ((this.data instanceof String))) {
          CBWebViewClient.this.openUrl((String)this.data);
        }
        super.onPostExecute(paramJSONObject);
      }
      catch (Exception localException)
      {
        for (;;)
        {
          localException = localException;
          super.onPostExecute(paramJSONObject);
        }
      }
      finally
      {
        localObject = finally;
        super.onPostExecute(paramJSONObject);
        throw localObject;
      }
      if (CBWebViewClient.this.dialogActivity.webView.getState() == CBWebView.CBViewState.CBViewStateDisplayedByDefaultController)
      {
        Log.w("cb", "closing interstitial ad");
        CBWebViewClient.this.closeView();
      }
    }
  }
}
