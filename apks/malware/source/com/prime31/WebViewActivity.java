package com.prime31;

import android.app.Activity;
import android.app.ProgressDialog;
import android.content.Intent;
import android.graphics.Bitmap;
import android.os.Bundle;
import android.webkit.WebSettings;
import android.webkit.WebView;
import android.webkit.WebViewClient;

public class WebViewActivity
  extends Activity
{
  private ProgressDialog _spinner;
  private WebView _webView;
  
  public WebViewActivity() {}
  
  private void setUpWebView(boolean paramBoolean)
  {
    this._webView = new WebView(this);
    this._webView.setWebViewClient(new P31WebViewClient(null));
    this._webView.getSettings().setLoadWithOverviewMode(true);
    this._webView.getSettings().setUseWideViewPort(true);
    this._webView.getSettings().setJavaScriptEnabled(true);
    this._webView.getSettings().setPluginsEnabled(true);
    this._webView.getSettings().setAllowFileAccess(true);
    this._webView.getSettings().setGeolocationEnabled(true);
    this._webView.getSettings().setSupportZoom(true);
    this._webView.getSettings().setBuiltInZoomControls(true);
    this._webView.getSettings().setSaveFormData(true);
    this._webView.getSettings().setSavePassword(true);
    this._webView.getSettings().setAppCacheEnabled(true);
    this._webView.getSettings().setDatabaseEnabled(true);
    if (paramBoolean) {
      this._webView.getSettings().setUserAgentString("Mozilla/5.0 (Linux; U; Android 2.0; en-us; Droid Build/ESD20) AppleWebKit/530.17 (KHTML, like Gecko) Version/4.0 Mobile Safari/530.17");
    }
    setContentView(this._webView);
  }
  
  public void onBackPressed()
  {
    EtceteraPlugin.instance().UnitySendMessage("EtceteraAndroidManager", "webViewCancelled", "");
    super.onBackPressed();
  }
  
  public void onCreate(Bundle paramBundle)
  {
    super.onCreate(paramBundle);
    this._spinner = new ProgressDialog(this);
    this._spinner.requestWindowFeature(1);
    this._spinner.setMessage("Loading...");
    paramBundle = getIntent().getExtras().getString("url");
    setUpWebView(paramBundle.toLowerCase().contains("twitter"));
    this._webView.loadUrl(paramBundle);
  }
  
  private class P31WebViewClient
    extends WebViewClient
  {
    private P31WebViewClient() {}
    
    public void onPageFinished(WebView paramWebView, String paramString)
    {
      super.onPageFinished(paramWebView, paramString);
      WebViewActivity.this._spinner.dismiss();
    }
    
    public void onPageStarted(WebView paramWebView, String paramString, Bitmap paramBitmap)
    {
      super.onPageStarted(paramWebView, paramString, paramBitmap);
      WebViewActivity.this._spinner.show();
    }
    
    public void onReceivedError(WebView paramWebView, int paramInt, String paramString1, String paramString2)
    {
      super.onReceivedError(paramWebView, paramInt, paramString1, paramString2);
      WebViewActivity.this._spinner.dismiss();
    }
  }
}
