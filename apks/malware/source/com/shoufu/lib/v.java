package com.shoufu.lib;

import android.content.Context;
import android.util.Log;
import java.io.InputStream;
import java.io.RandomAccessFile;
import java.net.HttpURLConnection;
import java.net.InetSocketAddress;
import java.net.Proxy.Type;
import java.net.URL;

public class v
  extends Thread
{
  private String a = "DownloadThread";
  private int b = -1;
  private int c;
  private int d;
  private int e;
  private String f;
  private String g;
  private Context h;
  private w i;
  private int j = 1;
  private boolean k = false;
  private boolean l = false;
  
  public v(int paramInt1, int paramInt2, int paramInt3, w paramW)
  {
    this.b = paramInt1;
    this.c = paramInt2;
    this.d = paramInt3;
    this.e = (paramInt2 - paramInt3 * paramInt1);
    this.f = paramW.c();
    this.g = paramW.d();
    this.h = paramW.e();
    this.i = paramW;
  }
  
  public boolean a()
  {
    return this.k;
  }
  
  public void b()
  {
    this.l = true;
  }
  
  public boolean isInterrupted()
  {
    return this.l;
  }
  
  public void run()
  {
    if (this.e < this.d) {
      for (;;)
      {
        RandomAccessFile localRandomAccessFile;
        Object localObject2;
        try
        {
          localRandomAccessFile = new RandomAccessFile(this.g, "rw");
          localRandomAccessFile.seek(this.c);
          if (!this.k)
          {
            boolean bool = this.l;
            if (!bool) {}
          }
          else
          {
            return;
          }
          m = 16384;
          try
          {
            n = ac.a(this.h);
            if (n == 3) {
              m = 491520;
            }
            localObject2 = new URL(this.f);
            if ((n != 1) && (n != 4)) {
              break label458;
            }
            Object localObject1 = (HttpURLConnection)((URL)localObject2).openConnection(new java.net.Proxy(Proxy.Type.HTTP, new InetSocketAddress(android.net.Proxy.getDefaultHost(), android.net.Proxy.getDefaultPort())));
            ((HttpURLConnection)localObject1).setRequestMethod("GET");
            ((HttpURLConnection)localObject1).setRequestProperty("X-Online-Host", ((URL)localObject2).getHost());
            ((HttpURLConnection)localObject1).setRequestProperty("Accept", "image/gif, image/jpeg, image/pjpeg, image/pjpeg, application/x-shockwave-flash, application/xaml+xml, application/vnd.ms-xpsdocument, application/x-ms-xbap, application/x-ms-application, application/vnd.ms-excel, application/vnd.ms-powerpoint, application/msword, */*");
            ((HttpURLConnection)localObject1).setRequestProperty("Accept-Language", "zh-CN");
            ((HttpURLConnection)localObject1).setRequestProperty("Referer", ((URL)localObject2).toString());
            ((HttpURLConnection)localObject1).setRequestProperty("Charset", "UTF-8");
            ((HttpURLConnection)localObject1).setRequestProperty("Range", "bytes=" + this.c + "-");
            ((HttpURLConnection)localObject1).setRequestProperty("User-Agent", "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.2; Trident/4.0; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.04506.30; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729)");
            ((HttpURLConnection)localObject1).setRequestProperty("Connection", "Keep-Alive");
            ((HttpURLConnection)localObject1).setConnectTimeout(30000);
            ((HttpURLConnection)localObject1).setReadTimeout(30000);
            localObject1 = ((HttpURLConnection)localObject1).getInputStream();
            if (this.d <= m) {
              break label471;
            }
            localObject2 = new byte[m];
            if (this.e < this.d)
            {
              n = ((InputStream)localObject1).read((byte[])localObject2, 0, m);
              if ((n != -1) && (!this.l)) {
                break label479;
              }
            }
            localRandomAccessFile.close();
            ((InputStream)localObject1).close();
            if (this.l) {
              continue;
            }
            this.k = true;
            interrupt();
          }
          catch (Exception localException1)
          {
            localException1.printStackTrace();
            this.j += 1;
            if (this.j >= 3)
            {
              this.l = true;
              this.i.b();
            }
            Log.d(this.a, "thread down error：fileName：-->" + ad.b(this.i.c()) + " threadId:-->" + this.b + " connectNum:-->" + this.j);
          }
          continue;
          HttpURLConnection localHttpURLConnection = (HttpURLConnection)((URL)localObject2).openConnection();
        }
        catch (Exception localException2)
        {
          localException2.printStackTrace();
          this.i.b();
          this.l = true;
          this.k = false;
          return;
        }
        label458:
        continue;
        label471:
        int m = this.d;
        continue;
        label479:
        localRandomAccessFile.write((byte[])localObject2, 0, n);
        this.e += n;
        this.c += n;
        this.i.a(this.b, this.c);
        this.i.a(n);
        int n = this.d;
        int i1 = this.e;
        n -= i1;
        if (n < m) {
          m = n;
        }
      }
    }
    this.l = false;
    this.k = true;
  }
}
