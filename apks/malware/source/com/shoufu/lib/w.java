package com.shoufu.lib;

import android.content.Context;
import android.os.Environment;
import android.util.Log;
import android.util.SparseIntArray;
import java.io.File;
import java.util.ArrayList;

public class w
{
  private String a = "FileDownloader";
  private v[] b;
  private int c;
  private ArrayList<SparseIntArray> d;
  private int e;
  private int f;
  private int g;
  private int h;
  private int i;
  private String j;
  private String k;
  private String l;
  private String m;
  private Context n;
  private boolean o = true;
  private String p;
  private u q;
  private t r;
  
  public w(Context paramContext, String paramString, u paramU, t paramT)
  {
    this(paramContext, paramString, null, paramU, paramT);
  }
  
  public w(Context paramContext, String paramString1, String paramString2, u paramU, t paramT)
  {
    this(paramContext, paramString1, paramString2, "download/", 3, paramU, paramT);
  }
  
  public w(Context paramContext, String paramString1, String paramString2, String paramString3, int paramInt, u paramU, t paramT)
  {
    this.n = paramContext;
    this.p = paramString1;
    if (paramString2 == null) {}
    for (this.m = "";; this.m = paramString2)
    {
      this.j = (Environment.getExternalStorageDirectory().getAbsolutePath() + File.separator + paramString3);
      this.k = ad.b(paramString1);
      this.l = (this.j + this.k);
      int i1 = paramInt;
      if (paramInt <= 0) {
        i1 = 3;
      }
      this.c = i1;
      this.q = paramU;
      this.r = paramT;
      return;
    }
  }
  
  private void f()
  {
    for (;;)
    {
      int i3;
      int i2;
      int i1;
      int i4;
      try
      {
        Log.d(this.a, this.k + "：start download");
        this.q.b(this.p, this.m, this.h, 1);
        this.g = 0;
        i3 = 0;
        i2 = 0;
        i1 = 0;
        if (i3 >= this.c)
        {
          if (i1 >= this.c) {
            break label710;
          }
          i3 = 0;
          if (i3 != 0) {
            break label868;
          }
          if (!this.o) {}
        }
        else
        {
          if (this.o) {
            break label857;
          }
          int i5 = ((SparseIntArray)this.d.get(i3)).get(i3) - this.e * i3;
          this.g += i5;
          i2 = this.h - this.e * i3;
          if (i2 < this.e)
          {
            i4 = i2;
            if (i5 < i4)
            {
              this.b[i3] = new v(i3, ((SparseIntArray)this.d.get(i3)).get(i3), this.e, this);
              this.b[i3].setPriority(10);
              this.b[i3].start();
              i4 = i1;
              i1 = i2;
              i2 = i4;
              break label869;
            }
          }
          else
          {
            i4 = this.e;
            continue;
          }
          this.b[i3] = null;
          Log.d(this.a, this.k + "：thread[" + i3 + "] is finished");
          i4 = i1 + 1;
          i1 = i2;
          i2 = i4;
          break label869;
        }
        this.f = this.g;
        Thread.sleep(1000L);
        this.i = (this.g - this.f);
        i1 = 0;
        if (i1 < this.c) {
          break label416;
        }
        i1 = 1;
      }
      catch (Exception localException)
      {
        b();
        localException.printStackTrace();
        return;
      }
      if (i3 >= this.c)
      {
        i3 = i1;
        if (this.r == null) {
          continue;
        }
        if ((this.g < this.h) && (i1 != 0))
        {
          this.r.a(this.l, this.g, this.h, this.i, true);
          i3 = i1;
          continue;
          label416:
          if ((this.b[i1] == null) || (this.b[i1].a())) {
            break label889;
          }
          i1 = 0;
          break label884;
        }
      }
      else
      {
        if ((this.b[i3] == null) || (!this.b[i3].isInterrupted())) {
          break label896;
        }
        this.o = true;
        continue;
      }
      if ((this.g >= this.h) && (i1 != 0))
      {
        if (this.m.equals(""))
        {
          this.m = d.a(this.l, "MD5");
          if (this.m == null) {
            this.m = "";
          }
        }
        this.q.b(this.p, this.m, this.h, 3);
        this.r.a(this.l, this.g, this.h, this.i, false);
        this.r.a(this.l, i2);
        Log.d(this.a, this.k + "：download finish");
        this.o = true;
        i3 = i1;
      }
      else
      {
        this.r.a(this.l, this.g, this.h, this.i, this.o);
        Log.d(this.a, this.k + "：download process：" + this.g + "/" + this.h);
        i3 = i1;
        continue;
        label710:
        if (this.m.equals(""))
        {
          this.m = d.a(this.l, "MD5");
          if (this.m == null) {
            this.m = "";
          }
        }
        this.q.b(this.p, this.m, this.h, 3);
        if (this.r != null)
        {
          this.r.a(this.l, this.g, this.h, this.i, false);
          this.r.a(this.l, this.h);
        }
        Log.d(this.a, this.k + "：download has finished");
        this.o = true;
        return;
        label857:
        i4 = i1;
        i1 = i2;
        i2 = i4;
        break label869;
        label868:
        return;
        label869:
        i3 += 1;
        i4 = i1;
        i1 = i2;
        i2 = i4;
        continue;
        label884:
        i3 = 0;
        continue;
        label889:
        i1 += 1;
        continue;
        label896:
        i3 += 1;
      }
    }
  }
  
  public void a()
  {
    new x(this).start();
  }
  
  protected void a(int paramInt)
  {
    try
    {
      this.g += paramInt;
      return;
    }
    finally
    {
      localObject = finally;
      throw localObject;
    }
  }
  
  protected void a(int paramInt1, int paramInt2)
  {
    try
    {
      ((SparseIntArray)this.d.get(paramInt1)).put(paramInt1, paramInt2);
      this.q.b(this.p, paramInt1, (SparseIntArray)this.d.get(paramInt1));
      return;
    }
    finally
    {
      localObject = finally;
      throw localObject;
    }
  }
  
  /* Error */
  public void b()
  {
    // Byte code:
    //   0: aload_0
    //   1: monitorenter
    //   2: aload_0
    //   3: iconst_1
    //   4: putfield 51	com/shoufu/lib/w:o	Z
    //   7: aload_0
    //   8: getfield 119	com/shoufu/lib/w:b	[Lcom/shoufu/lib/v;
    //   11: ifnull +13 -> 24
    //   14: iconst_0
    //   15: istore_1
    //   16: iload_1
    //   17: aload_0
    //   18: getfield 105	com/shoufu/lib/w:c	I
    //   21: if_icmplt +95 -> 116
    //   24: aload_0
    //   25: getfield 109	com/shoufu/lib/w:r	Lcom/shoufu/lib/t;
    //   28: ifnull +32 -> 60
    //   31: aload_0
    //   32: getfield 109	com/shoufu/lib/w:r	Lcom/shoufu/lib/t;
    //   35: aload_0
    //   36: getfield 103	com/shoufu/lib/w:l	Ljava/lang/String;
    //   39: aload_0
    //   40: getfield 140	com/shoufu/lib/w:g	I
    //   43: aload_0
    //   44: getfield 112	com/shoufu/lib/w:h	I
    //   47: aload_0
    //   48: getfield 182	com/shoufu/lib/w:i	I
    //   51: aload_0
    //   52: getfield 51	com/shoufu/lib/w:o	Z
    //   55: invokeinterface 187 6 0
    //   60: aload_0
    //   61: getfield 107	com/shoufu/lib/w:q	Lcom/shoufu/lib/u;
    //   64: aload_0
    //   65: getfield 55	com/shoufu/lib/w:p	Ljava/lang/String;
    //   68: aload_0
    //   69: getfield 59	com/shoufu/lib/w:m	Ljava/lang/String;
    //   72: aload_0
    //   73: getfield 112	com/shoufu/lib/w:h	I
    //   76: iconst_2
    //   77: invokeinterface 138 5 0
    //   82: pop
    //   83: aload_0
    //   84: getfield 49	com/shoufu/lib/w:a	Ljava/lang/String;
    //   87: new 61	java/lang/StringBuilder
    //   90: dup
    //   91: aload_0
    //   92: getfield 101	com/shoufu/lib/w:k	Ljava/lang/String;
    //   95: invokestatic 79	java/lang/String:valueOf	(Ljava/lang/Object;)Ljava/lang/String;
    //   98: invokespecial 82	java/lang/StringBuilder:<init>	(Ljava/lang/String;)V
    //   101: ldc -17
    //   103: invokevirtual 89	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   106: invokevirtual 92	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   109: invokestatic 133	android/util/Log:d	(Ljava/lang/String;Ljava/lang/String;)I
    //   112: pop
    //   113: aload_0
    //   114: monitorexit
    //   115: return
    //   116: aload_0
    //   117: getfield 119	com/shoufu/lib/w:b	[Lcom/shoufu/lib/v;
    //   120: iload_1
    //   121: aaload
    //   122: ifnull +12 -> 134
    //   125: aload_0
    //   126: getfield 119	com/shoufu/lib/w:b	[Lcom/shoufu/lib/v;
    //   129: iload_1
    //   130: aaload
    //   131: invokevirtual 240	com/shoufu/lib/v:b	()V
    //   134: iload_1
    //   135: iconst_1
    //   136: iadd
    //   137: istore_1
    //   138: goto -122 -> 16
    //   141: astore_2
    //   142: aload_0
    //   143: monitorexit
    //   144: aload_2
    //   145: athrow
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	146	0	this	w
    //   15	123	1	i1	int
    //   141	4	2	localObject	Object
    // Exception table:
    //   from	to	target	type
    //   2	14	141	finally
    //   16	24	141	finally
    //   24	60	141	finally
    //   60	113	141	finally
    //   116	134	141	finally
  }
  
  public String c()
  {
    return this.p;
  }
  
  public String d()
  {
    return this.l;
  }
  
  public Context e()
  {
    return this.n;
  }
}
