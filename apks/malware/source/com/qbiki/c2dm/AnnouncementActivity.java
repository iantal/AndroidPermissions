package com.qbiki.c2dm;

import android.app.Activity;
import android.content.Intent;
import android.net.ConnectivityManager;
import android.net.NetworkInfo;
import android.net.Uri;
import android.os.Bundle;
import android.os.Handler;
import android.view.View;
import android.view.View.OnClickListener;
import android.webkit.WebView;
import android.webkit.WebViewClient;
import android.widget.Button;
import android.widget.ProgressBar;
import android.widget.RelativeLayout.LayoutParams;
import android.widget.TextView;
import com.qbiki.seattleclouds.App;
import com.qbiki.util.DeviceUtil;

public class AnnouncementActivity
  extends Activity
{
  private boolean dataLoaded = false;
  private TextView mInfoText;
  private ProgressBar mProgressBar;
  private WebView mWebView;
  
  public AnnouncementActivity() {}
  
  protected void onCreate(Bundle paramBundle)
  {
    super.onCreate(paramBundle);
    int j = 0;
    paramBundle = getIntent().getExtras();
    int i = j;
    if (paramBundle != null)
    {
      i = j;
      if (paramBundle.getBoolean("noTitle"))
      {
        i = 1;
        requestWindowFeature(1);
      }
    }
    setContentView(2130903066);
    this.mProgressBar = ((ProgressBar)findViewById(2131099725));
    this.mInfoText = ((TextView)findViewById(2131099726));
    this.mWebView = ((WebView)findViewById(2131099724));
    this.mWebView.setVerticalScrollbarOverlay(true);
    this.mWebView.setWebViewClient(new WebViewClient()
    {
      public void onPageFinished(WebView paramAnonymousWebView, String paramAnonymousString)
      {
        new Handler().postDelayed(new Runnable()
        {
          public void run()
          {
            AnnouncementActivity.this.mWebView.setVisibility(0);
            AnnouncementActivity.this.mProgressBar.setVisibility(8);
          }
        }, 100L);
        super.onPageFinished(paramAnonymousWebView, paramAnonymousString);
      }
      
      public void onReceivedError(WebView paramAnonymousWebView, int paramAnonymousInt, String paramAnonymousString1, String paramAnonymousString2)
      {
        super.onReceivedError(paramAnonymousWebView, paramAnonymousInt, paramAnonymousString1, paramAnonymousString2);
        AnnouncementActivity.this.mProgressBar.setVisibility(8);
        paramAnonymousWebView = (ConnectivityManager)AnnouncementActivity.this.getSystemService("connectivity");
        if ((paramAnonymousWebView.getActiveNetworkInfo() == null) || (!paramAnonymousWebView.getActiveNetworkInfo().isConnected()))
        {
          AnnouncementActivity.this.mInfoText.setVisibility(0);
          AnnouncementActivity.this.mInfoText.setText(AnnouncementActivity.this.getString(2131362185));
          AnnouncementActivity.this.mWebView.setVisibility(8);
          return;
        }
        AnnouncementActivity.this.mWebView.setVisibility(0);
      }
      
      public boolean shouldOverrideUrlLoading(WebView paramAnonymousWebView, String paramAnonymousString)
      {
        paramAnonymousWebView = new Intent("android.intent.action.VIEW", Uri.parse(paramAnonymousString));
        AnnouncementActivity.this.startActivity(paramAnonymousWebView);
        return true;
      }
    });
    if (i != 0)
    {
      paramBundle = (RelativeLayout.LayoutParams)this.mWebView.getLayoutParams();
      paramBundle.topMargin = paramBundle.leftMargin;
      this.mWebView.setLayoutParams(paramBundle);
    }
    ((Button)findViewById(2131099727)).setOnClickListener(new View.OnClickListener()
    {
      public void onClick(View paramAnonymousView)
      {
        AnnouncementActivity.this.finish();
      }
    });
  }
  
  public void onWindowFocusChanged(boolean paramBoolean)
  {
    super.onWindowFocusChanged(paramBoolean);
    if (!this.dataLoaded)
    {
      int i = DeviceUtil.pxToDp(this, this.mWebView.getMeasuredWidth());
      this.mWebView.loadUrl("http://" + App.serverHostName + "/getpushedmessages.ashx?" + "publisherid=" + App.publisherId + "&username=" + App.username + "&appid=" + App.appId + "&maxwidth=" + i + "&limit=50");
    }
  }
}
