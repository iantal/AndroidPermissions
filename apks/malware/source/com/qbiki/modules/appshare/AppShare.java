package com.qbiki.modules.appshare;

import android.content.ActivityNotFoundException;
import android.content.Context;
import android.content.Intent;
import android.content.res.Resources;
import android.os.Bundle;
import android.text.Html;
import android.widget.Toast;
import com.facebook.android.DialogError;
import com.facebook.android.Facebook;
import com.facebook.android.Facebook.DialogListener;
import com.facebook.android.FacebookError;
import com.qbiki.seattleclouds.App;
import com.qbiki.seattleclouds.AppConfig;
import com.qbiki.seattleclouds.Page;
import com.qbiki.util.DialogUtil;
import java.net.URLEncoder;
import java.util.HashMap;
import java.util.Map;

public class AppShare
{
  public AppShare() {}
  
  private static Map<String, String> getShareInfo(String paramString)
  {
    HashMap localHashMap = new HashMap();
    paramString = (Page)App.appConfig.getPages().get(paramString);
    localHashMap.put("description", paramString.getAppDescription());
    localHashMap.put("sharelink", paramString.getAppShareLink());
    return localHashMap;
  }
  
  public static void share(Context paramContext, String paramString1, String paramString2)
  {
    if (paramString1.equalsIgnoreCase("email")) {
      shareByEmail(paramContext, paramString2);
    }
    do
    {
      return;
      if (paramString1.equalsIgnoreCase("facebook"))
      {
        shareOnFacebook(paramContext, paramString2);
        return;
      }
    } while (!paramString1.equals("apps"));
    shareViaApps(paramContext, paramString2);
  }
  
  public static void shareByEmail(Context paramContext, String paramString)
  {
    paramString = (HashMap)getShareInfo(paramString);
    if (paramString == null) {
      return;
    }
    Intent localIntent = new Intent("android.intent.action.SEND");
    localIntent.putExtra("android.intent.extra.EMAIL", new String[0]);
    localIntent.putExtra("android.intent.extra.SUBJECT", "Application " + paramContext.getResources().getString(2131361834));
    localIntent.putExtra("android.intent.extra.TEXT", Html.fromHtml((String)paramString.get("description") + new StringBuilder().append("<br /><br /><a href='").append((String)paramString.get("sharelink")).append("'>Application Link</a> ( ").append((String)paramString.get("sharelink")).append(" )").toString()));
    localIntent.setType("message/rfc822");
    try
    {
      paramContext.startActivity(Intent.createChooser(localIntent, "Choose an Email client"));
      return;
    }
    catch (ActivityNotFoundException paramString)
    {
      Toast.makeText(paramContext, "There are no email clients installed.", 0).show();
    }
  }
  
  public static void shareOnFacebook(Context paramContext, String paramString)
  {
    Object localObject1 = (Page)App.appConfig.getPages().get(paramString);
    if (localObject1 == null) {}
    HashMap localHashMap;
    do
    {
      return;
      localHashMap = (HashMap)getShareInfo(paramString);
    } while (localHashMap == null);
    localObject1 = ((Page)localObject1).getFBappid();
    if (localObject1 != null)
    {
      paramString = (String)localObject1;
      if (((String)localObject1).length() != 0) {}
    }
    else
    {
      paramString = App.appConfig.getFacebookAppID();
    }
    localObject1 = new Facebook(paramString);
    paramString = (String)localHashMap.get("sharelink");
    Object localObject2 = paramString.split("=");
    if (localObject2.length == 2) {
      paramString = localObject2[0] + "=" + URLEncoder.encode(localObject2[1]);
    }
    localObject2 = new Bundle();
    ((Bundle)localObject2).putString("name", paramContext.getResources().getString(2131361834));
    ((Bundle)localObject2).putString("description", (String)localHashMap.get("description"));
    ((Bundle)localObject2).putString("link", paramString);
    ((Facebook)localObject1).dialog(paramContext, "stream.publish", (Bundle)localObject2, new Facebook.DialogListener()
    {
      public void onCancel() {}
      
      public void onComplete(Bundle paramAnonymousBundle)
      {
        if (paramAnonymousBundle.getString("post_id") != null) {
          DialogUtil.showAlert(this.val$context, 2131362171, 2131362174);
        }
      }
      
      public void onError(DialogError paramAnonymousDialogError)
      {
        DialogUtil.showAlert(this.val$context, 2131362172, 2131362173);
      }
      
      public void onFacebookError(FacebookError paramAnonymousFacebookError)
      {
        DialogUtil.showAlert(this.val$context, 2131362172, 2131362173);
      }
    });
  }
  
  public static void shareViaApps(Context paramContext, String paramString)
  {
    Object localObject = (HashMap)getShareInfo(paramString);
    if (localObject == null) {
      return;
    }
    paramString = "Application " + paramContext.getResources().getString(2131361834);
    localObject = (String)((HashMap)localObject).get("description") + "\n\nApplication Link: " + (String)((HashMap)localObject).get("sharelink");
    Intent localIntent = new Intent("android.intent.action.SEND");
    localIntent.setType("text/plain");
    localIntent.addFlags(524288);
    localIntent.putExtra("android.intent.extra.SUBJECT", paramString);
    localIntent.putExtra("android.intent.extra.TEXT", (String)localObject);
    paramContext.startActivity(Intent.createChooser(localIntent, "How do you want to share?"));
  }
}
