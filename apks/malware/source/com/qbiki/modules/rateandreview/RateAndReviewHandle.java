package com.qbiki.modules.rateandreview;

import android.app.Activity;
import android.os.Bundle;
import android.util.Log;
import com.qbiki.seattleclouds.App;
import com.qbiki.seattleclouds.FragmentInfo;
import com.qbiki.seattleclouds.Page;
import com.qbiki.util.DataUtil;
import com.qbiki.util.HTTPUtil;
import java.io.IOException;

public class RateAndReviewHandle
{
  private static final String TAG = null;
  private static RateAndReviewHandle instance;
  
  private RateAndReviewHandle() {}
  
  public static RateAndReviewHandle getInstance()
  {
    try
    {
      if (instance == null) {
        instance = new RateAndReviewHandle();
      }
      RateAndReviewHandle localRateAndReviewHandle = instance;
      return localRateAndReviewHandle;
    }
    finally {}
  }
  
  private String getStarStr(int paramInt1, int paramInt2)
  {
    if (paramInt1 > paramInt2) {
      return "star.png";
    }
    return "stargrey.png";
  }
  
  public String generateRateForPage(String paramString)
  {
    Object localObject = "";
    int k = 0;
    int m = 0;
    String str = "http://" + App.serverHostName + "/getpagerate.ashx?username=" + App.username + "&appid=" + App.appId + "&pageid=" + paramString;
    try
    {
      str = HTTPUtil.performGetRequest(str);
      localObject = str;
    }
    catch (IOException localIOException1)
    {
      for (;;)
      {
        int j;
        int i;
        Log.e(TAG, localIOException1.getMessage());
      }
    }
    j = m;
    i = k;
    if (((String)localObject).startsWith("OK"))
    {
      localObject = ((String)localObject).substring(2).split(":");
      j = m;
      i = k;
      if (localObject.length == 3)
      {
        i = Integer.parseInt(localObject[0]);
        j = Integer.parseInt(localObject[2]);
      }
    }
    localObject = "";
    try
    {
      str = DataUtil.readString(App.getResourceStream(paramString));
      localObject = str;
    }
    catch (IOException localIOException2)
    {
      for (;;)
      {
        Log.e(TAG, "Error getting rawHtml");
      }
    }
    return ((String)localObject).replace("[%rate%]", "<div style='width:110px;'><a href='ratings://" + paramString + "' style='line-height:16px;'>" + "<img src='" + getStarStr(i, 0) + "'/><img src='" + getStarStr(i, 1) + "'/><img src='" + getStarStr(i, 2) + "'/><img src='" + getStarStr(i, 3) + "'/><img src='" + getStarStr(i, 4) + "'/></a><br>" + "<a href='ratings://" + paramString + "' style='line-height:16px;text-decoration:underline;'>" + "<font size='2' face='helvetica'> " + j + " comment(s)</font></a></div>");
  }
  
  public void showRatingView(Activity paramActivity, Page paramPage)
  {
    Bundle localBundle = new Bundle();
    localBundle.putString("pageid", paramPage.getId());
    localBundle.putString("fb_id", paramPage.getFBappid());
    paramActivity.startActivity(App.getPageIntent(new FragmentInfo(RateAndReviewFragment.class.getName(), localBundle), paramActivity));
  }
}
