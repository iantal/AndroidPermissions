package com.qbiki.modules.search;

import android.app.Activity;
import android.app.SearchManager;
import android.os.Bundle;
import android.support.v4.app.FragmentActivity;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.view.inputmethod.InputMethodManager;
import android.widget.ArrayAdapter;
import android.widget.ListView;
import android.widget.TextView;
import com.actionbarsherlock.view.Menu;
import com.actionbarsherlock.view.MenuInflater;
import com.actionbarsherlock.view.MenuItem;
import com.actionbarsherlock.widget.SearchView;
import com.actionbarsherlock.widget.SearchView.OnQueryTextListener;
import com.qbiki.seattleclouds.App;
import com.qbiki.seattleclouds.SCListFragment;
import com.qbiki.util.DeviceUtil;
import java.util.Set;

public class SearchFragment
  extends SCListFragment
  implements SearchView.OnQueryTextListener
{
  public static final String ARG_INDEX_FILE_NAME = "ARG_INDEX_FILE_NAME";
  public static final String ARG_USE_ACTIVITY_SEARCH = "ARG_USE_ACTIVITY_SEARCH";
  public static final String DEFAULT_INDEX_FILE_NAME = "indexpage.plist";
  private static final String TAG = "SearchFragment";
  private boolean LOGV = false;
  private boolean mFocusSearchView = true;
  private String mIndexFileName;
  private ArrayAdapter<String> mListAdapter;
  private SearchView mSearchView;
  
  public SearchFragment() {}
  
  /* Error */
  private Set<String> doSearch(String paramString)
  {
    // Byte code:
    //   0: new 45	java/util/HashSet
    //   3: dup
    //   4: aload_1
    //   5: invokestatic 51	java/util/Locale:getDefault	()Ljava/util/Locale;
    //   8: invokevirtual 57	java/lang/String:toLowerCase	(Ljava/util/Locale;)Ljava/lang/String;
    //   11: invokevirtual 61	java/lang/String:trim	()Ljava/lang/String;
    //   14: ldc 63
    //   16: invokevirtual 67	java/lang/String:split	(Ljava/lang/String;)[Ljava/lang/String;
    //   19: invokestatic 73	java/util/Arrays:asList	([Ljava/lang/Object;)Ljava/util/List;
    //   22: invokespecial 76	java/util/HashSet:<init>	(Ljava/util/Collection;)V
    //   25: astore 12
    //   27: aload_0
    //   28: getfield 32	com/qbiki/modules/search/SearchFragment:LOGV	Z
    //   31: ifeq +29 -> 60
    //   34: ldc 17
    //   36: new 78	java/lang/StringBuilder
    //   39: dup
    //   40: invokespecial 79	java/lang/StringBuilder:<init>	()V
    //   43: ldc 81
    //   45: invokevirtual 85	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   48: aload 12
    //   50: invokevirtual 88	java/lang/StringBuilder:append	(Ljava/lang/Object;)Ljava/lang/StringBuilder;
    //   53: invokevirtual 91	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   56: invokestatic 97	android/util/Log:v	(Ljava/lang/String;Ljava/lang/String;)I
    //   59: pop
    //   60: new 99	java/util/TreeSet
    //   63: dup
    //   64: invokespecial 100	java/util/TreeSet:<init>	()V
    //   67: astore 11
    //   69: aload 12
    //   71: invokeinterface 106 1 0
    //   76: ifeq +6 -> 82
    //   79: aload 11
    //   81: areturn
    //   82: ldc 108
    //   84: astore 10
    //   86: ldc 108
    //   88: astore 9
    //   90: iconst_0
    //   91: istore 7
    //   93: iconst_0
    //   94: istore 8
    //   96: iconst_0
    //   97: istore_2
    //   98: iconst_0
    //   99: istore 6
    //   101: invokestatic 114	android/util/Xml:newPullParser	()Lorg/xmlpull/v1/XmlPullParser;
    //   104: astore 13
    //   106: iload 6
    //   108: istore_3
    //   109: iload 7
    //   111: istore 4
    //   113: iload 8
    //   115: istore 5
    //   117: aload 13
    //   119: aload_0
    //   120: getfield 116	com/qbiki/modules/search/SearchFragment:mIndexFileName	Ljava/lang/String;
    //   123: invokestatic 122	com/qbiki/seattleclouds/App:getResourceStreamWithExceptions	(Ljava/lang/String;)Ljava/io/InputStream;
    //   126: aconst_null
    //   127: invokeinterface 128 3 0
    //   132: iload 6
    //   134: istore_3
    //   135: iload 7
    //   137: istore 4
    //   139: iload 8
    //   141: istore 5
    //   143: aload 13
    //   145: invokeinterface 132 1 0
    //   150: istore 6
    //   152: aconst_null
    //   153: astore_1
    //   154: iload 6
    //   156: istore_3
    //   157: goto +353 -> 510
    //   160: iload_2
    //   161: istore_3
    //   162: iload_2
    //   163: istore 4
    //   165: iload_2
    //   166: istore 5
    //   168: aload 13
    //   170: invokeinterface 135 1 0
    //   175: istore 6
    //   177: iload 6
    //   179: istore_3
    //   180: goto +330 -> 510
    //   183: goto -23 -> 160
    //   186: aload 13
    //   188: invokeinterface 138 1 0
    //   193: astore 14
    //   195: aload 14
    //   197: ldc -116
    //   199: invokevirtual 144	java/lang/String:equalsIgnoreCase	(Ljava/lang/String;)Z
    //   202: ifeq +6 -> 208
    //   205: goto -45 -> 160
    //   208: aload 14
    //   210: ldc -110
    //   212: invokevirtual 144	java/lang/String:equalsIgnoreCase	(Ljava/lang/String;)Z
    //   215: ifeq +341 -> 556
    //   218: aload 12
    //   220: aload 10
    //   222: invokeinterface 150 2 0
    //   227: ifne +11 -> 238
    //   230: aload 13
    //   232: invokestatic 156	com/qbiki/util/XmlPullUtil:skipSubTree	(Lorg/xmlpull/v1/XmlPullParser;)V
    //   235: goto -75 -> 160
    //   238: aload 12
    //   240: aload 10
    //   242: invokeinterface 159 2 0
    //   247: pop
    //   248: new 45	java/util/HashSet
    //   251: dup
    //   252: invokespecial 160	java/util/HashSet:<init>	()V
    //   255: astore_1
    //   256: goto -96 -> 160
    //   259: aload 13
    //   261: invokeinterface 163 1 0
    //   266: astore 9
    //   268: goto -108 -> 160
    //   271: aload 13
    //   273: invokeinterface 138 1 0
    //   278: astore 14
    //   280: aload 14
    //   282: ldc -116
    //   284: invokevirtual 144	java/lang/String:equalsIgnoreCase	(Ljava/lang/String;)Z
    //   287: ifeq +10 -> 297
    //   290: aload 9
    //   292: astore 10
    //   294: goto -134 -> 160
    //   297: aload 14
    //   299: ldc -110
    //   301: invokevirtual 144	java/lang/String:equalsIgnoreCase	(Ljava/lang/String;)Z
    //   304: ifeq +90 -> 394
    //   307: aload 11
    //   309: invokeinterface 166 1 0
    //   314: ifne +27 -> 341
    //   317: aload 11
    //   319: aload_1
    //   320: invokeinterface 170 2 0
    //   325: pop
    //   326: aload 12
    //   328: invokeinterface 106 1 0
    //   333: ifeq +223 -> 556
    //   336: iconst_1
    //   337: istore_2
    //   338: goto -178 -> 160
    //   341: aload 11
    //   343: aload_1
    //   344: invokeinterface 173 2 0
    //   349: pop
    //   350: goto -24 -> 326
    //   353: astore_1
    //   354: ldc 17
    //   356: new 78	java/lang/StringBuilder
    //   359: dup
    //   360: invokespecial 79	java/lang/StringBuilder:<init>	()V
    //   363: ldc -81
    //   365: invokevirtual 85	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   368: aload_1
    //   369: invokevirtual 88	java/lang/StringBuilder:append	(Ljava/lang/Object;)Ljava/lang/StringBuilder;
    //   372: invokevirtual 91	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   375: aload_1
    //   376: invokestatic 179	android/util/Log:e	(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
    //   379: pop
    //   380: iload_2
    //   381: ifne -302 -> 79
    //   384: aload 11
    //   386: invokeinterface 182 1 0
    //   391: aload 11
    //   393: areturn
    //   394: aload 14
    //   396: ldc -72
    //   398: invokevirtual 144	java/lang/String:equalsIgnoreCase	(Ljava/lang/String;)Z
    //   401: ifeq +155 -> 556
    //   404: aload_1
    //   405: aload 9
    //   407: invokeinterface 187 2 0
    //   412: pop
    //   413: goto +143 -> 556
    //   416: astore_1
    //   417: ldc 17
    //   419: new 78	java/lang/StringBuilder
    //   422: dup
    //   423: invokespecial 79	java/lang/StringBuilder:<init>	()V
    //   426: ldc -81
    //   428: invokevirtual 85	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   431: aload_1
    //   432: invokevirtual 88	java/lang/StringBuilder:append	(Ljava/lang/Object;)Ljava/lang/StringBuilder;
    //   435: invokevirtual 91	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   438: aload_1
    //   439: invokestatic 179	android/util/Log:e	(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
    //   442: pop
    //   443: aload_0
    //   444: invokevirtual 191	com/qbiki/modules/search/SearchFragment:getActivity	()Landroid/support/v4/app/FragmentActivity;
    //   447: ldc -64
    //   449: ldc -63
    //   451: invokestatic 199	com/qbiki/util/DialogUtil:showAlert	(Landroid/content/Context;II)V
    //   454: goto -74 -> 380
    //   457: goto -77 -> 380
    //   460: astore_1
    //   461: iload_3
    //   462: istore_2
    //   463: ldc 17
    //   465: new 78	java/lang/StringBuilder
    //   468: dup
    //   469: invokespecial 79	java/lang/StringBuilder:<init>	()V
    //   472: ldc -81
    //   474: invokevirtual 85	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   477: aload_1
    //   478: invokevirtual 88	java/lang/StringBuilder:append	(Ljava/lang/Object;)Ljava/lang/StringBuilder;
    //   481: invokevirtual 91	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   484: aload_1
    //   485: invokestatic 179	android/util/Log:e	(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
    //   488: pop
    //   489: goto -109 -> 380
    //   492: astore_1
    //   493: goto -30 -> 463
    //   496: astore_1
    //   497: iload 4
    //   499: istore_2
    //   500: goto -83 -> 417
    //   503: astore_1
    //   504: iload 5
    //   506: istore_2
    //   507: goto -153 -> 354
    //   510: iload_3
    //   511: iconst_1
    //   512: if_icmpeq -55 -> 457
    //   515: iload_2
    //   516: ifne -59 -> 457
    //   519: iload_3
    //   520: tableswitch	default:+36->556, 0:+-337->183, 1:+36->556, 2:+-334->186, 3:+-249->271, 4:+-261->259
    //   556: goto -396 -> 160
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	559	0	this	SearchFragment
    //   0	559	1	paramString	String
    //   97	419	2	i	int
    //   108	412	3	j	int
    //   111	387	4	k	int
    //   115	390	5	m	int
    //   99	79	6	n	int
    //   91	45	7	i1	int
    //   94	46	8	i2	int
    //   88	318	9	str1	String
    //   84	209	10	localObject	Object
    //   67	325	11	localTreeSet	java.util.TreeSet
    //   25	302	12	localHashSet	java.util.HashSet
    //   104	168	13	localXmlPullParser	org.xmlpull.v1.XmlPullParser
    //   193	202	14	str2	String
    // Exception table:
    //   from	to	target	type
    //   186	205	353	org/xmlpull/v1/XmlPullParserException
    //   208	235	353	org/xmlpull/v1/XmlPullParserException
    //   238	256	353	org/xmlpull/v1/XmlPullParserException
    //   259	268	353	org/xmlpull/v1/XmlPullParserException
    //   271	290	353	org/xmlpull/v1/XmlPullParserException
    //   297	326	353	org/xmlpull/v1/XmlPullParserException
    //   326	336	353	org/xmlpull/v1/XmlPullParserException
    //   341	350	353	org/xmlpull/v1/XmlPullParserException
    //   394	413	353	org/xmlpull/v1/XmlPullParserException
    //   186	205	416	java/io/FileNotFoundException
    //   208	235	416	java/io/FileNotFoundException
    //   238	256	416	java/io/FileNotFoundException
    //   259	268	416	java/io/FileNotFoundException
    //   271	290	416	java/io/FileNotFoundException
    //   297	326	416	java/io/FileNotFoundException
    //   326	336	416	java/io/FileNotFoundException
    //   341	350	416	java/io/FileNotFoundException
    //   394	413	416	java/io/FileNotFoundException
    //   117	132	460	java/io/IOException
    //   143	152	460	java/io/IOException
    //   168	177	460	java/io/IOException
    //   186	205	492	java/io/IOException
    //   208	235	492	java/io/IOException
    //   238	256	492	java/io/IOException
    //   259	268	492	java/io/IOException
    //   271	290	492	java/io/IOException
    //   297	326	492	java/io/IOException
    //   326	336	492	java/io/IOException
    //   341	350	492	java/io/IOException
    //   394	413	492	java/io/IOException
    //   117	132	496	java/io/FileNotFoundException
    //   143	152	496	java/io/FileNotFoundException
    //   168	177	496	java/io/FileNotFoundException
    //   117	132	503	org/xmlpull/v1/XmlPullParserException
    //   143	152	503	org/xmlpull/v1/XmlPullParserException
    //   168	177	503	org/xmlpull/v1/XmlPullParserException
  }
  
  private InputMethodManager getInputMethodManager()
  {
    FragmentActivity localFragmentActivity = getActivity();
    if (localFragmentActivity != null) {
      return (InputMethodManager)localFragmentActivity.getSystemService("input_method");
    }
    return null;
  }
  
  private View getSearchView()
  {
    this.mSearchView = new SearchView(getActivity());
    this.mSearchView.setQueryHint(getString(2131361992));
    this.mSearchView.setOnQueryTextListener(this);
    if (DeviceUtil.isTablet(getActivity())) {
      this.mSearchView.setIconifiedByDefault(false);
    }
    for (;;)
    {
      if (this.mFocusSearchView) {
        this.mSearchView.requestFocus();
      }
      if ((getActivity() instanceof SearchActivity))
      {
        SearchManager localSearchManager = (SearchManager)getActivity().getSystemService("search");
        this.mSearchView.setSearchableInfo(localSearchManager.getSearchableInfo(getActivity().getComponentName()));
      }
      return this.mSearchView;
      this.mSearchView.setIconifiedByDefault(true);
      this.mSearchView.setIconified(false);
    }
  }
  
  private void showKeyboard()
  {
    InputMethodManager localInputMethodManager = getInputMethodManager();
    if (localInputMethodManager != null) {
      localInputMethodManager.toggleSoftInput(2, 0);
    }
  }
  
  void handleSearchAction(String paramString)
  {
    if (this.LOGV) {
      Log.v("SearchFragment", "Search for: " + paramString);
    }
    this.mSearchView.setQuery(paramString, false);
    paramString = doSearch(paramString);
    this.mListAdapter = new ArrayAdapter(getActivity(), 17367043, paramString.toArray(new String[paramString.size()]));
    setListAdapter(this.mListAdapter);
  }
  
  public void onCreateOptionsMenu(Menu paramMenu, MenuInflater paramMenuInflater)
  {
    super.onCreateOptionsMenu(paramMenu, paramMenuInflater);
    paramMenu = paramMenu.add(2131361934);
    paramMenu.setIcon(17301583);
    paramMenu.setShowAsAction(2);
    paramMenu.setActionView(getSearchView());
  }
  
  public View onCreateView(LayoutInflater paramLayoutInflater, ViewGroup paramViewGroup, Bundle paramBundle)
  {
    paramLayoutInflater = paramLayoutInflater.inflate(2130903210, paramViewGroup, false);
    paramViewGroup = getArguments();
    if (paramViewGroup != null) {
      this.mIndexFileName = paramViewGroup.getString("ARG_INDEX_FILE_NAME");
    }
    if ((this.mIndexFileName == null) || (this.mIndexFileName.trim().length() == 0)) {
      this.mIndexFileName = "indexpage.plist";
    }
    return paramLayoutInflater;
  }
  
  public void onListItemClick(ListView paramListView, View paramView, int paramInt, long paramLong)
  {
    super.onListItemClick(paramListView, paramView, paramInt, paramLong);
    App.showPageWithId((String)this.mListAdapter.getItem(paramInt), this);
    this.mFocusSearchView = false;
  }
  
  public boolean onQueryTextChange(String paramString)
  {
    return true;
  }
  
  public boolean onQueryTextSubmit(String paramString)
  {
    this.mSearchView.clearFocus();
    InputMethodManager localInputMethodManager = getInputMethodManager();
    if (localInputMethodManager != null) {
      localInputMethodManager.hideSoftInputFromWindow(this.mSearchView.getWindowToken(), 0);
    }
    handleSearchAction(paramString);
    return true;
  }
  
  public void onViewCreated(View paramView, Bundle paramBundle)
  {
    super.onViewCreated(paramView, paramBundle);
    ((TextView)paramView.findViewById(16908292)).setVisibility(8);
    showKeyboard();
  }
}
