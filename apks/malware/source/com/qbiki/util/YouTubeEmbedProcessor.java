package com.qbiki.util;

import android.content.res.AssetManager;
import android.net.Uri;
import android.util.Log;
import android.webkit.WebView;
import com.qbiki.seattleclouds.App;
import java.io.IOException;
import java.io.InputStream;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class YouTubeEmbedProcessor
{
  private static final String TAG = "YouTubeEmbedProcessor";
  private static String youtubeProcessorJS = null;
  
  public YouTubeEmbedProcessor() {}
  
  public static String findYouTubeVideoId(String paramString)
  {
    try
    {
      String str = Uri.parse(paramString).getQueryParameter("v");
      return str;
    }
    catch (Exception localException)
    {
      Log.w("YouTubeEmbedProcessor", "Could not find YouTUbe video id in url: " + paramString, localException);
    }
    return null;
  }
  
  public static String process(InputStream paramInputStream)
  {
    try
    {
      Object localObject = DataUtil.readString(paramInputStream);
      paramInputStream = (InputStream)localObject;
      Pattern localPattern2 = Pattern.compile("<object.*?http://www\\.youtube\\.com/v/(.*?)(\\?|\\&).*?</object>", 32);
      Pattern localPattern1 = Pattern.compile("<embed.*?http://www\\.youtube\\.com/v/(.*?)(\\?|\\&).*?>", 32);
      localObject = localPattern2.matcher((CharSequence)localObject);
      boolean bool1 = false;
      if (((Matcher)localObject).find())
      {
        bool1 = true;
        paramInputStream = ((Matcher)localObject).replaceAll("<a href=\"http://www.youtube.com/watch?v=$1\"><img width=\"320\" height=\"265\" src=\"http://img.youtube.com/vi/$1/0.jpg\" alt=\"YouTube.com\"></a>");
      }
      localObject = localPattern1.matcher(paramInputStream);
      boolean bool2 = false;
      if (((Matcher)localObject).find())
      {
        bool2 = true;
        paramInputStream = ((Matcher)localObject).replaceAll("<a href=\"http://www.youtube.com/watch?v=$1\"><img width=\"320\" height=\"265\" src=\"http://img.youtube.com/vi/$1/0.jpg\" alt=\"YouTube.com\"></a>");
      }
      Log.v("YouTubeEmbedProcessor", "process: objectFound = " + bool1 + ", embedFound = " + bool2);
      if ((bool1) || (bool2)) {
        return paramInputStream;
      }
    }
    catch (IOException paramInputStream)
    {
      Log.e("YouTubeEmbedProcessor", "process " + paramInputStream, paramInputStream);
      return null;
    }
    return null;
  }
  
  public static void process(WebView paramWebView)
  {
    if (youtubeProcessorJS == null) {}
    try
    {
      youtubeProcessorJS = DataUtil.readString(App.assetManager.open("SC/youtubeProcessor.js"));
      if (youtubeProcessorJS != null) {
        paramWebView.loadUrl("javascript:" + youtubeProcessorJS);
      }
      return;
    }
    catch (Exception localException)
    {
      for (;;)
      {
        Log.d("YouTubeEmbedProcessor", "Exception", localException);
      }
    }
  }
}
