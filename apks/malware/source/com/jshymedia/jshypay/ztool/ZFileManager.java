package com.jshymedia.jshypay.ztool;

import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.util.HashMap;

public class ZFileManager
{
  public static HashMap fileLocks = new HashMap();
  
  public ZFileManager() {}
  
  private static Object a(String paramString)
  {
    try
    {
      Object localObject2 = fileLocks.get(paramString);
      Object localObject1 = localObject2;
      if (localObject2 == null)
      {
        localObject1 = new Object();
        fileLocks.put(paramString, localObject1);
      }
      return localObject1;
    }
    finally {}
  }
  
  public static byte[] getByteFromFile(File paramFile, ProgressChangeListener paramProgressChangeListener)
  {
    int i = 0;
    InputStream localInputStream = getStreamFromFile(paramFile);
    if (localInputStream == null) {
      return null;
    }
    if (paramProgressChangeListener != null) {
      i = 1;
    }
    ByteArrayOutputStream localByteArrayOutputStream = new ByteArrayOutputStream();
    byte[] arrayOfByte = new byte['Ѐ'];
    long l3 = paramFile.length();
    long l1 = 0L;
    try
    {
      for (;;)
      {
        int j = localInputStream.read(arrayOfByte);
        if (j == -1) {
          return localByteArrayOutputStream.toByteArray();
        }
        localByteArrayOutputStream.write(arrayOfByte, 0, j);
        long l2 = l1 + j;
        localByteArrayOutputStream.flush();
        l1 = l2;
        if (i != 0)
        {
          l1 = l2;
          if (l3 >= l2)
          {
            paramProgressChangeListener.onProgressChange(l2, l3);
            l1 = l2;
          }
        }
      }
      return null;
    }
    catch (IOException paramFile)
    {
      paramFile.printStackTrace();
    }
  }
  
  public static InputStream getStreamFromFile(File paramFile)
  {
    if (paramFile == null) {}
    while ((paramFile.isDirectory()) || (!paramFile.exists())) {
      return null;
    }
    try
    {
      paramFile = new FileInputStream(paramFile);
      return paramFile;
    }
    catch (FileNotFoundException paramFile)
    {
      paramFile.printStackTrace();
    }
    return null;
  }
  
  public static boolean writeFileFromByte(byte[] paramArrayOfByte, File paramFile)
  {
    return writeFileFromByte(paramArrayOfByte, paramFile, false);
  }
  
  public static boolean writeFileFromByte(byte[] paramArrayOfByte, File paramFile, boolean paramBoolean)
  {
    int i;
    if (paramArrayOfByte == null)
    {
      i = 1;
      if (paramFile != null) {
        break label27;
      }
    }
    label27:
    for (int j = 1;; j = 0)
    {
      if ((j | i) == 0) {
        break label33;
      }
      return false;
      i = 0;
      break;
    }
    try
    {
      label33:
      synchronized (a(paramFile.toString()))
      {
        paramFile = new FileOutputStream(paramFile, paramBoolean);
        paramFile.write(paramArrayOfByte);
        paramFile.close();
        return true;
      }
      return false;
    }
    catch (FileNotFoundException paramArrayOfByte)
    {
      paramArrayOfByte.printStackTrace();
      return false;
    }
    catch (IOException paramArrayOfByte)
    {
      paramArrayOfByte.printStackTrace();
    }
  }
  
  public static boolean writeFileFromStream(InputStream paramInputStream, File paramFile, long paramLong, ProgressChangeListener paramProgressChangeListener)
  {
    return writeFileFromStream(paramInputStream, paramFile, paramLong, paramProgressChangeListener, false);
  }
  
  public static boolean writeFileFromStream(InputStream paramInputStream, File paramFile, long paramLong, ProgressChangeListener paramProgressChangeListener, boolean paramBoolean)
  {
    int i;
    if (paramInputStream == null)
    {
      i = 1;
      if (paramFile != null) {
        break label30;
      }
    }
    label30:
    for (int j = 1;; j = 0)
    {
      if ((j | i) == 0) {
        break label36;
      }
      return false;
      i = 0;
      break;
    }
    label36:
    if (paramProgressChangeListener != null) {
      i = 1;
    }
    for (;;)
    {
      try
      {
        ??? = paramFile.toString();
        paramFile = new FileOutputStream(paramFile);
        byte[] arrayOfByte = new byte['Ѐ'];
        long l1 = 0L;
        synchronized (a((String)???))
        {
          j = paramInputStream.read(arrayOfByte);
          if (j == -1)
          {
            paramFile.close();
            if (!paramBoolean) {
              paramInputStream.close();
            }
            return true;
          }
          paramFile.write(arrayOfByte, 0, j);
          paramFile.flush();
          long l2 = l1 + j;
          l1 = l2;
          if (i == 0) {
            continue;
          }
          l1 = l2;
          if (paramLong < l2) {
            continue;
          }
          l1 = l2;
          if (paramLong <= 0L) {
            continue;
          }
          paramProgressChangeListener.onProgressChange(l2, paramLong);
          l1 = l2;
        }
        i = 0;
      }
      catch (FileNotFoundException paramInputStream)
      {
        paramInputStream.printStackTrace();
        return false;
      }
      catch (IOException paramInputStream)
      {
        paramInputStream.printStackTrace();
      }
    }
  }
}
