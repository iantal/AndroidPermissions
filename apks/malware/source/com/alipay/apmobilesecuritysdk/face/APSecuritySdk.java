package com.alipay.apmobilesecuritysdk.face;

import android.annotation.SuppressLint;
import android.content.Context;
import com.alipay.apmobilesecuritysdk.e.b;
import com.taobao.dp.DeviceSecuritySDK;
import java.lang.reflect.Method;
import java.util.LinkedList;
import java.util.Map;

@SuppressLint({"NewApi"})
public class APSecuritySdk
{
  private static APSecuritySdk a;
  private static Object b = new Object();
  private Context c;
  private String d;
  private volatile boolean e = false;
  private volatile boolean f = false;
  private Thread g;
  private LinkedList h = new LinkedList();
  
  private APSecuritySdk(Context paramContext)
  {
    this.c = paramContext;
  }
  
  public static APSecuritySdk getInstance(Context paramContext)
  {
    synchronized (b)
    {
      if (a == null) {
        a = new APSecuritySdk(paramContext);
      }
      paramContext = a;
      return paramContext;
    }
  }
  
  public static String getUtdid(Context paramContext)
  {
    try
    {
      paramContext = (String)Class.forName("com.ta.utdid2.device.UTDevice").getMethod("getUtdid", new Class[] { Context.class }).invoke(null, new Object[] { paramContext });
      return paramContext;
    }
    catch (Exception paramContext) {}
    return "";
  }
  
  public APSecuritySdk.TokenResult getTokenResult()
  {
    if (com.alipay.security.mobile.module.a.a.a(this.d)) {
      this.d = DeviceSecuritySDK.getInstance(this.c).getSecurityToken();
    }
    APSecuritySdk.TokenResult localTokenResult = new APSecuritySdk.TokenResult(this);
    try
    {
      localTokenResult.apdid = com.alipay.apmobilesecuritysdk.a.a.b(this.c);
      localTokenResult.apdidToken = com.alipay.apmobilesecuritysdk.a.a.a(this.c);
      localTokenResult.umidToken = this.d;
      localTokenResult.clientKey = b.a(this.c);
      return localTokenResult;
    }
    catch (Throwable localThrowable) {}
    return localTokenResult;
  }
  
  public void initToken(int paramInt, Map paramMap, APSecuritySdk.InitResultListener paramInitResultListener)
  {
    String str1 = com.alipay.security.mobile.module.a.a.a(paramMap, "utdid", "");
    String str2 = com.alipay.security.mobile.module.a.a.a(paramMap, "tid", "");
    paramMap = com.alipay.security.mobile.module.a.a.a(paramMap, "userId", "");
    this.h.addLast(new APSecuritySdk.RunningTask(this, paramInt, str1, str2, paramMap, paramInitResultListener));
    if (this.g == null)
    {
      this.g = new Thread(new APSecuritySdk.1(this));
      this.g.setUncaughtExceptionHandler(new APSecuritySdk.2(this));
      this.g.start();
    }
  }
}
