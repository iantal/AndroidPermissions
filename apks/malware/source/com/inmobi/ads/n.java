package com.inmobi.ads;

import android.os.SystemClock;
import android.view.View;
import android.view.ViewGroup;
import com.inmobi.commons.core.c.e;
import com.inmobi.commons.core.utilities.Logger;
import com.inmobi.commons.core.utilities.Logger.InternalLogLevel;
import com.inmobi.commons.core.utilities.d;
import com.inmobi.rendering.RenderView;
import com.inmobi.rendering.RenderingProperties.PlacementType;
import com.inmobi.rendering.a.c;
import java.lang.ref.WeakReference;
import java.net.URL;
import java.util.HashMap;
import java.util.Map;
import java.util.WeakHashMap;
import org.json.JSONException;
import org.json.JSONObject;

class n
  extends AdUnit
{
  private static final String a = n.class.getSimpleName();
  private Map b = new HashMap();
  private WeakHashMap c = new WeakHashMap();
  private String d;
  private String e;
  private l f;
  private URL g;
  private String h;
  private int i = 0;
  private long j = 0L;
  
  public n(long paramLong, AdUnit.a paramA)
  {
    super(com.inmobi.commons.a.a.b(), paramLong, paramA);
  }
  
  private String b(Map paramMap)
  {
    d.a(paramMap);
    if ((paramMap == null) || (paramMap.isEmpty())) {
      return this.e + "recordEvent(8)";
    }
    StringBuilder localStringBuilder = new StringBuilder();
    localStringBuilder.append(this.e + "recordEvent(8, ");
    localStringBuilder.append(new JSONObject(paramMap).toString());
    localStringBuilder.append(");");
    return localStringBuilder.toString();
  }
  
  protected String a()
  {
    return "native";
  }
  
  public void a(View paramView)
  {
    if (paramView == null) {}
    do
    {
      do
      {
        return;
      } while (AdUnit.AdState.STATE_ATTACHED != g());
      a(AdUnit.AdState.STATE_LOADED);
      InMobiNative.sMappedAdUnits.remove(paramView);
      this.f.a(paramView);
      this.b.remove(this);
      paramView = (n)this.c.remove(paramView);
    } while (paramView == null);
    paramView.a(AdUnit.AdState.STATE_LOADED);
    this.b.remove(paramView);
  }
  
  public void a(View paramView, URL paramURL, String paramString)
  {
    boolean bool2 = true;
    Object localObject = new HashMap();
    boolean bool1;
    if (paramString != null)
    {
      bool1 = true;
      ((Map)localObject).put("customScript", Boolean.valueOf(bool1));
      if (paramURL == null) {
        break label201;
      }
      bool1 = bool2;
      label42:
      ((Map)localObject).put("customUrl", Boolean.valueOf(bool1));
      com.inmobi.commons.core.c.a.a().a("ads", "TrackImpression", (Map)localObject);
      localObject = (WeakReference)this.b.get(this);
      if (localObject == null) {
        break label239;
      }
    }
    label201:
    label207:
    label239:
    for (localObject = (View)((WeakReference)localObject).get();; localObject = null)
    {
      if (!paramView.equals(localObject))
      {
        if ((AdUnit.AdState.STATE_LOADED != g()) && (AdUnit.AdState.STATE_ATTACHED != g())) {
          break label207;
        }
        a((View)localObject);
        a(paramView);
        this.b.put(this, new WeakReference(paramView));
        this.c.put(paramView, this);
        this.g = paramURL;
        this.h = paramString;
        this.f.a(paramView, this);
        a(AdUnit.AdState.STATE_ATTACHED);
      }
      while ((g() == AdUnit.AdState.STATE_RENDERED) || (g() == AdUnit.AdState.STATE_ACTIVE))
      {
        return;
        bool1 = false;
        break;
        bool1 = false;
        break label42;
      }
      Logger.a(Logger.InternalLogLevel.ERROR, a, "Please wait for the ad to finish loading before making a call to bind.");
      return;
    }
  }
  
  public void a(a paramA)
  {
    super.a(paramA);
    if (AdUnit.AdState.STATE_AVAILABLE == g()) {
      b(this.d);
    }
  }
  
  void a(Map paramMap, URL paramURL, String paramString)
  {
    boolean bool2 = false;
    Logger.a(Logger.InternalLogLevel.INTERNAL, a, "Click record requested");
    HashMap localHashMap = new HashMap();
    if (paramString != null) {}
    for (boolean bool1 = true;; bool1 = false)
    {
      localHashMap.put("customScript", Boolean.valueOf(bool1));
      bool1 = bool2;
      if (paramURL != null) {
        bool1 = true;
      }
      localHashMap.put("customUrl", Boolean.valueOf(bool1));
      com.inmobi.commons.core.c.a.a().a("ads", "ReportClick", localHashMap);
      if ((AdUnit.AdState.STATE_ATTACHED != g()) && (AdUnit.AdState.STATE_RENDERED != g())) {
        break;
      }
      paramMap = b(paramMap);
      m().b(paramMap);
      if (paramString != null) {
        m().b(paramString);
      }
      if (paramURL != null) {
        c.a().a(paramURL.toExternalForm(), true);
      }
      return;
    }
    com.inmobi.commons.core.c.a.a().a(new e("ads", "InvalidClickReport"));
    Logger.a(Logger.InternalLogLevel.ERROR, a, "reportAdClick call made in wrong state");
  }
  
  public boolean b(a paramA)
  {
    if (!super.b(paramA)) {}
    for (;;)
    {
      return false;
      try
      {
        paramA = new JSONObject(paramA.b());
        this.d = paramA.getString("contextCode");
        this.e = paramA.getString("namespace");
        if ((this.d != null) && (this.d.trim().length() != 0) && (this.e != null))
        {
          int k = this.e.trim().length();
          if (k != 0) {
            return true;
          }
        }
      }
      catch (JSONException paramA)
      {
        Logger.a(Logger.InternalLogLevel.INTERNAL, a, "Exception while parsing ad.", paramA);
      }
    }
    return false;
  }
  
  protected String c()
  {
    return null;
  }
  
  public void c(RenderView paramRenderView)
  {
    super.c(paramRenderView);
    if (AdUnit.AdState.STATE_AVAILABLE == g())
    {
      s();
      a(AdUnit.AdState.STATE_LOADED);
      u();
      l().a();
      p();
    }
  }
  
  protected RenderingProperties.PlacementType d()
  {
    return RenderingProperties.PlacementType.INLINE;
  }
  
  public void e(RenderView paramRenderView)
  {
    super.e(paramRenderView);
    if ((AdUnit.AdState.STATE_RENDERED == g()) || (AdUnit.AdState.STATE_ATTACHED == g()))
    {
      this.i += 1;
      a(AdUnit.AdState.STATE_ACTIVE);
      l().b();
    }
    while (g() != AdUnit.AdState.STATE_ACTIVE) {
      return;
    }
    this.i += 1;
  }
  
  public void f(RenderView paramRenderView)
  {
    super.f(paramRenderView);
    if (AdUnit.AdState.STATE_ACTIVE == g())
    {
      this.i -= 1;
      if (this.i == 0)
      {
        a(AdUnit.AdState.STATE_RENDERED);
        paramRenderView = new HashMap();
        paramRenderView.put("type", a());
        paramRenderView.put("impId", i());
        com.inmobi.commons.core.c.a.a().a("ads", "AdRendered", paramRenderView);
        l().c();
      }
    }
  }
  
  public void n()
  {
    if (this.j != 0L)
    {
      int k = k().f();
      if (SystemClock.elapsedRealtime() - this.j < k * 1000)
      {
        a(new InMobiAdRequestStatus(InMobiAdRequestStatus.StatusCode.EARLY_REFRESH_REQUEST).setCustomMessage("Ad cannot be refreshed before " + k + " seconds"), false);
        Logger.a(Logger.InternalLogLevel.ERROR, a, "Ad cannot be refreshed before " + k + " seconds");
        return;
      }
    }
    this.j = SystemClock.elapsedRealtime();
    super.n();
    this.f = new l(k().l());
  }
  
  protected void r()
  {
    j();
    this.b.clear();
    this.c.clear();
    if (this.f != null) {
      this.f.b();
    }
    this.h = null;
    this.g = null;
    if ((m() != null) && (m().getParent() != null)) {
      ((ViewGroup)m().getParent()).removeView(m());
    }
    super.r();
  }
  
  public void v()
  {
    if (AdUnit.AdState.STATE_ATTACHED == g())
    {
      Object localObject = (WeakReference)this.b.get(this);
      if (localObject != null)
      {
        localObject = (View)((WeakReference)localObject).get();
        if ((this.f != null) && (localObject != null)) {
          this.f.a((View)localObject, this);
        }
      }
    }
  }
  
  public void w()
  {
    if (AdUnit.AdState.STATE_ATTACHED == g())
    {
      Object localObject = (WeakReference)this.b.get(this);
      if (localObject != null)
      {
        localObject = (View)((WeakReference)localObject).get();
        if ((this.f != null) && (localObject != null)) {
          this.f.a((View)localObject);
        }
      }
    }
  }
  
  public Object x()
  {
    return h();
  }
  
  void y()
  {
    Logger.a(Logger.InternalLogLevel.INTERNAL, a, "Impression record requested for Ad unit (" + hashCode() + ")");
    if (AdUnit.AdState.STATE_ATTACHED == g())
    {
      a(AdUnit.AdState.STATE_RENDERED);
      String str = this.e + "recordEvent(18)";
      m().b(str);
      if (this.h != null) {
        m().b(this.h);
      }
      if (this.g != null) {
        c.a().a(this.g.toExternalForm(), true);
      }
    }
  }
  
  void z()
  {
    Logger.a(Logger.InternalLogLevel.INTERNAL, a, "Open landing page requested");
    com.inmobi.commons.core.c.a.a().a(new e("ads", "OpenLandingPage"));
    if ((AdUnit.AdState.STATE_RENDERED == g()) || (AdUnit.AdState.STATE_ATTACHED == g()))
    {
      String str = this.e + "openLandingPage()";
      m().b(str);
    }
  }
}
