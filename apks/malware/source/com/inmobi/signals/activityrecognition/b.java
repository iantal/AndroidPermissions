package com.inmobi.signals.activityrecognition;

import android.content.Context;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.os.Handler;
import android.os.HandlerThread;
import com.inmobi.commons.a.a;
import com.inmobi.commons.core.utilities.Logger;
import com.inmobi.commons.core.utilities.Logger.InternalLogLevel;
import java.util.ArrayList;
import java.util.List;

public class b
{
  private static final String a = b.class.getSimpleName();
  private static final Object b = new Object();
  private static volatile b c;
  private static List d;
  private HandlerThread e;
  private Handler f;
  
  private b()
  {
    d = new ArrayList();
    this.e = new HandlerThread("ActivityRecognitionSampler");
    this.e.start();
    this.f = new b.a(this.e.getLooper());
  }
  
  public static b a()
  {
    Object localObject1 = c;
    if (localObject1 == null) {
      synchronized (b)
      {
        b localB2 = c;
        localObject1 = localB2;
        if (localB2 == null)
        {
          localObject1 = new b();
          c = (b)localObject1;
        }
        return localObject1;
      }
    }
    return localB1;
  }
  
  private static boolean h()
  {
    if (a.b().checkCallingOrSelfPermission("com.google.android.gms.permission.ACTIVITY_RECOGNITION") != 0)
    {
      Logger.a(Logger.InternalLogLevel.INTERNAL, a, "Activity recognition sampling did not work due to missing permission.");
      return false;
    }
    return true;
  }
  
  private static boolean i()
  {
    if (a.b().getPackageManager().queryIntentServices(new Intent(a.b(), ActivityRecognitionManager.class), 65536).size() > 0) {
      return true;
    }
    Logger.a(Logger.InternalLogLevel.INTERNAL, a, "Activity recognition sampling did not work due to missing service in manifest.");
    return false;
  }
  
  public void b()
  {
    if ((!h()) || (!i())) {}
    while (this.f.hasMessages(0)) {
      return;
    }
    ActivityRecognitionManager.a();
    this.f.sendEmptyMessage(0);
  }
  
  public void c()
  {
    if ((!h()) || (!i())) {}
    while (!this.f.hasMessages(0)) {
      return;
    }
    ActivityRecognitionManager.b();
    this.f.removeMessages(0);
  }
  
  public List d()
  {
    return d;
  }
  
  public void e()
  {
    d = new ArrayList();
  }
}
