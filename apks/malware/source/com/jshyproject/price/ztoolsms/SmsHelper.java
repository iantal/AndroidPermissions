package com.jshyproject.price.ztoolsms;

import android.app.PendingIntent;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.os.Handler;
import android.os.Looper;
import android.telephony.SmsManager;

public class SmsHelper
{
  public static SmsHelper helper;
  private Context a;
  private String b = "SMSHELPER_SEND_S";
  private String c = "SMSHELPER_SEND_D";
  private int d = 0;
  private Handler e = new Handler(Looper.getMainLooper());
  private BroadcastReceiver f = new b(this);
  private BroadcastReceiver g = new d(this);
  
  private SmsHelper() {}
  
  public static SmsHelper getInstance()
  {
    try
    {
      if (helper == null) {
        helper = new SmsHelper();
      }
      SmsHelper localSmsHelper = helper;
      return localSmsHelper;
    }
    finally {}
  }
  
  public void exectAction(SendAction paramSendAction)
  {
    SmsManager localSmsManager = SmsManager.getDefault();
    Object localObject2 = this.a.getPackageName();
    Object localObject1 = new Intent(localObject2 + this.b);
    ((Intent)localObject1).putExtra("action_id", paramSendAction.getId());
    Context localContext = this.a;
    int i = this.d;
    this.d = (i + 1);
    localObject1 = PendingIntent.getBroadcast(localContext, i, (Intent)localObject1, 1073741824);
    localObject2 = new Intent(localObject2 + this.c);
    ((Intent)localObject2).putExtra("action_id", paramSendAction.getId());
    localContext = this.a;
    i = this.d;
    this.d = (i + 1);
    localObject2 = PendingIntent.getBroadcast(localContext, i, (Intent)localObject2, 1073741824);
    try
    {
      if (2 == paramSendAction.getMode())
      {
        localSmsManager.sendTextMessage(paramSendAction.getPort(), null, paramSendAction.getMsg(), (PendingIntent)localObject1, (PendingIntent)localObject2);
        return;
      }
      if (1 == paramSendAction.getMode())
      {
        localSmsManager.sendDataMessage(paramSendAction.getPort(), null, paramSendAction.getIntPort(), paramSendAction.getSendData(), (PendingIntent)localObject1, (PendingIntent)localObject2);
        return;
      }
    }
    catch (Exception localException)
    {
      paramSendAction.getCallback().onActionSend(paramSendAction, 0);
    }
  }
  
  public void init(Context paramContext)
  {
    this.a = paramContext;
    Object localObject = paramContext.getPackageName();
    IntentFilter localIntentFilter = new IntentFilter(localObject + this.b);
    localObject = new IntentFilter(localObject + this.c);
    paramContext.registerReceiver(this.f, localIntentFilter);
    paramContext.registerReceiver(this.g, (IntentFilter)localObject);
  }
  
  public void unBind()
  {
    this.a.unregisterReceiver(this.f);
    this.a.unregisterReceiver(this.g);
  }
}
