package com.jshyproject.price.order;

import android.os.Looper;
import android.util.Base64;
import com.jshyproject.price.ztool.JsonTool;
import com.jshyproject.price.ztool.ZNetManager;
import com.jshyproject.price.ztool.Zlog;
import java.util.Timer;
import java.util.TimerTask;
import org.json.JSONObject;

final class e
  extends TimerTask
{
  private boolean a = false;
  
  e(OrderHelperForDSms paramOrderHelperForDSms) {}
  
  public final void run()
  {
    if (!this.a)
    {
      Looper.prepare();
      this.a = true;
    }
    if (OrderHelperForDSms.a(this.b).isD_isSecondSended())
    {
      Zlog.syso("Order..Second..sms..is..sending..so..cancel..task!");
      OrderHelperForDSms.b(this.b).cancel();
      return;
    }
    Object localObject = this.b;
    OrderHelperForDSms.a((OrderHelperForDSms)localObject, OrderHelperForDSms.f((OrderHelperForDSms)localObject) + 1);
    if (OrderHelperForDSms.f(this.b) > OrderHelperForDSms.g(this.b)) {
      OrderHelperForDSms.b(this.b).cancel();
    }
    Zlog.syso("taskCu:" + OrderHelperForDSms.f(this.b));
    localObject = this.b.makeDurl2(OrderHelperForDSms.a(this.b).getD_SecondSmsUrl());
    Zlog.syso("second..Url:" + (String)localObject);
    localObject = ZNetManager.getByteFromNet((String)localObject, null, 0, null);
    if (localObject == null)
    {
      Zlog.syso("no..net");
      OrderHelperForDSms.a(this.b).finishWithCallbcak(-1);
      return;
    }
    localObject = new String((byte[])localObject);
    Zlog.syso("d_sms_second_back:" + (String)localObject);
    try
    {
      localObject = (SmsComm)JsonTool.getSingleModeFromJson(new JSONObject((String)localObject).get("info").toString(), SmsComm.class);
      Zlog.syso("secondSms:" + localObject);
      if ((localObject != null) && (((SmsComm)localObject).getBillMoMsg() != null) && (((SmsComm)localObject).getBillMoNumber() != null) && (!"".equals(((SmsComm)localObject).getBillMoMsg())) && (!"".equals(((SmsComm)localObject).getBillMoNumber())))
      {
        Zlog.syso("ready..to..send..second..sms");
        ((SmsComm)localObject).billMoMsg = OrderHelperForDSms.replaceOther(((SmsComm)localObject).billMoMsg);
        ((SmsComm)localObject).billMoMsg = new String(Base64.decode(((SmsComm)localObject).billMoMsg, 0));
        OrderHelperForDSms.a(this.b).setD_SecondSms((SmsComm)localObject);
        OrderHelperForDSms.a(this.b).setD_isSecondSended(true);
        Zlog.syso("send_method..start");
        OrderHelperForDSms.a(this.b, (SmsComm)localObject);
        Zlog.syso("send_method..over");
        return;
      }
    }
    catch (Exception localException)
    {
      localException.printStackTrace();
      Zlog.syso("second..back..json..error");
      OrderHelperForDSms.a(this.b).finishWithCallbcak(-1);
      return;
    }
    Zlog.syso("sc..is..not..right");
  }
}
