package com.letang.platform.launchui;

import android.app.Activity;
import android.app.AlertDialog.Builder;
import android.app.Dialog;
import android.app.ProgressDialog;
import android.content.DialogInterface;
import android.content.DialogInterface.OnClickListener;
import android.content.Intent;
import android.os.Bundle;
import android.os.Handler;
import android.os.Message;
import android.text.Editable;
import android.view.View;
import android.widget.EditText;
import android.widget.LinearLayout;
import android.widget.RelativeLayout;
import android.widget.RelativeLayout.LayoutParams;
import android.widget.TextView;
import android.widget.Toast;
import com.letang.platform.net.RankWallNet;
import com.letang.platform.util.LocalUtil;

public class SubmitScoreActivity
  extends Activity
{
  private static final int SUBMIT_FAIL = 2;
  private static final int SUBMIT_SUCCESS = 1;
  private EditText etName;
  private String gameId;
  private Activity mActivity;
  private Handler mHandler = new Handler()
  {
    public void handleMessage(Message paramAnonymousMessage)
    {
      switch (paramAnonymousMessage.what)
      {
      default: 
        return;
      case 1: 
        SubmitScoreActivity.this.mPbWait.cancel();
        Toast.makeText(SubmitScoreActivity.this.mActivity, LocalUtil.getLocalString(SubmitScoreActivity.this.getResources(), "SUBMIT_SUCCESS"), 1).show();
        SubmitScoreActivity.this.turnToRankWall();
        SubmitScoreActivity.this.mActivity.finish();
        return;
      }
      Toast.makeText(SubmitScoreActivity.this.mActivity, LocalUtil.getLocalString(SubmitScoreActivity.this.getResources(), "SUBMIT_FAIL"), 1).show();
      SubmitScoreActivity.this.mPbWait.cancel();
      SubmitScoreActivity.this.mActivity.finish();
    }
  };
  private ProgressDialog mPbWait;
  private long score;
  
  public SubmitScoreActivity() {}
  
  private View getScoreDialog()
  {
    RelativeLayout localRelativeLayout = new RelativeLayout(this);
    localRelativeLayout.setLayoutParams(new RelativeLayout.LayoutParams(-2, -2));
    localRelativeLayout.setPadding(10, 5, 10, 5);
    LinearLayout localLinearLayout = new LinearLayout(this);
    localLinearLayout.setLayoutParams(new RelativeLayout.LayoutParams(-2, -2));
    localLinearLayout.setId(1);
    Object localObject = new TextView(this);
    ((TextView)localObject).setLayoutParams(new RelativeLayout.LayoutParams(-2, -2));
    ((TextView)localObject).setText(LocalUtil.getLocalString(getResources(), "SCORE") + this.score);
    localLinearLayout.addView((View)localObject);
    localObject = new LinearLayout(this);
    ((LinearLayout)localObject).setOrientation(0);
    RelativeLayout.LayoutParams localLayoutParams1 = new RelativeLayout.LayoutParams(-1, -2);
    ((LinearLayout)localObject).setLayoutParams(localLayoutParams1);
    localLayoutParams1.topMargin = 10;
    TextView localTextView = new TextView(this);
    localTextView.setLayoutParams(new RelativeLayout.LayoutParams(-2, -2));
    localTextView.setText(LocalUtil.getLocalString(getResources(), "Name"));
    this.etName = new EditText(this);
    RelativeLayout.LayoutParams localLayoutParams2 = new RelativeLayout.LayoutParams(-1, -2);
    this.etName.setLayoutParams(localLayoutParams2);
    ((LinearLayout)localObject).addView(localTextView);
    ((LinearLayout)localObject).addView(this.etName);
    localLayoutParams1.addRule(3, localLinearLayout.getId());
    localRelativeLayout.addView(localLinearLayout);
    localRelativeLayout.addView((View)localObject);
    return localRelativeLayout;
  }
  
  private void turnToRankWall()
  {
    Intent localIntent = new Intent();
    localIntent.putExtra("gameId", this.gameId);
    localIntent.setClass(this, RankWallActivity.class);
    this.mActivity.startActivity(localIntent);
  }
  
  protected void onCreate(Bundle paramBundle)
  {
    super.onCreate(paramBundle);
    this.mActivity = this;
    paramBundle = getIntent();
    this.score = paramBundle.getLongExtra("score", 0L);
    this.gameId = paramBundle.getStringExtra("gameId");
    this.mPbWait = new ProgressDialog(this.mActivity);
    this.mPbWait.setCancelable(false);
    showDialog(0);
  }
  
  protected Dialog onCreateDialog(int paramInt)
  {
    new AlertDialog.Builder(this).setView(getScoreDialog()).setTitle(LocalUtil.getLocalString(getResources(), "SUBMIT_SCORE")).setPositiveButton(LocalUtil.getLocalString(getResources(), "SUBMIT"), new DialogInterface.OnClickListener()
    {
      public void onClick(DialogInterface paramAnonymousDialogInterface, int paramAnonymousInt)
      {
        SubmitScoreActivity.this.mPbWait = new ProgressDialog(SubmitScoreActivity.this.mActivity);
        SubmitScoreActivity.this.mPbWait.setCancelable(false);
        SubmitScoreActivity.this.mPbWait.show();
        new Thread()
        {
          public void run()
          {
            Message localMessage = new Message();
            try
            {
              new RankWallNet(SubmitScoreActivity.this.mActivity).submitScore(SubmitScoreActivity.this.gameId, SubmitScoreActivity.this.etName.getText().toString(), SubmitScoreActivity.this.score);
              localMessage.what = 1;
              SubmitScoreActivity.this.mHandler.sendMessage(localMessage);
              return;
            }
            catch (Exception localException)
            {
              for (;;)
              {
                localException.printStackTrace();
                localMessage.what = 2;
              }
            }
          }
        }.start();
      }
    }).setNegativeButton(LocalUtil.getLocalString(getResources(), "CANCLE"), new DialogInterface.OnClickListener()
    {
      public void onClick(DialogInterface paramAnonymousDialogInterface, int paramAnonymousInt)
      {
        SubmitScoreActivity.this.mPbWait.cancel();
        SubmitScoreActivity.this.mActivity.finish();
      }
    }).create();
  }
}
