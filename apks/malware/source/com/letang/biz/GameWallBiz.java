package com.letang.biz;

import android.content.Context;
import android.content.res.AssetManager;
import com.letang.config.Gobal;
import com.letang.util.DownloadUtils;
import com.letang.util.FileUtils;
import com.letang.util.ZipUtils;
import java.io.File;
import java.io.FileInputStream;
import java.io.InputStream;
import java.util.Locale;
import java.util.Properties;

public class GameWallBiz
{
  private Context mContext;
  
  public GameWallBiz(Context paramContext)
  {
    this.mContext = paramContext;
  }
  
  private void copyPackageFromAssets()
  {
    try
    {
      InputStream localInputStream = this.mContext.getAssets().open("game_wall.zip");
      FileUtils.writeFileToPhone(this.mContext, localInputStream, "game_wall.zip");
      return;
    }
    catch (Exception localException)
    {
      localException.printStackTrace();
    }
  }
  
  public void downloadPackage()
  {
    localObject2 = null;
    do
    {
      try
      {
        String str = Gobal.DIR_DATA + this.mContext.getPackageName() + "/files/" + "game_wall.zip";
        Object localObject1 = new FileInputStream(new File(Gobal.DIR_DATA + this.mContext.getPackageName() + "/files/" + "game_wall" + "/" + "ver.pro"));
        Object localObject3 = new Properties();
        ((Properties)localObject3).load((InputStream)localObject1);
        localObject3 = "http://data.cnappbox.com/androidplus/?c=down&a=get&ver=" + ((Properties)localObject3).getProperty("ver") + "&lang=" + Locale.getDefault().getLanguage();
        localObject1 = new File(str);
        localException1.printStackTrace();
      }
      catch (Exception localException1)
      {
        try
        {
          DownloadUtils.downloadFile((String)localObject3, str);
          return;
        }
        catch (Exception localException3)
        {
          localObject2 = localException1;
          Exception localException2 = localException3;
          continue;
        }
        localException1 = localException1;
      }
    } while ((localObject2 == null) || (!localObject2.exists()));
    localObject2.delete();
  }
  
  public String getGameWallPage()
  {
    return "file://" + Gobal.DIR_DATA + this.mContext.getPackageName() + "/files/" + "game_wall" + "/" + "index.html";
  }
  
  public void releasePackage()
  {
    try
    {
      String str = Gobal.DIR_DATA + this.mContext.getPackageName() + "/files/" + "game_wall" + "/";
      this.mContext.getPackageName();
      File localFile1 = new File(str);
      File localFile2 = new File(str + "index.html");
      if ((!localFile1.exists()) || (!localFile2.exists())) {
        copyPackageFromAssets();
      }
      localFile1 = new File(Gobal.DIR_DATA + this.mContext.getPackageName() + "/files/" + "game_wall.zip");
      if (localFile1.exists())
      {
        ZipUtils.upZipFile(localFile1, str);
        localFile1.delete();
      }
      return;
    }
    catch (Exception localException)
    {
      localException.printStackTrace();
    }
  }
}
