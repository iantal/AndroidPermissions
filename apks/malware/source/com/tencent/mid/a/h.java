package com.tencent.mid.a;

import android.content.Context;
import com.tencent.mid.api.MidCallback;
import com.tencent.mid.api.MidEntity;
import com.tencent.mid.util.Util;
import java.util.ArrayList;
import java.util.Arrays;

public class h
  implements Runnable
{
  private Context a = null;
  private MidCallback b = null;
  private int c = 0;
  
  public h(Context paramContext, int paramInt, MidCallback paramMidCallback)
  {
    this.a = paramContext;
    this.c = paramInt;
    this.b = paramMidCallback;
  }
  
  private void a()
  {
    MidEntity localMidEntity1 = com.tencent.mid.b.g.a(this.a).a(new ArrayList(Arrays.asList(new Integer[] { Integer.valueOf(1) })));
    MidEntity localMidEntity2 = com.tencent.mid.b.g.a(this.a).a(new ArrayList(Arrays.asList(new Integer[] { Integer.valueOf(2) })));
    MidEntity localMidEntity3 = com.tencent.mid.b.g.a(this.a).a(new ArrayList(Arrays.asList(new Integer[] { Integer.valueOf(4) })));
    if ((Util.equal(localMidEntity1, localMidEntity2)) && (Util.equal(localMidEntity1, localMidEntity3)))
    {
      Util.logInfo("local mid check passed.");
      return;
    }
    localMidEntity1 = Util.getNewerMidEntity(Util.getNewerMidEntity(localMidEntity1, localMidEntity2), Util.getNewerMidEntity(localMidEntity1, localMidEntity3));
    Util.logInfo("local mid check failed, redress with mid:" + localMidEntity1.toString());
    com.tencent.mid.b.g.a(this.a).a(localMidEntity1);
  }
  
  private void b()
  {
    d.a(this.a).a(new g(this.a), new i(this));
  }
  
  private void c()
  {
    com.tencent.mid.b.a localA = com.tencent.mid.b.g.a(this.a).b();
    if (localA == null)
    {
      Util.logInfo("CheckEntity is null");
      return;
    }
    int i = localA.c() + 1;
    long l = Math.abs(System.currentTimeMillis() - localA.b());
    Util.logInfo("check entity: " + localA.toString() + ",duration:" + l);
    if (((i > localA.d()) && (l > a.a)) || (l > localA.a() * a.a))
    {
      a();
      b();
      return;
    }
    localA.b(i);
    com.tencent.mid.b.g.a(this.a).a(localA);
  }
  
  public void run()
  {
    Util.logInfo("request type:" + this.c);
    switch (this.c)
    {
    default: 
      Util.logInfo("wrong type:" + this.c);
    }
    do
    {
      return;
      if (Util.isNetworkAvailable(this.a))
      {
        d.a(this.a).a(new g(this.a), this.b);
        return;
      }
      this.b.onFail(55526, "network not available.");
      return;
    } while (!Util.isNetworkAvailable(this.a));
    c();
  }
}
