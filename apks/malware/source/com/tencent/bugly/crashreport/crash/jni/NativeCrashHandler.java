package com.tencent.bugly.crashreport.crash.jni;

import android.content.Context;
import com.tencent.bugly.proguard.a;
import com.tencent.bugly.proguard.l;
import com.tencent.bugly.proguard.n;
import com.tencent.bugly.proguard.t;
import com.tencent.bugly.proguard.u;
import com.tencent.bugly.proguard.x;
import java.io.File;

public class NativeCrashHandler
{
  private static NativeCrashHandler a;
  private final Context b;
  private final n c;
  private final t d;
  private final NativeExceptionHandler e;
  private final String f;
  private final boolean g;
  private boolean h = false;
  private boolean i = false;
  
  private NativeCrashHandler(Context paramContext, n paramN, NativeExceptionHandler paramNativeExceptionHandler, t paramT, boolean paramBoolean)
  {
    this.b = paramContext.getApplicationContext();
    this.f = paramContext.getDir("bugly", 0).getAbsolutePath();
    this.c = paramN;
    this.e = paramNativeExceptionHandler;
    this.d = paramT;
    this.g = paramBoolean;
  }
  
  public static NativeCrashHandler a(Context paramContext, n paramN, NativeExceptionHandler paramNativeExceptionHandler, t paramT, boolean paramBoolean)
  {
    try
    {
      if (a == null) {
        a = new NativeCrashHandler(paramContext, paramN, paramNativeExceptionHandler, paramT, paramBoolean);
      }
      paramContext = a;
      return paramContext;
    }
    finally {}
  }
  
  /* Error */
  private void a(boolean paramBoolean)
  {
    // Byte code:
    //   0: aload_0
    //   1: monitorenter
    //   2: aload_0
    //   3: getfield 31	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler:i	Z
    //   6: ifeq +16 -> 22
    //   9: ldc 73
    //   11: iconst_0
    //   12: anewarray 4	java/lang/Object
    //   15: invokestatic 78	com/tencent/bugly/proguard/u:b	(Ljava/lang/String;[Ljava/lang/Object;)Z
    //   18: pop
    //   19: aload_0
    //   20: monitorexit
    //   21: return
    //   22: aload_0
    //   23: aload_0
    //   24: getfield 53	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler:f	Ljava/lang/String;
    //   27: iload_1
    //   28: iconst_1
    //   29: invokevirtual 82	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler:regist	(Ljava/lang/String;ZI)Ljava/lang/String;
    //   32: astore_2
    //   33: aload_2
    //   34: ifnull +41 -> 75
    //   37: ldc 84
    //   39: iconst_0
    //   40: anewarray 4	java/lang/Object
    //   43: invokestatic 86	com/tencent/bugly/proguard/u:a	(Ljava/lang/String;[Ljava/lang/Object;)Z
    //   46: pop
    //   47: aload_0
    //   48: getfield 55	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler:c	Lcom/tencent/bugly/proguard/n;
    //   51: aload_2
    //   52: invokevirtual 91	com/tencent/bugly/proguard/n:h	(Ljava/lang/String;)V
    //   55: aload_0
    //   56: iconst_1
    //   57: putfield 31	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler:i	Z
    //   60: goto -41 -> 19
    //   63: astore_2
    //   64: aload_2
    //   65: invokestatic 94	com/tencent/bugly/proguard/u:a	(Ljava/lang/Throwable;)Z
    //   68: ifne +7 -> 75
    //   71: aload_2
    //   72: invokevirtual 97	java/lang/Throwable:printStackTrace	()V
    //   75: aload_0
    //   76: iconst_0
    //   77: putfield 29	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler:h	Z
    //   80: goto -61 -> 19
    //   83: astore_2
    //   84: aload_0
    //   85: monitorexit
    //   86: aload_2
    //   87: athrow
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	88	0	this	NativeCrashHandler
    //   0	88	1	paramBoolean	boolean
    //   32	20	2	str	String
    //   63	9	2	localThrowable	Throwable
    //   83	4	2	localObject	Object
    // Exception table:
    //   from	to	target	type
    //   22	33	63	java/lang/Throwable
    //   37	60	63	java/lang/Throwable
    //   2	19	83	finally
    //   22	33	83	finally
    //   37	60	83	finally
    //   64	75	83	finally
    //   75	80	83	finally
  }
  
  public static NativeCrashHandler getInstance()
  {
    try
    {
      NativeCrashHandler localNativeCrashHandler = a;
      return localNativeCrashHandler;
    }
    finally
    {
      localObject = finally;
      throw localObject;
    }
  }
  
  public final String a()
  {
    try
    {
      String str = this.f;
      return str;
    }
    finally
    {
      localObject = finally;
      throw localObject;
    }
  }
  
  /* Error */
  public final void b()
  {
    // Byte code:
    //   0: aload_0
    //   1: monitorenter
    //   2: aload_0
    //   3: getfield 29	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler:h	Z
    //   6: ifeq +14 -> 20
    //   9: aload_0
    //   10: aload_0
    //   11: getfield 61	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler:g	Z
    //   14: invokespecial 103	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler:a	(Z)V
    //   17: aload_0
    //   18: monitorexit
    //   19: return
    //   20: aload_0
    //   21: getfield 55	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler:c	Lcom/tencent/bugly/proguard/n;
    //   24: invokevirtual 106	com/tencent/bugly/proguard/n:C	()Ljava/lang/String;
    //   27: astore_1
    //   28: aload_1
    //   29: ifnonnull +66 -> 95
    //   32: ldc 108
    //   34: invokestatic 113	java/lang/System:loadLibrary	(Ljava/lang/String;)V
    //   37: aload_0
    //   38: iconst_1
    //   39: putfield 29	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler:h	Z
    //   42: aload_0
    //   43: getfield 59	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler:d	Lcom/tencent/bugly/proguard/t;
    //   46: new 6	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler$1
    //   49: dup
    //   50: aload_0
    //   51: invokespecial 116	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler$1:<init>	(Lcom/tencent/bugly/crashreport/crash/jni/NativeCrashHandler;)V
    //   54: invokevirtual 121	com/tencent/bugly/proguard/t:a	(Ljava/lang/Runnable;)Z
    //   57: pop
    //   58: aload_0
    //   59: getfield 29	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler:h	Z
    //   62: ifeq -45 -> 17
    //   65: aload_0
    //   66: aload_0
    //   67: getfield 61	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler:g	Z
    //   70: invokespecial 103	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler:a	(Z)V
    //   73: goto -56 -> 17
    //   76: astore_1
    //   77: aload_0
    //   78: monitorexit
    //   79: aload_1
    //   80: athrow
    //   81: astore_1
    //   82: ldc 123
    //   84: iconst_0
    //   85: anewarray 4	java/lang/Object
    //   88: invokestatic 78	com/tencent/bugly/proguard/u:b	(Ljava/lang/String;[Ljava/lang/Object;)Z
    //   91: pop
    //   92: goto -34 -> 58
    //   95: aload_0
    //   96: getfield 55	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler:c	Lcom/tencent/bugly/proguard/n;
    //   99: invokevirtual 106	com/tencent/bugly/proguard/n:C	()Ljava/lang/String;
    //   102: invokestatic 113	java/lang/System:loadLibrary	(Ljava/lang/String;)V
    //   105: aload_0
    //   106: iconst_1
    //   107: putfield 29	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler:h	Z
    //   110: goto -52 -> 58
    //   113: astore_1
    //   114: ldc 125
    //   116: iconst_1
    //   117: anewarray 4	java/lang/Object
    //   120: dup
    //   121: iconst_0
    //   122: aload_0
    //   123: getfield 55	com/tencent/bugly/crashreport/crash/jni/NativeCrashHandler:c	Lcom/tencent/bugly/proguard/n;
    //   126: invokevirtual 106	com/tencent/bugly/proguard/n:C	()Ljava/lang/String;
    //   129: aastore
    //   130: invokestatic 127	com/tencent/bugly/proguard/u:c	(Ljava/lang/String;[Ljava/lang/Object;)Z
    //   133: pop
    //   134: goto -76 -> 58
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	137	0	this	NativeCrashHandler
    //   27	2	1	str	String
    //   76	4	1	localObject	Object
    //   81	1	1	localThrowable1	Throwable
    //   113	1	1	localThrowable2	Throwable
    // Exception table:
    //   from	to	target	type
    //   2	17	76	finally
    //   20	28	76	finally
    //   32	58	76	finally
    //   58	73	76	finally
    //   82	92	76	finally
    //   95	110	76	finally
    //   114	134	76	finally
    //   32	58	81	java/lang/Throwable
    //   95	110	113	java/lang/Throwable
  }
  
  public final void c()
  {
    if (!this.h)
    {
      u.b("libBugly.so has not been load! so fail!", new Object[0]);
      return;
    }
    testCrash();
  }
  
  protected final void d()
  {
    long l1 = a.n();
    Object localObject1 = new File(this.f);
    if ((((File)localObject1).exists()) && (((File)localObject1).isDirectory()))
    {
      localObject1 = ((File)localObject1).listFiles();
      if ((localObject1 != null) && (localObject1.length != 0)) {}
    }
    else
    {
      return;
    }
    int n = "tomb_".length();
    int i1 = localObject1.length;
    int j = 0;
    Object localObject2;
    String str;
    int m;
    for (int k = 0;; k = m)
    {
      if (j >= i1) {
        break label182;
      }
      localObject2 = localObject1[j];
      str = localObject2.getName();
      m = k;
      if (str.startsWith("tomb_")) {}
      try
      {
        m = str.indexOf(".txt");
        if (m <= 0) {
          break;
        }
        long l2 = Long.parseLong(str.substring(n, m));
        if (l2 < l1 - 604800000L) {
          break;
        }
        m = k;
      }
      catch (Throwable localThrowable)
      {
        for (;;)
        {
          u.c("tomb format error delete %s", new Object[] { str });
          m = k;
          if (localObject2.delete()) {
            m = k + 1;
          }
        }
      }
      j += 1;
    }
    label182:
    u.a();
  }
  
  public NativeExceptionHandler getNativeExceptionHandler()
  {
    return this.e;
  }
  
  protected native String regist(String paramString, boolean paramBoolean, int paramInt);
  
  protected native void testCrash();
  
  protected native String unregist();
}
