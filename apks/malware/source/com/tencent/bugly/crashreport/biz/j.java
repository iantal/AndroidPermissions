package com.tencent.bugly.crashreport.biz;

import android.app.Activity;
import android.app.ActivityManager;
import android.app.ActivityManager.RunningTaskInfo;
import android.content.ComponentName;
import android.content.Context;
import android.os.Debug.MemoryInfo;
import com.tencent.bugly.a.ao;
import com.tencent.bugly.a.bf;
import java.util.List;

class j
  implements Runnable
{
  private Context b;
  
  public j(f paramF, Context paramContext)
  {
    this.b = paramContext;
  }
  
  private int a(long paramLong1, long paramLong2)
  {
    int i = 2;
    if (b(paramLong1, paramLong2)) {
      i = 1;
    }
    while (f.a(this.a).c(2) > 5) {
      return i;
    }
    if (f.a(this.a).d() > 200) {
      return 3;
    }
    return -1;
  }
  
  private String a()
  {
    try
    {
      Object localObject = ((ActivityManager.RunningTaskInfo)f.f(this.a).getRunningTasks(1).get(0)).topActivity;
      if (!((ComponentName)localObject).getPackageName().equals(this.b.getPackageName())) {
        return null;
      }
      localObject = ((ComponentName)localObject).getClassName();
      return localObject;
    }
    catch (Throwable localThrowable) {}
    return null;
  }
  
  private void a(PageBean paramPageBean, int paramInt)
  {
    Object localObject = new String(f.c(this.a));
    f.b(this.a);
    paramPageBean.f = ((String)localObject);
    localObject = SessionBean.a((String)localObject, paramInt, f.a(this.a).e());
    if (localObject == null)
    {
      bf.c("[session] create session error. delete all pages", new Object[0]);
      f.a(this.a).f();
    }
    do
    {
      return;
      f.a(this.a).a((SessionBean)localObject);
      bf.c("[session] save last session(cause: %d): %s", new Object[] { Integer.valueOf(paramInt), localObject });
      f.a(this.a).f();
    } while (paramInt != 3);
    paramPageBean.d = 1;
  }
  
  private boolean a(int paramInt)
  {
    try
    {
      Debug.MemoryInfo[] arrayOfMemoryInfo = ((ActivityManager)this.b.getApplicationContext().getSystemService("activity")).getProcessMemoryInfo(new int[] { paramInt });
      if (arrayOfMemoryInfo[0].dalvikPss == 0)
      {
        paramInt = arrayOfMemoryInfo[0].nativePss;
        if (paramInt == 0) {
          return false;
        }
      }
      return true;
    }
    catch (Throwable localThrowable) {}
    return false;
  }
  
  private boolean b(long paramLong1, long paramLong2)
  {
    if (paramLong2 < 0L) {}
    do
    {
      return false;
      if (f.e(this.a) <= 0L)
      {
        bf.d("[session] SessionOverTime Warning: %d", new Object[] { Long.valueOf(f.e(this.a)) });
        return false;
      }
    } while ((paramLong1 - paramLong2 <= f.e(this.a)) && (paramLong1 >= paramLong2));
    return true;
  }
  
  public void run()
  {
    for (;;)
    {
      try
      {
        Object localObject;
        PageBean localPageBean;
        if ((this.b instanceof Activity))
        {
          localObject = this.b.getClass().getName();
          localObject = PageBean.a(this.b, (String)localObject);
          localPageBean = f.a(this.a).a(null, null, null);
          if (localPageBean == null) {
            break label277;
          }
          f.a(this.a, localPageBean.e);
          if (!localPageBean.a()) {
            continue;
          }
          if (((PageBean)localObject).c == localPageBean.c)
          {
            if ((!"_U".equals(localPageBean.b)) || ("_U".equals(((PageBean)localObject).b))) {
              break;
            }
            localPageBean.g = ((PageBean)localObject).g;
            localPageBean.b = ((PageBean)localObject).b;
            f.a(this.a).b(localPageBean);
            bf.c("[page] update last unnamed page to %s", new Object[] { ((PageBean)localObject).b });
          }
        }
        else
        {
          localObject = a();
          continue;
        }
        if (!a(localPageBean.c)) {
          f.a(this.a, 5, null, localPageBean);
        }
        int i = a(((PageBean)localObject).g, localPageBean.h);
        if (i != -1) {
          a((PageBean)localObject, i);
        }
        ((PageBean)localObject).e = f.c(this.a);
        f.a(this.a).a((PageBean)localObject);
        f.d(this.a).a(true, ((PageBean)localObject).b);
        bf.c("[page] resume record: %s", new Object[] { ((PageBean)localObject).b });
        return;
      }
      catch (Throwable localThrowable)
      {
        if (!bf.a(localThrowable)) {
          localThrowable.printStackTrace();
        }
        bf.c("[page] resume record fail", new Object[0]);
        return;
      }
      label277:
      f.b(this.a);
    }
  }
}
