package com.tencent.tmdownloader.internal.b.c;

import android.content.ContentValues;
import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;
import com.tencent.tmassistantbase.util.TMLog;
import com.tencent.tmdownloader.internal.a.d;
import com.tencent.tmdownloader.internal.b.a.c;
import java.util.ArrayList;

public class f
  implements j
{
  public f() {}
  
  private static int a(d paramD, SQLiteDatabase paramSQLiteDatabase)
  {
    int i;
    if (paramD == null) {
      i = -1;
    }
    for (;;)
    {
      return i;
      try
      {
        ContentValues localContentValues = new ContentValues();
        d.a(localContentValues, paramD);
        int j = paramSQLiteDatabase.update("downloadInfo", localContentValues, "taskUrl = ?", new String[] { paramD.b });
        i = j;
        if (j <= 0) {
          return 0;
        }
      }
      catch (Exception paramD)
      {
        TMLog.e("DownloadInfoTable", "exception: ", paramD);
        paramD.printStackTrace();
      }
    }
    return -2;
  }
  
  public static void a(d paramD)
  {
    if (paramD != null) {}
    try
    {
      SQLiteDatabase localSQLiteDatabase = com.tencent.tmdownloader.internal.b.a.b.a().getWritableDatabase();
      if ((localSQLiteDatabase != null) && (a(paramD, localSQLiteDatabase) <= 0))
      {
        ContentValues localContentValues = new ContentValues();
        d.a(localContentValues, paramD);
        localSQLiteDatabase.insert("downloadInfo", null, localContentValues);
      }
      return;
    }
    catch (Exception paramD)
    {
      TMLog.e("DownloadInfoTable", "exception: ", paramD);
      paramD.printStackTrace();
    }
  }
  
  public static void a(String paramString)
  {
    if ((paramString != null) && (paramString.length() > 0)) {}
    try
    {
      SQLiteDatabase localSQLiteDatabase = com.tencent.tmdownloader.internal.b.a.b.a().getWritableDatabase();
      if (localSQLiteDatabase != null) {
        localSQLiteDatabase.delete("downloadInfo", "taskUrl = ?", new String[] { paramString });
      }
      return;
    }
    catch (Exception paramString)
    {
      TMLog.e("DownloadInfoTable", "exception: ", paramString);
      paramString.printStackTrace();
    }
  }
  
  /* Error */
  public static void a(ArrayList paramArrayList)
  {
    // Byte code:
    //   0: aload_0
    //   1: ifnull +88 -> 89
    //   4: invokestatic 58	com/tencent/tmdownloader/internal/b/a/b:a	()Lcom/tencent/tmdownloader/internal/b/a/c;
    //   7: invokevirtual 64	com/tencent/tmdownloader/internal/b/a/c:getWritableDatabase	()Landroid/database/sqlite/SQLiteDatabase;
    //   10: astore_1
    //   11: aload_1
    //   12: ifnull +77 -> 89
    //   15: aload_1
    //   16: invokevirtual 83	android/database/sqlite/SQLiteDatabase:beginTransaction	()V
    //   19: aload_0
    //   20: invokevirtual 89	java/util/ArrayList:iterator	()Ljava/util/Iterator;
    //   23: astore_0
    //   24: aload_0
    //   25: invokeinterface 95 1 0
    //   30: ifeq +60 -> 90
    //   33: aload_0
    //   34: invokeinterface 99 1 0
    //   39: checkcast 20	com/tencent/tmdownloader/internal/a/d
    //   42: astore_2
    //   43: aload_2
    //   44: aload_1
    //   45: invokestatic 66	com/tencent/tmdownloader/internal/b/c/f:a	(Lcom/tencent/tmdownloader/internal/a/d;Landroid/database/sqlite/SQLiteDatabase;)I
    //   48: ifgt -24 -> 24
    //   51: new 17	android/content/ContentValues
    //   54: dup
    //   55: invokespecial 18	android/content/ContentValues:<init>	()V
    //   58: astore_3
    //   59: aload_3
    //   60: aload_2
    //   61: invokestatic 23	com/tencent/tmdownloader/internal/a/d:a	(Landroid/content/ContentValues;Lcom/tencent/tmdownloader/internal/a/d;)V
    //   64: aload_1
    //   65: ldc 25
    //   67: aconst_null
    //   68: aload_3
    //   69: invokevirtual 70	android/database/sqlite/SQLiteDatabase:insert	(Ljava/lang/String;Ljava/lang/String;Landroid/content/ContentValues;)J
    //   72: pop2
    //   73: goto -49 -> 24
    //   76: astore_0
    //   77: ldc 41
    //   79: ldc 43
    //   81: aload_0
    //   82: invokestatic 49	com/tencent/tmassistantbase/util/TMLog:e	(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)V
    //   85: aload_1
    //   86: invokevirtual 102	android/database/sqlite/SQLiteDatabase:endTransaction	()V
    //   89: return
    //   90: aload_1
    //   91: invokevirtual 105	android/database/sqlite/SQLiteDatabase:setTransactionSuccessful	()V
    //   94: aload_1
    //   95: invokevirtual 102	android/database/sqlite/SQLiteDatabase:endTransaction	()V
    //   98: return
    //   99: astore_0
    //   100: ldc 41
    //   102: ldc 43
    //   104: aload_0
    //   105: invokestatic 49	com/tencent/tmassistantbase/util/TMLog:e	(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)V
    //   108: return
    //   109: astore_0
    //   110: aload_1
    //   111: invokevirtual 102	android/database/sqlite/SQLiteDatabase:endTransaction	()V
    //   114: aload_0
    //   115: athrow
    //   116: astore_1
    //   117: ldc 41
    //   119: ldc 43
    //   121: aload_1
    //   122: invokestatic 49	com/tencent/tmassistantbase/util/TMLog:e	(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)V
    //   125: goto -11 -> 114
    //   128: astore_0
    //   129: goto -29 -> 100
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	132	0	paramArrayList	ArrayList
    //   10	101	1	localSQLiteDatabase	SQLiteDatabase
    //   116	6	1	localException	Exception
    //   42	19	2	localD	d
    //   58	11	3	localContentValues	ContentValues
    // Exception table:
    //   from	to	target	type
    //   15	24	76	java/lang/Exception
    //   24	73	76	java/lang/Exception
    //   90	94	76	java/lang/Exception
    //   94	98	99	java/lang/Exception
    //   15	24	109	finally
    //   24	73	109	finally
    //   77	85	109	finally
    //   90	94	109	finally
    //   110	114	116	java/lang/Exception
    //   85	89	128	java/lang/Exception
  }
  
  /* Error */
  public static d b(String paramString)
  {
    // Byte code:
    //   0: aconst_null
    //   1: astore 4
    //   3: aconst_null
    //   4: astore_3
    //   5: aload 4
    //   7: astore_1
    //   8: aload_0
    //   9: ifnull +78 -> 87
    //   12: aload 4
    //   14: astore_1
    //   15: aload_0
    //   16: invokevirtual 75	java/lang/String:length	()I
    //   19: ifle +68 -> 87
    //   22: invokestatic 58	com/tencent/tmdownloader/internal/b/a/b:a	()Lcom/tencent/tmdownloader/internal/b/a/c;
    //   25: invokevirtual 109	com/tencent/tmdownloader/internal/b/a/c:getReadableDatabase	()Landroid/database/sqlite/SQLiteDatabase;
    //   28: astore_2
    //   29: aload 4
    //   31: astore_1
    //   32: aload_2
    //   33: ifnull +54 -> 87
    //   36: aload_2
    //   37: ldc 111
    //   39: iconst_1
    //   40: anewarray 29	java/lang/String
    //   43: dup
    //   44: iconst_0
    //   45: aload_0
    //   46: aastore
    //   47: invokevirtual 115	android/database/sqlite/SQLiteDatabase:rawQuery	(Ljava/lang/String;[Ljava/lang/String;)Landroid/database/Cursor;
    //   50: astore_0
    //   51: aload_0
    //   52: ifnull +83 -> 135
    //   55: aload_0
    //   56: astore_1
    //   57: aload_0
    //   58: invokeinterface 120 1 0
    //   63: ifeq +72 -> 135
    //   66: aload_0
    //   67: astore_1
    //   68: aload_0
    //   69: invokestatic 123	com/tencent/tmdownloader/internal/a/d:a	(Landroid/database/Cursor;)Lcom/tencent/tmdownloader/internal/a/d;
    //   72: astore_2
    //   73: aload_2
    //   74: astore_1
    //   75: aload_0
    //   76: ifnull +11 -> 87
    //   79: aload_2
    //   80: astore_1
    //   81: aload_0
    //   82: invokeinterface 126 1 0
    //   87: aload_1
    //   88: areturn
    //   89: astore_2
    //   90: aconst_null
    //   91: astore_0
    //   92: aload_0
    //   93: astore_1
    //   94: ldc 41
    //   96: ldc 43
    //   98: aload_2
    //   99: invokestatic 49	com/tencent/tmassistantbase/util/TMLog:e	(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)V
    //   102: aload_0
    //   103: astore_1
    //   104: aload_2
    //   105: invokevirtual 52	java/lang/Exception:printStackTrace	()V
    //   108: aload 4
    //   110: astore_1
    //   111: aload_0
    //   112: ifnull -25 -> 87
    //   115: aload_3
    //   116: astore_1
    //   117: goto -36 -> 81
    //   120: astore_0
    //   121: aconst_null
    //   122: astore_1
    //   123: aload_1
    //   124: ifnull +9 -> 133
    //   127: aload_1
    //   128: invokeinterface 126 1 0
    //   133: aload_0
    //   134: athrow
    //   135: aload 4
    //   137: astore_1
    //   138: aload_0
    //   139: ifnull -52 -> 87
    //   142: aload_3
    //   143: astore_1
    //   144: goto -63 -> 81
    //   147: astore_0
    //   148: goto -25 -> 123
    //   151: astore_2
    //   152: goto -60 -> 92
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	155	0	paramString	String
    //   7	137	1	localObject1	Object
    //   28	52	2	localObject2	Object
    //   89	16	2	localException1	Exception
    //   151	1	2	localException2	Exception
    //   4	139	3	localObject3	Object
    //   1	135	4	localObject4	Object
    // Exception table:
    //   from	to	target	type
    //   36	51	89	java/lang/Exception
    //   36	51	120	finally
    //   57	66	147	finally
    //   68	73	147	finally
    //   94	102	147	finally
    //   104	108	147	finally
    //   57	66	151	java/lang/Exception
    //   68	73	151	java/lang/Exception
  }
  
  /* Error */
  public static d c(String paramString)
  {
    // Byte code:
    //   0: aconst_null
    //   1: astore 4
    //   3: aconst_null
    //   4: astore_3
    //   5: ldc 41
    //   7: new 129	java/lang/StringBuilder
    //   10: dup
    //   11: invokespecial 130	java/lang/StringBuilder:<init>	()V
    //   14: ldc -124
    //   16: invokevirtual 136	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   19: aload_0
    //   20: invokevirtual 136	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   23: invokevirtual 140	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   26: invokestatic 144	com/tencent/tmassistantbase/util/TMLog:i	(Ljava/lang/String;Ljava/lang/String;)V
    //   29: aload 4
    //   31: astore_1
    //   32: aload_0
    //   33: ifnull +78 -> 111
    //   36: aload 4
    //   38: astore_1
    //   39: aload_0
    //   40: invokevirtual 75	java/lang/String:length	()I
    //   43: ifle +68 -> 111
    //   46: invokestatic 58	com/tencent/tmdownloader/internal/b/a/b:a	()Lcom/tencent/tmdownloader/internal/b/a/c;
    //   49: invokevirtual 109	com/tencent/tmdownloader/internal/b/a/c:getReadableDatabase	()Landroid/database/sqlite/SQLiteDatabase;
    //   52: astore_2
    //   53: aload 4
    //   55: astore_1
    //   56: aload_2
    //   57: ifnull +54 -> 111
    //   60: aload_2
    //   61: ldc -110
    //   63: iconst_1
    //   64: anewarray 29	java/lang/String
    //   67: dup
    //   68: iconst_0
    //   69: aload_0
    //   70: aastore
    //   71: invokevirtual 115	android/database/sqlite/SQLiteDatabase:rawQuery	(Ljava/lang/String;[Ljava/lang/String;)Landroid/database/Cursor;
    //   74: astore_0
    //   75: aload_0
    //   76: ifnull +83 -> 159
    //   79: aload_0
    //   80: astore_1
    //   81: aload_0
    //   82: invokeinterface 120 1 0
    //   87: ifeq +72 -> 159
    //   90: aload_0
    //   91: astore_1
    //   92: aload_0
    //   93: invokestatic 123	com/tencent/tmdownloader/internal/a/d:a	(Landroid/database/Cursor;)Lcom/tencent/tmdownloader/internal/a/d;
    //   96: astore_2
    //   97: aload_2
    //   98: astore_1
    //   99: aload_0
    //   100: ifnull +11 -> 111
    //   103: aload_2
    //   104: astore_1
    //   105: aload_0
    //   106: invokeinterface 126 1 0
    //   111: aload_1
    //   112: areturn
    //   113: astore_2
    //   114: aconst_null
    //   115: astore_0
    //   116: aload_0
    //   117: astore_1
    //   118: ldc 41
    //   120: ldc 43
    //   122: aload_2
    //   123: invokestatic 49	com/tencent/tmassistantbase/util/TMLog:e	(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)V
    //   126: aload_0
    //   127: astore_1
    //   128: aload_2
    //   129: invokevirtual 52	java/lang/Exception:printStackTrace	()V
    //   132: aload 4
    //   134: astore_1
    //   135: aload_0
    //   136: ifnull -25 -> 111
    //   139: aload_3
    //   140: astore_1
    //   141: goto -36 -> 105
    //   144: astore_0
    //   145: aconst_null
    //   146: astore_1
    //   147: aload_1
    //   148: ifnull +9 -> 157
    //   151: aload_1
    //   152: invokeinterface 126 1 0
    //   157: aload_0
    //   158: athrow
    //   159: aload 4
    //   161: astore_1
    //   162: aload_0
    //   163: ifnull -52 -> 111
    //   166: aload_3
    //   167: astore_1
    //   168: goto -63 -> 105
    //   171: astore_0
    //   172: goto -25 -> 147
    //   175: astore_2
    //   176: goto -60 -> 116
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	179	0	paramString	String
    //   31	137	1	localObject1	Object
    //   52	52	2	localObject2	Object
    //   113	16	2	localException1	Exception
    //   175	1	2	localException2	Exception
    //   4	163	3	localObject3	Object
    //   1	159	4	localObject4	Object
    // Exception table:
    //   from	to	target	type
    //   60	75	113	java/lang/Exception
    //   60	75	144	finally
    //   81	90	171	finally
    //   92	97	171	finally
    //   118	126	171	finally
    //   128	132	171	finally
    //   81	90	175	java/lang/Exception
    //   92	97	175	java/lang/Exception
  }
  
  public static ArrayList c()
  {
    localObject3 = null;
    localObject1 = null;
    ArrayList localArrayList = new ArrayList();
    Object localObject4 = com.tencent.tmdownloader.internal.b.a.b.a().getReadableDatabase();
    if (localObject4 != null) {}
    try
    {
      localObject4 = ((SQLiteDatabase)localObject4).rawQuery("select * from downloadInfo", null);
      if (localObject4 != null)
      {
        localObject1 = localObject4;
        localObject3 = localObject4;
        if (((Cursor)localObject4).moveToFirst())
        {
          boolean bool;
          do
          {
            localObject1 = localObject4;
            localObject3 = localObject4;
            localArrayList.add(d.a((Cursor)localObject4));
            localObject1 = localObject4;
            localObject3 = localObject4;
            bool = ((Cursor)localObject4).moveToNext();
          } while (bool);
        }
      }
      if (localObject4 == null) {
        break label90;
      }
      localObject1 = localObject4;
    }
    catch (Exception localException)
    {
      for (;;)
      {
        label90:
        localObject3 = localObject1;
        TMLog.e("DownloadInfoTable", "exception: ", localException);
        localObject3 = localObject1;
        localException.printStackTrace();
        if (localObject1 == null) {}
      }
    }
    finally
    {
      if (localObject3 == null) {
        break label128;
      }
      localObject3.close();
    }
    localObject1.close();
    return localArrayList;
  }
  
  public static ArrayList d()
  {
    localObject3 = null;
    localObject1 = null;
    ArrayList localArrayList = new ArrayList();
    Object localObject4 = com.tencent.tmdownloader.internal.b.a.b.a().getReadableDatabase();
    if (localObject4 != null) {}
    try
    {
      localObject4 = ((SQLiteDatabase)localObject4).rawQuery("select a.taskUrl,a.status,b.clientId from downloadInfo as a left outer join clientinfo as b on a.taskUrl = b.taskUrl where b.clientId is not null and (a.status = 2 or a.status = 1)", null);
      if (localObject4 != null)
      {
        localObject1 = localObject4;
        localObject3 = localObject4;
        if (((Cursor)localObject4).moveToFirst())
        {
          boolean bool;
          do
          {
            localObject1 = localObject4;
            localObject3 = localObject4;
            Object localObject5 = ((Cursor)localObject4).getString(((Cursor)localObject4).getColumnIndex("clientId"));
            localObject1 = localObject4;
            localObject3 = localObject4;
            String str = ((Cursor)localObject4).getString(((Cursor)localObject4).getColumnIndex("taskUrl"));
            localObject1 = localObject4;
            localObject3 = localObject4;
            int i = ((Cursor)localObject4).getInt(((Cursor)localObject4).getColumnIndex("status"));
            localObject1 = localObject4;
            localObject3 = localObject4;
            localObject5 = new com.tencent.tmdownloader.internal.a.a.b((String)localObject5, str);
            localObject1 = localObject4;
            localObject3 = localObject4;
            ((com.tencent.tmdownloader.internal.a.a.b)localObject5).c = i;
            localObject1 = localObject4;
            localObject3 = localObject4;
            localArrayList.add(localObject5);
            localObject1 = localObject4;
            localObject3 = localObject4;
            bool = ((Cursor)localObject4).moveToNext();
          } while (bool);
        }
      }
      if (localObject4 == null) {
        break label205;
      }
      localObject1 = localObject4;
    }
    catch (Exception localException)
    {
      for (;;)
      {
        label205:
        localObject3 = localObject1;
        TMLog.e("DownloadInfoTable", "exception: ", localException);
        localObject3 = localObject1;
        localException.printStackTrace();
        if (localObject1 == null) {}
      }
    }
    finally
    {
      if (localObject3 == null) {
        break label246;
      }
      localObject3.close();
    }
    localObject1.close();
    return localArrayList;
  }
  
  public String a()
  {
    return "downloadInfo";
  }
  
  public void a(SQLiteDatabase paramSQLiteDatabase1, SQLiteDatabase paramSQLiteDatabase2)
  {
    localObject = null;
    localSQLiteDatabase = null;
    if ((paramSQLiteDatabase2 != null) && (paramSQLiteDatabase1 != null)) {
      paramSQLiteDatabase2.beginTransaction();
    }
    try
    {
      paramSQLiteDatabase1 = paramSQLiteDatabase1.rawQuery("select * from downloadInfo", null);
      if (paramSQLiteDatabase1 != null)
      {
        localSQLiteDatabase = paramSQLiteDatabase1;
        localObject = paramSQLiteDatabase1;
        if (paramSQLiteDatabase1.moveToFirst())
        {
          localSQLiteDatabase = paramSQLiteDatabase1;
          localObject = paramSQLiteDatabase1;
          TMLog.i("downloadInfo", "start move data!");
          boolean bool;
          do
          {
            localSQLiteDatabase = paramSQLiteDatabase1;
            localObject = paramSQLiteDatabase1;
            ContentValues localContentValues = new ContentValues();
            localSQLiteDatabase = paramSQLiteDatabase1;
            localObject = paramSQLiteDatabase1;
            d.a(localContentValues, d.b(paramSQLiteDatabase1));
            localSQLiteDatabase = paramSQLiteDatabase1;
            localObject = paramSQLiteDatabase1;
            paramSQLiteDatabase2.insert("downloadInfo", null, localContentValues);
            localSQLiteDatabase = paramSQLiteDatabase1;
            localObject = paramSQLiteDatabase1;
            bool = paramSQLiteDatabase1.moveToNext();
          } while (bool);
        }
      }
      if (paramSQLiteDatabase1 == null) {
        break label131;
      }
    }
    catch (Exception paramSQLiteDatabase1)
    {
      for (;;)
      {
        label131:
        localObject = localSQLiteDatabase;
        TMLog.e("DownloadInfoTable", "exception: ", paramSQLiteDatabase1);
        localObject = localSQLiteDatabase;
        paramSQLiteDatabase1.printStackTrace();
        localObject = localSQLiteDatabase;
        TMLog.i("downloadInfo", "move data exception!");
        if (localSQLiteDatabase != null) {
          paramSQLiteDatabase1 = localSQLiteDatabase;
        }
      }
    }
    finally
    {
      if (localObject == null) {
        break label196;
      }
      ((Cursor)localObject).close();
    }
    paramSQLiteDatabase1.close();
    paramSQLiteDatabase2.setTransactionSuccessful();
    paramSQLiteDatabase2.endTransaction();
  }
  
  public String[] a(int paramInt1, int paramInt2)
  {
    if ((paramInt1 == 1) && (paramInt2 == 2)) {
      return new String[] { "alter table downloadInfo add column headerParams TEXT;" };
    }
    if ((paramInt1 == 2) && (paramInt2 == 3)) {
      return new String[] { "alter table downloadInfo add column appId INTEGER;", "alter table downloadInfo add column taskPakcageName TEXT;", "alter table downloadInfo add column taskVersioncode TEXT;", "alter table downloadInfo add column clientIp TEXT;", "alter table downloadInfo add column startTime INTEGER;", "alter table downloadInfo add column endTime INTEGER;", "alter table downloadInfo add column downloadType INTEGER;", "alter table downloadInfo add column uin INTEGER;", "alter table downloadInfo add column uintype TEXT;", "alter table downloadInfo add column via TEXT;", "alter table downloadInfo add column channelId TEXT;", "alter table downloadInfo add column traceId TEXT;", "alter table downloadInfo add column extraData TEXT;" };
    }
    return new String[] { "alter table downloadInfo add column netType TEXT;", "alter table downloadInfo add column downloadFailedErrCode INTEGER;", "alter table downloadInfo add column downloadFailedTime INTEGER;" };
  }
  
  public String b()
  {
    return "CREATE TABLE if not exists downloadInfo( _id INTEGER PRIMARY KEY AUTOINCREMENT, taskId INTEGER , uId TEXT, taskUrl TEXT, finalUrl TEXT, fileName TEXT, contentType TEXT, redirectCnt INTEGER, retryCnt INTEGER, totalBytes INTEGER,status INTEGER,receivedBytes INTEGER,priority INTEGER, netType TEXT,downloadFailedErrCode INTEGER,downloadFailedTime INTEGER,headerParams TEXT,appId INTEGER,taskPakcageName TEXT,taskVersioncode TEXT,clientIp TEXT,startTime INTEGER,endTime INTEGER,downloadType INTEGER,uin INTEGER,uintype TEXT,via TEXT,channelId TEXT,traceId TEXT,extraData TEXT);";
  }
}
