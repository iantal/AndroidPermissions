package com.tencent.android.tpush.horse;

import android.text.TextUtils;
import com.tencent.android.tpush.horse.data.ServerItem;
import com.tencent.android.tpush.logging.TLog;
import com.tencent.android.tpush.service.cache.CacheManager;
import com.tencent.android.tpush.service.channel.exception.NullReturnException;
import com.tencent.android.tpush.service.channel.protocol.ApList;
import com.tencent.android.tpush.service.d.d;
import com.tencent.android.tpush.service.l;
import java.net.InetAddress;
import java.net.UnknownHostException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.Iterator;
import java.util.Map;
import java.util.Set;

public class DefaultServer
{
  public static String a = "tpns.qq.com";
  public static ArrayList b = new ArrayList(Arrays.asList(new Integer[] { Integer.valueOf(443), Integer.valueOf(8080), Integer.valueOf(80), Integer.valueOf(14000) }));
  public static String[] c = { "183.232.98.178" };
  public static String[] d = { "58.251.139.182" };
  public static String[] e = { "183.61.46.193" };
  public static final DefaultServer.ENV f = DefaultServer.ENV.RELEASE;
  public static final ArrayList g;
  
  static
  {
    Collections.shuffle(b);
    a = "tpns.qq.com";
    c = new String[] { "183.232.98.178", "111.30.131.23" };
    d = new String[] { "58.251.139.182", "125.39.240.55" };
    e = new String[] { "183.61.46.193", "123.151.152.50" };
    g = new ArrayList();
    g.add(new ServerItem("183.61.46.193", 443, 0));
  }
  
  public static ArrayList a()
  {
    TLog.v("XGService", "@@ getAllServerItems()");
    localArrayList = new ArrayList();
    Object localObject1 = b.iterator();
    while (((Iterator)localObject1).hasNext())
    {
      int j = ((Integer)((Iterator)localObject1).next()).intValue();
      int i = 0;
      while (i < c.length)
      {
        localArrayList.add(new ServerItem(c[i], j, 3));
        i += 1;
      }
      i = 0;
      while (i < e.length)
      {
        localArrayList.add(new ServerItem(e[i], j, 1));
        i += 1;
      }
      i = 0;
      while (i < d.length)
      {
        localArrayList.add(new ServerItem(d[i], j, 2));
        i += 1;
      }
    }
    Object localObject2 = CacheManager.getDomain(l.f());
    localObject1 = localObject2;
    if (TextUtils.isEmpty((CharSequence)localObject2)) {
      localObject1 = a;
    }
    try
    {
      localObject1 = InetAddress.getByName((String)localObject1).getHostAddress();
      localObject2 = b.iterator();
      while (((Iterator)localObject2).hasNext()) {
        localArrayList.add(new ServerItem((String)localObject1, ((Integer)((Iterator)localObject2).next()).intValue(), 0));
      }
      return localArrayList;
    }
    catch (UnknownHostException localUnknownHostException)
    {
      TLog.e("XGService", ">> Dns resolve err : " + localUnknownHostException.getMessage());
      return localArrayList;
    }
    catch (Exception localException)
    {
      TLog.e("XGService", ">> Dns resolve err : " + localException.getMessage());
    }
  }
  
  public static ArrayList a(String paramString)
  {
    TLog.v("XGService", "@@ createDefaultItems(" + paramString + ")");
    if (paramString == null) {
      throw new NullReturnException("createDefaultItems return null,because key is null");
    }
    ArrayList localArrayList = new ArrayList();
    int j;
    int i;
    if (paramString.equals(String.valueOf(3)))
    {
      paramString = b.iterator();
      while (paramString.hasNext())
      {
        j = ((Integer)paramString.next()).intValue();
        i = 0;
        while (i < c.length)
        {
          localArrayList.add(new ServerItem(c[i], j, 3));
          i += 1;
        }
      }
    }
    if (paramString.equals(String.valueOf(1)))
    {
      paramString = b.iterator();
      while (paramString.hasNext())
      {
        j = ((Integer)paramString.next()).intValue();
        i = 0;
        while (i < e.length)
        {
          localArrayList.add(new ServerItem(e[i], j, 1));
          i += 1;
        }
      }
    }
    if (paramString.equals(String.valueOf(2)))
    {
      paramString = b.iterator();
      while (paramString.hasNext())
      {
        j = ((Integer)paramString.next()).intValue();
        i = 0;
        while (i < d.length)
        {
          localArrayList.add(new ServerItem(d[i], j, 2));
          i += 1;
        }
      }
    }
    Object localObject = CacheManager.getDomain(l.f());
    TLog.i("XGService", "cache domain=" + (String)localObject);
    paramString = (String)localObject;
    if (TextUtils.isEmpty((CharSequence)localObject))
    {
      paramString = a;
      TLog.i("XGService", "default domain=" + paramString);
    }
    try
    {
      paramString = InetAddress.getByName(paramString).getHostAddress();
      TLog.i("XGService", "LocalDns parse domain success,domain ip=" + paramString);
      localObject = b.iterator();
      while (((Iterator)localObject).hasNext()) {
        localArrayList.add(new ServerItem(paramString, ((Integer)((Iterator)localObject).next()).intValue(), 0));
      }
    }
    catch (UnknownHostException paramString)
    {
      for (;;)
      {
        TLog.e("XGService", paramString.getMessage());
        paramString = c[0];
      }
    }
    catch (Exception paramString)
    {
      for (;;)
      {
        TLog.e("XGService", paramString.getMessage());
        paramString = c[0];
      }
    }
    return localArrayList;
  }
  
  public static void a(ApList paramApList)
  {
    TLog.v("XGService", "@@ saveDefaultServer(" + paramApList + ")");
    Object localObject1 = paramApList.primary;
    Object localObject2 = paramApList.secondary;
    ArrayList localArrayList = paramApList.portList;
    Object localObject3 = new ArrayList();
    Object localObject4 = new ArrayList();
    Object localObject5 = new ArrayList();
    Iterator localIterator1 = ((Map)localObject1).keySet().iterator();
    Byte localByte;
    String str;
    Iterator localIterator2;
    ServerItem localServerItem;
    while (localIterator1.hasNext())
    {
      localByte = (Byte)localIterator1.next();
      TLog.i("XGService", ">> ip : " + ((Map)localObject1).get(localByte));
      str = d.a(((Long)((Map)localObject1).get(localByte)).longValue());
      if (!TextUtils.isEmpty(str))
      {
        localIterator2 = localArrayList.iterator();
        while (localIterator2.hasNext())
        {
          localServerItem = new ServerItem(str, ((Integer)localIterator2.next()).intValue(), localByte.intValue());
          TLog.i("XGService", ">> serverItem : " + localServerItem.toString() + ",key : " + localByte);
          if (localByte.byteValue() == 3) {
            ((ArrayList)localObject3).add(localServerItem);
          }
          if (localByte.byteValue() == 1) {
            ((ArrayList)localObject4).add(localServerItem);
          }
          if (localByte.byteValue() == 2) {
            ((ArrayList)localObject5).add(localServerItem);
          }
        }
      }
    }
    localIterator1 = ((Map)localObject2).keySet().iterator();
    while (localIterator1.hasNext())
    {
      localByte = (Byte)localIterator1.next();
      TLog.i("XGService", ">> sec ip : " + ((Map)localObject1).get(localByte));
      str = d.a(((Long)((Map)localObject2).get(localByte)).longValue());
      if (!TextUtils.isEmpty(str))
      {
        localIterator2 = localArrayList.iterator();
        while (localIterator2.hasNext())
        {
          localServerItem = new ServerItem(str, ((Integer)localIterator2.next()).intValue(), localByte.intValue());
          TLog.i("XGService", ">> serverItem : " + localServerItem.toString());
          if (localByte.byteValue() == 3) {
            ((ArrayList)localObject3).add(localServerItem);
          }
          if (localByte.byteValue() == 1) {
            ((ArrayList)localObject4).add(localServerItem);
          }
          if (localByte.byteValue() == 2) {
            ((ArrayList)localObject5).add(localServerItem);
          }
        }
      }
    }
    if (!((ArrayList)localObject3).isEmpty()) {
      CacheManager.addServerItems(l.f(), "3", (ArrayList)localObject3);
    }
    if (!((ArrayList)localObject4).isEmpty()) {
      CacheManager.addServerItems(l.f(), "1", (ArrayList)localObject4);
    }
    if (!((ArrayList)localObject5).isEmpty()) {
      CacheManager.addServerItems(l.f(), "2", (ArrayList)localObject5);
    }
    localObject2 = paramApList.speedTestIpList;
    localObject1 = new ArrayList();
    localObject2 = ((ArrayList)localObject2).iterator();
    while (((Iterator)localObject2).hasNext())
    {
      localObject3 = (Long)((Iterator)localObject2).next();
      localObject4 = localArrayList.iterator();
      while (((Iterator)localObject4).hasNext())
      {
        localObject5 = (Integer)((Iterator)localObject4).next();
        TLog.i("XGService", ">> serverItem : " + new ServerItem(((Long)localObject3).longValue(), ((Integer)localObject5).intValue(), 0).toString());
        ((ArrayList)localObject1).add(new ServerItem(((Long)localObject3).longValue(), ((Integer)localObject5).intValue(), 0));
      }
    }
    CacheManager.saveSpeedTestList(l.f(), (ArrayList)localObject1);
    paramApList = paramApList.domain;
    TLog.i("XGService", ">> domain : " + paramApList);
    if ((!TextUtils.isEmpty(paramApList)) && (!paramApList.equals(CacheManager.getDomain(l.f()))))
    {
      CacheManager.clearDomainServerItem(l.f());
      CacheManager.saveDomain(l.f(), paramApList);
    }
  }
}
