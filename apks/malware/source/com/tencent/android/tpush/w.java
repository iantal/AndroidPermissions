package com.tencent.android.tpush;

import android.content.Context;
import android.content.Intent;
import com.tencent.android.tpush.common.l;
import com.tencent.android.tpush.common.o;
import com.tencent.android.tpush.common.p;
import com.tencent.android.tpush.encrypt.Rijndael;
import com.tencent.android.tpush.logging.TLog;
import com.tencent.android.tpush.service.channel.security.TpnsSecurity;

final class w
  implements Runnable
{
  w(Context paramContext, XGIOperateCallback paramXGIOperateCallback, long paramLong, String paramString) {}
  
  public void run()
  {
    try
    {
      if (!TpnsSecurity.checkTpnsSecurityLibSo(this.a))
      {
        if (this.b == null) {
          return;
        }
        this.b.onFail("missing libTpnsSecurity.so", 10004, "please add libTpnsSecurity.so to your project!");
        return;
      }
      if (!XGPushManager.isEnableService(this.a))
      {
        if (this.b == null) {
          return;
        }
        this.b.onFail("", 10004, "XG service is disable");
        return;
      }
    }
    catch (Throwable localThrowable)
    {
      TLog.e("TPush", localThrowable.getMessage());
      return;
    }
    if (!l.a(this.a))
    {
      TLog.e("TPush", "check Permissions failed!");
      if (this.b != null) {
        this.b.onFail("PermissionChecker", 10003, "check Permissions failed!");
      }
    }
    else
    {
      long l;
      if (this.c <= 0L)
      {
        l = XGPushConfig.getAccessId(this.a);
        if (!p.a(this.d)) {
          break label266;
        }
      }
      String str2;
      label266:
      for (String str1 = XGPushConfig.getAccessKey(this.a);; str1 = this.d)
      {
        str2 = XGPushConfig.getToken(this.a);
        if (((l > 0L) && (!p.a(str1)) && (!p.a(str2))) || (this.b == null)) {
          break label275;
        }
        this.b.onFail(null, 10001, "The accessId, accessKey or token is invalid! accessId=" + l + ",accessKey=" + str1 + ",token=" + str2);
        throw new IllegalArgumentException("accessId, accessKey or token is invalid.");
        l = this.c;
        break;
      }
      label275:
      Intent localIntent = new Intent("com.tencent.android.tpush.action.UNREGISTER");
      localIntent.putExtra("accId", Rijndael.encrypt("" + l));
      localIntent.putExtra("accKey", Rijndael.encrypt(str1));
      localIntent.putExtra("token", Rijndael.encrypt(str2));
      localIntent.putExtra("packName", Rijndael.encrypt(this.a.getPackageName()));
      localIntent.putExtra("operation", 101);
      localIntent.putExtra("opType", 1);
      boolean bool = o.a(this.a).a();
      if ((p.b(this.a) == 1) && (!bool))
      {
        XGPushManager.a(this.a, localIntent, this.b);
        return;
      }
      XGPushManager.a(this.a, localIntent, this.b, bool);
    }
  }
}
