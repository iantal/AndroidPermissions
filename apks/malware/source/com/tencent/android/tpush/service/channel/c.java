package com.tencent.android.tpush.service.channel;

import com.tencent.android.tpush.horse.data.StrategyItem;
import com.tencent.android.tpush.logging.TLog;
import com.tencent.android.tpush.service.channel.exception.ChannelException;
import java.nio.channels.SocketChannel;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

class c
  implements com.tencent.android.tpush.horse.l
{
  c(b paramB) {}
  
  public void a(int paramInt, String paramString)
  {
    TLog.v("XGService", "@@ onFailure(" + paramInt + "," + paramString + ")");
    for (;;)
    {
      n localN;
      synchronized (this.a)
      {
        b.a(this.a, false);
        if ((com.tencent.android.tpush.service.d.a.g(com.tencent.android.tpush.service.l.f())) && (b.a(this.a)))
        {
          TLog.i("XGService", ">> online but failed,retry");
          b.b(this.a, false);
          b.b(this.a);
          b.a = 0;
          return;
        }
        TLog.i("XGService", ">> retryed once,but failed again,then");
        paramString = new ChannelException(paramInt, paramString);
        Iterator localIterator = b.c(this.a).iterator();
        if (!localIterator.hasNext()) {
          break label202;
        }
        localN = (n)localIterator.next();
        if (localN.d != null) {
          localN.d.a(localN.c, paramString, a.a());
        }
      }
      TLog.e("XGService", localN.toString());
      continue;
      label202:
      b.c(this.a).clear();
    }
  }
  
  public void a(SocketChannel paramSocketChannel, StrategyItem paramStrategyItem)
  {
    TLog.v("XGService", "@@ onSuccess(" + paramSocketChannel + "," + paramSocketChannel + ")");
    for (;;)
    {
      synchronized (this.a)
      {
        b.a(this.a, false);
        try
        {
          if (!b.f().equals(paramStrategyItem.a())) {}
          switch (com.tencent.android.tpush.service.d.d.e(com.tencent.android.tpush.service.l.f()))
          {
          case 1: 
            b.a(paramStrategyItem.a());
            b.a = 0;
            b localB2 = this.a;
            if (!paramStrategyItem.i()) {
              break label343;
            }
            if (!paramStrategyItem.h()) {
              break label328;
            }
            paramSocketChannel = new com.tencent.android.tpush.service.channel.a.d(paramSocketChannel, b.b(), paramStrategyItem.a(), paramStrategyItem.b());
            b.a(localB2, paramSocketChannel);
            TLog.i("XGService", ">> tpnsClient : " + b.d(this.a) + ")");
            this.a.a(true);
            b.d(this.a).start();
            TLog.i("XGService", ">> sentMessagesOfClient Clear");
            b.e(this.a).clear();
            b.e(this.a).put(b.d(this.a), new ConcurrentHashMap());
            b.b(this.a, true);
          }
        }
        catch (Exception paramSocketChannel)
        {
          TLog.e("XGService", paramSocketChannel.getMessage());
          continue;
        }
        return;
        b.f = b.d;
      }
      b.f = b.c;
      continue;
      b.f = b.c;
      continue;
      b.f = b.c;
      continue;
      label328:
      paramSocketChannel = new com.tencent.android.tpush.service.channel.a.c(paramSocketChannel, b.b());
      continue;
      label343:
      paramSocketChannel = new com.tencent.android.tpush.service.channel.a.a(paramSocketChannel, b.b());
    }
  }
}
