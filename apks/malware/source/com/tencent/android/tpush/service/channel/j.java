package com.tencent.android.tpush.service.channel;

import android.os.Handler;
import com.tencent.android.tpush.logging.TLog;
import com.tencent.android.tpush.service.channel.exception.ChannelException;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Iterator;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

class j
  implements Runnable
{
  private com.tencent.android.tpush.service.channel.a.a b = null;
  private ChannelException c = null;
  
  public j(b paramB, com.tencent.android.tpush.service.channel.a.a paramA, ChannelException paramChannelException)
  {
    this.b = paramA;
    this.c = paramChannelException;
  }
  
  public void run()
  {
    TLog.v("XGService", "@@RequestFailRunnable run()");
    if (this.b == null)
    {
      TLog.e("XGService", "@@RequestFailRunnable currentClient == null");
      return;
    }
    long l = System.currentTimeMillis();
    a localA = this.b.e();
    ??? = (ConcurrentHashMap)b.e(this.a).get(this.b);
    Iterator localIterator;
    n localN;
    o localO;
    l localL;
    if (??? != null)
    {
      localIterator = ((ConcurrentHashMap)???).values().iterator();
      while (localIterator.hasNext())
      {
        localN = (n)localIterator.next();
        localO = localN.d;
        if (localO != null)
        {
          localA.a(3, Long.valueOf(l - localN.b));
          localL = (l)b.g(this.a).remove(localN);
          b.h(this.a).removeCallbacks(localL);
          localO.a(localN.c, this.c, localA);
        }
      }
      ((ConcurrentHashMap)???).clear();
    }
    if (!this.b.d())
    {
      TLog.i("XGService", ">> tcp");
      synchronized (this.a)
      {
        localIterator = b.c(this.a).iterator();
        while (localIterator.hasNext())
        {
          localN = (n)localIterator.next();
          localO = localN.d;
          if (localO != null)
          {
            localA.a(3, Long.valueOf(l - localN.b));
            localL = (l)b.g(this.a).get(localN);
            b.h(this.a).removeCallbacks(localL);
            localO.a(localN.c, this.c, localA);
          }
        }
      }
      b.c(this.a).clear();
    }
    b.a = 0;
    if (b.f > b.d) {}
    for (b.f = b.f / 10 * 9;; b.f = b.d)
    {
      this.a.d();
      if (b.c(this.a).isEmpty()) {
        break;
      }
      TLog.i("XGService", ">> tpnsMessages is not empty!");
      b.b(this.a);
      return;
    }
  }
}
