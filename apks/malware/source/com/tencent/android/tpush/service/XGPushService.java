package com.tencent.android.tpush.service;

import android.app.Notification;
import android.app.Service;
import android.content.Context;
import android.content.Intent;
import android.os.Build.VERSION;
import android.os.IBinder;
import android.os.Process;
import android.util.Log;
import com.jg.JgClassChecked;
import com.tencent.android.tpush.XGPushManager;
import com.tencent.android.tpush.logging.TLog;
import com.tencent.android.tpush.service.c.a;
import com.tencent.android.tpush.service.channel.security.TpnsSecurity;
import com.tencent.android.tpush.service.d.d;

@JgClassChecked(author=1, fComment="确认已进行安全校验", lastDate="20150316", reviewer=3, vComment={com.jg.EType.SERVICESCHECK})
public class XGPushService
  extends Service
{
  public XGPushService() {}
  
  private void a()
  {
    boolean bool = true;
    TLog.init(getApplicationContext());
    if (d.b(getApplicationContext(), "com.tencent.android.tpush.debug," + getApplicationContext().getPackageName(), 0) == 1) {}
    for (;;)
    {
      TLog.v("XGService", "@@ initDebug:" + bool);
      TLog.enable(bool);
      a.a(bool);
      return;
      bool = false;
    }
  }
  
  public IBinder onBind(Intent paramIntent)
  {
    return null;
  }
  
  public void onCreate()
  {
    super.onCreate();
    if (Build.VERSION.SDK_INT < 18) {
      startForeground(63538, new Notification());
    }
    Context localContext = getApplicationContext();
    a.a(localContext);
    l.b(localContext);
    a();
    TLog.v("XGService", "@@ onCreate():" + getPackageName());
    l.a().b();
  }
  
  public void onDestroy()
  {
    TLog.w("XGService", "@@ onDestroy() " + getClass().getName());
    l.a().d();
    super.onDestroy();
  }
  
  public void onStart(Intent paramIntent, int paramInt)
  {
    super.onStart(paramIntent, paramInt);
    TLog.v("XGService", "@@ onStart(" + paramIntent + "," + paramInt + ")");
  }
  
  public int onStartCommand(Intent paramIntent, int paramInt1, int paramInt2)
  {
    super.onStartCommand(paramIntent, 1, paramInt2);
    if ((!TpnsSecurity.checkTpnsSecurityLibSo(getApplicationContext())) || (!XGPushManager.isEnableService(getApplicationContext())))
    {
      Log.e("XGService", "libtpnsSecurity.so load failed or XG is disable, kill xg service.");
      Process.killProcess(Process.myPid());
      return 2;
    }
    a();
    TLog.v("XGService", "@@ onStartCommand(" + paramIntent + "," + paramInt1 + "," + paramInt2 + ")");
    d.a(l.f(), "tpush.wifi.bandon", "");
    l.a().c();
    return 1;
  }
}
