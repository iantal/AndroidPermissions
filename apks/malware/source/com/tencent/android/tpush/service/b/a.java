package com.tencent.android.tpush.service.b;

import android.app.PendingIntent;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.os.Bundle;
import com.jg.JgClassChecked;
import com.tencent.android.tpush.common.g;
import com.tencent.android.tpush.data.CachedMessageIntent;
import com.tencent.android.tpush.data.MessageId;
import com.tencent.android.tpush.data.PushClickEntity;
import com.tencent.android.tpush.encrypt.Rijndael;
import com.tencent.android.tpush.logging.TLog;
import com.tencent.android.tpush.service.cache.CacheManager;
import com.tencent.android.tpush.service.channel.protocol.TpnsClickClientReport;
import com.tencent.android.tpush.service.channel.protocol.TpnsPushClientReport;
import com.tencent.android.tpush.service.channel.protocol.TpnsPushMsg;
import com.tencent.android.tpush.service.l;
import com.tencent.android.tpush.service.o;
import com.tencent.android.tpush.service.t;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Set;
import org.json.JSONObject;

@JgClassChecked(author=1, fComment="确认已进行安全校验", lastDate="20150316", reviewer=3, vComment={com.jg.EType.INTENTSCHEMECHECK, com.jg.EType.INTENTCHECK, com.jg.EType.RECEIVERCHECK})
public class a
{
  public static long a = 306000L;
  private static a b = new a();
  private static final byte[] c = new byte[0];
  private static long d = 0L;
  private static volatile boolean e = false;
  private static volatile boolean f = false;
  private static volatile boolean g = false;
  private PendingIntent h = null;
  
  private a() {}
  
  public static a a()
  {
    return b;
  }
  
  private void a(Context paramContext, String paramString1, String paramString2, ArrayList paramArrayList)
  {
    try
    {
      paramArrayList = Rijndael.encrypt(com.tencent.android.tpush.common.k.a(paramArrayList));
      com.tencent.android.tpush.service.d.d.a(paramContext, paramString1 + paramString2, paramArrayList);
      return;
    }
    catch (Exception paramContext)
    {
      TLog.e("XGService", paramContext.getMessage());
    }
  }
  
  private void a(Intent paramIntent, String paramString, MessageId paramMessageId)
  {
    TLog.v("XGService", "@@ dispatchMessageOnTime(" + paramIntent + "," + paramString + "," + paramMessageId + ")");
    long l1 = paramIntent.getExtras().getLong("multiPkg");
    long l2 = paramIntent.getExtras().getLong("accId");
    Object localObject = new ArrayList();
    if (l1 == 0L) {
      ((List)localObject).add(paramIntent.getPackage());
    }
    for (;;)
    {
      TLog.i("XGService", "accid:" + l2 + ",multipkg:" + l1 + ",pkgs:" + ((List)localObject).size());
      int i = 0;
      label150:
      if (i < ((List)localObject).size()) {
        try
        {
          String str = (String)((List)localObject).get(i);
          TLog.i("XGService", ">> pkgs.get(" + i + "):" + str);
          if (com.tencent.android.tpush.service.d.d.a(str)) {
            TLog.i("XGService", ">> msg.appPkgName is null!");
          }
          for (;;)
          {
            i += 1;
            break label150;
            TLog.i("XGService", ">> multi_pkg");
            localObject = k.a().a(l.f(), l2);
            break;
            if (com.tencent.android.tpush.service.d.d.a(l.f(), str, l2)) {
              break label324;
            }
            o.a().a(str);
            k.a().a(l.f(), str);
            d(l.f(), str, new ArrayList());
          }
        }
        catch (Exception localException)
        {
          for (;;)
          {
            TLog.e("XGService", localException.getMessage());
            continue;
            label324:
            com.tencent.android.tpush.data.b localB = CacheManager.getRegisterInfoByPkgName(localException);
            if (localB != null) {
              if (localB.e > 0)
              {
                TLog.tf("XGService", ">> " + localException + " unregistered");
                d(l.f(), localException, new ArrayList());
              }
              else if (d(l.f(), localException, paramMessageId.id))
              {
                TLog.tf("XGService", ">> msgId:" + paramMessageId.id + " has been cached.");
              }
              else if (com.tencent.android.tpush.service.d.d.a(l.f(), localB.a).contains("@" + paramMessageId.id + localException + "@"))
              {
                TLog.tf("XGService", ">> msgId:" + paramMessageId.id + " has been cached.");
              }
              else if (c(l.f(), localException, paramMessageId.id))
              {
                TLog.tf("XGService", ">> msgId:" + paramMessageId.id + " has been acked.");
              }
              else
              {
                paramIntent.setPackage(localException);
                paramMessageId.pkgName = localException;
                if (paramMessageId.id > 0L) {
                  b(l.f(), localException, paramMessageId);
                }
                a(l.f(), paramString, paramIntent);
                c();
                a(paramMessageId.date, paramIntent, localException);
              }
            }
          }
        }
      }
    }
  }
  
  private void a(TpnsPushMsg paramTpnsPushMsg, long paramLong, com.tencent.android.tpush.service.channel.a paramA)
  {
    TLog.v("XGService", "@@ distribute2SDK(" + paramTpnsPushMsg + "," + paramLong + "," + paramA + ")");
    long l3 = System.currentTimeMillis();
    MessageId localMessageId = new MessageId();
    localMessageId.id = paramTpnsPushMsg.msgId;
    localMessageId.isAck = 0;
    localMessageId.accessId = paramTpnsPushMsg.accessId;
    localMessageId.host = com.tencent.android.tpush.service.d.d.b(paramA.d());
    localMessageId.port = paramA.e();
    localMessageId.pact = o.a(paramA.b());
    localMessageId.apn = com.tencent.android.tpush.service.d.d.e(l.f());
    localMessageId.isp = com.tencent.android.tpush.service.d.d.f(l.f());
    localMessageId.pushTime = paramLong;
    localMessageId.serviceHost = l.f().getPackageName();
    localMessageId.receivedTime = l3;
    localMessageId.pkgName = paramTpnsPushMsg.appPkgName;
    localMessageId.busiMsgId = paramTpnsPushMsg.busiMsgId;
    localMessageId.timestamp = paramTpnsPushMsg.timestamp;
    localMessageId.msgType = paramTpnsPushMsg.type;
    localMessageId.multiPkg = paramTpnsPushMsg.multiPkg;
    localMessageId.date = paramTpnsPushMsg.date;
    long l2 = 259200000L;
    long l1;
    if (paramTpnsPushMsg.ttl > 0) {
      l1 = paramTpnsPushMsg.ttl * 1000;
    }
    for (;;)
    {
      if ((paramTpnsPushMsg.serverTime > 0L) && (paramTpnsPushMsg.timestamp > 0L))
      {
        l1 += (paramTpnsPushMsg.serverTime - paramTpnsPushMsg.timestamp) * 1000L + l3;
        TLog.tf("confirmMs", ">> msg distribute @msgId=" + localMessageId.id + " @accId=" + localMessageId.accessId + " @timeUs=" + paramLong + " @recTime=" + localMessageId.receivedTime + " @msg.date=" + paramTpnsPushMsg.date + " @msg.busiMsgId=" + paramTpnsPushMsg.busiMsgId + " @msg.timestamp=" + paramTpnsPushMsg.timestamp + " @msg.type=" + paramTpnsPushMsg.type + " @msg.multiPkg=" + paramTpnsPushMsg.multiPkg + " @msg.serverTime=" + paramTpnsPushMsg.serverTime + " @msg.ttl=" + paramTpnsPushMsg.ttl + " @expire_time=" + l1 + " @currentTimeMillis=" + l3);
        paramA = new Intent("com.tencent.android.tpush.action.INTERNAL_PUSH_MESSAGE");
        paramA.setPackage(paramTpnsPushMsg.appPkgName);
        paramA.putExtra("msgId", paramTpnsPushMsg.msgId);
        paramA.putExtra("title", Rijndael.encrypt(paramTpnsPushMsg.title));
        paramA.putExtra("content", Rijndael.encrypt(paramTpnsPushMsg.content));
        paramA.putExtra("date", paramTpnsPushMsg.date);
        paramA.putExtra("type", paramTpnsPushMsg.type);
        paramA.putExtra("accId", paramTpnsPushMsg.accessId);
        paramA.putExtra("busiMsgId", paramTpnsPushMsg.busiMsgId);
        paramA.putExtra("timestamps", paramTpnsPushMsg.timestamp);
        paramA.putExtra("multiPkg", paramTpnsPushMsg.multiPkg);
        paramA.putExtra("server_time", paramTpnsPushMsg.serverTime * 1000L);
        paramA.putExtra("time_gap", l3 - paramTpnsPushMsg.serverTime * 1000L);
        paramA.putExtra("ttl", paramTpnsPushMsg.ttl * 1000);
        paramA.putExtra("expire_time", l1);
        paramA.putExtra("svrAck", true);
        paramA.putExtra("svrPkgName", l.g());
      }
      try
      {
        paramA.putExtra("enKeySet", com.tencent.android.tpush.common.k.a(new String[] { "title", "content" }));
        a(paramA, paramTpnsPushMsg.appPkgName, localMessageId);
        return;
        l1 = l2;
        if (paramTpnsPushMsg.msgId <= 0L) {
          continue;
        }
        l1 = l2;
        if (paramTpnsPushMsg.ttl != 0) {
          continue;
        }
        l1 = 30000L;
        continue;
        l1 += l3;
      }
      catch (Exception localException)
      {
        for (;;)
        {
          TLog.e("XGService", localException.getMessage());
        }
      }
    }
  }
  
  private Object b(Context paramContext, String paramString1, String paramString2)
  {
    try
    {
      paramContext = com.tencent.android.tpush.common.k.a(Rijndael.decrypt(com.tencent.android.tpush.service.d.d.e(paramContext, paramString1 + paramString2)));
      return paramContext;
    }
    catch (Exception paramContext)
    {
      TLog.e("XGService", paramContext.getMessage());
    }
    return null;
  }
  
  private void b()
  {
    try
    {
      TLog.v("XGService", "@@ cacheMsgBeat()");
      if (com.tencent.android.tpush.service.channel.b.b().b(true) > 0) {
        c();
      }
      return;
    }
    finally
    {
      localObject = finally;
      throw localObject;
    }
  }
  
  private void b(Context paramContext, MessageId paramMessageId)
  {
    paramMessageId = a(paramContext, paramMessageId);
    TLog.i("XGService", ">> requestServiceAck idList：" + paramMessageId);
    if (f) {
      TLog.i("XGService", ">> requestServiceAck msg ack is uploading , this time will give up!");
    }
    ArrayList localArrayList;
    do
    {
      return;
      localArrayList = a(paramContext, paramMessageId);
      TLog.i("XGService", ">> requestServiceAck list：" + localArrayList + ",idList:" + paramMessageId);
    } while ((localArrayList == null) || (localArrayList.size() == 0));
    f = true;
    o.a().a(localArrayList, new d(this, paramContext));
  }
  
  private void c()
  {
    TLog.v("XGService", "@@ scheduleCacheMsgBeat()");
    if (this.h == null)
    {
      l.f().registerReceiver(new h(this), new IntentFilter("com.tencent.android.tpush.service.channel.cacheMsgBeatIntent"));
      Intent localIntent = new Intent("com.tencent.android.tpush.service.channel.cacheMsgBeatIntent");
      this.h = PendingIntent.getBroadcast(l.f(), 0, localIntent, 134217728);
    }
    t.a().a(0, System.currentTimeMillis() + a, this.h);
  }
  
  private ArrayList d(Context paramContext, String paramString)
  {
    if ((paramContext != null) && (!com.tencent.android.tpush.service.d.d.a(paramString)))
    {
      TLog.v("XGService", "@@ getServiceMsgIdListByPackName(current pkg:" + paramContext.getPackageName() + ",remote pkg:" + paramString + ")");
      paramContext = b(paramContext, paramString, ".tpns.msg.id.service");
      if (paramContext == null) {}
    }
    for (paramContext = (ArrayList)paramContext;; paramContext = null)
    {
      TLog.i("XGService", ">> serviceMsgIdList : " + paramContext);
      paramString = paramContext;
      if (paramContext == null) {
        paramString = new ArrayList();
      }
      return paramString;
    }
  }
  
  private void d(Context paramContext, Intent paramIntent)
  {
    TLog.v("XGService", "@@ requestAck(" + paramContext.getPackageName() + "," + paramIntent + ")");
    long l = System.currentTimeMillis();
    ArrayList localArrayList = b(paramContext);
    TLog.i("XGService", ">>> requestAck >> idList:" + localArrayList);
    StringBuilder localStringBuilder = new StringBuilder().append(">> msg ack available, ack_count:").append(com.tencent.android.tpush.service.a.a.l).append(",ack_duration:").append(com.tencent.android.tpush.service.a.a.m).append("current_list:");
    if (localArrayList == null) {}
    for (int i = 0;; i = localArrayList.size())
    {
      TLog.i("XGService", i + "time:" + l + " - " + d);
      if (!e) {
        break;
      }
      TLog.i("XGService", ">> msg ack is uploading , this time will give up!");
      return;
    }
    localArrayList = b(paramContext, localArrayList);
    if ((localArrayList != null) && (localArrayList.size() > 0))
    {
      e = true;
      d = l;
    }
    o.a().a(localArrayList, new b(this, localArrayList, paramContext, paramIntent));
  }
  
  private ArrayList e(Context paramContext, String paramString)
  {
    if ((paramContext != null) && (!com.tencent.android.tpush.service.d.d.a(paramString)))
    {
      TLog.v("XGService", "@@ getClickedMessageIdListByPkgName(current pkg:" + paramContext.getPackageName() + ",remote pkg:" + paramString + ")");
      paramContext = b(paramContext, paramString, ".tpns.msg.id.clicked");
      if (paramContext == null) {}
    }
    for (paramContext = (ArrayList)paramContext;; paramContext = null)
    {
      TLog.i("XGService", ">> clickedMsgIdList : " + paramContext);
      paramString = paramContext;
      if (paramContext == null) {
        paramString = new ArrayList();
      }
      return paramString;
    }
  }
  
  private ArrayList f(Context paramContext, String paramString)
  {
    Iterator localIterator = null;
    Object localObject1 = localIterator;
    if (paramContext != null)
    {
      localObject1 = localIterator;
      if (!com.tencent.android.tpush.service.d.d.a(paramString))
      {
        TLog.v("XGService", "@@ getAckedMsgIdListByPackName(" + paramString + ")");
        Object localObject2 = a(paramContext, paramString);
        localObject1 = localIterator;
        if (localObject2 != null)
        {
          localObject1 = localIterator;
          if (((ArrayList)localObject2).size() > 0)
          {
            localObject1 = new ArrayList();
            localIterator = ((ArrayList)localObject2).iterator();
            while (localIterator.hasNext())
            {
              localObject2 = (MessageId)localIterator.next();
              if (((MessageId)localObject2).a()) {
                ((ArrayList)localObject1).add(localObject2);
              } else if (!d(paramContext, paramString, ((MessageId)localObject2).id)) {
                ((ArrayList)localObject1).add(localObject2);
              }
            }
          }
        }
      }
    }
    return localObject1;
  }
  
  public ArrayList a(Context paramContext)
  {
    TLog.v("XGService", "@@ getClickedReqMsgIdList(" + paramContext.getPackageName() + ")");
    Iterator localIterator = null;
    Object localObject = c(paramContext);
    paramContext = localIterator;
    if (localObject != null)
    {
      paramContext = localIterator;
      if (((List)localObject).size() > 0)
      {
        paramContext = new ArrayList();
        localIterator = ((List)localObject).iterator();
        while (localIterator.hasNext())
        {
          localObject = (PushClickEntity)localIterator.next();
          TpnsClickClientReport localTpnsClickClientReport = new TpnsClickClientReport();
          localTpnsClickClientReport.accessId = ((PushClickEntity)localObject).accessId;
          localTpnsClickClientReport.msgId = ((PushClickEntity)localObject).msgId;
          localTpnsClickClientReport.broadcastId = ((PushClickEntity)localObject).broadcastId;
          localTpnsClickClientReport.timestamp = ((PushClickEntity)localObject).timestamp;
          localTpnsClickClientReport.type = ((PushClickEntity)localObject).type;
          localTpnsClickClientReport.clickTime = ((PushClickEntity)localObject).clickTime;
          localTpnsClickClientReport.action = ((PushClickEntity)localObject).action;
          TLog.d("confirmMs", "+++ getClickedReqMsgIdList @msgId=" + localTpnsClickClientReport.msgId + " @accId=" + localTpnsClickClientReport.accessId + " @broadcastId=" + localTpnsClickClientReport.broadcastId + " @timestamp=" + localTpnsClickClientReport.timestamp + " @report.type=" + localTpnsClickClientReport.type + " @report.clickTime=" + localTpnsClickClientReport.clickTime + " @report.action=" + localTpnsClickClientReport.action);
          paramContext.add(localTpnsClickClientReport);
          if (paramContext.size() > 30) {
            return paramContext;
          }
        }
      }
    }
    return paramContext;
  }
  
  public ArrayList a(Context paramContext, MessageId paramMessageId)
  {
    if (paramContext != null)
    {
      TLog.v("XGService", "@@ getServiceMsgIdList(" + paramContext.getPackageName() + ")");
      Object localObject = CacheManager.getRegisterInfos(paramContext);
      ArrayList localArrayList1;
      int i;
      if ((localObject != null) && (((List)localObject).size() > 0))
      {
        localArrayList1 = new ArrayList();
        localObject = ((List)localObject).iterator();
        i = 0;
        while (((Iterator)localObject).hasNext())
        {
          String str = (String)((Iterator)localObject).next();
          ArrayList localArrayList2 = d(paramContext, str);
          if ((paramMessageId != null) && (!str.equals(paramMessageId.pkgName))) {
            break label233;
          }
          i = 1;
          if ((localArrayList2 != null) && (localArrayList2.size() > 0)) {
            localArrayList1.addAll(localArrayList2);
          }
        }
      }
      for (;;)
      {
        if (i == 0) {}
        for (;;)
        {
          try
          {
            paramMessageId = d(paramContext, paramMessageId.pkgName);
            if ((paramMessageId != null) && (paramMessageId.size() > 0))
            {
              localArrayList1.retainAll(paramMessageId);
              if (localArrayList1.size() <= 0) {
                continue;
              }
              localArrayList1.removeAll(localArrayList1);
              localArrayList1.addAll(paramMessageId);
            }
          }
          catch (Exception paramMessageId)
          {
            continue;
          }
          a(paramContext, "all", localArrayList1);
          return localArrayList1;
          localArrayList1.addAll(paramMessageId);
        }
        label233:
        break;
        localArrayList1 = null;
        i = 0;
      }
    }
    return null;
  }
  
  public ArrayList a(Context paramContext, String paramString)
  {
    if ((paramContext != null) && (!com.tencent.android.tpush.service.d.d.a(paramString)))
    {
      TLog.v("XGService", "@@ getMessageIdListByPkgName(current pkg:" + paramContext.getPackageName() + ",remote pkg:" + paramString + ")");
      paramContext = b(paramContext, paramString, ".tpns.msg.id");
      if (paramContext == null) {}
    }
    for (paramContext = (ArrayList)paramContext;; paramContext = null)
    {
      TLog.i("XGService", ">> msgIdList : " + paramContext);
      paramString = paramContext;
      if (paramContext == null) {
        paramString = new ArrayList();
      }
      return paramString;
    }
  }
  
  public ArrayList a(Context paramContext, List paramList)
  {
    TLog.v("XGService", "@@ getServiceReqMsgIdList(" + paramContext.getPackageName() + ")");
    MessageId localMessageId = null;
    Object localObject = localMessageId;
    if (paramList != null)
    {
      localObject = localMessageId;
      if (paramList.size() > 0)
      {
        localObject = new ArrayList();
        paramList = paramList.iterator();
        while (paramList.hasNext())
        {
          localMessageId = (MessageId)paramList.next();
          TpnsPushClientReport localTpnsPushClientReport = new TpnsPushClientReport();
          localTpnsPushClientReport.accessId = localMessageId.accessId;
          localTpnsPushClientReport.msgId = localMessageId.id;
          localTpnsPushClientReport.apn = localMessageId.apn;
          localTpnsPushClientReport.isp = localMessageId.isp;
          localTpnsPushClientReport.locip = localMessageId.host;
          localTpnsPushClientReport.locport = localMessageId.port;
          localTpnsPushClientReport.pack = localMessageId.pact;
          localTpnsPushClientReport.timeUs = localMessageId.pushTime;
          localTpnsPushClientReport.qua = CacheManager.getQua(paramContext, localTpnsPushClientReport.accessId);
          localTpnsPushClientReport.serviceHost = localMessageId.serviceHost;
          localTpnsPushClientReport.confirmMs = (System.currentTimeMillis() - localMessageId.receivedTime);
          localTpnsPushClientReport.broadcastId = localMessageId.busiMsgId;
          localTpnsPushClientReport.timestamp = localMessageId.timestamp;
          localTpnsPushClientReport.type = localMessageId.msgType;
          localTpnsPushClientReport.ackType = 1;
          localTpnsPushClientReport.receiveTime = (localMessageId.receivedTime / 1000L);
          TLog.d("confirmMs", "+++ getServiceReqMsgIdList @msgId=" + localTpnsPushClientReport.msgId + " @accId=" + localTpnsPushClientReport.accessId + " @timeUs=" + localTpnsPushClientReport.timeUs + " @confirmMs=" + localTpnsPushClientReport.confirmMs + " @recTime=" + localMessageId.receivedTime + " @msgType=" + localMessageId.msgType + " @broadcastId=" + localTpnsPushClientReport.broadcastId);
          ((ArrayList)localObject).add(localTpnsPushClientReport);
          if (((ArrayList)localObject).size() > 30) {
            return localObject;
          }
        }
      }
    }
    return localObject;
  }
  
  public void a(Context paramContext, Intent paramIntent)
  {
    if ((paramContext != null) && (paramIntent != null))
    {
      TLog.v("XGService", "@@ msgAck_service(" + paramContext.getPackageName() + "," + paramIntent + ")");
      long l = paramIntent.getLongExtra("msgId", -1L);
      String str = paramIntent.getStringExtra("packName");
      b(paramContext, str, l);
      a(paramContext, str, l, (short)1);
      d(paramContext, paramIntent);
    }
  }
  
  public void a(Context paramContext, TpnsPushMsg paramTpnsPushMsg, long paramLong, com.tencent.android.tpush.service.channel.a paramA)
  {
    long l = System.currentTimeMillis();
    MessageId localMessageId = new MessageId();
    localMessageId.id = paramTpnsPushMsg.msgId;
    localMessageId.accessId = paramTpnsPushMsg.accessId;
    localMessageId.host = com.tencent.android.tpush.service.d.d.b(paramA.d());
    localMessageId.port = paramA.e();
    localMessageId.pact = o.a(paramA.b());
    localMessageId.apn = com.tencent.android.tpush.service.d.d.e(l.f());
    localMessageId.isp = com.tencent.android.tpush.service.d.d.f(l.f());
    localMessageId.pushTime = paramLong;
    localMessageId.serviceHost = l.f().getPackageName();
    localMessageId.receivedTime = l;
    localMessageId.pkgName = paramTpnsPushMsg.appPkgName;
    localMessageId.busiMsgId = paramTpnsPushMsg.busiMsgId;
    localMessageId.timestamp = paramTpnsPushMsg.timestamp;
    localMessageId.msgType = paramTpnsPushMsg.type;
    localMessageId.multiPkg = paramTpnsPushMsg.multiPkg;
    localMessageId.date = paramTpnsPushMsg.date;
    a(paramContext, paramTpnsPushMsg.appPkgName, localMessageId);
    b(paramContext, localMessageId);
  }
  
  public void a(Context paramContext, String paramString, long paramLong)
  {
    byte[] arrayOfByte = c;
    if (paramContext != null) {}
    for (;;)
    {
      int i;
      try
      {
        TLog.v("XGService", "@@ deleteCachedMsgIntentByPkgNameBusiId(current pkg:" + paramContext.getPackageName() + ",remote pkg:" + paramString + "," + paramLong + ")");
        ArrayList localArrayList1 = b(paramContext, paramString);
        TLog.i("XGService", "@@ deleteCachedMsgIntentByPkgNameBusiId(current pkg:" + paramContext.getPackageName() + ",remote pkg:" + paramString + "," + paramLong + ")" + localArrayList1.size());
        if ((localArrayList1 != null) && (localArrayList1.size() > 0))
        {
          ArrayList localArrayList2 = new ArrayList();
          i = 0;
          if (i < localArrayList1.size())
          {
            CachedMessageIntent localCachedMessageIntent = (CachedMessageIntent)localArrayList1.get(i);
            if (paramLong == Intent.parseUri(Rijndael.decrypt(localCachedMessageIntent.intent), 1).getLongExtra("busiMsgId", -1L)) {
              localArrayList2.add(localCachedMessageIntent);
            }
          }
          else
          {
            TLog.i("XGService", "deleteCachedMsgIntentByPkgNameBusiId removeList:" + localArrayList2.toString() + ", size:" + localArrayList2.size());
            localArrayList1.removeAll(localArrayList2);
          }
        }
        else
        {
          d(paramContext, paramString, localArrayList1);
          return;
        }
      }
      finally {}
      i += 1;
    }
  }
  
  public void a(Context paramContext, String paramString, long paramLong, short paramShort)
  {
    byte[] arrayOfByte = c;
    if ((paramContext != null) && (paramLong > 0L)) {
      try
      {
        TLog.v("XGService", "@@ updateMsgIdFlag(current pkg:" + paramContext.getPackageName() + ",remote pkg:" + paramString + "," + paramLong + ")");
        ArrayList localArrayList = a(paramContext, paramString);
        if ((localArrayList != null) && (localArrayList.size() > 0))
        {
          Iterator localIterator = localArrayList.iterator();
          while (localIterator.hasNext())
          {
            MessageId localMessageId = (MessageId)localIterator.next();
            if (localMessageId.id == paramLong) {
              localMessageId.isAck = paramShort;
            }
          }
          c(paramContext, paramString, localArrayList);
        }
      }
      finally {}
    }
  }
  
  public void a(Context paramContext, String paramString, Intent paramIntent)
  {
    byte[] arrayOfByte = c;
    if (paramContext != null) {}
    for (;;)
    {
      int i;
      try
      {
        if ((com.tencent.android.tpush.service.d.d.a(paramString)) || (paramIntent == null)) {
          break label331;
        }
        TLog.v("XGService", "@@ addCachedMsgIntent(current pkg:" + paramContext.getPackageName() + ",remote pkg:" + paramString + ")");
        CachedMessageIntent localCachedMessageIntent1 = new CachedMessageIntent();
        localCachedMessageIntent1.pkgName = paramString;
        localCachedMessageIntent1.msgId = paramIntent.getLongExtra("msgId", -1L);
        localCachedMessageIntent1.intent = Rijndael.encrypt(paramIntent.toUri(1));
        paramIntent = b(paramContext, paramString);
        if (paramIntent == null)
        {
          paramIntent = new ArrayList();
          int j = paramIntent.size() / 2;
          if (j > 1000)
          {
            TLog.w("XGService", "too much cache msg, try to cut " + j);
            i = 0;
            if (i < j)
            {
              TLog.w("XGService", "too much cache msg, delete " + paramIntent.remove(i));
              i += 1;
              continue;
            }
          }
        }
        else
        {
          ArrayList localArrayList = new ArrayList();
          i = 0;
          if (i < paramIntent.size())
          {
            CachedMessageIntent localCachedMessageIntent2 = (CachedMessageIntent)paramIntent.get(i);
            if (!localCachedMessageIntent2.equals(localCachedMessageIntent1)) {
              break label335;
            }
            TLog.i("XGService", ">> equal msgId:" + localCachedMessageIntent1.msgId);
            localArrayList.add(localCachedMessageIntent2);
            break label335;
          }
          paramIntent.removeAll(localArrayList);
          continue;
        }
        paramIntent.add(localCachedMessageIntent1);
      }
      finally {}
      d(paramContext, paramString, paramIntent);
      label331:
      return;
      label335:
      i += 1;
    }
  }
  
  public void a(Context paramContext, String paramString, MessageId paramMessageId)
  {
    byte[] arrayOfByte = c;
    if (paramContext != null) {}
    for (;;)
    {
      int i;
      try
      {
        if ((!com.tencent.android.tpush.service.d.d.a(paramString)) && (paramMessageId != null))
        {
          TLog.v("XGService", "@@ addServiceMsgId(" + paramContext.getPackageName() + "," + paramMessageId + ")");
          ArrayList localArrayList1 = d(paramContext, paramString);
          ArrayList localArrayList2 = new ArrayList();
          i = 0;
          if (i < localArrayList1.size())
          {
            MessageId localMessageId = (MessageId)localArrayList1.get(i);
            if (localMessageId.id == paramMessageId.id)
            {
              TLog.i("XGService", ">> equal msgId:" + paramMessageId.id);
              localArrayList2.add(localMessageId);
            }
          }
          else
          {
            localArrayList1.removeAll(localArrayList2);
            localArrayList1.add(paramMessageId);
            a(paramContext, paramString, localArrayList1);
          }
        }
        else
        {
          return;
        }
      }
      finally {}
      i += 1;
    }
  }
  
  public void a(Context paramContext, String paramString, PushClickEntity paramPushClickEntity)
  {
    byte[] arrayOfByte = c;
    if (paramContext != null) {}
    for (;;)
    {
      int i;
      try
      {
        if ((!com.tencent.android.tpush.service.d.d.a(paramString)) && (paramPushClickEntity != null))
        {
          TLog.v("XGService", "@@ addClickedMsgId(" + paramContext.getPackageName() + "," + paramPushClickEntity + ")");
          ArrayList localArrayList1 = e(paramContext, paramString);
          ArrayList localArrayList2 = new ArrayList();
          i = 0;
          if (i < localArrayList1.size())
          {
            PushClickEntity localPushClickEntity = (PushClickEntity)localArrayList1.get(i);
            if (localPushClickEntity.msgId == paramPushClickEntity.msgId)
            {
              TLog.i("XGService", ">> equal msgId:" + paramPushClickEntity.msgId);
              localArrayList2.add(localPushClickEntity);
            }
          }
          else
          {
            localArrayList1.removeAll(localArrayList2);
            localArrayList1.add(paramPushClickEntity);
            b(paramContext, paramString, localArrayList1);
          }
        }
        else
        {
          return;
        }
      }
      finally {}
      i += 1;
    }
  }
  
  public void a(Context paramContext, String paramString1, String paramString2)
  {
    try
    {
      paramString2 = new JSONObject(paramString2);
      switch (paramString2.optInt("action", 2))
      {
      case 2: 
        c(paramContext, paramString1);
        return;
      }
    }
    catch (Exception paramContext)
    {
      TLog.e("XGService", "onCrtlMsgHandle", paramContext);
      return;
    }
    paramString2 = paramString2.optString("pushIdList", "").split(",");
    int j = paramString2.length;
    int i = 0;
    while (i < j)
    {
      a(paramContext, paramString1, Long.valueOf(paramString2[i]).longValue());
      i += 1;
    }
  }
  
  public void a(Context paramContext, String paramString, ArrayList paramArrayList)
  {
    byte[] arrayOfByte = c;
    if ((paramContext != null) && (paramArrayList != null)) {}
    try
    {
      TLog.v("XGService", "@@ updateServiceMsgId(current pkg:" + paramContext.getPackageName() + ",remote pkg:" + paramString + "," + paramArrayList + ")");
      a(paramContext, paramString, ".tpns.msg.id.service", paramArrayList);
      return;
    }
    finally {}
  }
  
  public void a(Context paramContext, ArrayList paramArrayList)
  {
    byte[] arrayOfByte = c;
    if ((paramContext != null) && (paramArrayList != null)) {}
    for (;;)
    {
      try
      {
        Object localObject;
        HashMap localHashMap;
        if (paramArrayList.size() > 0)
        {
          TLog.v("XGService", "@@ deleteServiceMsgIdBatch(" + paramContext.getPackageName() + "," + paramArrayList + ")");
          try
          {
            localObject = d(paramContext, "all");
            if ((localObject == null) || (((ArrayList)localObject).size() <= 0)) {
              continue;
            }
            localHashMap = new HashMap();
            Iterator localIterator = ((ArrayList)localObject).iterator();
            if (!localIterator.hasNext()) {
              continue;
            }
            localMessageId = (MessageId)localIterator.next();
            localObject = (ArrayList)localHashMap.get(localMessageId.pkgName);
            if (localObject != null) {
              break label322;
            }
            localObject = new ArrayList();
            localHashMap.put(localMessageId.pkgName, localObject);
          }
          catch (Exception paramContext)
          {
            MessageId localMessageId;
            TpnsPushClientReport localTpnsPushClientReport;
            TLog.e("XGService", "+++ clear msg id exception", paramContext);
          }
          if (i >= paramArrayList.size()) {
            break label317;
          }
          localTpnsPushClientReport = (TpnsPushClientReport)paramArrayList.get(i);
          if (localMessageId.id != localTpnsPushClientReport.msgId) {
            continue;
          }
          paramArrayList.remove(i);
          i = 0;
          if (i == 0) {
            continue;
          }
          ((ArrayList)localObject).add(localMessageId);
          localHashMap.put(localMessageId.pkgName, localObject);
          continue;
        }
        return;
        i += 1;
        continue;
        paramArrayList = localHashMap.keySet().iterator();
        if (paramArrayList.hasNext())
        {
          localObject = (String)paramArrayList.next();
          a(paramContext, (String)localObject, (ArrayList)localHashMap.get(localObject));
          continue;
        }
        continue;
        i = 1;
      }
      finally {}
      label317:
      continue;
      label322:
      int i = 0;
    }
  }
  
  public void a(Context paramContext, List paramList, ArrayList paramArrayList)
  {
    byte[] arrayOfByte = c;
    if ((paramContext != null) && (paramList != null)) {}
    for (;;)
    {
      ArrayList localArrayList;
      HashMap localHashMap;
      int i;
      Object localObject2;
      try
      {
        if (paramList.size() > 0)
        {
          TLog.v("XGService", "@@ deleteCachedMsgIntent(current pkg:" + paramContext.getPackageName() + "," + paramList + ")");
          try
          {
            localArrayList = new ArrayList();
            if ((paramArrayList != null) && (paramArrayList.size() > 0))
            {
              TLog.i("XGService", ">> before cached msg list size:" + paramArrayList.size());
              localHashMap = new HashMap();
              i = 0;
              if (i >= paramArrayList.size()) {
                continue;
              }
              CachedMessageIntent localCachedMessageIntent1 = (CachedMessageIntent)paramArrayList.get(i);
              Iterator localIterator = paramList.iterator();
              if (!localIterator.hasNext()) {
                continue;
              }
              CachedMessageIntent localCachedMessageIntent2 = (CachedMessageIntent)localIterator.next();
              if (!localCachedMessageIntent1.equals(localCachedMessageIntent2)) {
                continue;
              }
              localArrayList.add(localCachedMessageIntent1);
              localObject2 = (ArrayList)localHashMap.get(localCachedMessageIntent2.pkgName);
              localObject1 = localObject2;
              if (localObject2 == null) {
                localObject1 = new ArrayList();
              }
              localHashMap.put(localCachedMessageIntent2.pkgName, localObject1);
              continue;
            }
          }
          catch (Exception paramContext)
          {
            TLog.e("XGService", paramContext.getMessage());
          }
        }
        return;
      }
      finally {}
      i += 1;
      continue;
      paramArrayList.removeAll(localArrayList);
      TLog.i("XGService", ">> end cached msg list size:" + paramArrayList.size());
      Object localObject1 = paramArrayList.iterator();
      if (((Iterator)localObject1).hasNext())
      {
        localObject2 = (CachedMessageIntent)((Iterator)localObject1).next();
        paramArrayList = (ArrayList)localHashMap.get(((CachedMessageIntent)localObject2).pkgName);
        paramList = paramArrayList;
        if (paramArrayList == null) {
          paramList = new ArrayList();
        }
        paramList.add(localObject2);
        localHashMap.put(((CachedMessageIntent)localObject2).pkgName, paramList);
      }
      else
      {
        paramList = localHashMap.keySet().iterator();
        while (paramList.hasNext())
        {
          paramArrayList = (String)paramList.next();
          d(paramContext, paramArrayList, (ArrayList)localHashMap.get(paramArrayList));
        }
      }
    }
  }
  
  public void a(Intent paramIntent)
  {
    TLog.v("XGService", "@@ SendBroadcastByRPC()");
    g.a().a(new i(this, paramIntent));
  }
  
  public void a(TpnsPushMsg paramTpnsPushMsg)
  {
    TLog.v("XGService", "@@ ctrlMsg(" + paramTpnsPushMsg + ")");
    String str2 = paramTpnsPushMsg.appPkgName;
    String str1 = str2;
    if (paramTpnsPushMsg.multiPkg == 1L)
    {
      com.tencent.android.tpush.data.b localB = CacheManager.getRegisterInfoByPkgName(str2);
      str1 = str2;
      if (localB != null)
      {
        str1 = str2;
        if (!com.tencent.android.tpush.service.d.d.a(localB.d)) {
          str1 = localB.d;
        }
      }
    }
    a(l.f(), str1, paramTpnsPushMsg.content);
  }
  
  public void a(String paramString1, Intent paramIntent, String paramString2)
  {
    TLog.v("XGService", "@@ sendBroadcast(" + paramString1 + "," + paramString2 + ")");
    SimpleDateFormat localSimpleDateFormat = new SimpleDateFormat("yyyyMMdd");
    if ((com.tencent.android.tpush.service.d.d.a(paramString1)) || ((!com.tencent.android.tpush.service.d.d.a(paramString1)) && (localSimpleDateFormat.parse(paramString1).compareTo(localSimpleDateFormat.parse(localSimpleDateFormat.format(new Date()))) == 0))) {
      if (com.tencent.android.tpush.service.d.d.a(paramIntent))
      {
        paramString1 = com.tencent.android.tpush.service.d.d.a(l.f(), paramString2 + ".PUSH_ACTION");
        if ((paramString1 != null) && (paramString1.size() >= 1)) {
          break label175;
        }
        TLog.i("XGService", ">> send message intent:" + paramIntent);
        l.f().sendBroadcast(paramIntent);
      }
    }
    label175:
    while ((com.tencent.android.tpush.service.d.d.a(paramString1)) || (localSimpleDateFormat.parse(paramString1).compareTo(localSimpleDateFormat.parse(localSimpleDateFormat.format(new Date()))) >= 0))
    {
      return;
      TLog.i("XGService", ">> send rpc message intent:" + paramIntent);
      a(paramIntent);
      return;
    }
    paramString1 = com.tencent.android.tpush.service.d.d.a(l.f(), paramString2 + ".PUSH_ACTION");
    if ((paramString1 == null) || (paramString1.size() < 1))
    {
      TLog.tf("XGService", ">> send message intent:" + paramIntent);
      l.f().sendBroadcast(paramIntent);
      return;
    }
    TLog.tf("XGService", ">> send rpc message intent:" + paramIntent);
    a(paramIntent);
  }
  
  public void a(ArrayList paramArrayList, long paramLong, com.tencent.android.tpush.service.channel.a paramA)
  {
    b(paramArrayList, paramLong, paramA);
  }
  
  public ArrayList b(Context paramContext)
  {
    Iterator localIterator = null;
    Object localObject1 = localIterator;
    if (paramContext != null)
    {
      TLog.v("XGService", "@@ getAckedMsgIdList(" + paramContext.getPackageName() + ")");
      Object localObject2 = CacheManager.getRegisterInfos(paramContext);
      localObject1 = localIterator;
      if (localObject2 != null)
      {
        localObject1 = localIterator;
        if (((List)localObject2).size() > 0)
        {
          localObject1 = new ArrayList();
          localIterator = ((List)localObject2).iterator();
          while (localIterator.hasNext())
          {
            localObject2 = f(paramContext, (String)localIterator.next());
            if ((localObject2 != null) && (((ArrayList)localObject2).size() > 0)) {
              ((ArrayList)localObject1).addAll((Collection)localObject2);
            }
          }
        }
      }
    }
    return localObject1;
  }
  
  public ArrayList b(Context paramContext, String paramString)
  {
    if (paramContext != null) {}
    for (;;)
    {
      try
      {
        if (!com.tencent.android.tpush.service.d.d.a(paramString))
        {
          TLog.v("XGService", "@@ getCachedMsgIntentListByPkgName(current pkg:" + paramContext.getPackageName() + ",remote pkg:" + paramString + ")");
          paramContext = b(paramContext, paramString, ".tpns.msg.id.cached");
          if (paramContext != null)
          {
            paramContext = (ArrayList)paramContext;
            TLog.i("XGService", ">> cachedMsgIdList : " + paramContext);
            paramString = paramContext;
            if (paramContext == null) {
              paramString = new ArrayList();
            }
            return paramString;
          }
        }
      }
      catch (Throwable paramContext)
      {
        return new ArrayList();
      }
      paramContext = null;
    }
  }
  
  public ArrayList b(Context paramContext, List paramList)
  {
    TLog.v("XGService", "@@ getAckedReqMsgIdList(" + paramContext.getPackageName() + ")");
    MessageId localMessageId = null;
    Object localObject = localMessageId;
    if (paramList != null)
    {
      localObject = localMessageId;
      if (paramList.size() > 0)
      {
        localObject = new ArrayList();
        paramList = paramList.iterator();
        while (paramList.hasNext())
        {
          localMessageId = (MessageId)paramList.next();
          TpnsPushClientReport localTpnsPushClientReport = new TpnsPushClientReport();
          localTpnsPushClientReport.accessId = localMessageId.accessId;
          localTpnsPushClientReport.msgId = localMessageId.id;
          localTpnsPushClientReport.apn = localMessageId.apn;
          localTpnsPushClientReport.isp = localMessageId.isp;
          localTpnsPushClientReport.locip = localMessageId.host;
          localTpnsPushClientReport.locport = localMessageId.port;
          localTpnsPushClientReport.pack = localMessageId.pact;
          localTpnsPushClientReport.timeUs = localMessageId.pushTime;
          localTpnsPushClientReport.qua = CacheManager.getQua(paramContext, localTpnsPushClientReport.accessId);
          localTpnsPushClientReport.serviceHost = localMessageId.serviceHost;
          localTpnsPushClientReport.confirmMs = (System.currentTimeMillis() - localMessageId.receivedTime);
          localTpnsPushClientReport.broadcastId = localMessageId.busiMsgId;
          localTpnsPushClientReport.timestamp = localMessageId.timestamp;
          localTpnsPushClientReport.type = localMessageId.msgType;
          localTpnsPushClientReport.receiveTime = (localMessageId.receivedTime / 1000L);
          TLog.d("confirmMs", "+++ getAckedReqMsgIdList @msgId=" + localTpnsPushClientReport.msgId + " @accId=" + localTpnsPushClientReport.accessId + " @timeUs=" + localTpnsPushClientReport.timeUs + " @confirmMs=" + localTpnsPushClientReport.confirmMs + " @recTime=" + localMessageId.receivedTime + " @msgType=" + localMessageId.msgType + " @broadcastId=" + localTpnsPushClientReport.broadcastId);
          ((ArrayList)localObject).add(localTpnsPushClientReport);
          if (((ArrayList)localObject).size() > 30) {
            return localObject;
          }
        }
      }
    }
    return localObject;
  }
  
  public void b(Context paramContext, Intent paramIntent)
  {
    if ((paramContext != null) && (paramIntent != null))
    {
      TLog.v("XGService", "@@ msgClick(" + paramContext.getPackageName() + "," + paramIntent + ")");
      String str = paramIntent.getStringExtra("packName");
      a(paramContext, str, new PushClickEntity(paramIntent.getLongExtra("msgId", -1L), paramIntent.getLongExtra("accId", -1L), paramIntent.getLongExtra("busiMsgId", -1L), paramIntent.getLongExtra("timestamps", -1L), str, 1L, paramIntent.getLongExtra("clickTime", System.currentTimeMillis() / 1000L), paramIntent.getIntExtra("action", 0)));
      c(paramContext, paramIntent);
    }
  }
  
  public void b(Context paramContext, String paramString, long paramLong)
  {
    byte[] arrayOfByte = c;
    if (paramContext != null) {}
    for (;;)
    {
      int i;
      try
      {
        TLog.v("XGService", "@@ deleteCachedMsgIntentByPkgName(current pkg:" + paramContext.getPackageName() + ",remote pkg:" + paramString + "," + paramLong + ")");
        ArrayList localArrayList1 = b(paramContext, paramString);
        TLog.i("XGService", "@@ deleteCachedMsgIntentByPkgName(current pkg:" + paramContext.getPackageName() + ",remote pkg:" + paramString + "," + paramLong + ")" + localArrayList1.size());
        if ((localArrayList1 != null) && (localArrayList1.size() > 0))
        {
          ArrayList localArrayList2 = new ArrayList();
          i = 0;
          if (i < localArrayList1.size())
          {
            CachedMessageIntent localCachedMessageIntent = (CachedMessageIntent)localArrayList1.get(i);
            if (localCachedMessageIntent.msgId == paramLong)
            {
              TLog.i("XGService", ">> equal msgId:" + localCachedMessageIntent.msgId);
              localArrayList2.add(localCachedMessageIntent);
            }
          }
          else
          {
            localArrayList1.removeAll(localArrayList2);
          }
        }
        else
        {
          d(paramContext, paramString, localArrayList1);
          return;
        }
      }
      finally {}
      i += 1;
    }
  }
  
  public void b(Context paramContext, String paramString, MessageId paramMessageId)
  {
    byte[] arrayOfByte = c;
    if (paramContext != null) {}
    for (;;)
    {
      ArrayList localArrayList;
      int i;
      try
      {
        if ((!com.tencent.android.tpush.service.d.d.a(paramString)) && (paramMessageId != null))
        {
          TLog.v("XGService", "@@ addMsgId(current pkg:" + paramContext.getPackageName() + ",remote pkg:" + paramString + "," + paramMessageId + ")");
          localArrayList = a(paramContext, paramString);
          if (localArrayList != null) {
            break label167;
          }
          localArrayList = new ArrayList();
          localArrayList.add(paramMessageId);
          c(paramContext, paramString, localArrayList);
        }
        return;
      }
      finally {}
      if (i < localArrayList.size())
      {
        if (((MessageId)localArrayList.get(i)).id == paramMessageId.id) {
          localArrayList.remove(i);
        }
      }
      else
      {
        continue;
        label167:
        i = 0;
        continue;
      }
      i += 1;
    }
  }
  
  public void b(Context paramContext, String paramString, ArrayList paramArrayList)
  {
    byte[] arrayOfByte = c;
    if ((paramContext != null) && (paramArrayList != null)) {}
    try
    {
      TLog.v("XGService", "@@ updateClickedMsgId(current pkg:" + paramContext.getPackageName() + ",remote pkg:" + paramString + "," + paramArrayList + ")");
      a(paramContext, paramString, ".tpns.msg.id.clicked", paramArrayList);
      return;
    }
    finally {}
  }
  
  public void b(Context paramContext, ArrayList paramArrayList)
  {
    byte[] arrayOfByte = c;
    if ((paramContext != null) && (paramArrayList != null)) {}
    for (;;)
    {
      try
      {
        Object localObject;
        HashMap localHashMap;
        if (paramArrayList.size() > 0)
        {
          TLog.v("XGService", "@@ deleteClickedMsgIdBatch(" + paramContext.getPackageName() + "," + paramArrayList + ")");
          try
          {
            localObject = c(paramContext);
            if ((localObject == null) || (((ArrayList)localObject).size() <= 0)) {
              continue;
            }
            localHashMap = new HashMap();
            Iterator localIterator = ((ArrayList)localObject).iterator();
            if (!localIterator.hasNext()) {
              continue;
            }
            localPushClickEntity = (PushClickEntity)localIterator.next();
            localObject = (ArrayList)localHashMap.get(localPushClickEntity.pkgName);
            if (localObject != null) {
              break label319;
            }
            localObject = new ArrayList();
            localHashMap.put(localPushClickEntity.pkgName, localObject);
          }
          catch (Exception paramContext)
          {
            PushClickEntity localPushClickEntity;
            TpnsClickClientReport localTpnsClickClientReport;
            TLog.e("XGService", "+++ clear msg id exception", paramContext);
          }
          if (i >= paramArrayList.size()) {
            break label314;
          }
          localTpnsClickClientReport = (TpnsClickClientReport)paramArrayList.get(i);
          if (localPushClickEntity.msgId != localTpnsClickClientReport.msgId) {
            continue;
          }
          paramArrayList.remove(i);
          i = 0;
          if (i == 0) {
            continue;
          }
          ((ArrayList)localObject).add(localPushClickEntity);
          localHashMap.put(localPushClickEntity.pkgName, localObject);
          continue;
        }
        return;
        i += 1;
        continue;
        paramArrayList = localHashMap.keySet().iterator();
        if (paramArrayList.hasNext())
        {
          localObject = (String)paramArrayList.next();
          b(paramContext, (String)localObject, (ArrayList)localHashMap.get(localObject));
          continue;
        }
        continue;
        i = 1;
      }
      finally {}
      label314:
      continue;
      label319:
      int i = 0;
    }
  }
  
  public void b(ArrayList paramArrayList, long paramLong, com.tencent.android.tpush.service.channel.a paramA)
  {
    TLog.v("XGService", "@@ messageDistribute(" + paramArrayList + "," + paramLong + "," + paramA + ")");
    if ((l.f() != null) && (paramArrayList != null) && (paramArrayList.size() > 0))
    {
      Iterator localIterator = paramArrayList.iterator();
      while (localIterator.hasNext())
      {
        Object localObject = (TpnsPushMsg)localIterator.next();
        TLog.tf("XGService", "@ message distribute, accid=" + ((TpnsPushMsg)localObject).accessId + ",busiId=" + ((TpnsPushMsg)localObject).busiMsgId + ",pkg=" + ((TpnsPushMsg)localObject).appPkgName + ",msgId=" + ((TpnsPushMsg)localObject).msgId + ",type=" + ((TpnsPushMsg)localObject).type + ",timestamp=" + ((TpnsPushMsg)localObject).timestamp + ",multi=" + ((TpnsPushMsg)localObject).multiPkg + ",date=" + ((TpnsPushMsg)localObject).date + ",serverTime=" + ((TpnsPushMsg)localObject).serverTime + ",ttl=" + ((TpnsPushMsg)localObject).ttl);
        a(l.f(), (TpnsPushMsg)localObject, paramLong, paramA);
        if (com.tencent.android.tpush.service.d.d.a(((TpnsPushMsg)localObject).appPkgName))
        {
          TLog.e("XGService", ">> messageDistribute, msg.appPkgName is null!");
        }
        else
        {
          if (((TpnsPushMsg)localObject).type == 3L) {
            a((TpnsPushMsg)localObject);
          }
          if (((TpnsPushMsg)localObject).timestamp > 0L)
          {
            long l1 = System.currentTimeMillis() / 1000L;
            long l2 = l1 - ((TpnsPushMsg)localObject).serverTime;
            long l3 = l1 - l2 - ((TpnsPushMsg)localObject).timestamp;
            TLog.tf("XGService", "messageDistribute check server time, now=" + l1 + ",diffSec(client-server)=" + l2 + ",reviseMaxTimeoutSec=" + l3 + ",msg.ttl=" + ((TpnsPushMsg)localObject).ttl);
            if ((((TpnsPushMsg)localObject).msgId >= 0L) && (((TpnsPushMsg)localObject).ttl > 0) && (((TpnsPushMsg)localObject).ttl < l3))
            {
              localObject = "messageDistribute check server time failed, msg discarded cause msg is timeout, msg.ttl:" + ((TpnsPushMsg)localObject).ttl + "<reviseMaxTimeoutSec:" + l3;
              TLog.e("XGService", (String)localObject);
              TLog.tf("XGService", (String)localObject);
              continue;
            }
          }
          a((TpnsPushMsg)localObject, paramLong, paramA);
        }
      }
    }
    com.tencent.android.tpush.service.c.a.a(paramArrayList);
  }
  
  public ArrayList c(Context paramContext)
  {
    Iterator localIterator = null;
    Object localObject1 = localIterator;
    if (paramContext != null)
    {
      TLog.v("XGService", "@@ getClickedMsgIdList(" + paramContext.getPackageName() + ")");
      Object localObject2 = CacheManager.getRegisterInfos(paramContext);
      localObject1 = localIterator;
      if (localObject2 != null)
      {
        localObject1 = localIterator;
        if (((List)localObject2).size() > 0)
        {
          localObject1 = new ArrayList();
          localIterator = ((List)localObject2).iterator();
          while (localIterator.hasNext())
          {
            localObject2 = e(paramContext, (String)localIterator.next());
            if ((localObject2 != null) && (((ArrayList)localObject2).size() > 0)) {
              ((ArrayList)localObject1).addAll((Collection)localObject2);
            }
          }
        }
      }
    }
    return localObject1;
  }
  
  public void c(Context paramContext, Intent paramIntent)
  {
    TLog.v("XGService", "@@ requestClick(" + paramContext.getPackageName() + "," + paramIntent + ",isClickedAcking=" + g + ")");
    if (g) {
      return;
    }
    ArrayList localArrayList = a(paramContext);
    if ((localArrayList != null) && (localArrayList.size() > 0))
    {
      g = true;
      o.a().b(localArrayList, new f(this, localArrayList, paramContext, paramIntent));
      return;
    }
    g = false;
  }
  
  public void c(Context paramContext, String paramString)
  {
    byte[] arrayOfByte = c;
    if (paramContext != null) {}
    try
    {
      TLog.v("XGService", "@@ deleteAllCachedMsgIntentByPkgName(current pkg:" + paramContext.getPackageName() + ",remote pkg:" + paramString + ")");
      d(paramContext, paramString, new ArrayList());
      return;
    }
    finally {}
  }
  
  public void c(Context paramContext, String paramString, ArrayList paramArrayList)
  {
    byte[] arrayOfByte = c;
    if ((paramContext != null) && (paramArrayList != null)) {}
    try
    {
      TLog.v("XGService", "@@ updateMsgId(current pkg:" + paramContext.getPackageName() + ",remote pkg:" + paramString + "," + paramArrayList + ")");
      a(paramContext, paramString, ".tpns.msg.id", paramArrayList);
      return;
    }
    finally {}
  }
  
  public void c(Context paramContext, List paramList)
  {
    byte[] arrayOfByte = c;
    if ((paramContext != null) && (paramList != null)) {}
    for (;;)
    {
      try
      {
        Object localObject;
        HashMap localHashMap;
        if (paramList.size() > 0)
        {
          TLog.v("XGService", "@@ deleteMsgIdBatch(" + paramContext.getPackageName() + "," + paramList + ")");
          try
          {
            localObject = b(paramContext);
            if ((localObject == null) || (((ArrayList)localObject).size() <= 0)) {
              continue;
            }
            localHashMap = new HashMap();
            Iterator localIterator = ((ArrayList)localObject).iterator();
            if (!localIterator.hasNext()) {
              continue;
            }
            localMessageId = (MessageId)localIterator.next();
            localObject = (ArrayList)localHashMap.get(localMessageId.pkgName);
            if (localObject != null) {
              break label348;
            }
            localObject = new ArrayList();
            localHashMap.put(localMessageId.pkgName, localObject);
          }
          catch (Exception paramContext)
          {
            MessageId localMessageId;
            TpnsPushClientReport localTpnsPushClientReport;
            TLog.e("XGService", paramContext.getMessage());
          }
          if (i >= paramList.size()) {
            break label343;
          }
          localTpnsPushClientReport = (TpnsPushClientReport)paramList.get(i);
          if (localMessageId.id != localTpnsPushClientReport.msgId) {
            continue;
          }
          TLog.i("XGService", ">> deleteMsgId" + localMessageId.id);
          i = 0;
          if (i == 0) {
            continue;
          }
          ((ArrayList)localObject).add(localMessageId);
          localHashMap.put(localMessageId.pkgName, localObject);
          continue;
        }
        return;
        i += 1;
        continue;
        paramList = localHashMap.keySet().iterator();
        if (paramList.hasNext())
        {
          localObject = (String)paramList.next();
          c(paramContext, (String)localObject, (ArrayList)localHashMap.get(localObject));
          continue;
        }
        continue;
        i = 1;
      }
      finally {}
      label343:
      continue;
      label348:
      int i = 0;
    }
  }
  
  public boolean c(Context paramContext, String paramString, long paramLong)
  {
    if ((paramContext != null) && (!com.tencent.android.tpush.service.d.d.a(paramString)) && (paramLong > 0L))
    {
      TLog.v("XGService", "@@ isMsgAcked(current pkg:" + paramContext.getPackageName() + ",remote pkg:" + paramString + "," + paramLong + ")");
      paramContext = a(paramContext, paramString);
      if ((paramContext != null) && (paramContext.size() > 0))
      {
        paramContext = paramContext.iterator();
        while (paramContext.hasNext())
        {
          paramString = (MessageId)paramContext.next();
          if (paramString.id == paramLong) {
            return paramString.a();
          }
        }
      }
    }
    return false;
  }
  
  public void d(Context paramContext)
  {
    if (paramContext == null) {}
    for (;;)
    {
      try
      {
        TLog.e("XGService", "clearLocalMsg context==null");
        return;
      }
      finally {}
      String str = paramContext.getPackageName();
      ArrayList localArrayList1 = b(paramContext, str);
      if ((localArrayList1 != null) && (localArrayList1.size() > 0))
      {
        ArrayList localArrayList2 = new ArrayList();
        int i = 0;
        label198:
        if (i < localArrayList1.size())
        {
          CachedMessageIntent localCachedMessageIntent = (CachedMessageIntent)localArrayList1.get(i);
          try
          {
            Object localObject = Rijndael.decrypt(localCachedMessageIntent.intent);
            if (com.tencent.android.tpush.service.d.d.a((String)localObject)) {
              break label198;
            }
            localObject = Intent.parseUri((String)localObject, 1);
            if (((Intent)localObject).getLongExtra("msgId", 0L) < 0L)
            {
              TLog.i("Constants.ServiceLogTag", ">> clearLocalMsg msgId:" + ((Intent)localObject).getLongExtra("msgId", 0L));
              localArrayList2.add(localCachedMessageIntent);
            }
          }
          catch (Exception localException)
          {
            TLog.e("XGService", localException.getMessage());
            continue;
            i += 1;
          }
          localArrayList1.removeAll(localArrayList2);
          d(paramContext, str, localArrayList1);
        }
      }
    }
  }
  
  public void d(Context paramContext, String paramString, ArrayList paramArrayList)
  {
    byte[] arrayOfByte = c;
    if ((paramContext != null) && (paramArrayList != null)) {}
    try
    {
      TLog.v("XGService", "@@ updateCachedMsgIntent(current pkg:" + paramContext.getPackageName() + ",remote pkg:" + paramString + "," + paramArrayList + ")");
      a(paramContext, paramString, ".tpns.msg.id.cached", paramArrayList);
      return;
    }
    finally {}
  }
  
  public boolean d(Context paramContext, String paramString, long paramLong)
  {
    if ((paramContext != null) && (!com.tencent.android.tpush.service.d.d.a(paramString)))
    {
      TLog.v("XGService", "@@ isMsgCached(current pkg:" + paramContext.getPackageName() + ",remote pkg:" + paramString + "," + paramLong + ")");
      paramContext = b(paramContext, paramString);
      if ((paramContext != null) && (paramContext.size() > 0))
      {
        paramContext = paramContext.iterator();
        while (paramContext.hasNext())
        {
          CachedMessageIntent localCachedMessageIntent = (CachedMessageIntent)paramContext.next();
          if ((localCachedMessageIntent.msgId == paramLong) && (paramString.equals(localCachedMessageIntent.pkgName)))
          {
            TLog.i("XGService", ">> cached msgId:" + paramLong + " pkgName:" + paramString + ")");
            return true;
          }
        }
      }
    }
    return false;
  }
  
  public ArrayList e(Context paramContext)
  {
    Iterator localIterator = null;
    Object localObject1 = localIterator;
    if (paramContext != null)
    {
      TLog.v("XGService", "@@ getCachedMsgIntentList" + paramContext.getPackageName());
      Object localObject2 = CacheManager.getRegisterInfos(paramContext);
      localObject1 = localIterator;
      if (localObject2 != null)
      {
        localObject1 = localIterator;
        if (((List)localObject2).size() > 0)
        {
          TLog.i("XGService", ">> getCachedMsgIntentList apps : " + ((List)localObject2).size());
          localObject1 = new ArrayList();
          localIterator = ((List)localObject2).iterator();
          while (localIterator.hasNext())
          {
            localObject2 = (String)localIterator.next();
            TLog.i("XGService", ">> getCachedMsgIntentList app : " + (String)localObject2);
            localObject2 = b(paramContext, (String)localObject2);
            if ((localObject2 != null) && (((ArrayList)localObject2).size() > 0)) {
              ((ArrayList)localObject1).addAll((Collection)localObject2);
            }
          }
        }
      }
    }
    return localObject1;
  }
}
