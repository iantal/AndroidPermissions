package com.tencent.beacon.applog;

import android.content.Context;
import com.tencent.beacon.a.d;
import com.tencent.beacon.event.p;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.Iterator;
import java.util.List;
import java.util.Locale;
import org.apache.http.util.EncodingUtils;

public final class b
{
  protected static Context a;
  private static b c = null;
  private static com.tencent.beacon.event.g d = null;
  private static a e = null;
  protected com.tencent.beacon.upload.g b;
  private Runnable f = new Runnable()
  {
    public final void run()
    {
      label234:
      for (;;)
      {
        try
        {
          Object localObject = b.this;
          int i = b.c();
          com.tencent.beacon.b.a localA;
          if (i > 0) {
            try
            {
              if (b.this.b != null)
              {
                Iterator localIterator = a.a(b.a, null, -1, -1).iterator();
                if (localIterator.hasNext())
                {
                  localA = (com.tencent.beacon.b.a)localIterator.next();
                  byte[] arrayOfByte = a.a(localA.h());
                  if (arrayOfByte == null) {
                    continue;
                  }
                  com.tencent.beacon.a.b.e localE = com.tencent.beacon.a.b.e.a();
                  i = 2;
                  localObject = "*^@K#K@!";
                  if (localE == null) {
                    break label234;
                  }
                  j = localE.i();
                  i = localE.j();
                  localObject = localE.k();
                  localObject = com.tencent.beacon.b.a.b(arrayOfByte, i, j, (String)localObject);
                  if (localObject == null) {
                    continue;
                  }
                  localObject = EncodingUtils.getString((byte[])localObject, "UTF-8");
                  if ((localObject == null) || ("".equals(localObject))) {
                    continue;
                  }
                  localA.e((String)localObject);
                  b.this.b.a(new c(b.a, localA, false));
                  continue;
                }
              }
              return;
            }
            catch (Throwable localThrowable1)
            {
              com.tencent.beacon.e.a.c(" up common error }%s", new Object[] { localThrowable1.toString() });
              localThrowable1.printStackTrace();
            }
          }
          ArrayList localArrayList = new ArrayList();
          localArrayList.add(localA);
          a.b(b.a, localArrayList);
          localArrayList = null;
          continue;
          int j = 1;
        }
        catch (Throwable localThrowable2)
        {
          localThrowable2.printStackTrace();
          return;
        }
      }
    }
  };
  
  protected b()
  {
    p localP = p.d();
    if (localP != null)
    {
      a = localP.c;
      this.b = localP.h();
      if (localP.a == null) {
        break label67;
      }
    }
    label67:
    for (d = localP.a;; d = new com.tencent.beacon.event.g())
    {
      e = new a(a);
      return;
    }
  }
  
  public static b a()
  {
    try
    {
      if (c == null) {
        c = new b();
      }
      b localB = c;
      return localB;
    }
    finally {}
  }
  
  private static String a(String paramString)
  {
    try
    {
      Object localObject = new SimpleDateFormat("MM/dd/yyyy HH:mm:ss", Locale.US);
      String str = ((SimpleDateFormat)localObject).format(Long.valueOf(new Date().getTime()));
      long l2 = new Date().getTime();
      com.tencent.beacon.a.e localE = com.tencent.beacon.a.e.m();
      long l1 = l2;
      if (localE != null) {
        l1 = l2 + localE.h();
      }
      localObject = ((SimpleDateFormat)localObject).format(Long.valueOf(l1));
      paramString = str + " " + (String)localObject + "\r\n" + paramString + "\r\n";
      return paramString;
    }
    catch (Throwable paramString)
    {
      paramString.printStackTrace();
    }
    return "";
  }
  
  public static boolean a(String paramString1, String paramString2, boolean paramBoolean)
  {
    int j = 1;
    int i;
    if (a() == null)
    {
      com.tencent.beacon.e.a.d("isModuleAble:not init ua", new Object[0]);
      i = 0;
    }
    for (;;)
    {
      if (i == 0) {}
      com.tencent.beacon.b.a localA;
      for (;;)
      {
        return false;
        if ((d == null) || (!d.n())) {
          break label259;
        }
        i = 1;
        break;
        i = paramString1.length();
        if (d != null) {
          if (i > d.o()) {}
        }
        for (i = j; (i != 0) && (e != null); i = 0)
        {
          localA = new com.tencent.beacon.b.a();
          paramString1 = a(paramString1);
          localA.e(paramString1);
          localA.d(paramString2);
          localA.b(System.currentTimeMillis());
          localA.c(paramString1.length());
          com.tencent.beacon.e.a.e("appLog upload   logSize:" + paramString1.length(), new Object[0]);
          if ((!paramBoolean) || (!d.r()) || (d())) {
            break label227;
          }
          com.tencent.beacon.e.a.e("appLog upload   isRealTime:" + paramBoolean, new Object[0]);
          return e.a(localA);
          com.tencent.beacon.e.a.c(" reach app Log size limited! %d ", new Object[] { Integer.valueOf(d.o()) });
        }
      }
      label227:
      com.tencent.beacon.e.a.e("appLog upload   isRealTime:" + paramBoolean, new Object[0]);
      return e.b(localA);
      label259:
      i = 0;
    }
  }
  
  public static void b()
  {
    b localB = a();
    if ((localB != null) && (!d())) {
      d.a().a(localB.f);
    }
  }
  
  public static int c()
  {
    return a.a(a);
  }
  
  private static boolean d()
  {
    if (Long.parseLong(com.tencent.beacon.a.a.b(a, "app_log_consume", "0")) > d.c())
    {
      com.tencent.beacon.e.a.c(" reach app Log upload size limited! %d ", new Object[] { Integer.valueOf(d.o()) });
      return true;
    }
    return false;
  }
}
