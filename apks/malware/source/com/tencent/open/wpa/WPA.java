package com.tencent.open.wpa;

import android.app.Activity;
import android.content.Context;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.net.Uri;
import android.text.TextUtils;
import android.util.Base64;
import com.tencent.connect.auth.QQAuth;
import com.tencent.connect.auth.QQToken;
import com.tencent.connect.common.BaseApi;
import com.tencent.connect.common.BaseApi.TempRequestListener;
import com.tencent.open.TDialog;
import com.tencent.open.b.d;
import com.tencent.open.utils.Global;
import com.tencent.open.utils.HttpUtils;
import com.tencent.tauth.IUiListener;
import com.tencent.tauth.UiError;
import java.io.UnsupportedEncodingException;
import java.util.List;

public class WPA
  extends BaseApi
{
  public static final String CHAT_TYPE_GROUP = "group";
  public static final String CHAT_TYPE_WPA = "wpa";
  
  public WPA(Context paramContext, QQAuth paramQQAuth, QQToken paramQQToken)
  {
    super(paramQQAuth, paramQQToken);
  }
  
  public WPA(Context paramContext, QQToken paramQQToken)
  {
    super(paramQQToken);
  }
  
  public WPA(QQToken paramQQToken)
  {
    super(paramQQToken);
  }
  
  public void getWPAUserOnlineState(String paramString, IUiListener paramIUiListener)
  {
    if (paramString == null) {
      try
      {
        d.a().a(this.mToken.getOpenId(), this.mToken.getAppId(), "ANDROIDSDK.WPASTATE.XX", "15", "18", "1");
        throw new Exception("uin null");
      }
      catch (Exception paramString)
      {
        if (paramIUiListener != null) {
          paramIUiListener.onError(new UiError(-5, "传入参数有误!", null));
        }
        d.a().a(this.mToken.getOpenId(), this.mToken.getAppId(), "ANDROIDSDK.WPASTATE.XX", "15", "18", "1");
        return;
      }
    }
    if (paramString.length() < 5)
    {
      d.a().a(this.mToken.getOpenId(), this.mToken.getAppId(), "ANDROIDSDK.WPASTATE.XX", "15", "18", "1");
      throw new Exception("uin length < 5");
    }
    for (;;)
    {
      int i;
      if (i < paramString.length())
      {
        if (!Character.isDigit(paramString.charAt(i)))
        {
          d.a().a(this.mToken.getOpenId(), this.mToken.getAppId(), "ANDROIDSDK.WPASTATE.XX", "15", "18", "1");
          throw new Exception("uin not digit");
        }
        i += 1;
      }
      else
      {
        paramString = "http://webpresence.qq.com/getonline?Type=1&" + paramString + ":";
        paramIUiListener = new BaseApi.TempRequestListener(this, paramIUiListener);
        HttpUtils.requestAsync(this.mToken, Global.getContext(), paramString, null, "GET", paramIUiListener);
        d.a().a(this.mToken.getOpenId(), this.mToken.getAppId(), "ANDROIDSDK.WPASTATE.XX", "15", "18", "0");
        return;
        i = 0;
      }
    }
  }
  
  public int startWPAConversation(Activity paramActivity, String paramString1, String paramString2)
  {
    return startWPAConversation(paramActivity, "wpa", paramString1, paramString2);
  }
  
  public int startWPAConversation(Activity paramActivity, String paramString1, String paramString2, String paramString3)
  {
    if ((paramString1 == null) || ((!paramString1.equals("wpa")) && (!paramString1.equals("group")))) {
      return -5;
    }
    String str1 = "16";
    if (paramString1.equals("group")) {
      str1 = "17";
    }
    Intent localIntent = new Intent("android.intent.action.VIEW");
    if (TextUtils.isEmpty(paramString2))
    {
      d.a().a(this.mToken.getOpenId(), this.mToken.getAppId(), "ANDROIDSDK.STARTWPA.XX", str1, "18", "1");
      return -1;
    }
    if (paramString2.length() < 5)
    {
      d.a().a(this.mToken.getOpenId(), this.mToken.getAppId(), "ANDROIDSDK.STARTWPA.XX", str1, "18", "1");
      return -3;
    }
    int i = 0;
    while (i < paramString2.length())
    {
      if (!Character.isDigit(paramString2.charAt(i)))
      {
        d.a().a(this.mToken.getOpenId(), this.mToken.getAppId(), "ANDROIDSDK.STARTWPA.XX", str1, "18", "1");
        return -4;
      }
      i += 1;
    }
    String str3 = "";
    String str2 = str3;
    if (!TextUtils.isEmpty(paramString3)) {}
    try
    {
      str2 = Base64.encodeToString(paramString3.getBytes("UTF-8"), 2);
      localIntent.setData(Uri.parse(String.format("mqqwpa://im/chat?chat_type=%1$s&uin=%2$s&version=1&src_type=app&attach_content=%3$s", new Object[] { paramString1, paramString2, str2 })));
      paramString1 = Global.getContext().getPackageManager();
      if (paramString1.queryIntentActivities(localIntent, 65536).size() > 0)
      {
        paramActivity.startActivity(localIntent);
        i = 0;
      }
      for (;;)
      {
        d.a().a(this.mToken.getOpenId(), this.mToken.getAppId(), "ANDROIDSDK.STARTWPA.XX", str1, "18", "0");
        return i;
        localIntent.setData(Uri.parse("http://www.myapp.com/forward/a/45592?g_f=990935"));
        if (paramString1.queryIntentActivities(localIntent, 65536).size() > 0)
        {
          new TDialog(paramActivity, "", getCommonDownloadQQUrl(""), null, this.mToken).show();
          i = 0;
        }
        else
        {
          d.a().a(this.mToken.getOpenId(), this.mToken.getAppId(), "ANDROIDSDK.STARTWPA.XX", str1, "18", "1");
          i = -2;
        }
      }
    }
    catch (UnsupportedEncodingException paramString3)
    {
      for (;;)
      {
        str2 = str3;
      }
    }
  }
}
