package com.unity3d.ads.android;

import com.unity3d.ads.android.cache.UnityAdsCacheManager;
import com.unity3d.ads.android.campaign.UnityAdsCampaign;
import com.unity3d.ads.android.properties.UnityAdsProperties;
import com.unity3d.ads.android.video.UnityAdsVideoPlayView;
import com.unity3d.ads.android.view.UnityAdsMainView;
import com.unity3d.ads.android.view.UnityAdsMainView.UnityAdsMainViewState;
import com.unity3d.ads.android.webapp.UnityAdsWebView;
import org.json.JSONObject;

final class l
  implements Runnable
{
  private l() {}
  
  public final void run()
  {
    
    if (UnityAdsProperties.SELECTED_CAMPAIGN != null)
    {
      UnityAdsDeviceLog.debug("Selected campaign found");
      Object localObject = new JSONObject();
      for (;;)
      {
        try
        {
          ((JSONObject)localObject).put("textKey", "buffering");
          UnityAds.mainview.webview.sendNativeEventToWebApp("showSpinner", (JSONObject)localObject);
          UnityAds.p();
          if (!UnityAds.cachemanager.isCampaignCached(UnityAdsProperties.SELECTED_CAMPAIGN, true))
          {
            localObject = UnityAdsProperties.SELECTED_CAMPAIGN.getVideoStreamUrl();
            UnityAdsProperties.SELECTED_CAMPAIGN_CACHED = Boolean.valueOf(false);
            UnityAds.mainview.setViewState(UnityAdsMainView.UnityAdsMainViewState.VideoPlayer);
            UnityAdsDeviceLog.debug("Start videoplayback with: " + (String)localObject);
            UnityAds.mainview.videoplayerview.playVideo((String)localObject);
            return;
          }
        }
        catch (Exception localException)
        {
          UnityAdsDeviceLog.error("Couldn't create data JSON");
          return;
        }
        String str = UnityAdsUtils.getCacheDirectory() + "/" + UnityAdsProperties.SELECTED_CAMPAIGN.getVideoFilename();
        UnityAdsProperties.SELECTED_CAMPAIGN_CACHED = Boolean.valueOf(true);
      }
    }
    UnityAdsDeviceLog.error("Campaign is null");
  }
}
