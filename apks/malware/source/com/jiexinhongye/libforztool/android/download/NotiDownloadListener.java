package com.jiexinhongye.libforztool.android.download;

import android.app.Notification;
import android.app.NotificationManager;
import android.app.PendingIntent;
import android.content.Context;
import android.graphics.Bitmap;
import android.os.Handler;
import android.os.Looper;
import android.widget.RemoteViews;
import com.jiexinhongye.libforztool.android.ResHelper;
import com.jiexinhongye.libforztool.ztool.DefaultZProgressListener;
import com.jiexinhongye.libforztool.ztool.DefaultZProgressListener.SmallTool;

public abstract class NotiDownloadListener
  extends DefaultZProgressListener
{
  int a;
  private String b = "ztool_download_noti";
  private RemoteViews c;
  private Handler d = new Handler(Looper.getMainLooper());
  private Bitmap e;
  private NotificationManager f = (NotificationManager)getProvider().getContext().getSystemService("notification");
  private PendingIntent g = getProvider().getPendingIntent();
  private String h;
  private String i;
  private Notification j;
  private int k;
  private Runnable l;
  
  public NotiDownloadListener()
  {
    getProvider().getTaskName();
    this.h = getProvider().getTaskTitle();
    this.i = getProvider().getTaskTicker();
    this.a = getProvider().getTaskId();
    Context localContext = getProvider().getContext();
    this.c = new RemoteViews(localContext.getPackageName(), ResHelper.getLayoutId(localContext, this.b));
    this.c = this.c;
    this.e = getProvider().getIcon();
    a();
    this.l = new b(this);
  }
  
  private void a()
  {
    this.j = new Notification(17301633, this.h, System.currentTimeMillis());
    this.j.tickerText = this.i;
    this.j.contentView = this.c;
    this.j.flags = 18;
    this.c.setTextViewText(ResHelper.getId(getProvider().getContext(), "noti_title"), getProvider().getTaskName());
    if (this.e != null) {
      this.c.setImageViewBitmap(ResHelper.getId(getProvider().getContext(), "noti_image"), this.e);
    }
  }
  
  public abstract NotiDownloadContentProvider getProvider();
  
  public void onPercentChange(int paramInt) {}
  
  public abstract void onProgressChange(long paramLong1, long paramLong2);
  
  public void setBitmap(Bitmap paramBitmap)
  {
    this.e = paramBitmap;
    a();
  }
  
  public void updateNotification(long paramLong1, long paramLong2)
  {
    int m = getTool().getPercent(paramLong1, paramLong2);
    if (getTool().changePercent(m, getProvider().getStepInt()))
    {
      this.k = m;
      this.d.post(this.l);
      onPercentChange(m);
    }
  }
}
