package org.scribe.extractors;

import java.util.regex.Matcher;
import java.util.regex.Pattern;
import org.scribe.exceptions.OAuthException;
import org.scribe.model.Token;
import org.scribe.utils.Preconditions;
import org.scribe.utils.URLUtils;

public class TokenExtractorImpl
  implements RequestTokenExtractor, AccessTokenExtractor
{
  private static final Pattern SECRET_REGEX = Pattern.compile("oauth_token_secret=([^&]+)");
  private static final Pattern TOKEN_REGEX = Pattern.compile("oauth_token=([^&]+)");
  
  public TokenExtractorImpl() {}
  
  private String extract(String paramString, Pattern paramPattern)
  {
    paramPattern = paramPattern.matcher(paramString);
    if ((paramPattern.find()) && (paramPattern.groupCount() >= 1)) {
      return URLUtils.formURLDecode(paramPattern.group(1));
    }
    throw new OAuthException("Response body is incorrect. Can't extract token and secret from this: '" + paramString + "'", null);
  }
  
  public Token extract(String paramString)
  {
    Preconditions.checkEmptyString(paramString, "Response body is incorrect. Can't extract a token from an empty string");
    return new Token(extract(paramString, TOKEN_REGEX), extract(paramString, SECRET_REGEX), paramString);
  }
}
