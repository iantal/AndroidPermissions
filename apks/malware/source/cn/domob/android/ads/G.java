package cn.domob.android.ads;

import android.content.Context;
import android.util.Log;
import java.net.URLEncoder;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map.Entry;
import java.util.Set;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;
import org.json.JSONTokener;

class G
{
  private static G A = null;
  private static H a = new H(G.class.getSimpleName());
  private static final String b = "method";
  private static final String c = "ua";
  private static final String d = "cid";
  private static final String e = "ipb";
  private static final String f = "sv";
  private static final String g = "apn";
  private static final String h = "network";
  private static final String i = "idv";
  private static final String j = "get_task_list";
  private static final String k = "report_result";
  private static final String l = "3rd";
  private static final String m = "tasks";
  private static final String n = "det_interval";
  private static final String o = "pb[version_code]";
  private static final String p = "pb[identifier]";
  private static final String q = "result";
  private static final String r = "visit";
  private static final String s = "seqid";
  private static final String t = "vcode";
  private static final String u = "s";
  private static final String v = "c";
  private static final long w = 3600000L;
  private static final long x = 604800000L;
  private static final long y = 600000L;
  private f B = null;
  private Context z;
  
  private G() {}
  
  protected static G a()
  {
    if (A == null) {
      A = new G();
    }
    return A;
  }
  
  private String a(HashMap<String, String> paramHashMap)
  {
    StringBuilder localStringBuilder = new StringBuilder();
    paramHashMap = paramHashMap.entrySet().iterator();
    boolean bool = true;
    if (paramHashMap.hasNext())
    {
      Map.Entry localEntry = (Map.Entry)paramHashMap.next();
      a(localStringBuilder, (String)localEntry.getKey(), (String)localEntry.getValue(), bool);
      if (!bool) {
        break label107;
      }
      bool = false;
    }
    label107:
    for (;;)
    {
      break;
      paramHashMap = localStringBuilder.toString();
      a.b(this, "post params string:" + paramHashMap);
      return paramHashMap;
    }
  }
  
  private static HashMap<String, String> a(Context paramContext, String paramString)
  {
    HashMap localHashMap = new HashMap();
    localHashMap.put("method", paramString);
    String str1 = n.f(paramContext);
    paramString = str1;
    if (str1 == null) {
      paramString = "Android,,,,,,,,";
    }
    localHashMap.put("ua", paramString);
    str1 = new a(paramContext, "domob_config").a("cookie_id", null);
    if (str1 != null)
    {
      a.b(G.class.getSimpleName(), "CID:" + str1);
      localHashMap.put("cid", str1);
    }
    String str2 = g.a().a(paramContext);
    if ((str2 != null) && (str2.length() > 0)) {
      localHashMap.put("ipb", str2);
    }
    for (;;)
    {
      String str3 = String.valueOf(n.b(paramContext));
      if ((str3 != null) && (str3.length() > 0)) {
        localHashMap.put("pb[version_code]", str3);
      }
      str3 = String.valueOf(n.a(paramContext));
      if ((str3 != null) && (str3.length() > 0)) {
        localHashMap.put("pb[identifier]", str3);
      }
      localHashMap.put("sv", "030003");
      localHashMap.put("apn", n.z(paramContext));
      localHashMap.put("network", n.p(paramContext));
      localHashMap.put("idv", n.g(paramContext));
      localHashMap.put("vcode", p.a(str2, paramString, str1).c());
      return localHashMap;
      Log.e("DomobSDK", "publisher id is null or empty!");
    }
  }
  
  private void a(Context paramContext, long paramLong)
  {
    try
    {
      paramContext = new a(paramContext, "domob_config");
      HashMap localHashMap = new HashMap();
      localHashMap.put("next_time", Long.valueOf(System.currentTimeMillis() + paramLong));
      paramContext.a(localHashMap);
      return;
    }
    catch (Exception paramContext)
    {
      a.e(this, "updateDetectTime error:" + paramContext.getMessage());
    }
  }
  
  private static void a(StringBuilder paramStringBuilder, String paramString1, String paramString2, boolean paramBoolean)
  {
    if ((paramString1 != null) && (paramString1.length() > 0) && (paramString2 != null))
    {
      if (paramBoolean) {}
      try
      {
        paramStringBuilder.append(URLEncoder.encode(paramString1, "UTF-8")).append("=").append(URLEncoder.encode(paramString2, "UTF-8"));
        return;
      }
      catch (Exception paramStringBuilder)
      {
        a.a(paramStringBuilder);
      }
      paramStringBuilder.append("&").append(URLEncoder.encode(paramString1, "UTF-8")).append("=").append(URLEncoder.encode(paramString2, "UTF-8"));
      return;
    }
  }
  
  private void a(JSONObject paramJSONObject1, JSONObject paramJSONObject2)
  {
    b(paramJSONObject1, paramJSONObject2);
    c(paramJSONObject1, paramJSONObject2);
    a.a(this, "taskResult" + paramJSONObject2.toString());
  }
  
  private boolean a(Context paramContext)
  {
    if (n.i(paramContext)) {
      a.b(this, "is emulator ignore request");
    }
    for (;;)
    {
      return false;
      try
      {
        long l1 = new a(paramContext, "domob_config").a("next_time", -1L);
        if (l1 < 0L) {
          return true;
        }
        paramContext = Long.valueOf(System.currentTimeMillis() - l1);
        l1 = paramContext.longValue() / 60000L;
        a.b(this, "Exceed detInterval:" + paramContext + "ms    " + Long.valueOf(l1) + " min");
        l1 = paramContext.longValue();
        if (l1 >= 0L) {
          return true;
        }
      }
      catch (Exception paramContext)
      {
        a.e(this, "checkIsNeedDetect error:" + paramContext.getMessage());
      }
    }
    return false;
  }
  
  private void b()
  {
    try
    {
      if (a(this.z))
      {
        a.b(this, "need to detect");
        b(this.z);
      }
      for (;;)
      {
        return;
        a.b(this, "no need to detect");
      }
    }
    catch (Throwable localThrowable)
    {
      for (;;)
      {
        a.e(this, "info detect has Throwable " + localThrowable.getMessage());
        a.a(localThrowable);
      }
    }
    finally {}
  }
  
  private void b(Context paramContext)
  {
    a(paramContext, 600000L);
    Object localObject1 = a(a(paramContext, "get_task_list"));
    s localS = new s(paramContext);
    a.b(this, "Https req:" + (String)localObject1);
    localObject1 = localS.a((String)localObject1, this.B);
    a.b(this, "Https rsp:" + (String)localObject1);
    if ((localObject1 == null) || (((String)localObject1).trim().equals(""))) {}
    label308:
    do
    {
      for (;;)
      {
        return;
        localObject1 = new JSONTokener((String)localObject1);
        try
        {
          localObject2 = new JSONObject((JSONTokener)localObject1);
          if ((localObject2 == null) || (((JSONObject)localObject2).length() == 0))
          {
            a.e(this, "Https rsp jsonobject is error");
            return;
          }
        }
        catch (Exception paramContext)
        {
          a.e(this, "startDetectInfo has a exception msg:" + paramContext.getMessage());
          a.a(paramContext);
          return;
        }
        localObject1 = ((JSONObject)localObject2).optString("det_interval", null);
        if (localObject1 == null) {
          a(paramContext, 3600000L);
        }
        while (!((JSONObject)localObject2).isNull("tasks"))
        {
          localObject1 = ((JSONObject)localObject2).getJSONObject("tasks");
          if ((localObject1 != null) && (((JSONObject)localObject1).length() != 0)) {
            break label308;
          }
          a.e(this, "Can't find a tag name of task");
          return;
          long l1 = Long.parseLong((String)localObject1) * 1000L;
          if (l1 > 604800000L) {
            a(paramContext, 604800000L);
          } else {
            a(paramContext, l1);
          }
        }
      }
      paramContext = a(paramContext, "report_result");
      Object localObject2 = ((JSONObject)localObject2).optString("seqid");
      if (localObject2 != null) {
        paramContext.put("seqid", localObject2);
      }
      localObject2 = new JSONObject();
      a((JSONObject)localObject1, (JSONObject)localObject2);
      localObject1 = new JSONObject();
      ((JSONObject)localObject1).put("result", localObject2);
      paramContext.put("result", URLEncoder.encode(((JSONObject)localObject1).toString(), "UTF-8"));
    } while (paramContext == null);
    paramContext = a(paramContext);
    localS.a(paramContext, this.B);
    a.b(this, "Https send:" + paramContext);
  }
  
  private void b(JSONObject paramJSONObject1, JSONObject paramJSONObject2)
  {
    try
    {
      if (paramJSONObject1.isNull("3rd")) {
        return;
      }
      paramJSONObject1 = paramJSONObject1.getJSONArray("3rd");
      if (paramJSONObject1 == null)
      {
        a.e(this, "Https rsp JSONArray is error");
        return;
      }
    }
    catch (Exception paramJSONObject1)
    {
      a.e(this, "checkThirdPartyExist has exception " + paramJSONObject1.getMessage());
      return;
    }
    JSONObject localJSONObject = new JSONObject();
    int i1 = 0;
    for (;;)
    {
      if (i1 < paramJSONObject1.length())
      {
        String str = paramJSONObject1.getString(i1);
        try
        {
          Class.forName(str);
          localJSONObject.put(str, "1");
          i1 += 1;
        }
        catch (ClassNotFoundException localClassNotFoundException)
        {
          for (;;)
          {
            localJSONObject.put(str, "0");
          }
        }
        catch (Exception localException)
        {
          for (;;)
          {
            a.e(this, "check package has exception");
          }
        }
      }
    }
    paramJSONObject2.put("3rd", localJSONObject);
  }
  
  private void c(JSONObject paramJSONObject1, JSONObject paramJSONObject2)
  {
    paramJSONObject1 = paramJSONObject1.optString("visit", null);
    JSONObject localJSONObject = new JSONObject();
    if (paramJSONObject1 != null) {}
    try
    {
      l localL = new l(this.z, paramJSONObject1, n.f(this.z), null, "GET", null, 20000, null);
      localL.c();
      String str = localL.e();
      paramJSONObject1 = str;
      if (str == null) {
        paramJSONObject1 = "";
      }
      localJSONObject.put("c", paramJSONObject1);
      localJSONObject.put("s", localL.f());
      paramJSONObject2.put("visit", localJSONObject);
      return;
    }
    catch (Exception paramJSONObject1)
    {
      a.e(this, "visit url has a Exception " + paramJSONObject1.getMessage());
      try
      {
        localJSONObject.put("c", "" + paramJSONObject1.getMessage());
        localJSONObject.put("s", -1);
        paramJSONObject2.put("visit", localJSONObject);
        return;
      }
      catch (JSONException paramJSONObject1)
      {
        a.a(paramJSONObject1);
      }
    }
  }
  
  protected void a(Context paramContext, f paramF)
  {
    try
    {
      this.z = paramContext;
      this.B = paramF;
      new Thread()
      {
        public void run()
        {
          G.a(G.this);
        }
      }.start();
      return;
    }
    finally
    {
      paramContext = finally;
      throw paramContext;
    }
  }
  
  static abstract interface a
  {
    public abstract void i(String paramString);
  }
}
