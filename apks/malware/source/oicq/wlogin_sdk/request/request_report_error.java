package oicq.wlogin_sdk.request;

import android.os.Build.VERSION;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import oicq.wlogin_sdk.report.report_t;
import oicq.wlogin_sdk.report.report_t1;
import oicq.wlogin_sdk.tlv_type.tlv_t150;
import oicq.wlogin_sdk.tools.cryptor;
import oicq.wlogin_sdk.tools.util;
import org.json.JSONObject;

public class request_report_error
  extends oicq_report_error
{
  public final String _req_report_error_default_key = "x'Z8mSi,V(Wu~.v:";
  public final int _req_report_error_head_len = 33;
  public final int _req_report_error_head_magic = 1737040709;
  
  public request_report_error(request_global paramRequest_global)
  {
    this._g = paramRequest_global;
  }
  
  public byte[] get_request(long paramLong1, byte[] paramArrayOfByte1, byte[] paramArrayOfByte2, byte[] paramArrayOfByte3, long paramLong2)
  {
    if ((paramArrayOfByte2 != null) && (paramArrayOfByte2.length != 0))
    {
      paramArrayOfByte1 = cryptor.encrypt(paramArrayOfByte1, 0, paramArrayOfByte1.length, paramArrayOfByte3);
      paramArrayOfByte3 = new byte[paramArrayOfByte2.length + 10 + paramArrayOfByte1.length];
      util.int32_to_buf(paramArrayOfByte3, 0, (int)paramLong1);
      i = 0 + 4;
      util.int32_to_buf(paramArrayOfByte3, i, (int)paramLong2);
      i += 4;
      util.int16_to_buf(paramArrayOfByte3, i, paramArrayOfByte2.length);
      System.arraycopy(paramArrayOfByte2, 0, paramArrayOfByte3, i + 2, paramArrayOfByte2.length);
      i = paramArrayOfByte2.length + 10;
      System.arraycopy(paramArrayOfByte1, 0, paramArrayOfByte3, i, paramArrayOfByte1.length);
      i = paramArrayOfByte1.length;
      return paramArrayOfByte3;
    }
    paramArrayOfByte1 = cryptor.encrypt(paramArrayOfByte1, 0, paramArrayOfByte1.length, "x'Z8mSi,V(Wu~.v:".getBytes());
    paramArrayOfByte2 = new byte[paramArrayOfByte1.length + 10];
    util.int32_to_buf(paramArrayOfByte2, 0, (int)paramLong1);
    int i = 0 + 4;
    util.int32_to_buf(paramArrayOfByte2, i, (int)paramLong2);
    i += 4;
    util.int16_to_buf(paramArrayOfByte2, i, 0);
    System.arraycopy(paramArrayOfByte1, 0, paramArrayOfByte2, i + 2, paramArrayOfByte1.length);
    i = paramArrayOfByte1.length;
    return paramArrayOfByte2;
  }
  
  public byte[] get_request_body(byte[] paramArrayOfByte, long paramLong1, long paramLong2, long paramLong3, int paramInt)
  {
    byte[] arrayOfByte = new byte[paramArrayOfByte.length + 33];
    util.int32_to_buf(arrayOfByte, 0, 1737040709);
    int i = 0 + 4;
    util.int32_to_buf(arrayOfByte, i, 0);
    i += 4;
    util.int32_to_buf(arrayOfByte, i, arrayOfByte.length);
    i += 4;
    util.int64_to_buf32(arrayOfByte, i, paramLong1);
    i += 4;
    util.int64_to_buf32(arrayOfByte, i, paramLong2);
    i += 4;
    util.int64_to_buf32(arrayOfByte, i, paramLong3 / 1000L);
    i += 4;
    util.int8_to_buf(arrayOfByte, i, paramInt);
    System.arraycopy(paramArrayOfByte, 0, arrayOfByte, i + 1 + 8, paramArrayOfByte.length);
    paramInt = paramArrayOfByte.length;
    return arrayOfByte;
  }
  
  public int make_request(long paramLong1, byte[] paramArrayOfByte1, byte[] paramArrayOfByte2, byte[] paramArrayOfByte3, long paramLong2, int paramInt)
  {
    int i = 0;
    if (paramInt == 0) {
      i = make_request_0(paramLong1, paramArrayOfByte1, paramArrayOfByte2, paramArrayOfByte3, paramLong2);
    }
    while (paramInt != 1) {
      return i;
    }
    return make_request_1(paramLong1, paramArrayOfByte1, paramArrayOfByte2, paramArrayOfByte3, paramLong2);
  }
  
  public int make_request_0(long paramLong1, byte[] paramArrayOfByte1, byte[] paramArrayOfByte2, byte[] paramArrayOfByte3, long paramLong2)
  {
    int j = 0;
    long l = System.currentTimeMillis();
    this._g._rt1.commit(Build.VERSION.RELEASE, new String(this._g._apk_v), "", util.buf_to_string(util.get_ksid(this._g._context)), new String(this._g._apk_id), new String(this._g._device), new String(this._g._apk_sig));
    paramArrayOfByte1 = this._g._rt1.toJasonObj().toString().getBytes();
    if (paramArrayOfByte1 == null) {}
    int i;
    byte[] arrayOfByte;
    for (paramArrayOfByte1 = new byte[0];; paramArrayOfByte1 = get_request_body(arrayOfByte, paramLong1, paramLong2, l, 0))
    {
      report_t.delete_file(this._g._context);
      i = j;
      if (paramArrayOfByte1 != null)
      {
        i = j;
        if (paramArrayOfByte1.length > 0) {
          i = snd_rcv_req_error(encrypt_body(get_request(paramLong1, paramArrayOfByte1, paramArrayOfByte2, paramArrayOfByte3, paramLong2)));
        }
      }
      util.LOGI("request_report_error(0) rsp: ret=" + i);
      if (i == 0) {
        break;
      }
      report_t.write_tofile(this._g._rt1, this._g._context);
      return i;
      arrayOfByte = new byte[paramArrayOfByte1.length + 4];
      util.int8_to_buf(arrayOfByte, 0, 0);
      util.int8_to_buf(arrayOfByte, 1, 0);
      util.int16_to_buf(arrayOfByte, 2, paramArrayOfByte1.length);
      System.arraycopy(paramArrayOfByte1, 0, arrayOfByte, 4, paramArrayOfByte1.length);
    }
    this._g._rt1.clear_t2();
    return i;
  }
  
  public int make_request_1(long paramLong1, byte[] paramArrayOfByte1, byte[] paramArrayOfByte2, byte[] paramArrayOfByte3, long paramLong2)
  {
    long l4;
    SimpleDateFormat localSimpleDateFormat;
    Calendar localCalendar;
    int j;
    int k;
    int i;
    if ((this._g._t150 != null) && (!this._g.isUploading.booleanValue()))
    {
      this._g.isUploading = Boolean.valueOf(true);
      l4 = System.currentTimeMillis();
      localSimpleDateFormat = new SimpleDateFormat("yyyyMMdd");
      localCalendar = Calendar.getInstance();
      j = this._g._t150.get_bitmap();
      k = this._g._t150.get_network();
      util.LOGI("bitmap:" + j + " network:" + k + " local network:" + util.get_network_type(this._g._context));
      i = 0;
      if (i < 32) {}
    }
    else
    {
      this._g._t150 = null;
      this._g.isUploading = Boolean.valueOf(false);
      return 0;
    }
    if ((1 << i & j) == 0) {}
    label365:
    for (;;)
    {
      i += 1;
      break;
      if ((k == 0) || ((k == 1) && (util.get_network_type(this._g._context) == 2)))
      {
        long l2 = l4 - 86400000 * i;
        localCalendar.setTimeInMillis(l2);
        String str = localSimpleDateFormat.format(localCalendar.getTime());
        long l3 = util.getLogModifyTime(this._g._context, str);
        long l1 = l3;
        if (l3 == 0L) {
          l1 = l2;
        }
        paramArrayOfByte1 = util.readLog(this._g._context, str);
        if (paramArrayOfByte1 == null) {}
        for (paramArrayOfByte1 = new byte[0];; paramArrayOfByte1 = get_request_body(paramArrayOfByte1, paramLong1, paramLong2, l1, 1))
        {
          if ((paramArrayOfByte1 == null) || (paramArrayOfByte1.length <= 0)) {
            break label365;
          }
          int m = snd_rcv_req_error(encrypt_body(get_request(paramLong1, paramArrayOfByte1, paramArrayOfByte2, paramArrayOfByte3, paramLong2)));
          util.LOGI("request_report_error(1) rsp: ret=" + m + "(" + str + ")");
          break;
        }
      }
    }
  }
}
