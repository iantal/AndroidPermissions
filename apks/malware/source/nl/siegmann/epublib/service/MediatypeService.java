package nl.siegmann.epublib.service;

import java.util.Collection;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;
import nl.siegmann.epublib.domain.MediaType;
import nl.siegmann.epublib.util.StringUtil;

public class MediatypeService
{
  public static final MediaType CSS;
  public static final MediaType EPUB;
  public static final MediaType GIF;
  public static final MediaType JPG;
  public static final MediaType NCX;
  public static final MediaType OPENTYPE;
  public static final MediaType PNG;
  public static final MediaType SVG;
  public static final MediaType TTF;
  public static final MediaType XHTML = new MediaType("application/xhtml+xml", ".xhtml", new String[] { ".htm", ".html", ".xhtml" });
  public static final MediaType XPGT;
  public static Map<String, MediaType> mediaTypesByName;
  public static MediaType[] mediatypes;
  
  static
  {
    EPUB = new MediaType("application/epub+zip", ".epub");
    JPG = new MediaType("image/jpeg", ".jpg", new String[] { ".jpg", ".jpeg" });
    PNG = new MediaType("image/png", ".png");
    GIF = new MediaType("image/gif", ".gif");
    CSS = new MediaType("text/css", ".css");
    SVG = new MediaType("image/svg+xml", ".svg");
    TTF = new MediaType("application/x-truetype-font", ".ttf");
    NCX = new MediaType("application/x-dtbncx+xml", ".ncx");
    XPGT = new MediaType("application/adobe-page-template+xml", ".xpgt");
    OPENTYPE = new MediaType("font/opentype", ".otf");
    mediatypes = new MediaType[] { XHTML, EPUB, JPG, PNG, GIF, CSS, SVG, TTF, NCX, XPGT, OPENTYPE };
    mediaTypesByName = new HashMap();
    int i = 0;
    while (i < mediatypes.length)
    {
      mediaTypesByName.put(mediatypes[i].getName(), mediatypes[i]);
      i += 1;
    }
  }
  
  public MediatypeService() {}
  
  public static MediaType determineMediaType(String paramString)
  {
    int i = 0;
    while (i < mediatypes.length)
    {
      MediaType localMediaType = mediatypes[i];
      Iterator localIterator = localMediaType.getExtensions().iterator();
      while (localIterator.hasNext()) {
        if (StringUtil.endsWithIgnoreCase(paramString, (String)localIterator.next())) {
          return localMediaType;
        }
      }
      i += 1;
    }
    return null;
  }
  
  public static MediaType getMediaTypeByName(String paramString)
  {
    return (MediaType)mediaTypesByName.get(paramString);
  }
  
  public static boolean isBitmapImage(MediaType paramMediaType)
  {
    return (paramMediaType == JPG) || (paramMediaType == PNG) || (paramMediaType == GIF);
  }
}
