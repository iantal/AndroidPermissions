package com.google.android.gms.tagmanager;

import android.content.Context;
import com.google.android.gms.analytics.Tracker;
import com.google.android.gms.internal.a;
import com.google.android.gms.internal.b;
import com.google.android.gms.internal.d.a;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.LinkedHashMap;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;

class di
  extends df
{
  private static final String ID = a.aF.toString();
  private static final String aiA = b.ei.toString();
  private static final String aiB = b.ek.toString();
  private static Map aiC;
  private static Map aiD;
  private static final String aiw = b.aV.toString();
  private static final String aix = b.be.toString();
  private static final String aiy = b.bd.toString();
  private static final String aiz = b.eg.toString();
  private final DataLayer aeu;
  private final Set aiE;
  private final de aiF;
  
  public di(Context paramContext, DataLayer paramDataLayer)
  {
    this(paramContext, paramDataLayer, new de(paramContext));
  }
  
  di(Context paramContext, DataLayer paramDataLayer, de paramDe)
  {
    super(ID, new String[0]);
    this.aeu = paramDataLayer;
    this.aiF = paramDe;
    this.aiE = new HashSet();
    this.aiE.add("");
    this.aiE.add("0");
    this.aiE.add("false");
  }
  
  private Map G(Map paramMap)
  {
    paramMap = (d.a)paramMap.get(aiA);
    if (paramMap != null) {
      return c(paramMap);
    }
    if (aiC == null)
    {
      paramMap = new HashMap();
      paramMap.put("transactionId", "&ti");
      paramMap.put("transactionAffiliation", "&ta");
      paramMap.put("transactionTax", "&tt");
      paramMap.put("transactionShipping", "&ts");
      paramMap.put("transactionTotal", "&tr");
      paramMap.put("transactionCurrency", "&cu");
      aiC = paramMap;
    }
    return aiC;
  }
  
  private Map H(Map paramMap)
  {
    paramMap = (d.a)paramMap.get(aiB);
    if (paramMap != null) {
      return c(paramMap);
    }
    if (aiD == null)
    {
      paramMap = new HashMap();
      paramMap.put("name", "&in");
      paramMap.put("sku", "&ic");
      paramMap.put("category", "&iv");
      paramMap.put("price", "&ip");
      paramMap.put("quantity", "&iq");
      paramMap.put("currency", "&cu");
      aiD = paramMap;
    }
    return aiD;
  }
  
  private void a(Tracker paramTracker, Map paramMap)
  {
    String str = cu("transactionId");
    if (str == null) {
      bh.A("Cannot find transactionId in data layer.");
    }
    for (;;)
    {
      return;
      LinkedList localLinkedList = new LinkedList();
      Object localObject2;
      Object localObject3;
      try
      {
        localObject1 = p((d.a)paramMap.get(aiy));
        ((Map)localObject1).put("&t", "transaction");
        localObject2 = G(paramMap).entrySet().iterator();
        while (((Iterator)localObject2).hasNext())
        {
          localObject3 = (Map.Entry)((Iterator)localObject2).next();
          b((Map)localObject1, (String)((Map.Entry)localObject3).getValue(), cu((String)((Map.Entry)localObject3).getKey()));
        }
        localLinkedList.add(localObject1);
      }
      catch (IllegalArgumentException paramTracker)
      {
        bh.b("Unable to send transaction", paramTracker);
        return;
      }
      Object localObject1 = ne();
      if (localObject1 != null)
      {
        localObject1 = ((List)localObject1).iterator();
        while (((Iterator)localObject1).hasNext())
        {
          localObject2 = (Map)((Iterator)localObject1).next();
          if (((Map)localObject2).get("name") == null)
          {
            bh.A("Unable to send transaction item hit due to missing 'name' field.");
            return;
          }
          localObject3 = p((d.a)paramMap.get(aiy));
          ((Map)localObject3).put("&t", "item");
          ((Map)localObject3).put("&ti", str);
          Iterator localIterator = H(paramMap).entrySet().iterator();
          while (localIterator.hasNext())
          {
            Map.Entry localEntry = (Map.Entry)localIterator.next();
            b((Map)localObject3, (String)localEntry.getValue(), (String)((Map)localObject2).get(localEntry.getKey()));
          }
          localLinkedList.add(localObject3);
        }
      }
      paramMap = localLinkedList.iterator();
      while (paramMap.hasNext()) {
        paramTracker.send((Map)paramMap.next());
      }
    }
  }
  
  private void b(Map paramMap, String paramString1, String paramString2)
  {
    if (paramString2 != null) {
      paramMap.put(paramString1, paramString2);
    }
  }
  
  private Map c(d.a paramA)
  {
    paramA = dh.o(paramA);
    if (!(paramA instanceof Map)) {
      return null;
    }
    Object localObject = (Map)paramA;
    paramA = new LinkedHashMap();
    localObject = ((Map)localObject).entrySet().iterator();
    while (((Iterator)localObject).hasNext())
    {
      Map.Entry localEntry = (Map.Entry)((Iterator)localObject).next();
      paramA.put(localEntry.getKey().toString(), localEntry.getValue().toString());
    }
    return paramA;
  }
  
  private String cu(String paramString)
  {
    paramString = this.aeu.get(paramString);
    if (paramString == null) {
      return null;
    }
    return paramString.toString();
  }
  
  private boolean e(Map paramMap, String paramString)
  {
    paramMap = (d.a)paramMap.get(paramString);
    if (paramMap == null) {
      return false;
    }
    return dh.n(paramMap).booleanValue();
  }
  
  private List ne()
  {
    Object localObject = this.aeu.get("transactionProducts");
    if (localObject == null) {
      return null;
    }
    if (!(localObject instanceof List)) {
      throw new IllegalArgumentException("transactionProducts should be of type List.");
    }
    Iterator localIterator = ((List)localObject).iterator();
    while (localIterator.hasNext()) {
      if (!(localIterator.next() instanceof Map)) {
        throw new IllegalArgumentException("Each element of transactionProducts should be of type Map.");
      }
    }
    return (List)localObject;
  }
  
  private Map p(d.a paramA)
  {
    if (paramA == null) {
      return new HashMap();
    }
    paramA = c(paramA);
    if (paramA == null) {
      return new HashMap();
    }
    String str = (String)paramA.get("&aip");
    if ((str != null) && (this.aiE.contains(str.toLowerCase()))) {
      paramA.remove("&aip");
    }
    return paramA;
  }
  
  public void y(Map paramMap)
  {
    Tracker localTracker = this.aiF.cm("_GTM_DEFAULT_TRACKER_");
    if (e(paramMap, aix))
    {
      localTracker.send(p((d.a)paramMap.get(aiy)));
      return;
    }
    if (e(paramMap, aiz))
    {
      a(localTracker, paramMap);
      return;
    }
    bh.D("Ignoring unknown tag.");
  }
}
