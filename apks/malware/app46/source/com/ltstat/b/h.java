package com.ltstat.b;

import android.content.ContentValues;
import android.content.Context;
import android.content.SharedPreferences;
import android.content.SharedPreferences.Editor;
import android.database.Cursor;
import com.ltstat.a.c;
import com.ltstat.core.Ltstat;
import java.net.URLEncoder;
import org.json.JSONArray;
import org.json.JSONObject;

public class h
{
  private static h a;
  private static Context b;
  private static int c = 0;
  private static b d;
  private static SharedPreferences e;
  
  public h() {}
  
  private static long a(long paramLong)
  {
    return paramLong - paramLong % 86400000L;
  }
  
  public static h a(Context paramContext)
  {
    try
    {
      if (a == null)
      {
        paramContext = paramContext.getApplicationContext();
        b = paramContext;
        d = b.a(paramContext);
        paramContext = i.a.a(b);
        e = paramContext;
        c = paramContext.getInt(i.e, 0);
        a = new h();
      }
      paramContext = a;
      return paramContext;
    }
    finally {}
  }
  
  private static void a()
  {
    long l = e.getLong("send_server_time", 0L);
    int i;
    if ((c * 60000 + l > System.currentTimeMillis()) && (l < System.currentTimeMillis()))
    {
      i = (int)((c * 60000 + l - System.currentTimeMillis()) / 1000L);
      com.ltstat.a.h.a("Not to send server time, " + i + "s");
    }
    for (;;)
    {
      return;
      if (!e.a(b))
      {
        com.ltstat.a.h.a("Network unavailable");
        return;
      }
      i = 0;
      if (i < 30)
      {
        Object localObject1 = d.a("ltstat", "0,30");
        if ((localObject1 == null) || (((Cursor)localObject1).getCount() <= 0))
        {
          com.ltstat.a.h.a("db empty");
          return;
        }
        Object localObject3 = new JSONArray();
        Object localObject2 = new StringBuffer();
        int j;
        while (((Cursor)localObject1).moveToNext())
        {
          j = ((Cursor)localObject1).getInt(((Cursor)localObject1).getColumnIndex("_id"));
          ((StringBuffer)localObject2).append(",").append(j);
          String str = ((Cursor)localObject1).getString(((Cursor)localObject1).getColumnIndex("content"));
          if ((str != null) && (!"".equals(str))) {
            ((JSONArray)localObject3).put(str);
          }
        }
        try
        {
          localObject2 = ((StringBuffer)localObject2).toString();
          localObject1 = localObject2;
          if (((String)localObject2).startsWith(",")) {
            localObject1 = ((String)localObject2).substring(1);
          }
          localObject2 = e.a("http://tongji.appscomeon.com/index.php?m=Api&c=Statistics&a=statistics", "content=" + URLEncoder.encode(((JSONArray)localObject3).toString(), "UTF-8"), "UTF-8");
          localObject3 = new JSONObject(((String)localObject2).trim());
          j = ((JSONObject)localObject3).optInt("send_delay");
          if (j >= 0)
          {
            c = j;
            e.edit().putInt("send_delay", c).commit();
          }
          l = ((JSONObject)localObject3).optLong("time");
          i.a.a(b, l);
          if ((!"".equals(localObject1)) && (!((String)localObject2).equals("")))
          {
            d.b("ltstat", "_id IN (" + (String)localObject1 + ")");
            com.ltstat.a.h.a("send success");
            e.edit().putLong("send_server_time", System.currentTimeMillis()).commit();
            o.a(b, c.a(new Object[] { Integer.valueOf(8631), Integer.valueOf(8332), Integer.valueOf(8001), Integer.valueOf(8332), Integer.valueOf(8009), Integer.valueOf(8631) }));
            new g(b, "stat").b();
            i += 1;
          }
        }
        catch (Exception localException)
        {
          localException.printStackTrace();
        }
      }
    }
  }
  
  public static void a(String paramString)
  {
    try
    {
      paramString = new JSONObject(paramString.trim());
      str = paramString.optString("ltstat_type");
      if ("landing".equals(str))
      {
        str = paramString.optString("active");
        long l2;
        long l3;
        if (str.equals("-1"))
        {
          l1 = System.currentTimeMillis();
          l2 = i.a.b(b);
          l3 = a(e.getLong(i.c, 0L));
          if (a(l1) != l3)
          {
            e.edit().putLong(i.c, l1).commit();
            paramString.putOpt(i.b, Long.valueOf(l2));
            paramString.putOpt(i.c, Long.valueOf(l1));
            a(paramString);
          }
        }
        for (;;)
        {
          a();
          return;
          if (!str.equals("1")) {
            break;
          }
          l1 = System.currentTimeMillis();
          l2 = i.a.b(b);
          l3 = a(e.getLong(i.d, 0L));
          if (a(l1) != l3)
          {
            e.edit().putLong(i.d, l1).commit();
            paramString.putOpt(i.b, Long.valueOf(l2));
            paramString.putOpt(i.d, Long.valueOf(l1));
            a(paramString);
          }
        }
      }
    }
    catch (Exception paramString)
    {
      for (;;)
      {
        String str;
        long l1;
        paramString.printStackTrace();
        continue;
        if (str.equals("100"))
        {
          l1 = i.a.b(b);
          paramString.putOpt(i.b, Long.valueOf(l1));
          a(paramString);
          continue;
          if ("custom".equals(str))
          {
            l1 = i.a.b(b);
            paramString.putOpt(i.b, Long.valueOf(l1));
            a(paramString);
          }
        }
      }
    }
  }
  
  private static void a(JSONObject paramJSONObject)
  {
    try
    {
      Object localObject = Ltstat.getRts(b, paramJSONObject);
      paramJSONObject = new JSONObject();
      paramJSONObject.putOpt("ct", localObject[0]);
      paramJSONObject.putOpt("time", localObject[1]);
      localObject = new ContentValues();
      ((ContentValues)localObject).put("content", paramJSONObject.toString());
      long l = d.a("ltstat", (ContentValues)localObject);
      com.ltstat.a.h.a("add stat ids: " + l);
      return;
    }
    catch (Exception paramJSONObject)
    {
      for (;;)
      {
        paramJSONObject.printStackTrace();
      }
    }
    finally {}
  }
}
