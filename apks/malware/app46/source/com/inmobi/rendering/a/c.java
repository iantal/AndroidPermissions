package com.inmobi.rendering.a;

import android.os.HandlerThread;
import android.os.Looper;
import android.os.Message;
import com.inmobi.commons.core.utilities.Logger;
import com.inmobi.commons.core.utilities.Logger.InternalLogLevel;
import com.inmobi.commons.core.utilities.d;
import java.util.ArrayList;
import java.util.List;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.atomic.AtomicBoolean;

public final class c
  implements com.inmobi.commons.core.configs.b.b
{
  private static final String a = c.class.getSimpleName();
  private static c b;
  private static final Object c = new Object();
  private static ExecutorService d;
  private static c.a e;
  private static HandlerThread f;
  private static List g = new ArrayList();
  private static b h;
  private static AtomicBoolean i = new AtomicBoolean(false);
  private static com.inmobi.ads.b.b j;
  private static final Object k = new Object();
  private final c.d l = new c.3(this);
  
  private c()
  {
    Logger.a(Logger.InternalLogLevel.INTERNAL, a, "Creating a new instance ...");
    d = Executors.newFixedThreadPool(5);
    f = new HandlerThread("pingHandlerThread");
    f.start();
    e = new c.a(this, f.getLooper());
    com.inmobi.ads.b localB = new com.inmobi.ads.b();
    com.inmobi.commons.core.configs.b.a().a(localB, this);
    j = localB.i();
    h = new b();
    com.inmobi.commons.core.utilities.c.a().a(new c.2(this));
  }
  
  public static c a()
  {
    Object localObject1 = b;
    if (localObject1 == null) {
      synchronized (c)
      {
        c localC2 = b;
        localObject1 = localC2;
        if (localC2 == null)
        {
          localObject1 = new c();
          b = (c)localObject1;
        }
        return localObject1;
      }
    }
    return localC1;
  }
  
  private void a(a paramA)
  {
    if (paramA.d > 0)
    {
      paramA.d -= 1;
      paramA.c = System.currentTimeMillis();
      h.a(paramA);
    }
  }
  
  private void b(a paramA)
  {
    h.a(paramA, j.d());
    if (!d.a())
    {
      Logger.a(Logger.InternalLogLevel.INTERNAL, a, "No network available. Saving click for later processing ...");
      i.set(false);
      c();
      return;
    }
    d.submit(new c.1(this, paramA));
  }
  
  public void a(com.inmobi.commons.core.configs.a paramA)
  {
    j = ((com.inmobi.ads.b)paramA).i();
  }
  
  public void a(String paramString, boolean paramBoolean)
  {
    paramString = new a(paramString, paramBoolean, false, j.a() + 1);
    Logger.a(Logger.InternalLogLevel.INTERNAL, a, "Received click (" + paramString.a + ") for pinging over HTTP");
    b(paramString);
  }
  
  public void b()
  {
    if (!d.a()) {
      return;
    }
    for (;;)
    {
      synchronized (k)
      {
        if (i.compareAndSet(false, true))
        {
          Logger.a(Logger.InternalLogLevel.INTERNAL, a, "Resume processing clicks ...");
          if (f == null)
          {
            f = new HandlerThread("pingHandlerThread");
            f.start();
          }
          if (e == null) {
            e = new c.a(this, f.getLooper());
          }
          if (h.a())
          {
            Logger.a(Logger.InternalLogLevel.INTERNAL, a, "Done processing all clicks!");
            i.set(false);
            c();
          }
        }
        else
        {
          return;
        }
      }
      Message localMessage = Message.obtain();
      localMessage.what = 1;
      e.sendMessage(localMessage);
    }
  }
  
  public void b(String paramString, boolean paramBoolean)
  {
    paramString = new a(paramString, paramBoolean, true, j.a() + 1);
    Logger.a(Logger.InternalLogLevel.INTERNAL, a, "Received click (" + paramString.a + ") for pinging in WebView");
    b(paramString);
  }
  
  public void c()
  {
    i.set(false);
    synchronized (k)
    {
      if (!i.get())
      {
        if (f != null)
        {
          f.getLooper().quit();
          f.interrupt();
          f = null;
          e = null;
        }
        g.clear();
      }
      return;
    }
  }
}
