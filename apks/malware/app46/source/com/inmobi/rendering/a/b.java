package com.inmobi.rendering.a;

import android.content.ContentValues;
import com.inmobi.commons.core.utilities.Logger;
import com.inmobi.commons.core.utilities.Logger.InternalLogLevel;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

public class b
{
  public static final String[] a = { "id", "pending_attempts", "url", "ping_in_webview", "follow_redirect", "ts" };
  private static final String b = b.class.getSimpleName();
  
  public b()
  {
    com.inmobi.commons.core.b.b localB = com.inmobi.commons.core.b.b.a();
    localB.a("click", "(id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, pending_attempts INTEGER NOT NULL, url TEXT NOT NULL, ping_in_webview TEXT NOT NULL, follow_redirect TEXT NOT NULL, ts TEXT NOT NULL)");
    localB.b();
  }
  
  public a a(ContentValues paramContentValues)
  {
    int i = paramContentValues.getAsInteger("id").intValue();
    int j = paramContentValues.getAsInteger("pending_attempts").intValue();
    String str = paramContentValues.getAsString("url");
    long l = Long.valueOf(paramContentValues.getAsString("ts")).longValue();
    return new a(i, str, Boolean.valueOf(paramContentValues.getAsString("follow_redirect")).booleanValue(), Boolean.valueOf(paramContentValues.getAsString("ping_in_webview")).booleanValue(), j, l);
  }
  
  public List a(int paramInt1, int paramInt2)
  {
    ArrayList localArrayList = new ArrayList();
    com.inmobi.commons.core.b.b localB = com.inmobi.commons.core.b.b.a();
    if (localB.a("click") == 0) {
      return localArrayList;
    }
    if (-1 == paramInt1) {}
    for (Object localObject = null;; localObject = Integer.toString(paramInt1))
    {
      localObject = localB.a("click", a, null, null, "ts", "ts < " + String.valueOf(System.currentTimeMillis() - paramInt2), "ts ASC ", (String)localObject);
      localB.b();
      localObject = ((List)localObject).iterator();
      while (((Iterator)localObject).hasNext()) {
        localArrayList.add(a((ContentValues)((Iterator)localObject).next()));
      }
    }
    return localArrayList;
  }
  
  public void a(a paramA)
  {
    com.inmobi.commons.core.b.b localB = com.inmobi.commons.core.b.b.a();
    int i = paramA.a;
    localB.a("click", c(paramA), "id = ?", new String[] { String.valueOf(i) });
    localB.b();
  }
  
  public boolean a()
  {
    return com.inmobi.commons.core.b.b.a().a("click") == 0;
  }
  
  public boolean a(a paramA, int paramInt)
  {
    try
    {
      paramA = c(paramA);
      com.inmobi.commons.core.b.b localB = com.inmobi.commons.core.b.b.a();
      if (localB.a("click") >= paramInt)
      {
        Object localObject = new HashMap();
        ((Map)localObject).put("errorCode", "MaxDbLimitBreach");
        com.inmobi.commons.core.c.a.a().a("ads", "PingDiscarded", (Map)localObject);
        Logger.a(Logger.InternalLogLevel.INTERNAL, b, "Pruning persistent store to remove the oldest entry ...");
        localObject = a((ContentValues)localB.a("click", a, "ts= (SELECT MIN(ts) FROM click LIMIT 1)", null, null, null, null, null).get(0));
        Logger.a(Logger.InternalLogLevel.INTERNAL, b, "Deleting click (" + ((a)localObject).a + ")");
        b((a)localObject);
      }
      localB.a("click", paramA);
      localB.b();
      return true;
    }
    finally {}
  }
  
  public void b(a paramA)
  {
    com.inmobi.commons.core.b.b localB = com.inmobi.commons.core.b.b.a();
    localB.a("click", "id = ?", new String[] { String.valueOf(paramA.a) });
    localB.b();
  }
  
  public ContentValues c(a paramA)
  {
    ContentValues localContentValues = new ContentValues();
    localContentValues.put("id", Integer.valueOf(paramA.a));
    localContentValues.put("url", paramA.b);
    localContentValues.put("pending_attempts", Integer.valueOf(paramA.d));
    localContentValues.put("ts", Long.toString(paramA.c));
    localContentValues.put("follow_redirect", Boolean.toString(paramA.g));
    localContentValues.put("ping_in_webview", Boolean.toString(paramA.f));
    return localContentValues;
  }
}
