package com.sprinkle.ads.util;

import android.content.Context;
import android.content.SharedPreferences;
import android.content.SharedPreferences.Editor;
import android.os.Environment;
import android.util.Log;
import java.io.File;
import org.json.JSONObject;

public class SprinkleUtil
{
  private static final String TAG = "Sprinkle_SprinkleUtil";
  
  public SprinkleUtil() {}
  
  public static void updateServiceConfig(Context paramContext)
  {
    for (;;)
    {
      Object localObject1;
      SharedPreferences.Editor localEditor;
      try
      {
        if (!FrxUtil.isNetworkAvaliable(paramContext))
        {
          Log.w("Sprinkle_SprinkleUtil", "network unavaliable");
          return;
        }
        localObject1 = paramContext.getSharedPreferences("com.sprinkle.ads.srvconf", 0);
        localEditor = ((SharedPreferences)localObject1).edit();
        if (Long.valueOf(((SharedPreferences)localObject1).getLong("last_update_time", 0L)).longValue() + 7200000L > System.currentTimeMillis())
        {
          Log.i("Sprinkle_SprinkleUtil", "need not update");
          continue;
        }
        localEditor.putLong("last_update_time", System.currentTimeMillis()).commit();
      }
      finally {}
      paramContext = FrxUtil.sendPost("http://adconfig.appscomeon.com/joymeng/sprinkle", "type=json&group=6&packagename=" + paramContext.getPackageName() + "&" + FrxUtil.getSystemInfo(paramContext), "UTF-8");
      if ((paramContext == null) || ("".equals(paramContext)))
      {
        Log.w("Sprinkle_SprinkleUtil", "load service config failed");
      }
      else
      {
        localObject1 = ((SharedPreferences)localObject1).getString("version", "");
        try
        {
          paramContext = new JSONObject(paramContext);
          int i = paramContext.getInt("status");
          localEditor.putInt("status", i).commit();
          if (i == 0) {
            break label631;
          }
          Object localObject2 = paramContext.getString("version");
          if (((String)localObject2).equals(localObject1)) {
            continue;
          }
          Log.i("Sprinkle_SprinkleUtil", "new version:" + (String)localObject2);
          String str = paramContext.getString("fullad_type");
          localObject1 = paramContext.getString("banner_type");
          localEditor.putString("version", (String)localObject2).putString("fullad_type", str).putString("banner_type", (String)localObject1).commit();
          localObject2 = paramContext.getJSONObject(str);
          JSONObject localJSONObject = ((JSONObject)localObject2).getJSONObject("landscape");
          localEditor.putString(str + "_landscape_pic", localJSONObject.getString("pic")).commit();
          localEditor.putString(str + "_landscape_packname", localJSONObject.getString("packname")).commit();
          localObject2 = ((JSONObject)localObject2).getJSONObject("portrait");
          localEditor.putString(str + "_portrait_pic", ((JSONObject)localObject2).getString("pic")).commit();
          localEditor.putString(str + "_portrait_packname", ((JSONObject)localObject2).getString("packname")).commit();
          paramContext = paramContext.getJSONObject((String)localObject1);
          localEditor.putString(localObject1 + "_pic", paramContext.getString("pic")).commit();
          localEditor.putString(localObject1 + "_packname", paramContext.getString("packname")).commit();
          if (!Environment.getExternalStorageState().equals("mounted")) {
            continue;
          }
          FrxUtil.delFile(Environment.getExternalStorageDirectory().getAbsolutePath() + "/" + "com.sprinkle.ads");
        }
        catch (Exception paramContext)
        {
          Log.e("Sprinkle_SprinkleUtil", "Exception: " + paramContext.getMessage());
        }
        continue;
        label631:
        if (Environment.getExternalStorageState().equals("mounted")) {
          FrxUtil.delFile(Environment.getExternalStorageDirectory().getAbsolutePath() + "/" + "com.sprinkle.ads");
        }
      }
    }
  }
}
