package com.ltad.dialog;

import android.app.Activity;
import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.content.SharedPreferences.Editor;
import android.content.pm.PackageManager;
import android.content.pm.PackageManager.NameNotFoundException;
import android.net.Uri;
import android.preference.PreferenceManager;
import android.util.Log;
import com.ltad.a.i;
import com.ltad.b.b.a;
import com.ltad.b.c;

public class AdDialog
{
  private static final String TAG = AdDialog.class.getSimpleName();
  private static AdDialog mInstance = null;
  private AdDialog.DialogAd mAd = null;
  private AdDialog.AdListener mAdListener = null;
  private Context mContext = null;
  private SharedPreferences mPreferences = null;
  
  public AdDialog(Context paramContext)
  {
    this.mContext = paramContext;
    this.mPreferences = PreferenceManager.getDefaultSharedPreferences(paramContext);
  }
  
  private boolean CheckPackageInstalled(Context paramContext, String paramString)
  {
    try
    {
      paramContext = paramContext.getPackageManager().getPackageInfo(paramString, 1);
      if (paramContext != null) {
        return true;
      }
    }
    catch (PackageManager.NameNotFoundException paramContext)
    {
      return false;
    }
    catch (Exception paramContext)
    {
      return false;
    }
    catch (Error paramContext)
    {
      return false;
    }
    return false;
  }
  
  private void clearCountData()
  {
    this.mPreferences.edit().remove(i.a(196609)).commit();
    this.mPreferences.edit().remove(i.a(196610)).commit();
    this.mPreferences.edit().remove(i.a(196611)).commit();
  }
  
  private void countAdDialog(String paramString)
  {
    int i = this.mPreferences.getInt(paramString, 0);
    this.mPreferences.edit().putInt(paramString, i + 1).commit();
  }
  
  private void countAdDialogPackage(String paramString1, String paramString2)
  {
    this.mPreferences.edit().putString(paramString1, paramString2).commit();
  }
  
  private int getCountData(String paramString)
  {
    return this.mPreferences.getInt(paramString, 0);
  }
  
  private String getCountPackage(String paramString)
  {
    return this.mPreferences.getString(paramString, "");
  }
  
  public static AdDialog getInstance(Context paramContext)
  {
    if (mInstance == null) {
      mInstance = new AdDialog(paramContext);
    }
    return mInstance;
  }
  
  private long getInterval(Context paramContext)
  {
    paramContext = Long.valueOf(this.mPreferences.getLong(i.a(196608), 0L));
    if (paramContext.longValue() == 0L)
    {
      this.mPreferences.edit().putLong(i.a(196608), System.currentTimeMillis()).commit();
      return 0L;
    }
    return System.currentTimeMillis() - paramContext.longValue();
  }
  
  private void jumpToGooglePlay(Context paramContext, String paramString)
  {
    try
    {
      paramString = new Intent("android.intent.action.VIEW", Uri.parse(i.a(393225) + paramString));
      paramString.addFlags(268435456);
      paramString.setPackage(i.a(393226));
      paramContext.startActivity(paramString);
      return;
    }
    catch (Exception paramContext)
    {
      paramContext.printStackTrace();
    }
  }
  
  private void requestAdDialogData(Context paramContext, c paramC)
  {
    new AdDialog.2(this, paramC, paramContext).start();
  }
  
  private void requestCountData(c paramC)
  {
    new AdDialog.3(this, paramC).start();
  }
  
  public void init()
  {
    Log.e(TAG, "ad dialog is init !");
    requestAdDialogData(this.mContext, new a(this.mContext));
  }
  
  public void setAdListener(AdDialog.AdListener paramAdListener)
  {
    this.mAdListener = paramAdListener;
  }
  
  public boolean showAd(Activity paramActivity)
  {
    if (paramActivity == null) {
      Log.e(TAG, "activity is null !");
    }
    long l;
    do
    {
      do
      {
        return false;
      } while ((this.mAd == null) || (!this.mAd.show));
      l = getInterval(paramActivity);
      Log.e(TAG, "interval:" + l);
    } while ((l != 0L) && (l < this.mAd.interval));
    paramActivity.runOnUiThread(new AdDialog.1(this, paramActivity));
    this.mPreferences.edit().putLong(i.a(196608), System.currentTimeMillis()).commit();
    countAdDialog(i.a(196609));
    countAdDialogPackage(i.a(196611), this.mAd.packageName);
    return true;
  }
}
