package com.ltad.dialog;

import android.app.Dialog;
import android.content.Context;
import android.content.pm.PackageManager;
import android.content.pm.PackageManager.NameNotFoundException;
import android.content.res.Resources;
import android.os.Bundle;
import android.util.DisplayMetrics;
import android.view.KeyEvent;
import android.webkit.WebSettings;
import android.webkit.WebView;
import android.widget.ImageButton;
import android.widget.ProgressBar;
import android.widget.RelativeLayout;
import android.widget.RelativeLayout.LayoutParams;
import com.ltad.util.ConstUtil;

public class WebViewDialog
  extends Dialog
{
  private RelativeLayout baseLayout;
  private float density;
  private Context mAppContext;
  private ImageButton mCloseBtn;
  private RelativeLayout.LayoutParams mCloseBtnParams;
  private ProgressBar mProgressBar;
  private RelativeLayout.LayoutParams mProgressBarParams;
  private WebView mWebView;
  
  public WebViewDialog(Context paramContext)
  {
    super(paramContext);
  }
  
  public WebViewDialog(Context paramContext, int paramInt)
  {
    super(paramContext, paramInt);
  }
  
  private boolean isInstalled(Context paramContext, String paramString)
  {
    boolean bool = false;
    try
    {
      paramContext = paramContext.getPackageManager().getPackageInfo(paramString, 0);
      if (paramContext != null) {
        bool = true;
      }
      return bool;
    }
    catch (PackageManager.NameNotFoundException paramContext) {}
    return false;
  }
  
  protected void onCreate(Bundle paramBundle)
  {
    super.onCreate(paramBundle);
    this.mAppContext = getContext().getApplicationContext();
    this.density = this.mAppContext.getResources().getDisplayMetrics().density;
    this.baseLayout = new RelativeLayout(this.mAppContext);
    this.baseLayout.setBackgroundColor(-1);
    addContentView(this.baseLayout, new RelativeLayout.LayoutParams(-1, -1));
  }
  
  public boolean onKeyDown(int paramInt, KeyEvent paramKeyEvent)
  {
    if ((paramInt == 4) && (this.mWebView.canGoBack()))
    {
      this.mWebView.goBack();
      return true;
    }
    return super.onKeyDown(paramInt, paramKeyEvent);
  }
  
  protected void onStart()
  {
    super.onStart();
    this.mWebView = new WebView(this.mAppContext);
    this.mWebView.setWebViewClient(new WebViewDialog.1(this));
    this.mWebView.getSettings().setJavaScriptEnabled(true);
    this.mWebView.getSettings().setCacheMode(1);
    this.mWebView.loadUrl(ConstUtil.URL_MOREGAME);
    this.baseLayout.addView(this.mWebView, new RelativeLayout.LayoutParams(-1, -1));
    this.mProgressBar = new ProgressBar(this.mAppContext);
    this.mProgressBarParams = new RelativeLayout.LayoutParams(-2, -2);
    this.mProgressBarParams.addRule(13, -1);
    this.baseLayout.addView(this.mProgressBar, this.mProgressBarParams);
    this.mCloseBtn = new ImageButton(this.mAppContext);
    this.mCloseBtn.setOnClickListener(new WebViewDialog.2(this));
    this.mCloseBtnParams = new RelativeLayout.LayoutParams((int)(this.density * 30.0F), (int)(this.density * 30.0F));
    this.mCloseBtn.setBackgroundColor(0);
    this.mCloseBtn.setImageResource(17301527);
    this.mCloseBtnParams.setMargins(0, 0, 0, 0);
    this.mCloseBtnParams.addRule(9, -1);
    this.mCloseBtnParams.addRule(10, -1);
    this.baseLayout.addView(this.mCloseBtn, this.mCloseBtnParams);
  }
  
  protected void onStop()
  {
    super.onStop();
    if (this.baseLayout != null) {
      this.baseLayout.removeAllViews();
    }
    if (this.mWebView != null) {
      this.mWebView.destroy();
    }
    if (this.mCloseBtn != null) {
      this.mCloseBtn.setBackgroundDrawable(null);
    }
  }
}
