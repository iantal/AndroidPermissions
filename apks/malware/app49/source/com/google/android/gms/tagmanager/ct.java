package com.google.android.gms.tagmanager;

import android.content.Context;
import android.net.ConnectivityManager;
import android.net.NetworkInfo;
import com.google.android.gms.b.p;
import com.google.android.gms.b.wy;
import com.google.android.gms.b.wz;
import java.io.ByteArrayOutputStream;
import java.io.FileNotFoundException;
import java.io.IOException;

final class ct
  implements Runnable
{
  private final Context a;
  private final wz b;
  private final String c;
  private final String d;
  private bh<p> e;
  private volatile fk f;
  private volatile String g;
  private volatile String h;
  
  private ct(Context paramContext, String paramString, wz paramWz, fk paramFk)
  {
    this.a = paramContext;
    this.b = paramWz;
    this.c = paramString;
    this.f = paramFk;
    this.d = ("/r?id=" + paramString);
    this.g = this.d;
    this.h = null;
  }
  
  public ct(Context paramContext, String paramString, fk paramFk)
  {
    this(paramContext, paramString, new wz(), paramFk);
  }
  
  final void a(bh<p> paramBh)
  {
    this.e = paramBh;
  }
  
  final void a(String paramString)
  {
    if (paramString == null)
    {
      this.g = this.d;
      return;
    }
    bj.d("Setting CTFE URL path: " + paramString);
    this.g = paramString;
  }
  
  final void b(String paramString)
  {
    bj.d("Setting previous container version: " + paramString);
    this.h = paramString;
  }
  
  public final void run()
  {
    if (this.e == null) {
      throw new IllegalStateException("callback must be set before execute");
    }
    Object localObject1 = this.e;
    localObject1 = ((ConnectivityManager)this.a.getSystemService("connectivity")).getActiveNetworkInfo();
    if ((localObject1 == null) || (!((NetworkInfo)localObject1).isConnected())) {
      bj.e("...no network connectivity");
    }
    for (int i = 0; i == 0; i = 1)
    {
      localObject1 = this.e;
      localObject1 = bi.a;
      return;
    }
    bj.e("Start loading resource from network ...");
    Object localObject3 = this.f.a() + this.g + "&v=a65833898";
    localObject1 = localObject3;
    if (this.h != null)
    {
      localObject1 = localObject3;
      if (!this.h.trim().equals("")) {
        localObject1 = (String)localObject3 + "&pv=" + this.h;
      }
    }
    if (ci.a().b().equals(cj.c))
    {
      localObject1 = (String)localObject1 + "&gtm_debug=x";
      for (;;)
      {
        localObject3 = this.b;
        localObject3 = wz.a();
        try
        {
          Object localObject4 = ((wy)localObject3).a((String)localObject1);
          ByteArrayOutputStream localByteArrayOutputStream;
        }
        catch (FileNotFoundException localFileNotFoundException)
        {
          localFileNotFoundException = localFileNotFoundException;
          bj.b("No data is retrieved from the given url: " + (String)localObject1 + ". Make sure container_id: " + this.c + " is correct.");
          localObject1 = this.e;
          localObject1 = bi.c;
          return;
        }
        catch (IOException localIOException1)
        {
          bj.b("Error when loading resources from url: " + (String)localObject1 + " " + localIOException1.getMessage(), localIOException1);
          localObject1 = this.e;
          localObject1 = bi.b;
          return;
        }
        finally
        {
          ((wy)localObject3).a();
        }
      }
    }
  }
}
