package com.google.android.gms.internal;

import android.content.ComponentName;
import android.content.Context;
import android.content.Intent;
import android.content.ServiceConnection;
import android.os.Bundle;
import android.os.Handler;
import android.os.IBinder;
import android.os.SystemClock;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Set;

public final class fv
  extends lh
  implements ServiceConnection
{
  private final Object a = new Object();
  private boolean b = false;
  private Context c;
  private gx d;
  private fu e;
  private gc f;
  private List<ga> g = null;
  private gf h;
  
  public fv(Context paramContext, gx paramGx, gf paramGf)
  {
    this.c = paramContext;
    this.d = paramGx;
    this.h = paramGf;
    this.e = new fu(paramContext);
    this.f = gc.a(this.c);
    this.g = this.f.a();
  }
  
  private void a(long paramLong)
  {
    do
    {
      if (!b(paramLong)) {
        mi.e("Timeout waiting for pending transaction to be processed.");
      }
    } while (!this.b);
  }
  
  private boolean b(long paramLong)
  {
    paramLong = 60000L - (SystemClock.elapsedRealtime() - paramLong);
    if (paramLong <= 0L) {
      return false;
    }
    try
    {
      this.a.wait(paramLong);
      return true;
    }
    catch (InterruptedException localInterruptedException)
    {
      for (;;)
      {
        mi.e("waitWithTimeout_lock interrupted");
      }
    }
  }
  
  public final void a()
  {
    synchronized (this.a)
    {
      Context localContext1 = this.c;
      Intent localIntent = new Intent("com.android.vending.billing.InAppBillingService.BIND");
      Context localContext2 = this.c;
      localContext1.bindService(localIntent, this, 1);
      a(SystemClock.elapsedRealtime());
      this.c.unbindService(this);
      this.e.a();
      return;
    }
  }
  
  public final void o_()
  {
    synchronized (this.a)
    {
      this.c.unbindService(this);
      this.e.a();
      return;
    }
  }
  
  public final void onServiceConnected(ComponentName paramComponentName, IBinder paramIBinder)
  {
    Object localObject2;
    synchronized (this.a)
    {
      this.e.a(paramIBinder);
      if (this.g.isEmpty()) {
        break label363;
      }
      paramIBinder = new HashMap();
      paramComponentName = this.g.iterator();
      if (paramComponentName.hasNext())
      {
        localObject2 = (ga)paramComponentName.next();
        paramIBinder.put(((ga)localObject2).c, localObject2);
      }
    }
    paramComponentName = null;
    paramComponentName = this.e.b(this.c.getPackageName(), paramComponentName);
    ArrayList localArrayList1;
    ArrayList localArrayList2;
    int i;
    if ((paramComponentName != null) && (ge.a(paramComponentName) == 0))
    {
      localObject2 = paramComponentName.getStringArrayList("INAPP_PURCHASE_ITEM_LIST");
      localArrayList1 = paramComponentName.getStringArrayList("INAPP_PURCHASE_DATA_LIST");
      localArrayList2 = paramComponentName.getStringArrayList("INAPP_DATA_SIGNATURE_LIST");
      paramComponentName = paramComponentName.getString("INAPP_CONTINUATION_TOKEN");
      i = 0;
    }
    for (;;)
    {
      if (i < ((ArrayList)localObject2).size())
      {
        if (paramIBinder.containsKey(((ArrayList)localObject2).get(i)))
        {
          String str1 = (String)((ArrayList)localObject2).get(i);
          String str2 = (String)localArrayList1.get(i);
          String str3 = (String)localArrayList2.get(i);
          ga localGa = (ga)paramIBinder.get(str1);
          Object localObject3 = ge.a(str2);
          if (localGa.b.equals(localObject3))
          {
            localObject3 = new Intent();
            ((Intent)localObject3).putExtra("RESPONSE_CODE", 0);
            ((Intent)localObject3).putExtra("INAPP_PURCHASE_DATA", str2);
            ((Intent)localObject3).putExtra("INAPP_DATA_SIGNATURE", str3);
            mg.a.post(new fw(this, localGa, (Intent)localObject3));
            paramIBinder.remove(str1);
          }
        }
      }
      else
      {
        if ((paramComponentName == null) || (paramIBinder.isEmpty()))
        {
          paramComponentName = paramIBinder.keySet().iterator();
          while (paramComponentName.hasNext())
          {
            localObject2 = (String)paramComponentName.next();
            this.f.a((ga)paramIBinder.get(localObject2));
          }
          label363:
          this.b = true;
          this.a.notify();
          return;
        }
        break;
      }
      i += 1;
    }
  }
  
  public final void onServiceDisconnected(ComponentName paramComponentName)
  {
    mi.c("In-app billing service disconnected.");
    this.e.a();
  }
}
