package com.google.android.gms.b;

import android.content.Context;
import android.os.Environment;
import android.text.TextUtils;
import com.google.android.gms.ads.internal.util.client.b;
import com.google.android.gms.ads.internal.w;
import java.io.File;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;
import java.util.concurrent.ArrayBlockingQueue;
import java.util.concurrent.BlockingQueue;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.atomic.AtomicBoolean;

public final class dl
{
  private BlockingQueue<dp> a;
  private ExecutorService b;
  private int c;
  private int d;
  private int e;
  private int f;
  private LinkedHashMap<String, String> g = new LinkedHashMap();
  private String h;
  private final Context i;
  private final String j;
  private AtomicBoolean k;
  private File l;
  
  public dl(Context paramContext, String paramString1, String paramString2, int paramInt1, int paramInt2, int paramInt3, int paramInt4, Map<String, String> paramMap, int paramInt5)
  {
    this.i = paramContext;
    this.j = paramString1;
    this.h = paramString2;
    this.d = paramInt1;
    this.e = paramInt2;
    this.f = paramInt3;
    paramInt1 = paramInt4;
    if (paramInt4 <= 0)
    {
      b.e("CsiReporter - too small batch size :" + paramInt4 + ", changed to 1");
      paramInt1 = 1;
    }
    paramInt2 = paramInt1;
    if (paramInt1 > this.d)
    {
      b.e("CsiReporter - batch size :" + paramInt1 + " bigger than buffer size, change to buffer limit");
      paramInt2 = this.d;
    }
    this.c = paramInt2;
    this.k = new AtomicBoolean(false);
    paramContext = this.k;
    paramString1 = dh.z;
    paramContext.set(((Boolean)w.n().a(paramString1)).booleanValue());
    if (this.k.get())
    {
      paramContext = Environment.getExternalStorageDirectory();
      if (paramContext != null) {
        this.l = new File(paramContext, "sdk_csi_data.txt");
      }
    }
    paramContext = paramMap.entrySet().iterator();
    while (paramContext.hasNext())
    {
      paramString1 = (Map.Entry)paramContext.next();
      a((String)paramString1.getKey(), (String)paramString1.getValue());
    }
    if (paramInt5 == 1) {
      a(dh.a());
    }
    if (paramInt5 == 2) {
      a(dh.b(this.i));
    }
    this.a = new ArrayBlockingQueue(this.d);
    this.b = Executors.newSingleThreadExecutor();
    this.b.execute(new dm(this));
  }
  
  private void a(String paramString1, String paramString2)
  {
    this.g.put(paramString1, paramString2);
  }
  
  private void a(List<String> paramList)
  {
    if ((paramList != null) && (!paramList.isEmpty())) {
      a("eid", TextUtils.join(",", paramList));
    }
  }
  
  /* Error */
  private boolean a(Map<String, String> paramMap)
  {
    // Byte code:
    //   0: iconst_0
    //   1: istore_2
    //   2: iconst_0
    //   3: istore_3
    //   4: iload_3
    //   5: ifne +312 -> 317
    //   8: iload_2
    //   9: aload_0
    //   10: getfield 46	com/google/android/gms/b/dl:e	I
    //   13: if_icmpge +304 -> 317
    //   16: aload_0
    //   17: getfield 48	com/google/android/gms/b/dl:f	I
    //   20: i2l
    //   21: invokestatic 261	java/lang/Thread:sleep	(J)V
    //   24: aload_0
    //   25: getfield 42	com/google/android/gms/b/dl:h	Ljava/lang/String;
    //   28: invokestatic 267	android/net/Uri:parse	(Ljava/lang/String;)Landroid/net/Uri;
    //   31: invokevirtual 271	android/net/Uri:buildUpon	()Landroid/net/Uri$Builder;
    //   34: astore 4
    //   36: aload_1
    //   37: invokeinterface 135 1 0
    //   42: invokeinterface 141 1 0
    //   47: astore 5
    //   49: aload 5
    //   51: invokeinterface 146 1 0
    //   56: ifeq +67 -> 123
    //   59: aload 5
    //   61: invokeinterface 150 1 0
    //   66: checkcast 152	java/util/Map$Entry
    //   69: astore 6
    //   71: aload 4
    //   73: aload 6
    //   75: invokeinterface 155 1 0
    //   80: checkcast 157	java/lang/String
    //   83: aload 6
    //   85: invokeinterface 160 1 0
    //   90: checkcast 157	java/lang/String
    //   93: invokevirtual 277	android/net/Uri$Builder:appendQueryParameter	(Ljava/lang/String;Ljava/lang/String;)Landroid/net/Uri$Builder;
    //   96: pop
    //   97: goto -48 -> 49
    //   100: astore 4
    //   102: ldc_w 279
    //   105: aload 4
    //   107: invokestatic 222	com/google/android/gms/ads/internal/util/client/b:c	(Ljava/lang/String;Ljava/lang/Throwable;)V
    //   110: invokestatic 283	java/lang/Thread:currentThread	()Ljava/lang/Thread;
    //   113: invokevirtual 286	java/lang/Thread:interrupt	()V
    //   116: iload_2
    //   117: iconst_1
    //   118: iadd
    //   119: istore_2
    //   120: goto -116 -> 4
    //   123: aload 4
    //   125: invokevirtual 290	android/net/Uri$Builder:build	()Landroid/net/Uri;
    //   128: invokevirtual 291	android/net/Uri:toString	()Ljava/lang/String;
    //   131: astore 6
    //   133: aload_0
    //   134: getfield 85	com/google/android/gms/b/dl:k	Ljava/util/concurrent/atomic/AtomicBoolean;
    //   137: invokevirtual 114	java/util/concurrent/atomic/AtomicBoolean:get	()Z
    //   140: ifeq +157 -> 297
    //   143: aload_0
    //   144: getfield 129	com/google/android/gms/b/dl:l	Ljava/io/File;
    //   147: astore 4
    //   149: aload 4
    //   151: ifnull +137 -> 288
    //   154: new 293	java/io/FileOutputStream
    //   157: dup
    //   158: aload 4
    //   160: iconst_1
    //   161: invokespecial 296	java/io/FileOutputStream:<init>	(Ljava/io/File;Z)V
    //   164: astore 5
    //   166: aload 5
    //   168: astore 4
    //   170: aload 5
    //   172: aload 6
    //   174: invokevirtual 300	java/lang/String:getBytes	()[B
    //   177: invokevirtual 304	java/io/FileOutputStream:write	([B)V
    //   180: aload 5
    //   182: astore 4
    //   184: aload 5
    //   186: bipush 10
    //   188: invokevirtual 306	java/io/FileOutputStream:write	(I)V
    //   191: aload 5
    //   193: invokevirtual 309	java/io/FileOutputStream:close	()V
    //   196: iconst_1
    //   197: istore_3
    //   198: goto -82 -> 116
    //   201: astore 4
    //   203: ldc_w 311
    //   206: aload 4
    //   208: invokestatic 222	com/google/android/gms/ads/internal/util/client/b:c	(Ljava/lang/String;Ljava/lang/Throwable;)V
    //   211: goto -15 -> 196
    //   214: astore 6
    //   216: aconst_null
    //   217: astore 5
    //   219: aload 5
    //   221: astore 4
    //   223: ldc_w 313
    //   226: aload 6
    //   228: invokestatic 222	com/google/android/gms/ads/internal/util/client/b:c	(Ljava/lang/String;Ljava/lang/Throwable;)V
    //   231: aload 5
    //   233: ifnull -37 -> 196
    //   236: aload 5
    //   238: invokevirtual 309	java/io/FileOutputStream:close	()V
    //   241: goto -45 -> 196
    //   244: astore 4
    //   246: ldc_w 311
    //   249: aload 4
    //   251: invokestatic 222	com/google/android/gms/ads/internal/util/client/b:c	(Ljava/lang/String;Ljava/lang/Throwable;)V
    //   254: goto -58 -> 196
    //   257: astore 5
    //   259: aconst_null
    //   260: astore 4
    //   262: aload 4
    //   264: ifnull +8 -> 272
    //   267: aload 4
    //   269: invokevirtual 309	java/io/FileOutputStream:close	()V
    //   272: aload 5
    //   274: athrow
    //   275: astore 4
    //   277: ldc_w 311
    //   280: aload 4
    //   282: invokestatic 222	com/google/android/gms/ads/internal/util/client/b:c	(Ljava/lang/String;Ljava/lang/Throwable;)V
    //   285: goto -13 -> 272
    //   288: ldc_w 315
    //   291: invokestatic 72	com/google/android/gms/ads/internal/util/client/b:e	(Ljava/lang/String;)V
    //   294: goto -98 -> 196
    //   297: invokestatic 318	com/google/android/gms/ads/internal/w:e	()Lcom/google/android/gms/b/nj;
    //   300: pop
    //   301: aload_0
    //   302: getfield 38	com/google/android/gms/b/dl:i	Landroid/content/Context;
    //   305: aload_0
    //   306: getfield 40	com/google/android/gms/b/dl:j	Ljava/lang/String;
    //   309: aload 6
    //   311: invokestatic 323	com/google/android/gms/b/nj:a	(Landroid/content/Context;Ljava/lang/String;Ljava/lang/String;)V
    //   314: goto -118 -> 196
    //   317: iload_3
    //   318: ireturn
    //   319: astore 5
    //   321: goto -59 -> 262
    //   324: astore 6
    //   326: goto -107 -> 219
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	329	0	this	dl
    //   0	329	1	paramMap	Map<String, String>
    //   1	119	2	m	int
    //   3	315	3	bool	boolean
    //   34	38	4	localBuilder	android.net.Uri.Builder
    //   100	24	4	localInterruptedException	InterruptedException
    //   147	36	4	localObject1	Object
    //   201	6	4	localIOException1	java.io.IOException
    //   221	1	4	localObject2	Object
    //   244	6	4	localIOException2	java.io.IOException
    //   260	8	4	localObject3	Object
    //   275	6	4	localIOException3	java.io.IOException
    //   47	190	5	localObject4	Object
    //   257	16	5	localObject5	Object
    //   319	1	5	localObject6	Object
    //   69	104	6	localObject7	Object
    //   214	96	6	localIOException4	java.io.IOException
    //   324	1	6	localIOException5	java.io.IOException
    // Exception table:
    //   from	to	target	type
    //   16	49	100	java/lang/InterruptedException
    //   49	97	100	java/lang/InterruptedException
    //   123	149	100	java/lang/InterruptedException
    //   191	196	100	java/lang/InterruptedException
    //   203	211	100	java/lang/InterruptedException
    //   236	241	100	java/lang/InterruptedException
    //   246	254	100	java/lang/InterruptedException
    //   267	272	100	java/lang/InterruptedException
    //   272	275	100	java/lang/InterruptedException
    //   277	285	100	java/lang/InterruptedException
    //   288	294	100	java/lang/InterruptedException
    //   297	314	100	java/lang/InterruptedException
    //   191	196	201	java/io/IOException
    //   154	166	214	java/io/IOException
    //   236	241	244	java/io/IOException
    //   154	166	257	finally
    //   267	272	275	java/io/IOException
    //   170	180	319	finally
    //   184	191	319	finally
    //   223	231	319	finally
    //   170	180	324	java/io/IOException
    //   184	191	324	java/io/IOException
  }
  
  private Map<String, Map<String, String>> b(List<dp> paramList)
  {
    Object localObject1 = new LinkedHashMap();
    paramList = paramList.iterator();
    Object localObject2;
    Object localObject3;
    Object localObject4;
    while (paramList.hasNext())
    {
      localObject2 = (dp)paramList.next();
      localObject3 = ((dp)localObject2).a;
      if (((Map)localObject1).containsKey(localObject3))
      {
        ((List)((Map)localObject1).get(localObject3)).add(localObject2);
      }
      else
      {
        localObject4 = new ArrayList();
        ((List)localObject4).add(localObject2);
        ((Map)localObject1).put(localObject3, localObject4);
      }
    }
    paramList = new LinkedHashMap();
    localObject1 = ((Map)localObject1).entrySet().iterator();
    while (((Iterator)localObject1).hasNext())
    {
      localObject3 = (Map.Entry)((Iterator)localObject1).next();
      localObject2 = (List)((Map.Entry)localObject3).getValue();
      localObject4 = new LinkedHashMap(this.g);
      try
      {
        Map localMap = dp.a((dp[])((List)localObject2).toArray(new dp[((List)localObject2).size()]));
        ((Map)localObject4).putAll(localMap);
        paramList.put(((Map.Entry)localObject3).getKey(), localObject4);
      }
      catch (IllegalArgumentException localIllegalArgumentException)
      {
        b.c("CsiReporter:failed to merge tickers:" + localObject2, localIllegalArgumentException);
      }
    }
    return paramList;
  }
  
  public final boolean a(dp paramDp)
  {
    return this.a.offer(paramDp);
  }
}
