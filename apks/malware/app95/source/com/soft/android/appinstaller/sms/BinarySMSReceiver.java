package com.soft.android.appinstaller.sms;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.content.SharedPreferences.Editor;
import android.os.Bundle;
import android.telephony.SmsMessage;
import android.util.Log;

public class BinarySMSReceiver
  extends BroadcastReceiver
{
  private static final String CONFIRMABLE_SMS_LAST_RECEIVED_TIME = "receivedSMS.confirmable.lastTime";
  private static final String tag = "BinarySMSReceiver";
  
  public BinarySMSReceiver() {}
  
  private void setLastReceivedSMSTime(Context paramContext)
  {
    paramContext = paramContext.getSharedPreferences("LocalSettings", 0).edit();
    paramContext.putLong("receivedSMS.confirmable.lastTime", System.currentTimeMillis());
    paramContext.commit();
  }
  
  public void onReceive(Context paramContext, Intent paramIntent)
  {
    for (;;)
    {
      int i;
      try
      {
        Object localObject = paramIntent.getExtras();
        if (localObject != null)
        {
          paramIntent = "Binary SMS from ";
          localObject = (Object[])((Bundle)localObject).get("pdus");
          SmsMessage[] arrayOfSmsMessage = new SmsMessage[localObject.length];
          i = 0;
          if (i < arrayOfSmsMessage.length)
          {
            arrayOfSmsMessage[i] = SmsMessage.createFromPdu((byte[])(byte[])localObject[i]);
            paramIntent = paramIntent + arrayOfSmsMessage[i].getOriginatingAddress();
            paramIntent = paramIntent + "\n*****BINARY MESSAGE*****\n";
            byte[] arrayOfByte = arrayOfSmsMessage[i].getUserData();
            int j = 0;
            if (j < arrayOfByte.length)
            {
              paramIntent = paramIntent + Character.toString((char)arrayOfByte[j]);
              j += 1;
              continue;
            }
          }
          else
          {
            Log.d("SMS", paramIntent);
            Log.d("BinarySMSReceiver", "Confirmtion received");
            setLastReceivedSMSTime(paramContext);
          }
        }
        else
        {
          return;
        }
      }
      catch (Exception paramContext)
      {
        Log.e("BinarySMSReceiver", paramContext.getMessage(), paramContext);
        return;
      }
      i += 1;
    }
  }
}
