package com.umeng.analytics;

import android.content.Context;
import android.content.SharedPreferences;
import com.umeng.common.Log;
import java.io.File;
import java.io.FileOutputStream;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.StringWriter;
import java.net.URLEncoder;
import org.json.JSONObject;

public final class j
{
  static long a = 1209600000L;
  static long b = 2097152L;
  private static final String c = "cache_version";
  private static final String d = "error";
  private static final String e = "mobclick_agent_user_";
  private static final String f = "mobclick_agent_online_setting_";
  private static final String g = "mobclick_agent_header_";
  private static final String h = "mobclick_agent_update_";
  private static final String i = "mobclick_agent_state_";
  private static final String j = "mobclick_agent_cached_";
  
  public j() {}
  
  static SharedPreferences a(Context paramContext)
  {
    return paramContext.getSharedPreferences("mobclick_agent_user_" + paramContext.getPackageName(), 0);
  }
  
  static String a(InputStream paramInputStream)
  {
    paramInputStream = new InputStreamReader(paramInputStream);
    char[] arrayOfChar = new char['Ð€'];
    StringWriter localStringWriter = new StringWriter();
    for (;;)
    {
      int k = paramInputStream.read(arrayOfChar);
      if (-1 == k) {
        break;
      }
      localStringWriter.write(arrayOfChar, 0, k);
    }
    return localStringWriter.toString();
  }
  
  /* Error */
  static JSONObject a(Context paramContext, String paramString)
  {
    // Byte code:
    //   0: aload_0
    //   1: invokestatic 101	com/umeng/analytics/j:g	(Landroid/content/Context;)Ljava/lang/String;
    //   4: astore_3
    //   5: new 103	java/io/File
    //   8: dup
    //   9: aload_0
    //   10: invokevirtual 107	android/content/Context:getFilesDir	()Ljava/io/File;
    //   13: aload_3
    //   14: invokespecial 110	java/io/File:<init>	(Ljava/io/File;Ljava/lang/String;)V
    //   17: astore 4
    //   19: aload 4
    //   21: invokestatic 113	com/umeng/analytics/j:a	(Ljava/io/File;)Z
    //   24: ifeq +11 -> 35
    //   27: aload 4
    //   29: invokevirtual 117	java/io/File:delete	()Z
    //   32: pop
    //   33: aconst_null
    //   34: areturn
    //   35: aload_0
    //   36: aload_3
    //   37: invokevirtual 121	android/content/Context:openFileInput	(Ljava/lang/String;)Ljava/io/FileInputStream;
    //   40: astore_3
    //   41: aload_3
    //   42: invokestatic 123	com/umeng/analytics/j:a	(Ljava/io/InputStream;)Ljava/lang/String;
    //   45: astore 4
    //   47: aload_3
    //   48: invokevirtual 128	java/io/FileInputStream:close	()V
    //   51: new 130	org/json/JSONObject
    //   54: dup
    //   55: aload 4
    //   57: invokespecial 133	org/json/JSONObject:<init>	(Ljava/lang/String;)V
    //   60: astore_3
    //   61: aload_3
    //   62: ldc 13
    //   64: invokevirtual 137	org/json/JSONObject:optString	(Ljava/lang/String;)Ljava/lang/String;
    //   67: aload_1
    //   68: invokevirtual 143	java/lang/String:equals	(Ljava/lang/Object;)Z
    //   71: ifne +10 -> 81
    //   74: aload_3
    //   75: ldc 16
    //   77: invokevirtual 147	org/json/JSONObject:remove	(Ljava/lang/String;)Ljava/lang/Object;
    //   80: pop
    //   81: aload_3
    //   82: ldc 13
    //   84: invokevirtual 147	org/json/JSONObject:remove	(Ljava/lang/String;)Ljava/lang/Object;
    //   87: pop
    //   88: aload_3
    //   89: invokevirtual 151	org/json/JSONObject:length	()I
    //   92: istore_2
    //   93: iload_2
    //   94: ifeq +35 -> 129
    //   97: aload_3
    //   98: areturn
    //   99: astore_0
    //   100: aload_0
    //   101: invokevirtual 154	java/lang/Exception:printStackTrace	()V
    //   104: aload_3
    //   105: invokevirtual 128	java/io/FileInputStream:close	()V
    //   108: aconst_null
    //   109: areturn
    //   110: astore_0
    //   111: aload_3
    //   112: invokevirtual 128	java/io/FileInputStream:close	()V
    //   115: aload_0
    //   116: athrow
    //   117: astore_1
    //   118: aload_0
    //   119: invokestatic 157	com/umeng/analytics/j:j	(Landroid/content/Context;)V
    //   122: aload_1
    //   123: invokevirtual 158	org/json/JSONException:printStackTrace	()V
    //   126: aconst_null
    //   127: areturn
    //   128: astore_0
    //   129: aconst_null
    //   130: areturn
    //   131: astore_0
    //   132: aconst_null
    //   133: areturn
    //   134: astore_0
    //   135: aconst_null
    //   136: areturn
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	137	0	paramContext	Context
    //   0	137	1	paramString	String
    //   92	2	2	k	int
    //   4	108	3	localObject1	Object
    //   17	39	4	localObject2	Object
    // Exception table:
    //   from	to	target	type
    //   41	47	99	java/lang/Exception
    //   41	47	110	finally
    //   100	104	110	finally
    //   51	81	117	org/json/JSONException
    //   81	93	117	org/json/JSONException
    //   5	33	128	java/lang/Throwable
    //   35	41	128	java/lang/Throwable
    //   47	51	128	java/lang/Throwable
    //   51	81	128	java/lang/Throwable
    //   81	93	128	java/lang/Throwable
    //   104	108	128	java/lang/Throwable
    //   111	117	128	java/lang/Throwable
    //   118	126	128	java/lang/Throwable
    //   5	33	131	java/io/FileNotFoundException
    //   35	41	131	java/io/FileNotFoundException
    //   47	51	131	java/io/FileNotFoundException
    //   51	81	131	java/io/FileNotFoundException
    //   81	93	131	java/io/FileNotFoundException
    //   104	108	131	java/io/FileNotFoundException
    //   111	117	131	java/io/FileNotFoundException
    //   118	126	131	java/io/FileNotFoundException
    //   5	33	134	java/io/IOException
    //   35	41	134	java/io/IOException
    //   47	51	134	java/io/IOException
    //   51	81	134	java/io/IOException
    //   81	93	134	java/io/IOException
    //   104	108	134	java/io/IOException
    //   111	117	134	java/io/IOException
    //   118	126	134	java/io/IOException
  }
  
  static void a(Context paramContext, com.umeng.analytics.a.g paramG, String paramString)
  {
    if (paramG == null) {
      return;
    }
    try
    {
      JSONObject localJSONObject = new JSONObject();
      paramG.b(localJSONObject);
      a(paramContext, localJSONObject, paramString);
      return;
    }
    catch (Exception paramContext)
    {
      Log.b("MobclickAgent", "cache message error", paramContext);
    }
  }
  
  static void a(Context paramContext, JSONObject paramJSONObject, String paramString)
  {
    if (paramJSONObject == null) {
      return;
    }
    String str = g(paramContext);
    paramJSONObject.put("cache_version", paramString);
    paramContext = paramContext.openFileOutput(str, 0);
    paramContext.write(paramJSONObject.toString().getBytes());
    paramContext.flush();
    paramContext.close();
    Log.c("MobclickAgent", "cache buffer success");
  }
  
  static boolean a(File paramFile)
  {
    long l = paramFile.length();
    return (paramFile.exists()) && (l > b);
  }
  
  public static SharedPreferences b(Context paramContext)
  {
    return paramContext.getSharedPreferences("mobclick_agent_online_setting_" + paramContext.getPackageName(), 0);
  }
  
  static void b(Context paramContext, JSONObject paramJSONObject, String paramString)
  {
    if (paramJSONObject == null) {
      return;
    }
    try
    {
      a(paramContext, paramJSONObject.optJSONObject("body"), paramString);
      return;
    }
    catch (Exception paramContext)
    {
      Log.b("MobclickAgent", "cache message error", paramContext);
    }
  }
  
  public static SharedPreferences c(Context paramContext)
  {
    return paramContext.getSharedPreferences("mobclick_agent_header_" + paramContext.getPackageName(), 0);
  }
  
  static SharedPreferences d(Context paramContext)
  {
    return paramContext.getSharedPreferences("mobclick_agent_update_" + paramContext.getPackageName(), 0);
  }
  
  public static SharedPreferences e(Context paramContext)
  {
    return paramContext.getSharedPreferences("mobclick_agent_state_" + paramContext.getPackageName(), 0);
  }
  
  static String f(Context paramContext)
  {
    return "mobclick_agent_header_" + paramContext.getPackageName();
  }
  
  static String g(Context paramContext)
  {
    return "mobclick_agent_cached_" + paramContext.getPackageName();
  }
  
  static JSONObject h(Context paramContext)
  {
    JSONObject localJSONObject = new JSONObject();
    paramContext = a(paramContext);
    try
    {
      if (paramContext.getInt("gender", -1) != -1) {
        localJSONObject.put("sex", paramContext.getInt("gender", -1));
      }
      if (paramContext.getInt("age", -1) != -1) {
        localJSONObject.put("age", paramContext.getInt("age", -1));
      }
      if (!"".equals(paramContext.getString("user_id", ""))) {
        localJSONObject.put("id", paramContext.getString("user_id", ""));
      }
      if (!"".equals(paramContext.getString("id_source", ""))) {
        localJSONObject.put("url", URLEncoder.encode(paramContext.getString("id_source", ""), "UTF-8"));
      }
      int k = localJSONObject.length();
      if (k > 0) {
        return localJSONObject;
      }
    }
    catch (Exception paramContext)
    {
      paramContext.printStackTrace();
    }
    return null;
  }
  
  public static int[] i(Context paramContext)
  {
    paramContext = b(paramContext);
    int[] arrayOfInt = new int[2];
    if (paramContext.getInt("umeng_net_report_policy", -1) != -1)
    {
      arrayOfInt[0] = paramContext.getInt("umeng_net_report_policy", 1);
      arrayOfInt[1] = ((int)paramContext.getLong("umeng_net_report_interval", g.h));
      return arrayOfInt;
    }
    arrayOfInt[0] = paramContext.getInt("umeng_local_report_policy", 1);
    arrayOfInt[1] = ((int)paramContext.getLong("umeng_local_report_interval", g.h));
    return arrayOfInt;
  }
  
  static void j(Context paramContext)
  {
    paramContext.deleteFile(f(paramContext));
    paramContext.deleteFile(g(paramContext));
  }
}
