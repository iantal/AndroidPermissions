package com.umpay.huafubao.ui;

import android.app.Activity;
import android.app.Dialog;
import android.content.DialogInterface.OnCancelListener;
import android.content.DialogInterface.OnClickListener;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.res.Resources;
import android.graphics.Color;
import android.graphics.drawable.Drawable;
import android.os.Build.VERSION;
import android.os.Bundle;
import android.os.StrictMode;
import android.os.StrictMode.ThreadPolicy.Builder;
import android.text.TextUtils;
import android.view.KeyEvent;
import android.view.View.OnClickListener;
import android.view.Window;
import android.widget.Button;
import android.widget.EditText;
import android.widget.LinearLayout;
import android.widget.TextView;
import com.umpay.huafubao.HuafubaoListener;
import com.umpay.huafubao.PayType;
import com.umpay.huafubao.e.f;
import com.umpay.huafubao.receivers.SMSStatusReceiver;
import com.umpay.huafubao.view.CountDownButton;

public class BillingActivity
  extends Activity
{
  private static HuafubaoListener J;
  private EditText A;
  private EditText B;
  private CountDownButton C;
  private Button D;
  private Button E;
  private Button F;
  private LinearLayout G;
  private LinearLayout H;
  private String I;
  private View.OnClickListener K = new h(this);
  private DialogInterface.OnClickListener L = new i(this);
  private DialogInterface.OnCancelListener M = new j(this);
  private DialogInterface.OnClickListener N = new k(this);
  com.umpay.huafubao.receivers.a a = new g(this);
  private int b = u.a;
  private Activity c = this;
  private Dialog d = null;
  private com.umpay.huafubao.e.b e = null;
  private com.umpay.huafubao.e.a f = null;
  private com.umpay.huafubao.e.c g = null;
  private boolean h = true;
  private boolean i = true;
  private boolean j = false;
  private boolean k = false;
  private boolean l = false;
  private String m = "1";
  private int n = 0;
  private SMSStatusReceiver o;
  private IntentFilter p;
  private IntentFilter q;
  private TextView r;
  private TextView s;
  private TextView t;
  private TextView u;
  private TextView v;
  private TextView w;
  private TextView x;
  private TextView y;
  private TextView z;
  
  public BillingActivity() {}
  
  private void a()
  {
    Object localObject;
    TextView localTextView;
    if (!TextUtils.isEmpty(this.f.d))
    {
      if (!this.l) {
        com.umpay.huafubao.d.a.e(this, this.e.a);
      }
      com.umpay.huafubao.d.a.a(this, f.c, this.e.a);
      this.s.setText(this.f.d);
      localObject = String.format("%s(不含通信费)", new Object[] { this.f.a() });
      this.t.setText(com.umpay.huafubao.d.a.b((String)localObject, this.f.a()));
      this.u.setText("4006125880");
      this.A.setHint("限中国移动手机号");
      localTextView = this.v;
      localObject = this.e;
      if (!TextUtils.isEmpty(((com.umpay.huafubao.e.b)localObject).m)) {
        break label184;
      }
      localObject = "";
    }
    for (;;)
    {
      com.umpay.huafubao.d.a.a(localTextView, (String)localObject);
      this.w.setText(com.umpay.huafubao.d.a.b("点击“确认支付”即同意向10658008发送短信以完成支付；费用由本机话费扣除。", "确认支付"));
      this.x.setText("* 10658008是中国移动通信账户支付专用短信特服号码");
      return;
      this.f.e = this.e.e;
      break;
      label184:
      if (((com.umpay.huafubao.e.b)localObject).m.length() >= 60) {
        localObject = ((com.umpay.huafubao.e.b)localObject).m.substring(0, 60);
      } else {
        localObject = ((com.umpay.huafubao.e.b)localObject).m;
      }
    }
  }
  
  private void a(int paramInt)
  {
    com.umpay.huafubao.d.a.a(this.d);
    this.b = paramInt;
    switch (m.a[(paramInt - 1)])
    {
    default: 
      return;
    case 1: 
      b(com.umpay.huafubao.d.a.d(this, "hfb_billingcode"));
      this.G.setVisibility(8);
      this.H.setVisibility(8);
      this.D.setOnClickListener(new a(this));
      a();
      return;
    case 2: 
      b(com.umpay.huafubao.d.a.d(this, "hfb_success"));
      if (this.k)
      {
        this.r.setTextColor(Color.parseColor("#7ea512"));
        this.E.setOnClickListener(this.K);
        this.F.setVisibility(8);
        if (!this.k) {
          break label299;
        }
        localObject = "hfb_succ";
        Drawable localDrawable = this.c.getResources().getDrawable(com.umpay.huafubao.d.a.b(this.c, (String)localObject));
        if (!this.k) {
          break label306;
        }
        localObject = "支付成功";
        this.r.setText((CharSequence)localObject);
        localDrawable.setBounds(0, 0, localDrawable.getMinimumWidth(), localDrawable.getMinimumHeight());
        this.r.setCompoundDrawables(localDrawable, null, null, null);
        if (!this.k) {
          break label313;
        }
      }
      for (localObject = String.format("感谢您使用通信账户支付服务。\n购买【%s】费用为【%s元】\n支付服务客服：4006125880", new Object[] { com.umpay.huafubao.d.a.b(this.f.d), com.umpay.huafubao.d.a.c(this.f.e) });; localObject = "具体原因请注意查收10658008下发的通知短信。\n支付服务客服：4006125880")
      {
        this.y.setText((CharSequence)localObject);
        return;
        this.r.setTextColor(Color.parseColor("#f94110"));
        break;
        localObject = "hfb_fail";
        break label167;
        localObject = "支付失败";
        break label197;
      }
    case 3: 
      b(com.umpay.huafubao.d.a.d(this, "hfb_success"));
      this.r.setTextColor(Color.parseColor("#f94110"));
      this.m = "2";
      this.F.setVisibility(0);
      this.E.setOnClickListener(this.K);
      this.F.setOnClickListener(new l(this));
      localObject = this.c.getResources().getDrawable(com.umpay.huafubao.d.a.b(this.c, "hfb_query"));
      this.r.setText("未查询到支付结果");
      ((Drawable)localObject).setBounds(0, 0, ((Drawable)localObject).getMinimumWidth(), ((Drawable)localObject).getMinimumHeight());
      this.r.setCompoundDrawables((Drawable)localObject, null, null, null);
      this.y.setText("可能原因：\n1、系统繁忙，支付请求处理中2、网络不通畅，未获取到支付信息\n\n您可以点击“再查一次”重新查询，也可以点击“返回应用”到商户客户端查询购买结果。");
      return;
    case 4: 
      b(com.umpay.huafubao.d.a.d(this, "hfb_billingcode"));
      this.G.setVisibility(0);
      this.H.setVisibility(0);
      a();
      this.C.setOnCountDownListener(new com.umpay.huafubao.view.d("获取验证码"));
      this.C.setOnClickListener(new n(this));
      this.D.setOnClickListener(new o(this));
      return;
    case 5: 
      label167:
      label197:
      label299:
      label306:
      label313:
      b(com.umpay.huafubao.d.a.d(this, "hfb_billingcode"));
      this.G.setVisibility(0);
      this.H.setVisibility(8);
      a();
      this.D.setOnClickListener(new p(this));
      return;
    }
    setContentView(com.umpay.huafubao.d.a.d(this, "hfb_padquery"));
    this.z = ((TextView)findViewById(com.umpay.huafubao.d.a.c(this, "tv_result")));
    Object localObject = String.format("请查收%s下发的短信", new Object[] { this.I });
    this.z.setText(com.umpay.huafubao.d.a.b((String)localObject, this.I));
    localObject = (CountDownButton)findViewById(com.umpay.huafubao.d.a.c(this, "btn_sms"));
    ((CountDownButton)localObject).setOnCountDownListener(new com.umpay.huafubao.view.d("重新接收"));
    ((CountDownButton)localObject).setOnClickListener(new q(this));
    ((Button)findViewById(com.umpay.huafubao.d.a.c(this, "btn_query"))).setOnClickListener(new r(this));
  }
  
  public static void a(HuafubaoListener paramHuafubaoListener)
  {
    J = paramHuafubaoListener;
  }
  
  private void b()
  {
    com.umpay.huafubao.c.d.a(this.c);
    Bundle localBundle = new Bundle();
    localBundle.putBoolean("succ", this.k);
    localBundle.putString("orderId", this.e.c);
    J.onResult(this.m, this.e.c);
    this.c.setResult(5556, this.c.getIntent().putExtras(localBundle));
    this.c.finish();
  }
  
  private void b(int paramInt)
  {
    setContentView(paramInt);
    this.r = ((TextView)findViewById(com.umpay.huafubao.d.a.c(this, "tv_title")));
    this.s = ((TextView)findViewById(com.umpay.huafubao.d.a.c(this, "tv_goodsName")));
    this.t = ((TextView)findViewById(com.umpay.huafubao.d.a.c(this, "tv_amount")));
    this.u = ((TextView)findViewById(com.umpay.huafubao.d.a.c(this, "tv_cusphone")));
    this.v = ((TextView)findViewById(com.umpay.huafubao.d.a.c(this, "tv_goodsInfo")));
    this.w = ((TextView)findViewById(com.umpay.huafubao.d.a.c(this, "tv_smsInfo")));
    this.x = ((TextView)findViewById(com.umpay.huafubao.d.a.c(this, "tv_smsInfo2")));
    this.A = ((EditText)findViewById(com.umpay.huafubao.d.a.c(this, "et_phone")));
    this.B = ((EditText)findViewById(com.umpay.huafubao.d.a.c(this, "et_code")));
    this.C = ((CountDownButton)findViewById(com.umpay.huafubao.d.a.c(this, "btn_code")));
    this.D = ((Button)findViewById(com.umpay.huafubao.d.a.c(this, "btn_pay")));
    this.G = ((LinearLayout)findViewById(com.umpay.huafubao.d.a.c(this, "ll_phone")));
    this.H = ((LinearLayout)findViewById(com.umpay.huafubao.d.a.c(this, "ll_code")));
    this.y = ((TextView)findViewById(com.umpay.huafubao.d.a.c(this, "tv_info")));
    this.E = ((Button)findViewById(com.umpay.huafubao.d.a.c(this, "btn_return")));
    this.F = ((Button)findViewById(com.umpay.huafubao.d.a.c(this, "btn_query")));
  }
  
  protected void onCreate(Bundle paramBundle)
  {
    super.onCreate(paramBundle);
    requestWindowFeature(1);
    getWindow().setSoftInputMode(18);
    setContentView(com.umpay.huafubao.d.a.d(this, "hfb_billingcode"));
    if (Build.VERSION.SDK_INT > 9) {
      StrictMode.setThreadPolicy(new StrictMode.ThreadPolicy.Builder().permitAll().build());
    }
    this.p = new IntentFilter(com.umpay.huafubao.d.a.a);
    this.q = new IntentFilter(com.umpay.huafubao.d.a.b);
    com.umpay.huafubao.d.e.a(this);
    if (this.o == null)
    {
      this.o = new SMSStatusReceiver();
      this.o.a = this.a;
    }
    registerReceiver(this.o, this.p);
    registerReceiver(this.o, this.q);
    this.f = new com.umpay.huafubao.e.a();
    this.g = new com.umpay.huafubao.e.c();
    this.e = new com.umpay.huafubao.e.b(this);
    paramBundle = getIntent().getExtras();
    Object localObject = this.e;
    ((com.umpay.huafubao.e.b)localObject).a = paramBundle.getString("merId");
    ((com.umpay.huafubao.e.b)localObject).b = paramBundle.getString("goodsId");
    ((com.umpay.huafubao.e.b)localObject).c = paramBundle.getString("orderId");
    ((com.umpay.huafubao.e.b)localObject).d = paramBundle.getString("merDate");
    ((com.umpay.huafubao.e.b)localObject).e = paramBundle.getString("amount");
    ((com.umpay.huafubao.e.b)localObject).f = paramBundle.getString("merPriv");
    ((com.umpay.huafubao.e.b)localObject).g = paramBundle.getString("expand");
    ((com.umpay.huafubao.e.b)localObject).k = paramBundle.getBoolean("isNetResult");
    ((com.umpay.huafubao.e.b)localObject).m = paramBundle.getString("goodsInf");
    ((com.umpay.huafubao.e.b)localObject).n = PayType.valueOf(paramBundle.getString("paytype"));
    localObject = ((com.umpay.huafubao.e.b)localObject).n;
    localObject = PayType.HFB;
    new StringBuilder("payType=").append(paramBundle.getString("paytype"));
    this.e.toString();
    if ((!com.umpay.huafubao.d.a.a(this)) && (this.e.n == PayType.HFB)) {
      this.e.n = PayType.CARDPAY;
    }
    a(u.a);
    com.umpay.huafubao.e.b localB = this.e;
    localObject = new com.umpay.huafubao.c.e(this, com.umpay.huafubao.c.g.b);
    ((com.umpay.huafubao.c.e)localObject).a("merId", localB.a);
    ((com.umpay.huafubao.c.e)localObject).a("goodsId", localB.b);
    ((com.umpay.huafubao.c.e)localObject).a("orderId", localB.c);
    ((com.umpay.huafubao.c.e)localObject).a("merDate", localB.d);
    ((com.umpay.huafubao.c.e)localObject).a("amount", localB.e);
    if (("".equals(localB.f)) || (localB.f == null))
    {
      paramBundle = "merPriv";
      ((com.umpay.huafubao.c.e)localObject).a("merPriv", paramBundle);
      if ((!"".equals(localB.g)) && (localB.g != null)) {
        break label567;
      }
    }
    label567:
    for (paramBundle = "expand";; paramBundle = localB.g)
    {
      ((com.umpay.huafubao.c.e)localObject).a("expand", paramBundle);
      paramBundle = new s(this, this);
      paramBundle.i = this.M;
      paramBundle.a("正在联网提交订单，请保持网络畅通…");
      paramBundle.a("确定", this.L);
      com.umpay.huafubao.c.d.a((com.umpay.huafubao.c.e)localObject, paramBundle);
      return;
      paramBundle = localB.f;
      break;
    }
  }
  
  protected void onDestroy()
  {
    this.i = false;
    if (this.o != null)
    {
      unregisterReceiver(this.o);
      this.o = null;
    }
    super.onDestroy();
  }
  
  public boolean onKeyDown(int paramInt, KeyEvent paramKeyEvent)
  {
    if (paramInt == 4)
    {
      if (this.b == u.b) {
        break label42;
      }
      com.umpay.huafubao.d.a.a(this.d);
      com.umpay.huafubao.d.c.a(this.c, "确定", "交易尚未完成，确定放弃交易？", this.L);
    }
    for (;;)
    {
      return false;
      label42:
      b();
    }
  }
  
  protected void onStart()
  {
    this.i = true;
    super.onStart();
  }
  
  protected void onStop()
  {
    this.i = false;
    super.onStop();
    com.umpay.huafubao.c.d.a(this.c);
  }
}
