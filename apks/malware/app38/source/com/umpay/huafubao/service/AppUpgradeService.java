package com.umpay.huafubao.service;

import android.app.Application;
import android.app.Notification;
import android.app.NotificationManager;
import android.app.PendingIntent;
import android.app.Service;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.net.Uri;
import android.os.Environment;
import android.os.Handler;
import android.os.IBinder;
import android.widget.RemoteViews;
import java.io.File;
import java.net.URLEncoder;

public class AppUpgradeService
  extends Service
{
  private String a = null;
  private NotificationManager b = null;
  private Notification c = null;
  private PendingIntent d = null;
  private File e = null;
  private File f = null;
  private Handler g = new a(this);
  private d h = new b(this);
  
  public AppUpgradeService() {}
  
  /* Error */
  public static long a(String paramString, File paramFile, d paramD)
  {
    // Byte code:
    //   0: aconst_null
    //   1: astore 11
    //   3: aload_1
    //   4: invokevirtual 55	java/io/File:exists	()Z
    //   7: ifeq +15 -> 22
    //   10: aload_1
    //   11: invokevirtual 58	java/io/File:isFile	()Z
    //   14: ifeq +8 -> 22
    //   17: aload_1
    //   18: invokevirtual 61	java/io/File:delete	()Z
    //   21: pop
    //   22: new 63	org/apache/http/client/methods/HttpGet
    //   25: dup
    //   26: aload_0
    //   27: invokespecial 66	org/apache/http/client/methods/HttpGet:<init>	(Ljava/lang/String;)V
    //   30: astore 10
    //   32: new 68	org/apache/http/params/BasicHttpParams
    //   35: dup
    //   36: invokespecial 69	org/apache/http/params/BasicHttpParams:<init>	()V
    //   39: astore 12
    //   41: aload 12
    //   43: sipush 10000
    //   46: invokestatic 75	org/apache/http/params/HttpConnectionParams:setConnectionTimeout	(Lorg/apache/http/params/HttpParams;I)V
    //   49: aload 12
    //   51: ldc 76
    //   53: invokestatic 79	org/apache/http/params/HttpConnectionParams:setSoTimeout	(Lorg/apache/http/params/HttpParams;I)V
    //   56: new 81	org/apache/http/impl/client/DefaultHttpClient
    //   59: dup
    //   60: aload 12
    //   62: invokespecial 84	org/apache/http/impl/client/DefaultHttpClient:<init>	(Lorg/apache/http/params/HttpParams;)V
    //   65: astore 12
    //   67: aload 12
    //   69: aload 10
    //   71: invokeinterface 90 2 0
    //   76: astore 12
    //   78: aload 12
    //   80: invokeinterface 96 1 0
    //   85: invokeinterface 102 1 0
    //   90: sipush 200
    //   93: if_icmpne +309 -> 402
    //   96: aload 12
    //   98: invokeinterface 106 1 0
    //   103: invokeinterface 112 1 0
    //   108: astore 10
    //   110: aload 12
    //   112: invokeinterface 106 1 0
    //   117: invokeinterface 116 1 0
    //   122: lstore 8
    //   124: aload 12
    //   126: ldc 118
    //   128: invokeinterface 122 2 0
    //   133: astore 12
    //   135: aload 12
    //   137: ifnull +262 -> 399
    //   140: aload 12
    //   142: invokeinterface 128 1 0
    //   147: ldc -126
    //   149: invokevirtual 136	java/lang/String:equalsIgnoreCase	(Ljava/lang/String;)Z
    //   152: ifeq +247 -> 399
    //   155: new 138	java/util/zip/GZIPInputStream
    //   158: dup
    //   159: aload 10
    //   161: invokespecial 141	java/util/zip/GZIPInputStream:<init>	(Ljava/io/InputStream;)V
    //   164: astore 12
    //   166: aload 12
    //   168: astore 10
    //   170: new 143	java/io/FileOutputStream
    //   173: dup
    //   174: aload_1
    //   175: iconst_0
    //   176: invokespecial 146	java/io/FileOutputStream:<init>	(Ljava/io/File;Z)V
    //   179: astore_1
    //   180: sipush 8192
    //   183: newarray byte
    //   185: astore 11
    //   187: ldc2_w 147
    //   190: lstore 4
    //   192: aload 10
    //   194: aload 11
    //   196: invokevirtual 154	java/io/InputStream:read	([B)I
    //   199: istore_3
    //   200: iload_3
    //   201: ifle +77 -> 278
    //   204: aload_1
    //   205: aload 11
    //   207: iconst_0
    //   208: iload_3
    //   209: invokevirtual 158	java/io/FileOutputStream:write	([BII)V
    //   212: aload_1
    //   213: invokevirtual 161	java/io/FileOutputStream:flush	()V
    //   216: lload 4
    //   218: iload_3
    //   219: i2l
    //   220: ladd
    //   221: lstore 6
    //   223: lload 6
    //   225: lstore 4
    //   227: aload_2
    //   228: ifnull -36 -> 192
    //   231: aload_2
    //   232: ldc2_w 162
    //   235: lload 6
    //   237: lmul
    //   238: lload 8
    //   240: ldiv
    //   241: l2i
    //   242: invokeinterface 168 2 0
    //   247: lload 6
    //   249: lstore 4
    //   251: goto -59 -> 192
    //   254: astore_0
    //   255: aload_1
    //   256: astore_2
    //   257: aload 10
    //   259: astore_1
    //   260: aload_2
    //   261: ifnull +7 -> 268
    //   264: aload_2
    //   265: invokevirtual 171	java/io/FileOutputStream:close	()V
    //   268: aload_1
    //   269: ifnull +7 -> 276
    //   272: aload_1
    //   273: invokevirtual 172	java/io/InputStream:close	()V
    //   276: aload_0
    //   277: athrow
    //   278: lload 4
    //   280: lstore 6
    //   282: aload_1
    //   283: astore 11
    //   285: aload 10
    //   287: astore 12
    //   289: lload 4
    //   291: lconst_0
    //   292: lcmp
    //   293: ifge +13 -> 306
    //   296: lconst_0
    //   297: lstore 6
    //   299: aload 10
    //   301: astore 12
    //   303: aload_1
    //   304: astore 11
    //   306: aload 11
    //   308: ifnull +8 -> 316
    //   311: aload 11
    //   313: invokevirtual 171	java/io/FileOutputStream:close	()V
    //   316: aload 12
    //   318: ifnull +8 -> 326
    //   321: aload 12
    //   323: invokevirtual 172	java/io/InputStream:close	()V
    //   326: lload 6
    //   328: lconst_0
    //   329: lcmp
    //   330: ifge +27 -> 357
    //   333: new 174	java/lang/Exception
    //   336: dup
    //   337: new 176	java/lang/StringBuilder
    //   340: dup
    //   341: ldc -78
    //   343: invokespecial 179	java/lang/StringBuilder:<init>	(Ljava/lang/String;)V
    //   346: aload_0
    //   347: invokevirtual 183	java/lang/StringBuilder:append	(Ljava/lang/String;)Ljava/lang/StringBuilder;
    //   350: invokevirtual 186	java/lang/StringBuilder:toString	()Ljava/lang/String;
    //   353: invokespecial 187	java/lang/Exception:<init>	(Ljava/lang/String;)V
    //   356: athrow
    //   357: aload_2
    //   358: ifnull +9 -> 367
    //   361: aload_2
    //   362: invokeinterface 189 1 0
    //   367: lload 6
    //   369: lreturn
    //   370: astore_0
    //   371: aconst_null
    //   372: astore_1
    //   373: aload 11
    //   375: astore_2
    //   376: goto -116 -> 260
    //   379: astore_0
    //   380: aload 11
    //   382: astore_2
    //   383: aload 10
    //   385: astore_1
    //   386: goto -126 -> 260
    //   389: astore_0
    //   390: aload 10
    //   392: astore_1
    //   393: aload 11
    //   395: astore_2
    //   396: goto -136 -> 260
    //   399: goto -229 -> 170
    //   402: aconst_null
    //   403: astore 11
    //   405: aconst_null
    //   406: astore 12
    //   408: ldc2_w 147
    //   411: lstore 6
    //   413: goto -107 -> 306
    // Local variable table:
    //   start	length	slot	name	signature
    //   0	416	0	paramString	String
    //   0	416	1	paramFile	File
    //   0	416	2	paramD	d
    //   199	20	3	i	int
    //   190	100	4	l1	long
    //   221	191	6	l2	long
    //   122	117	8	l3	long
    //   30	361	10	localObject1	Object
    //   1	403	11	localObject2	Object
    //   39	368	12	localObject3	Object
    // Exception table:
    //   from	to	target	type
    //   180	187	254	finally
    //   192	200	254	finally
    //   204	216	254	finally
    //   231	247	254	finally
    //   67	110	370	finally
    //   110	135	379	finally
    //   140	166	379	finally
    //   170	180	389	finally
  }
  
  public final void a(File paramFile)
  {
    paramFile = Uri.fromFile(paramFile);
    Intent localIntent = new Intent("android.intent.action.VIEW");
    localIntent.setFlags(268435456);
    localIntent.setDataAndType(paramFile, "application/vnd.android.package-archive");
    startActivity(localIntent);
  }
  
  public final boolean a(String paramString)
  {
    try
    {
      paramString = getPackageManager().getPackageArchiveInfo(paramString, 1);
      return paramString != null;
    }
    catch (Exception paramString)
    {
      paramString.printStackTrace();
    }
    return false;
  }
  
  public IBinder onBind(Intent paramIntent)
  {
    return null;
  }
  
  public void onStart(Intent paramIntent, int paramInt)
  {
    this.a = paramIntent.getStringExtra("downloadUrl");
    if ((this.a == null) || ("".equals(this.a))) {
      this.a = "";
    }
    Object localObject;
    if (Environment.getExternalStorageState().equals("mounted"))
    {
      this.e = new File(Environment.getExternalStorageDirectory().getPath() + "/umpay/huafubao/download");
      if (this.e.exists())
      {
        localObject = new File(this.e.getPath() + "/" + URLEncoder.encode(this.a));
        if ((((File)localObject).exists()) && (((File)localObject).isFile()) && (a(((File)localObject).getPath())))
        {
          ((File)localObject).delete();
          stopSelf();
          super.onStart(paramIntent, paramInt);
        }
      }
    }
    for (;;)
    {
      this.b = ((NotificationManager)getSystemService("notification"));
      this.c = new Notification();
      this.c.contentView = new RemoteViews(getApplication().getPackageName(), com.umpay.huafubao.d.a.d(getApplicationContext(), "hfb_upgrade_notification"));
      localObject = new Intent();
      ((Intent)localObject).setFlags(536870912);
      ((Intent)localObject).setClass(getApplicationContext(), AppUpgradeService.class);
      this.d = PendingIntent.getActivity(this, 1, (Intent)localObject, 134217728);
      this.c.icon = com.umpay.huafubao.d.a.b(getApplicationContext(), "hfb_application");
      this.c.tickerText = "开始下载";
      this.c.contentIntent = this.d;
      this.c.contentView.setProgressBar(com.umpay.huafubao.d.a.c(getApplicationContext(), "app_upgrade_progressbar"), 100, 0, false);
      this.c.contentView.setTextViewText(com.umpay.huafubao.d.a.c(getApplicationContext(), "app_upgrade_progresstext"), "0%");
      this.b.cancel(100);
      this.b.notify(100, this.c);
      new c(this).start();
      super.onStart(paramIntent, paramInt);
      return;
      super.onStart(paramIntent, paramInt);
    }
  }
}
