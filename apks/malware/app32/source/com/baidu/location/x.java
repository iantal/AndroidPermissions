package com.baidu.location;

import android.os.Environment;
import android.os.Process;
import java.io.File;
import java.io.PrintWriter;
import java.io.RandomAccessFile;
import java.io.StringWriter;
import java.util.ArrayList;
import java.util.List;
import org.apache.http.HttpResponse;
import org.apache.http.StatusLine;
import org.apache.http.client.HttpClient;
import org.apache.http.client.entity.UrlEncodedFormEntity;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.message.BasicNameValuePair;
import org.apache.http.params.HttpParams;

public class x
  implements bb, Thread.UncaughtExceptionHandler
{
  private static x a = null;
  
  private x() {}
  
  public static x a()
  {
    if (a == null) {
      a = new x();
    }
    return a;
  }
  
  private String a(Throwable paramThrowable)
  {
    StringWriter localStringWriter = new StringWriter();
    PrintWriter localPrintWriter = new PrintWriter(localStringWriter);
    paramThrowable.printStackTrace(localPrintWriter);
    localPrintWriter.close();
    return localStringWriter.toString();
  }
  
  public void a(File paramFile, String paramString1, String paramString2)
  {
    try
    {
      paramFile = new RandomAccessFile(paramFile, "rw");
      paramFile.seek(280L);
      paramFile.writeInt(12346);
      paramFile.seek(300L);
      paramFile.writeLong(System.currentTimeMillis());
      byte[] arrayOfByte = paramString1.getBytes();
      paramFile.writeInt(arrayOfByte.length);
      paramFile.write(arrayOfByte, 0, arrayOfByte.length);
      paramFile.seek(600L);
      arrayOfByte = paramString2.getBytes();
      paramFile.writeInt(arrayOfByte.length);
      paramFile.write(arrayOfByte, 0, arrayOfByte.length);
      if (!a(paramString1, paramString2))
      {
        paramFile.seek(280L);
        paramFile.writeInt(1326);
      }
      paramFile.close();
      return;
    }
    catch (Exception paramFile) {}
  }
  
  boolean a(String paramString1, String paramString2)
  {
    if (!ao.g()) {}
    for (;;)
    {
      return false;
      try
      {
        HttpPost localHttpPost = new HttpPost(bh.e);
        ArrayList localArrayList = new ArrayList();
        localArrayList.add(new BasicNameValuePair("e0", paramString1));
        localArrayList.add(new BasicNameValuePair("e1", paramString2));
        localHttpPost.setEntity(new UrlEncodedFormEntity(localArrayList, "utf-8"));
        paramString1 = new DefaultHttpClient();
        paramString1.getParams().setParameter("http.connection.timeout", Integer.valueOf(12000));
        paramString1.getParams().setParameter("http.socket.timeout", Integer.valueOf(12000));
        int i = paramString1.execute(localHttpPost).getStatusLine().getStatusCode();
        if (i == 200) {
          return true;
        }
      }
      catch (Exception paramString1) {}
    }
    return false;
  }
  
  public void b()
  {
    Object localObject4 = null;
    for (;;)
    {
      try
      {
        Object localObject1 = Environment.getExternalStorageDirectory().getPath() + "/traces";
        localObject1 = new File((String)localObject1 + "/error_fs.dat");
        if (((File)localObject1).exists())
        {
          RandomAccessFile localRandomAccessFile = new RandomAccessFile((File)localObject1, "rw");
          localRandomAccessFile.seek(280L);
          if (1326 == localRandomAccessFile.readInt())
          {
            localRandomAccessFile.seek(308L);
            int i = localRandomAccessFile.readInt();
            if ((i <= 0) || (i >= 2048)) {
              break label230;
            }
            localObject1 = new byte[i];
            localRandomAccessFile.read((byte[])localObject1, 0, i);
            localObject1 = new String((byte[])localObject1, 0, i);
            localRandomAccessFile.seek(600L);
            i = localRandomAccessFile.readInt();
            Object localObject3 = localObject4;
            if (i > 0)
            {
              localObject3 = localObject4;
              if (i < 2048)
              {
                localObject3 = new byte[i];
                localRandomAccessFile.read((byte[])localObject3, 0, i);
                localObject3 = new String((byte[])localObject3, 0, i);
              }
            }
            if (a((String)localObject1, (String)localObject3))
            {
              localRandomAccessFile.seek(280L);
              localRandomAccessFile.writeInt(12346);
            }
          }
          localRandomAccessFile.close();
        }
        else
        {
          return;
        }
      }
      catch (Exception localException)
      {
        return;
      }
      label230:
      Object localObject2 = null;
    }
  }
  
  public void uncaughtException(Thread paramThread, Throwable paramThrowable)
  {
    localObject1 = null;
    if ((System.currentTimeMillis() - y.c() < 10000L) && (4.2F > f.a()))
    {
      l = bm.a().c();
      if (System.currentTimeMillis() - l >= 40000L) {
        break label106;
      }
      paramThread = new File(bh.g() + File.separator + f.b());
      if (paramThread.exists()) {
        paramThread.delete();
      }
    }
    while (!cq.d)
    {
      Process.killProcess(Process.myPid());
      return;
      label106:
      bm.a().b(System.currentTimeMillis());
    }
    for (;;)
    {
      try
      {
        paramThread = a(paramThrowable);
      }
      catch (Exception paramThread)
      {
        Object localObject2;
        label261:
        label269:
        paramThread = null;
        paramThrowable = null;
        continue;
        localObject1 = new RandomAccessFile(localFile, "rw");
        ((RandomAccessFile)localObject1).seek(300L);
        l = ((RandomAccessFile)localObject1).readLong();
        if (System.currentTimeMillis() - l > 604800000L) {
          a(localFile, paramThrowable, paramThread);
        }
        ((RandomAccessFile)localObject1).close();
        continue;
      }
      for (;;)
      {
        try
        {
          paramThrowable = bg.a().a(false);
          paramThrowable = paramThrowable + br.a().c();
          if (paramThrowable == null) {
            continue;
          }
          paramThrowable = Jni.a(paramThrowable);
        }
        catch (Exception paramThrowable)
        {
          break label279;
          localObject1 = localFile;
          break label261;
          paramThrowable = null;
          break;
        }
        try
        {
          localObject2 = Environment.getExternalStorageDirectory().getPath() + "/traces";
          localFile = new File((String)localObject2 + "/error_fs.dat");
          if (localFile.exists()) {
            break label284;
          }
          localObject2 = new File((String)localObject2);
          if (!((File)localObject2).exists()) {
            ((File)localObject2).mkdirs();
          }
          if (localFile.createNewFile()) {
            continue;
          }
          a((File)localObject1, paramThrowable, paramThread);
        }
        catch (Exception paramThread)
        {
          break label269;
        }
      }
    }
    Process.killProcess(Process.myPid());
  }
}
