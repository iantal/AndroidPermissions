package com.baidu.location;

import android.location.GpsSatellite;
import android.location.GpsStatus;
import android.location.GpsStatus.Listener;
import android.location.GpsStatus.NmeaListener;
import android.location.Location;
import android.location.LocationManager;
import android.os.Handler;
import android.os.Message;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Locale;

class cn
  implements GpsStatus.Listener, GpsStatus.NmeaListener
{
  long a = 0L;
  private long c = 0L;
  private final int d = 400;
  private boolean e = true;
  private boolean f = false;
  private List g = new ArrayList();
  private String h = null;
  private String i = null;
  private String j = null;
  
  private cn(cl paramCl) {}
  
  public void a(String paramString)
  {
    if ((System.currentTimeMillis() - this.c > 400L) && (this.f) && (this.g.size() > 0)) {}
    try
    {
      at localAt = new at(this.g, this.h, this.i, this.j);
      if (localAt.a())
      {
        bh.d = cl.a(this.b, localAt, cl.i(this.b));
        if (bh.d > 0) {
          cl.a(String.format(Locale.CHINA, "&nmea=%.1f|%.1f&g_tp=%d", new Object[] { Double.valueOf(localAt.c()), Double.valueOf(localAt.b()), Integer.valueOf(bh.d) }));
        }
      }
      for (;;)
      {
        this.g.clear();
        this.j = null;
        this.i = null;
        this.h = null;
        this.f = false;
        if (!paramString.startsWith("$GPGGA")) {
          break;
        }
        this.f = true;
        this.h = paramString.trim();
        this.c = System.currentTimeMillis();
        return;
        bh.d = 0;
      }
    }
    catch (Exception localException)
    {
      for (;;)
      {
        bh.d = 0;
        continue;
        if (paramString.startsWith("$GPGSV")) {
          this.g.add(paramString.trim());
        } else if (paramString.startsWith("$GPGSA")) {
          this.j = paramString.trim();
        }
      }
    }
  }
  
  public void onGpsStatusChanged(int paramInt)
  {
    if (cl.d(this.b) == null) {}
    long l;
    do
    {
      do
      {
        int n;
        int k;
        do
        {
          do
          {
            return;
            switch (paramInt)
            {
            case 3: 
            default: 
              return;
            case 2: 
              cl.b(this.b, null);
              cl.a(this.b, false);
              cl.a(0);
              return;
            }
          } while ((!cl.b(this.b)) && (System.currentTimeMillis() - this.a < 10000L));
          if (cl.e(this.b) == null) {
            cl.a(this.b, cl.d(this.b).getGpsStatus(null));
          }
          for (;;)
          {
            localObject = cl.e(this.b).getSatellites().iterator();
            cl.a(new StringBuilder());
            cl.a(this.b, 0);
            cl.b(this.b, 0);
            cl.a(this.b, new HashMap());
            paramInt = 0;
            n = 0;
            int m;
            for (k = 0; ((Iterator)localObject).hasNext(); k = m)
            {
              GpsSatellite localGpsSatellite = (GpsSatellite)((Iterator)localObject).next();
              n += 1;
              m = k;
              if (localGpsSatellite.usedInFix()) {
                m = k + 1;
              }
              k = paramInt;
              if (localGpsSatellite.getSnr() > 0.0F) {
                k = paramInt + 1;
              }
              if (localGpsSatellite.getSnr() >= bh.A) {
                cl.f(this.b);
              }
              cl.m().append(cl.a(this.b, localGpsSatellite, cl.g(this.b)));
              paramInt = k;
            }
            cl.d(this.b).getGpsStatus(cl.e(this.b));
          }
          cl.a(paramInt);
          cl.b(this.b, cl.g(this.b));
        } while ((cl.b(this.b)) || (System.currentTimeMillis() - cl.h(this.b) < 60000L) || ((k <= 3) && (n <= 15)));
        localObject = cl.d(this.b).getLastKnownLocation("gps");
      } while (localObject == null);
      this.a = System.currentTimeMillis();
      l = System.currentTimeMillis() + bn.a().b - ((Location)localObject).getTime();
    } while ((l >= 3500L) || (l <= -200L) || (!bw.a((Location)localObject, false)));
    Object localObject = cl.c(this.b).obtainMessage(3, localObject);
    cl.c(this.b).sendMessage((Message)localObject);
  }
  
  public void onNmeaReceived(long paramLong, String paramString)
  {
    if (!cl.b(this.b)) {}
    do
    {
      return;
      if (!cq.f)
      {
        bh.d = 0;
        return;
      }
    } while ((paramString == null) || (paramString.equals("")) || (paramString.length() < 9) || (paramString.length() > 150) || (!this.b.j()));
    cl.c(this.b).sendMessage(cl.c(this.b).obtainMessage(2, paramString));
  }
}
