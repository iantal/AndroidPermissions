package com.baidu.location;

import android.content.ContentValues;
import android.database.Cursor;
import android.database.DatabaseUtils;
import android.database.sqlite.SQLiteDatabase;
import android.location.Location;
import android.net.wifi.ScanResult;
import android.os.Handler;
import android.os.Message;
import java.io.File;
import java.util.Iterator;
import java.util.List;
import java.util.Locale;
import org.json.JSONObject;

class bc
  implements bb
{
  private static bc a = null;
  private String b = null;
  private boolean c = false;
  private boolean d = false;
  private boolean e = false;
  private String f = null;
  private int g = 0;
  private double h = 0.0D;
  private double j = 0.0D;
  private double k = 0.0D;
  private double l = 0.0D;
  private double m = 0.0D;
  private long n = 0L;
  private boolean o = false;
  private volatile boolean p = false;
  private final int q = 6;
  private final int r = 10000;
  private final String s = "bdcltb09";
  private final String t = "wof";
  private final String u = i + "/ls.db";
  private boolean v = true;
  
  private bc()
  {
    try
    {
      d();
      return;
    }
    catch (Exception localException) {}
  }
  
  public static bc a()
  {
    if (a == null) {
      a = new bc();
    }
    return a;
  }
  
  private void a(ar paramAr)
  {
    System.currentTimeMillis();
    this.d = false;
    if (paramAr.a == null) {}
    for (;;)
    {
      return;
      try
      {
        SQLiteDatabase localSQLiteDatabase = SQLiteDatabase.openOrCreateDatabase(this.u, null);
        if ((localSQLiteDatabase == null) || (paramAr == null)) {
          continue;
        }
        Iterator localIterator = paramAr.a.iterator();
        i1 = 0;
        paramAr = null;
        i2 = 0;
        i = 0;
        d2 = 0.0D;
        d1 = 0.0D;
        int i3 = 0;
        i4 = i;
        d3 = d2;
        d4 = d1;
        if (localIterator.hasNext())
        {
          localObject2 = (ScanResult)localIterator.next();
          i3 += 1;
          if (i3 > 10)
          {
            d4 = d1;
            d3 = d2;
            i4 = i;
          }
        }
        else
        {
          if (i4 > 0)
          {
            this.d = true;
            this.l = (d4 / i4);
            this.m = (d3 / i4);
          }
          localSQLiteDatabase.close();
          return;
        }
      }
      catch (Exception localException1)
      {
        for (;;)
        {
          int i1;
          int i2;
          int i;
          double d2;
          double d1;
          Object localObject1 = null;
          continue;
          Object localObject2 = Jni.c(((ScanResult)localObject2).BSSID.replace(":", ""));
          int i5 = i2;
          int i4 = i;
          double d4 = d2;
          double d3 = d1;
          try
          {
            localObject2 = localObject1.rawQuery("select * from wof where id = \"" + (String)localObject2 + "\";", null);
            i5 = i2;
            i4 = i;
            d4 = d2;
            d3 = d1;
            double d5;
            double d6;
            int i6;
            if (((Cursor)localObject2).moveToFirst())
            {
              i5 = i2;
              i4 = i;
              d4 = d2;
              d3 = d1;
              d5 = ((Cursor)localObject2).getDouble(1) - 113.2349D;
              i5 = i2;
              i4 = i;
              d4 = d2;
              d3 = d1;
              d6 = ((Cursor)localObject2).getDouble(2) - 432.1238D;
              i5 = i2;
              i4 = i;
              d4 = d2;
              d3 = d1;
              ((Cursor)localObject2).getInt(3);
              i5 = i2;
              i4 = i;
              d4 = d2;
              d3 = d1;
              i6 = ((Cursor)localObject2).getInt(4);
              i5 = i2;
              i4 = i;
              d4 = d2;
              d3 = d1;
              int i7 = ((Cursor)localObject2).getInt(5);
              i5 = i2;
              i4 = i;
              d4 = d2;
              d3 = d1;
              ((Cursor)localObject2).close();
              if ((i7 > 8) && (i7 > i6)) {
                continue;
              }
              i5 = i2;
              i4 = i;
              d4 = d2;
              d3 = d1;
              if (this.c)
              {
                i5 = i2;
                i4 = i;
                d4 = d2;
                d3 = d1;
                localObject2 = new float[1];
                i5 = i2;
                i4 = i;
                d4 = d2;
                d3 = d1;
                Location.distanceBetween(d6, d5, this.j, this.h, (float[])localObject2);
                i5 = i2;
                i4 = i;
                d4 = d2;
                d3 = d1;
                if (localObject2[0] <= this.k + 2000.0D) {
                  break label919;
                }
                continue;
              }
              if (i2 != 0)
              {
                i5 = i2;
                i4 = i;
                d4 = d2;
                d3 = d1;
                localObject2 = new float[1];
                i5 = i2;
                i4 = i;
                d4 = d2;
                d3 = d1;
                Location.distanceBetween(d6, d5, d2 / i, d1 / i, (float[])localObject2);
                if (localObject2[0] <= 1000.0F) {
                  break label979;
                }
                continue;
              }
              if (paramAr != null) {
                break label992;
              }
              i5 = i2;
              i4 = i;
              d4 = d2;
              d3 = d1;
              localObject2 = new double[8];
              i4 = i1 + 1;
              localObject2[i1] = d5;
              localObject2[i4] = d6;
              i1 = i4 + 1;
              paramAr = (ar)localObject2;
              d3 = d1;
              d1 = d2;
              d2 = d3;
              break label944;
            }
            for (;;)
            {
              label677:
              if (i6 < i1)
              {
                i5 = i2;
                i4 = i;
                d4 = d2;
                d3 = d1;
                localObject2 = new float[1];
                i5 = i2;
                i4 = i;
                d4 = d2;
                d3 = d1;
                Location.distanceBetween(d6, d5, paramAr[(i6 + 1)], paramAr[i6], (float[])localObject2);
                float f1 = localObject2[0];
                if (f1 >= 1000.0F) {
                  break label916;
                }
                i2 = 1;
                d3 = paramAr[i6];
                d2 += paramAr[(i6 + 1)];
                i += 1;
                d1 += d3;
              }
              label916:
              for (;;)
              {
                i6 += 2;
                break label677;
                if (i2 != 0)
                {
                  i += 1;
                  d2 += d6;
                  d3 = d1 + d5;
                  d1 = d2;
                  d2 = d3;
                  break label944;
                }
                if (i1 < 8)
                {
                  i4 = i1 + 1;
                  paramAr[i1] = d5;
                  paramAr[i4] = d6;
                  i1 = i4 + 1;
                  d3 = d1;
                  d1 = d2;
                  d2 = d3;
                  break label944;
                }
                i5 = i2;
                i4 = i;
                d4 = d2;
                d3 = d1;
                localObject1.close();
                return;
                i5 = i2;
                i4 = i;
                d4 = d2;
                d3 = d1;
                ((Cursor)localObject2).close();
                break;
              }
              label919:
              i2 = 1;
              i += 1;
              d3 = d2 + d6;
              d2 = d1 + d5;
              d1 = d3;
              for (;;)
              {
                label944:
                i4 = i1;
                i1 = i;
                d4 = d1;
                d3 = d2;
                if (i <= 4) {
                  break label1016;
                }
                i4 = i;
                d3 = d1;
                d4 = d2;
                break;
                label979:
                d3 = d1;
                d1 = d2;
                d2 = d3;
              }
              label992:
              i6 = 0;
            }
          }
          catch (Exception localException2)
          {
            i = i1;
            i2 = i5;
            i1 = i4;
            i4 = i;
            label1016:
            i = i1;
            d2 = d4;
            d1 = d3;
            i1 = i4;
          }
        }
      }
    }
  }
  
  private void a(ar paramAr, BDLocation paramBDLocation, SQLiteDatabase paramSQLiteDatabase)
  {
    if ((paramBDLocation == null) || (paramBDLocation.e() != 161) || ((!"wf".equals(paramBDLocation.f())) && (paramBDLocation.d() >= 300.0F))) {
      break label36;
    }
    label36:
    label671:
    label677:
    for (;;)
    {
      return;
      if (paramAr.a != null)
      {
        int i4 = (int)(System.currentTimeMillis() >> 28);
        System.currentTimeMillis();
        paramAr = paramAr.a.iterator();
        int i = 0;
        for (;;)
        {
          if (!paramAr.hasNext()) {
            break label677;
          }
          Object localObject1 = (ScanResult)paramAr.next();
          if (((ScanResult)localObject1).level != 0)
          {
            i += 1;
            if (i > 6) {
              break;
            }
            ContentValues localContentValues = new ContentValues();
            localObject1 = Jni.c(((ScanResult)localObject1).BSSID.replace(":", ""));
            do
            {
              try
              {
                Object localObject2 = paramSQLiteDatabase.rawQuery("select * from wof where id = \"" + (String)localObject1 + "\";", null);
                double d2;
                double d1;
                int i1;
                int i2;
                if ((localObject2 != null) && (((Cursor)localObject2).moveToFirst()))
                {
                  d2 = ((Cursor)localObject2).getDouble(1);
                  d1 = ((Cursor)localObject2).getDouble(2);
                  ((Cursor)localObject2).getInt(3);
                  i1 = ((Cursor)localObject2).getInt(4);
                  i3 = ((Cursor)localObject2).getInt(5);
                  d1 -= 432.1238D;
                  i2 = 1;
                  d2 -= 113.2349D;
                }
                for (;;)
                {
                  ((Cursor)localObject2).close();
                  if (i2 != 0) {
                    break label671;
                  }
                  localContentValues.put("mktime", Double.valueOf(paramBDLocation.c() + 113.2349D));
                  localContentValues.put("time", Double.valueOf(paramBDLocation.b() + 432.1238D));
                  localContentValues.put("bc", Integer.valueOf(1));
                  localContentValues.put("cc", Integer.valueOf(1));
                  localContentValues.put("ac", Integer.valueOf(i4));
                  localContentValues.put("id", (String)localObject1);
                  paramSQLiteDatabase.insert("wof", null, localContentValues);
                  break;
                  localObject2 = new float[1];
                  Location.distanceBetween(d1, d2, paramBDLocation.b(), paramBDLocation.c(), (float[])localObject2);
                  if (localObject2[0] > 1500.0F)
                  {
                    i2 = i3 + 1;
                    if ((i2 > 10) && (i2 > i1 * 3))
                    {
                      localContentValues.put("mktime", Double.valueOf(paramBDLocation.c() + 113.2349D));
                      localContentValues.put("time", Double.valueOf(paramBDLocation.b() + 432.1238D));
                      localContentValues.put("bc", Integer.valueOf(1));
                      localContentValues.put("cc", Integer.valueOf(1));
                      localContentValues.put("ac", Integer.valueOf(i4));
                    }
                  }
                  try
                  {
                    for (;;)
                    {
                      i1 = paramSQLiteDatabase.update("wof", localContentValues, "id = \"" + (String)localObject1 + "\"", null);
                      if (i1 > 0) {
                        break;
                      }
                      break;
                      localContentValues.put("cc", Integer.valueOf(i2));
                      continue;
                      d2 = (d2 * i1 + paramBDLocation.c()) / (i1 + 1);
                      d1 = (d1 * i1 + paramBDLocation.b()) / (i1 + 1);
                      localContentValues.put("mktime", Double.valueOf(d2 + 113.2349D));
                      localContentValues.put("time", Double.valueOf(d1 + 432.1238D));
                      localContentValues.put("bc", Integer.valueOf(i1 + 1));
                      localContentValues.put("ac", Integer.valueOf(i4));
                    }
                    i3 = 0;
                  }
                  catch (Exception localException1) {}
                  i1 = 0;
                  d2 = 0.0D;
                  i2 = 0;
                  d1 = 0.0D;
                }
              }
              catch (Exception localException2)
              {
                int i3;
                for (;;) {}
              }
            } while (i3 != 0);
          }
        }
      }
    }
  }
  
  private void a(String paramString)
  {
    Object localObject1 = null;
    if ((paramString == null) || (paramString.equals(this.b))) {
      return;
    }
    try
    {
      localObject2 = SQLiteDatabase.openOrCreateDatabase(this.u, null);
      localObject1 = localObject2;
    }
    catch (Exception localException)
    {
      Object localObject2;
      for (;;) {}
    }
    if ((localObject1 == null) || (paramString == null))
    {
      this.c = false;
      return;
    }
    this.c = false;
    try
    {
      localObject2 = localObject1.rawQuery("select * from bdcltb09 where id = \"" + paramString + "\";", null);
      this.b = paramString;
      this.n = System.currentTimeMillis();
      if (localObject2 != null)
      {
        if (((Cursor)localObject2).moveToFirst())
        {
          this.h = (((Cursor)localObject2).getDouble(1) - 1235.4323D);
          this.k = (((Cursor)localObject2).getDouble(2) - 4326.0D);
          this.j = (((Cursor)localObject2).getDouble(3) - 2367.3217D);
          this.c = true;
        }
        ((Cursor)localObject2).close();
      }
    }
    catch (Exception paramString)
    {
      for (;;) {}
    }
    localObject1.close();
  }
  
  private void a(String paramString, cf paramCf, SQLiteDatabase paramSQLiteDatabase)
  {
    if ((!paramCf.b()) || (!af.b().e())) {}
    for (;;)
    {
      return;
      System.currentTimeMillis();
      double d2 = 0.0D;
      double d1 = 0.0D;
      float f1 = 0.0F;
      int i1 = (int)(System.currentTimeMillis() >> 28);
      paramCf = paramCf.c();
      int i = 1;
      try
      {
        paramString = new JSONObject(paramString);
        int i2 = Integer.parseInt(paramString.getJSONObject("result").getString("error"));
        if (i2 == 161)
        {
          paramString = paramString.getJSONObject("content");
          if (paramString.has("clf"))
          {
            i = 0;
            localObject = paramString.getString("clf");
            if (!((String)localObject).equals("0")) {
              break label299;
            }
            localObject = paramString.getJSONObject("point");
            d2 = Double.parseDouble(((JSONObject)localObject).getString("x"));
            d1 = Double.parseDouble(((JSONObject)localObject).getString("y"));
            f1 = Float.parseFloat(paramString.getString("radius"));
          }
        }
        label299:
        while (i2 != 167)
        {
          Object localObject;
          while (i == 0)
          {
            paramString = new ContentValues();
            paramString.put("time", Double.valueOf(d2 + 1235.4323D));
            paramString.put("tag", Float.valueOf(4326.0F + f1));
            paramString.put("type", Double.valueOf(d1 + 2367.3217D));
            paramString.put("ac", Integer.valueOf(i1));
            try
            {
              if (paramSQLiteDatabase.update("bdcltb09", paramString, "id = \"" + paramCf + "\"", null) > 0) {
                break;
              }
              paramString.put("id", paramCf);
              paramSQLiteDatabase.insert("bdcltb09", null, paramString);
              return;
            }
            catch (Exception paramString)
            {
              return;
            }
            paramString = ((String)localObject).split("\\|");
            d2 = Double.parseDouble(paramString[0]);
            d1 = Double.parseDouble(paramString[1]);
            f1 = Float.parseFloat(paramString[2]);
          }
        }
        paramSQLiteDatabase.delete("bdcltb09", "id = \"" + paramCf + "\"", null);
        return;
      }
      catch (Exception paramString) {}
    }
  }
  
  private String b(boolean paramBoolean)
  {
    double d2 = 0.0D;
    double d1;
    double d3;
    boolean bool;
    int i;
    if (this.d)
    {
      d1 = this.l;
      d2 = this.m;
      d3 = 246.4D;
      bool = true;
      i = 1;
    }
    for (;;)
    {
      bq.a().a(this.c, this.d, d1, d2);
      if (i != 0)
      {
        String str;
        if (paramBoolean)
        {
          str = "{\"result\":{\"time\":\"" + bh.a() + "\",\"error\":\"66\"},\"content\":{\"point\":{\"x\":" + "\"%f\",\"y\":\"%f\"},\"radius\":\"%f\",\"isCellChanged\":\"%b\"}}";
          return String.format(Locale.CHINA, str, new Object[] { Double.valueOf(d1), Double.valueOf(d2), Double.valueOf(d3), Boolean.valueOf(true) });
          if (this.c)
          {
            d1 = this.h;
            d2 = this.j;
            d3 = this.k;
            bool = af.b().e();
            i = 1;
          }
        }
        else
        {
          str = "{\"result\":{\"time\":\"" + bh.a() + "\",\"error\":\"68\"},\"content\":{\"point\":{\"x\":" + "\"%f\",\"y\":\"%f\"},\"radius\":\"%f\",\"isCellChanged\":\"%b\"}}";
          return String.format(Locale.CHINA, str, new Object[] { Double.valueOf(d1), Double.valueOf(d2), Double.valueOf(d3), Boolean.valueOf(bool) });
        }
      }
      else
      {
        if (paramBoolean) {
          return "{\"result\":{\"time\":\"" + bh.a() + "\",\"error\":\"67\"}}";
        }
        return "{\"result\":{\"time\":\"" + bh.a() + "\",\"error\":\"63\"}}";
      }
      d3 = 0.0D;
      d1 = 0.0D;
      bool = false;
      i = 0;
    }
  }
  
  private void b(Message paramMessage)
  {
    br.a().a(a(true), paramMessage);
  }
  
  private void c()
  {
    cf localCf = ce.a().e();
    if (localCf != null) {
      a(localCf.c());
    }
    a(ao.a().i());
  }
  
  private void d()
  {
    try
    {
      Object localObject = new File(i);
      File localFile = new File(this.u);
      if (!((File)localObject).exists()) {
        ((File)localObject).mkdirs();
      }
      if (!localFile.exists()) {
        localFile.createNewFile();
      }
      if (localFile.exists())
      {
        localObject = SQLiteDatabase.openOrCreateDatabase(localFile, null);
        ((SQLiteDatabase)localObject).execSQL("CREATE TABLE IF NOT EXISTS bdcltb09(id CHAR(40) PRIMARY KEY,time DOUBLE,tag DOUBLE, type DOUBLE , ac INT);");
        ((SQLiteDatabase)localObject).execSQL("CREATE TABLE IF NOT EXISTS wof(id CHAR(15) PRIMARY KEY,mktime DOUBLE,time DOUBLE, ac INT, bc INT, cc INT);");
        ((SQLiteDatabase)localObject).setVersion(1);
        ((SQLiteDatabase)localObject).close();
      }
      return;
    }
    catch (Exception localException) {}
  }
  
  private void e()
  {
    SQLiteDatabase localSQLiteDatabase2;
    long l2;
    try
    {
      SQLiteDatabase localSQLiteDatabase1 = SQLiteDatabase.openOrCreateDatabase(this.u, null);
      if (localSQLiteDatabase1 == null) {
        return;
      }
    }
    catch (Exception localException)
    {
      for (;;)
      {
        localSQLiteDatabase2 = null;
      }
      long l1 = DatabaseUtils.queryNumEntries(localSQLiteDatabase2, "wof");
      l2 = DatabaseUtils.queryNumEntries(localSQLiteDatabase2, "bdcltb09");
      if (l1 <= 10000L) {
        break label111;
      }
    }
    boolean bool1 = true;
    if (l2 > 10000L) {}
    for (boolean bool2 = true;; bool2 = false)
    {
      if ((bool1) || (bool2)) {
        new be(this, null).execute(new Boolean[] { Boolean.valueOf(bool1), Boolean.valueOf(bool2) });
      }
      localSQLiteDatabase2.close();
      return;
      label111:
      bool1 = false;
      break;
    }
  }
  
  public BDLocation a(boolean paramBoolean)
  {
    c();
    return new BDLocation(b(paramBoolean));
  }
  
  public void a(Message paramMessage)
  {
    b(paramMessage);
  }
  
  public void a(String paramString, cf paramCf, ar paramAr, BDLocation paramBDLocation)
  {
    if ((!paramCf.b()) || (!af.b().e())) {}
    for (int i1 = 1;; i1 = 0)
    {
      if ((paramBDLocation == null) || (paramBDLocation.e() != 161) || ((!"wf".equals(paramBDLocation.f())) && (paramBDLocation.d() >= 300.0F))) {}
      for (int i = 1;; i = 0)
      {
        if (paramAr.a == null) {
          i = 1;
        }
        if ((i1 != 0) && (i != 0)) {}
        while (this.p) {
          return;
        }
        this.p = true;
        new bf(this, null).execute(new Object[] { paramString, paramCf, paramAr, paramBDLocation });
        return;
      }
    }
  }
  
  public void b()
  {
    this.v = true;
    y.b().postDelayed(new bd(this), 3000L);
  }
}
