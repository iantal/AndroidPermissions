package com.payeco.android.plugin;

import android.graphics.Bitmap;
import android.graphics.Bitmap.CompressFormat;
import android.graphics.Matrix;
import android.os.AsyncTask;
import android.os.Build.VERSION;
import android.util.Log;
import com.payeco.android.plugin.b.h;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileOutputStream;
import java.io.OutputStream;

final class g
  extends AsyncTask
{
  private String b;
  
  g(PayecoPluginLoadingActivity paramPayecoPluginLoadingActivity) {}
  
  private Void a()
  {
    try
    {
      i = Integer.parseInt(h.a("PhotoSize"));
      try
      {
        j = com.payeco.android.plugin.c.a.a(com.payeco.android.plugin.b.a.b);
        localObject1 = com.payeco.android.plugin.b.a.b;
        localObject2 = com.payeco.android.plugin.b.a.c;
        if (Integer.valueOf(Build.VERSION.SDK).intValue() <= 11) {
          break label241;
        }
        localObject1 = com.payeco.android.plugin.c.a.a((String)localObject1, 640, 960);
        localObject3 = new Matrix();
        ((Matrix)localObject3).postRotate(j);
        if (j == 0) {
          break label303;
        }
        localObject1 = Bitmap.createBitmap((Bitmap)localObject1, 0, 0, ((Bitmap)localObject1).getWidth(), ((Bitmap)localObject1).getHeight(), (Matrix)localObject3, true);
      }
      catch (Exception localException1)
      {
        for (;;)
        {
          int j;
          Object localObject1;
          Object localObject2;
          Object localObject3;
          int k;
          Log.e("payeco", "压缩失败", localException1);
          break;
        }
      }
      localObject3 = new File((String)localObject2);
      if (((File)localObject3).exists()) {
        ((File)localObject3).delete();
      }
      localObject2 = new ByteArrayOutputStream();
      ((Bitmap)localObject1).compress(Bitmap.CompressFormat.JPEG, 100, (OutputStream)localObject2);
      localObject3 = new FileOutputStream((File)localObject3);
      k = ((ByteArrayOutputStream)localObject2).toByteArray().length;
      j = 100;
      for (;;)
      {
        if ((k / 1024 <= i) || (j == 10))
        {
          ((ByteArrayOutputStream)localObject2).toByteArray();
          ((FileOutputStream)localObject3).write(((ByteArrayOutputStream)localObject2).toByteArray());
          ((FileOutputStream)localObject3).close();
          ((ByteArrayOutputStream)localObject2).close();
          if (!((Bitmap)localObject1).isRecycled())
          {
            ((Bitmap)localObject1).recycle();
            System.gc();
          }
          this.b = com.payeco.android.plugin.c.a.a(com.payeco.android.plugin.c.a.a(com.payeco.android.plugin.b.a.c, 100, 100));
          break label306;
          label241:
          localObject1 = com.payeco.android.plugin.c.a.a((String)localObject1, 240, 320);
          break;
        }
        ((ByteArrayOutputStream)localObject2).reset();
        ((Bitmap)localObject1).compress(Bitmap.CompressFormat.JPEG, j, (OutputStream)localObject2);
        k = ((ByteArrayOutputStream)localObject2).toByteArray().length;
        j -= 3;
      }
      label303:
      label306:
      return null;
    }
    catch (Exception localException2)
    {
      for (;;)
      {
        int i = 500;
      }
    }
  }
}
