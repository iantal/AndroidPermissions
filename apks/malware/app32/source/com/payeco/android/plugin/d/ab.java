package com.payeco.android.plugin.d;

import android.annotation.SuppressLint;
import android.content.Context;
import android.graphics.drawable.BitmapDrawable;
import android.media.MediaPlayer;
import android.media.MediaRecorder;
import android.os.Handler;
import android.view.View;
import android.widget.Button;
import android.widget.PopupWindow;
import android.widget.TextView;
import com.payeco.android.plugin.b.a;
import com.payeco.android.plugin.c.d;
import com.payeco.android.plugin.c.g;
import java.io.IOException;

@SuppressLint({"ViewConstructor"})
public final class ab
  extends PopupWindow
{
  private static ab c;
  public boolean a;
  public boolean b;
  private Context d;
  private View e;
  private Button f;
  private Button g;
  private Button h;
  private Button i;
  private TextView j;
  private int k = 5;
  private int l;
  private Handler m;
  private MediaRecorder n;
  private MediaPlayer o;
  private aj p;
  private Runnable q = new ac(this);
  
  private ab(View paramView, Context paramContext, int paramInt)
  {
    super(paramView, -1, -1, false);
    this.d = paramContext;
    this.e = paramView;
    this.k = paramInt;
    this.m = new Handler();
    this.j = ((TextView)a("time"));
    this.f = ((Button)a("btnStart"));
    this.f.setOnClickListener(new ad(this));
    this.h = ((Button)a("btnPlay"));
    this.h.setOnClickListener(new ae(this));
    this.h.setEnabled(false);
    this.i = ((Button)a("btnFinish"));
    this.i.setOnClickListener(new af(this));
    this.i.setEnabled(false);
    this.g = ((Button)a("btnCancel"));
    this.g.setOnClickListener(new ag(this));
  }
  
  private int a(int paramInt)
  {
    if (!g.b()) {
      return 1;
    }
    if (this.b) {
      return 2;
    }
    if (this.a) {
      return 3;
    }
    try
    {
      this.n = new MediaRecorder();
      this.n.setAudioSource(1);
      this.n.setOutputFormat(2);
      this.n.setOutputFile(a.a);
      this.n.setAudioEncoder(1);
      this.n.prepare();
      this.n.start();
      new Thread(new ah(this, paramInt)).start();
      this.a = true;
      return 0;
    }
    catch (IOException localIOException)
    {
      this.a = false;
    }
    return 4;
  }
  
  private View a(String paramString)
  {
    return d.a(this.e, this.d, paramString);
  }
  
  public static ab a(Context paramContext, View paramView, int paramInt, aj paramAj)
  {
    View localView = d.a(paramContext, "payeco_plugin_record");
    if (c == null)
    {
      paramContext = new ab(localView, paramContext, paramInt);
      c = paramContext;
      paramContext.setBackgroundDrawable(new BitmapDrawable());
      c.update();
      c.showAtLocation(paramView, 80, 0, 0);
      c.p = paramAj;
    }
    return c;
  }
  
  public final int a()
  {
    try
    {
      if (this.a)
      {
        this.n.stop();
        this.n.release();
        this.n = null;
        this.a = false;
      }
      return 0;
    }
    catch (Exception localException) {}
    return 1;
  }
  
  public final int b()
  {
    if (this.a) {
      return 1;
    }
    if (this.b) {
      return 2;
    }
    try
    {
      this.o = new MediaPlayer();
      this.o.setDataSource(a.a);
      this.o.prepare();
      this.o.start();
      this.o.setOnCompletionListener(new ai(this));
      this.b = true;
      return 0;
    }
    catch (IOException localIOException)
    {
      this.b = false;
    }
    return 3;
  }
  
  public final void dismiss()
  {
    this.m.removeCallbacks(this.q);
    this.m = null;
    c = null;
    super.dismiss();
  }
}
