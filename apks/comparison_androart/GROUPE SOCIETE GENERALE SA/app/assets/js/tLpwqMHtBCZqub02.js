Class.ns("Bankingapp.functions.receivemoney.bringyourmoney");Bankingapp.functions.receivemoney.bringyourmoney.CardSelectionItemSecondLevel=Class.extend(Bankingapp.ui.ListItem,{formDataFunctionAttributeId:Functions.transferfunds.TransferUtils.BRINGYOURMONEY_FORMDATA,cardIdField:"cardId",cardTypeField:"cardType",cardNumberField:"cardNumber",lastUsedDateField:"lastUsedDate",nextPaymentDateField:"nextPaymentDate",cardExpiryDateField:"cardExpiryDate",transactionIdField:"transactionId",isMain:true,renderItem:function(){debugLog("CardSelectionItemSecondLevel.renderItem");var g=$("<div>",{"class":"bym-cardselector-second-outer"}).appendTo(this);var e=$("<div>",{"class":"bym-cardselector-second-inner"});var h=$("<div>",{"class":"bym-cardselector-second-inner-row"});var f=$("<table>",{"class":"bym-cardselector-second-table"});var a=f.appendRow();var d=a.appendCell();this.button1=new Bankingapp.ui.ComplexButton(resolve("bankingapp_brd_function_bringyourmoney_dashboard_usecardbutton"),{id:"useCardButton-"+this.itemData[this.cardIdField],"class":"bym-cardselector-usecardbutton"});this.button1.bind("buttonClick",$.proxy(this.button1ClickHandler,this));d.append(this.button1);var c=a.appendCell();this.button2=new Bankingapp.ui.ComplexButton(resolve("bankingapp_brd_function_bringyourmoney_dashboard_deletecardbutton"),{id:"deleteCardButton-"+this.itemData[this.cardIdField],"class":"bym-cardselector-deletecardbutton"});this.button2.bind("buttonClick",$.proxy(this.button2ClickHandler,this));c.append(this.button2);var b=a.appendCell();this.button3=new Bankingapp.ui.ComplexButton(resolve("bankingapp_brd_function_bringyourmoney_dashboard_deleterecurrencebutton"),{id:"deleteRecurrenceButton-"+this.itemData[this.cardIdField],"class":"bym-cardselector-deleterecurrencebutton",disabled:this.itemData[this.nextPaymentDateField]==undefined||this.itemData[this.nextPaymentDateField]==null});if(this.itemData[this.nextPaymentDateField]==undefined||this.itemData[this.nextPaymentDateField]==null){this.button3.hide();}else{this.button3.show();}this.button3.bind("buttonClick",$.proxy(this.button3ClickHandler,this));b.append(this.button3);h.append(f);e.append(h);g.append(e);debugLog("outerDiv: "+g.html());},button1ClickHandler:function(b,a){debugLog("button1 clicked ... "+this.itemData[this.cardIdField]);this.formData=getFunctionAttribute(this.formDataFunctionAttributeId);if((this.formData==undefined)||(this.formData==null)){debugLog("formdata is not defined ...");this.formData={};}$.extend(this.formData,{progressIndicatorCurrentStep:0,savedCardId:this.itemData[this.cardIdField],savedCardType:this.itemData[this.cardTypeField],savedCardExpiryDate:this.itemData[this.cardExpiryDateField],savedMaskedCardNumber:this.itemData[this.cardNumberField],savedAmount:this.itemData.amount,savedCurrency:this.itemData.currency,isRecurring:this.itemData[this.nextPaymentDateField]!=undefined&&this.itemData[this.nextPaymentDateField]!=null,mpiCardTransactionId:this.itemData[this.transactionIdField]});setFunctionAttribute(this.formDataFunctionAttributeId,this.formData);loadView("view://brd/bankingapp/function/receivemoney/bringyourmoney/targetaccountselection");},button2ClickHandler:function(b,a){debugLog("button3 clicked ... "+this.itemData[this.cardIdField]);Bankingapp.framework.Application.showConfirmation(resolve("bankingapp_brd_function_bringyourmoney_dashboard_deletecard_confirmation"),new Boolean(0),$.proxy(this.handleDeleteCardConfirmationResult,this));},button3ClickHandler:function(b,a){debugLog("button2 clicked ... "+this.itemData[this.cardIdField]);Bankingapp.framework.Application.showConfirmation(resolve("bankingapp_brd_function_bringyourmoney_dashboard_deleterecurrence_confirmation"),new Boolean(0),$.proxy(this.handleDeleteRecurrenceConfirmationResult,this));},handleDeleteRecurrenceConfirmationResult:function(a){if(a.valueOf()){debugLog("confirmed ...");var b={DeleteBringYourMoneyRecurrenceRequest:{cardId:this.itemData[this.cardIdField],transactionId:this.itemData[this.transactionIdField]}};Bankingapp.framework.Application.callService("/bringyourmoney/deleteRecurrence",b,$.proxy(this.handleListResult,this));return;}debugLog("not confirmed ...");},handleDeleteCardConfirmationResult:function(a){if(a.valueOf()){debugLog("confirmed ...");var b={DeleteBringYourMoneyCardRequest:{cardId:this.itemData[this.cardIdField]}};Bankingapp.framework.Application.callService("/bringyourmoney/deleteCard",b,$.proxy(this.handleListResult,this));return;}debugLog("not confirmed ...");},handleListResult:function(){debugLog("handleListResult ...");this.trigger("refreshCardList",null);}});