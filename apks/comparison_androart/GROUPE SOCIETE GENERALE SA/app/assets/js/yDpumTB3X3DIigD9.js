$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");$().loadJavaScript("/js/CF0WiFs1SjIy0Szl.js");$().loadJavaScript("/js/0A4YRnFx1DbUd3zN.js");$().loadJavaScript("/js/AZPz8vN1TNFqZWpw.js");Class.ns("Bankingapp.functions.receivemoney.westernunion_receive");Bankingapp.functions.receivemoney.westernunion_receive.Forecast=Class.extend(Bankingapp.framework.View,{progressIndicatorStepCount:Functions.transferfunds.TransferUtils.WU_RECEIVE_STEPCOUNT,progressIndicatorCurrentStep:3,container:null,formData:null,signBlock:null,groupcontainer:null,dateFormatPattern:resolve("bankingapp_common_dateFormatPattern_per"),layoutRender:function(){debugLog("Forecast layoutRender ...");this.formData=getFunctionAttribute(Functions.transferfunds.TransferUtils.WU_RECEIVE_FORMDATA);this.container=$("<div>",{id:"forecastCt","class":"maincontainer transactiondetails"});this.container.append(new Bankingapp.ui.ProgressIndicator(this.progressIndicatorStepCount,this.progressIndicatorCurrentStep));this.groupcontainer=$("<div>",{"class":"paymentdetail groupcontainer"});this.groupcontainerSender=$("<div>",{"class":"paymentdetail groupcontainer"});this.groupcontainerReceiver=$("<div>",{"class":"paymentdetail groupcontainer"});return this.container;},errorMessageHandler:function(b,a){debugLog("Forecast errorMessageHandler ...");Bankingapp.framework.event.ServiceMessageHandler.errorMessageHandler(b,a);debugLog("Forecast errorMessageHandler, error message showed!");this.signBlock.remove();this.signBlock=new Bankingapp.ui.ManualSignBlock({signMode:Functions.transferfunds.TransferUtils.SIGNMODE,tokenSubmitResourceKey:"bankingapp_function_transferfunds_signtransaction",submitButtonResourceKey:"bankingapp_function_transferfunds_signtransaction"});this.signBlock.bind("formSubmitted",$.proxy(this.submitHandler,this));this.container.append(this.signBlock);this.backButton.show();this.signBlock.hide();},run:function(){debugLog("Forecast run ...");Bankingapp.framework.Application.unBind("onErrorMessageReceived");$("body").bind("onErrorMessageReceived",$.proxy(this.errorMessageHandler,this));Bankingapp.framework.event.BrdServiceMessageHandler.handleMessages();var a=getFunctionAttribute(Functions.transferfunds.TransferUtils.WU_RECEIVE_FORECAST_REPLY);var b=a.forecastReply;debugLog("Forecast reply: ");debugLog(b);var c=b.fXAmountData;this.container.append(new Bankingapp.functions.util.component.TransactionSummary({summaryData:{titleInfo:"",upperTitle:(this.formData.targetAccount.accountName),upperText:(this.formData.targetAccount.accountType+" ("+this.formData.targetAccount.currency+")"),amount:c.toAmount==undefined?"":c.toAmount,currency:c.toCurrency==undefined?"":c.toCurrency,lowerTitle:(b==undefined||b.westernUnionReceiveData==undefined)?"":b.westernUnionReceiveData.senderName,lowerText:"",creditDebitFlag:"C"}}));this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_westernunion_target_account_holder"),this.formData.targetAccount.ownerName));this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_westernunion_mtcn"),this.formData.mtcn));var c=b.fXAmountData;if(c!=undefined&&c){this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_westernunion_sent_amount"),c.fromCurrency+" "+c.fromAmount));if(c.fXRate&&c.fXRate!=1){this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_westernunion_exchange_rate"),c.fXRate));}}if(b!=undefined&&b.westernUnionReceiveData!=undefined){this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_westernunion_personal_message"),b.westernUnionReceiveData.personalMessage));this.groupcontainerSender.append(new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_westernunion_sender_name"),b.westernUnionReceiveData.senderName));this.groupcontainerSender.append(new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_westernunion_sender_address"),b.westernUnionReceiveData.senderAddress));this.groupcontainerSender.append(new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_westernunion_sender_country"),resolve("bankingapp_function_insternationaltransfer_details_country_"+b.westernUnionReceiveData.senderCountry)));this.groupcontainerReceiver.append(new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_westernunion_receiver_name"),b.westernUnionReceiveData.receiverName));this.groupcontainerReceiver.append(new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_westernunion_receiver_address"),b.westernUnionReceiveData.receiverAddress));this.groupcontainerReceiver.append(new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_westernunion_receiver_country"),resolve("bankingapp_function_insternationaltransfer_details_country_"+b.westernUnionReceiveData.receiverCountry)));}this.container.append(this.groupcontainer);this.container.append(this.groupcontainerSender);this.container.append(this.groupcontainerReceiver);this.signBlock=new Bankingapp.ui.ManualSignBlock({signMode:Functions.transferfunds.TransferUtils.SIGNMODE,tokenSubmitResourceKey:"bankingapp_function_transferfunds_signtransaction",submitButtonResourceKey:"bankingapp_function_transferfunds_signtransaction"});this.signBlock.bind("formSubmitted",$.proxy(this.submitHandler,this));this.container.append(this.signBlock);this.backButton=new Bankingapp.ui.ComplexButton(resolve("bankingapp_brd_function_finances_westernunion_receive_result_back"),{});this.container.append(this.backButton);this.backButton.bind("buttonClick",$.proxy(this.backButtonHandler,this));this.backButton.hide();},submitHandler:function(){debugLog("Forecast submitHandler ...");setFunctionAttribute(Functions.transferfunds.TransferUtils.WU_RECEIVE_SIGN_CREDENTIAL,this.signBlock.getCredential());Bankingapp.framework.Application.callService("/westernunion_receive/perform",{PerformTransactionOperationRequest:{credential:getFunctionAttribute(Functions.transferfunds.TransferUtils.WU_RECEIVE_SIGN_CREDENTIAL),book:true,sign:true,fingerPrint:this.signBlock.getIsFingerprint()}},$.proxy(this.handleSignResult,this));},handleSignResult:function(a){debugLog("Forecast handleSignResult ...");setFunctionAttribute(Functions.transferfunds.TransferUtils.WU_RECEIVE_SIGN_REPLY,a);if(a!=undefined&&a!=null&&a.status!=undefined&&a.status!=null&&a.status!="FAILED"){debugLog("status ...");debugLog(a.status);loadView("view://brd/bankingapp/function/receivemoney/westernunion_receive/result",null);}else{debugLog("The transaction is failed!");loadView("view://brd/bankingapp/function/receivemoney/westernunion_receive/result",null);}},backButtonHandler:function(a){goToPreviousView("view://brd/bankingapp/function/receivemoney/westernunion_receive/TransactionDetails");debugLog("Forecast backButtonHandler, goToPreviousView ready!");}});Bankingapp.framework.Application.setView(Bankingapp.functions.receivemoney.westernunion_receive.Forecast);