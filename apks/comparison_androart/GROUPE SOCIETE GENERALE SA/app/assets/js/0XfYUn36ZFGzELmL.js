$().loadJavaScript("/js/ub7EBPmB1JG8uW5S.js");$().loadJavaScript("/js/UTo6WsoyQcdUSv0z.js");Class.ns("Bankingapp.functions.homescreen");Bankingapp.functions.homescreen.HomeScreen=Class.extend(Bankingapp.framework.View,{container:null,amountFormatKey:"bankingapp_component_amount_format",feedCategoryTypeArray:[],layoutRender:function(){this.authorized=this.isAuthorized();this.container=$("<div>",{id:"homeScreenMainContainer","class":"homeScreenMainContainer"});Bankingapp.framework.Application.bind("onResume",$.proxy(this.onResume,this));Bankingapp.framework.Application.bind("onContextMenuItemPressed",$.proxy(this.onContextMenuItemPressed,this));return this.container;},onResume:function(){this.getEnabledFeedCategories();},getEnabledFeedCategories:function(){Bankingapp.framework.Application.callService("/messaging/customer/getCategoryTypePreferences",null,$.proxy(this.getEnabledFeedCategoriesResult,this));},getEnabledFeedCategoriesResult:function(c){this.feedCategoryTypeArray=[];for(var b in c.categoryType){if(c.categoryType[b].checked===true||c.categoryType[b].checked==="true"){this.feedCategoryTypeArray.push(c.categoryType[b].categoryTypeId);}}if(this.authorized===true){showLoadingPopup();$("#homeScreenWelcomeMessageContainer").remove();var a=getSessionAttribute("HOMESCREEN_WELCOME_MESSAGE_DISPLAYED");a=a!=null?a.valueOf():false;if(a===false||a=="false"){Bankingapp.framework.Application.callService("/homescreen/information",{HomeScreenInformationRequest:{LastLoginLocationRequest:{}}},$.proxy(this.renderPageElements,this));}else{Bankingapp.framework.Application.callService("/homescreen/information",{HomeScreenInformationRequest:{}},$.proxy(this.renderPageElements,this));}}},handleResult:function(e){var c=0;if(e){for(var d=0;d<e.length;d++){if(e[d].status&&e[d].status["@name"]=="UNREAD"&&$.inArray(e[d].categoryTypeId,this.feedCategoryTypeArray)!=-1){c++;}}}var b=null;var a=null;if(c!=0){b=resolve("bankingapp_brd_function_homescreen_bankfeedbutton_hasmessages",{numberOfMessages:c});a="bankfeedHasMessages";}else{b=resolve("bankingapp_brd_function_homescreen_bankfeedbutton_nomessages");a="bankfeedNoMessages";}if(this.buttonNewsAndMessages){this.buttonNewsAndMessages.find(".row1").text(b);}else{this.buttonNewsAndMessages=new Bankingapp.ui.LandingPageButton([resolve("bankingapp_brd_function_homescreen_bankfeedbutton_title"),b],{"class":a,authorizationId:"bankfeed/view"});this.buttonNewsAndMessages.bind("buttonClick",$.proxy(this.bankFeedButtonHandler,this));$("#mailboxButtonContainer").append(this.buttonNewsAndMessages);}if(this.buttonBringYourMoney){if(!Bankingapp.framework.Application.isAuthorized("bring_your_money/view")){this.buttonBringYourMoney.hide();}else{this.buttonBringYourMoney.show();}}setFunctionAttribute("HOMESCREEN_WELCOME_MESSAGES_LOADED",true);},getCity:function(a){var e=null;for(var c=0;c<a.results.length;c++){if(($.inArray("locality",a.results[c].types)!=-1)&&($.inArray("political",a.results[c].types)!=-1)){var d=a.results[c].address_components;for(var b=0;b<d.length;b++){if(($.inArray("locality",d[b].types)!=-1)&&($.inArray("political",d[b].types)!=-1)){return d[b].long_name;}}}}return e;},renderPageElements:function(s){Framework.offerFingerprint();var h=null;var l=null;if(s.lastLoginLocationReply!=null){var j=s.lastLoginLocationReply.lastGeocodingResponse;var p=null;if(typeof String.prototype.startsWith!="function"){String.prototype.startsWith=function(t){return this.indexOf(t)===0;};}if(j!=undefined&&j!=null&&!j.startsWith("{")){p=j;}else{if((j!=undefined)&&(j!=null)){p=this.getCity(JSON.parse(j));}}j=null;var r=s.lastLoginLocationReply.lastLoginTs;if((r!=undefined)&&(r!=null)){r=$().dateParserWithoutTimezone(r);}h=resolve("bankingapp_brd_function_homescreen_greeting"+new Date().getHours(),{"0":s.trusteeName});l=resolve("bankingapp_brd_function_homescreen_lastlogin_na");if((p!=undefined)&&(p!=null)&&(r!=undefined)&&(r!=null)){l=resolve("bankingapp_brd_function_homescreen_lastlogin",{time:r.dateFormat(resolve("bankingapp_common_dateFormatPattern")),location:p});}else{if((r!=undefined)&&(r!=null)){l=resolve("bankingapp_brd_function_homescreen_lastlogin_time",{time:r.dateFormat(resolve("bankingapp_common_dateFormatPattern"))});}}$("#homeScreenWelcomeMessageContainer").remove();var f=$("<div>",{id:"homeScreenWelcomeMessageContainer","class":"homeScreenWelcomeMessageContainer"}).insertBefore("#content");f.append(new Bankingapp.ui.MessageBlock([{title:h,details:l}],{baseClass:"infoblock greeting"}));setSessionAttribute("HOMESCREEN_WELCOME_MESSAGE_DISPLAYED",true);}setSessionAttribute("HOMESCREEN_INFORMATION",s);if(this.amountchart){this.amountChart.refreshChart({minAmount:s.minimumLimit,maxAmount:s.maximumLimit,actualAmount:s.favoriteAccountBalance});}else{try{this.amountchart=$("<div>",{id:"amount_chart","class":"amount_chart"});$("#homeScreenMainContainer").append(this.amountchart);var b=$('<div id="amount_chart_edit" class="amount_chart_edit"></div>');this.amountChart=new Bankingapp.ui.AmountChart({containerId:"amount_chart",editImageObject:b,duration:5000});this.amountChartEditImage=$("#amount_chart_edit");this.amountChartEditImage.bind("click",$.proxy(this.editClickHandler,this));this.amountChart.refreshChart({minAmount:s.minimumLimit,maxAmount:s.maximumLimit,actualAmount:s.favoriteAccountBalance});}catch(c){debugLog(c);}}if(this.favoriteBalanceContainer){if($.isNumeric(s.favoriteAccountBalance)){this.favoriteBalanceContainer.find(".favoriteBalanceContainerCellContentLeft").text(s.favoriteAccountCurrency);this.favoriteBalanceContainer.find(".favoriteBalanceContainerCellContentRight").text($().amountFormatter(s.favoriteAccountBalance,resolve(this.amountFormatKey)));}else{this.favoriteBalanceContainer.find(".favoriteBalanceContainerCellContentLeft").text("");this.favoriteBalanceContainer.find(".favoriteBalanceContainerCellContentRight").text("");}}else{this.favoriteBalanceContainer=$("<div>",{"class":"favoriteBalanceContainer"});var k=$("<div>",{"class":"favoriteBalanceContainerRow"});var n=$("<div>",{"class":"favoriteBalanceContainerCell"});if($.isNumeric(s.favoriteAccountBalance)){n.append($("<div>",{"class":"favoriteBalanceContainerCellContentLeft"}).append(s.favoriteAccountCurrency));n.append($("<div>",{"class":"favoriteBalanceContainerCellContentRight"}).append($().amountFormatter(s.favoriteAccountBalance,resolve(this.amountFormatKey))));}else{n.append($("<div>",{"class":"favoriteBalanceContainerCellContentLeft"}).append(""));n.append($("<div>",{"class":"favoriteBalanceContainerCellContentRight"}).append(""));}k.append(n);this.favoriteBalanceContainer.append(k);$("#homeScreenMainContainer").append(this.favoriteBalanceContainer);}this.mailboxButtonContainer=$("<div>",{id:"mailboxButtonContainer"});$("#homeScreenMainContainer").append(this.mailboxButtonContainer);if(!this.buttonBringYourMoney){this.buttonBringYourMoney=new Bankingapp.ui.LandingPageButton(resolve("bankingapp_brd_function_homescreen_bringyourmoneybutton_title"),{"class":"bringYourMoneyButton-home",authorizationId:"bring_your_money/view"});this.buttonBringYourMoney.bind("buttonClick",$.proxy(this.bringYourMoneyButtonClickHandler,this));$("#homeScreenMainContainer").append(this.buttonBringYourMoney);}var e={GetCustomerMessagesRequest:{OnlyFeeds:"true",CategoryTypeId:this.feedCategoryTypeArray}};var m=isLoggedIn().valueOf();if(!m){e.GetCustomerMessagesRequest.OnlyPublic="true";}var q=getSessionAttribute("CURRENT_CUSTOMER").id;var d=getSessionAttribute("CURRENT_TRUSTEE").id;debugLog("XXXX customer "+q+" trustee "+d);callService("/feed/getInboxFeedMessages",e,Bankingapp.framework.Application.proxy(this.handleResult,this,false),m?"PRIVATE_BANK_FEED_LIST_"+q+"_"+d:"PUBLIC_BANK_FEED_LIST");hideLoadingPopup();var g=getSessionAttribute("HOMESCREEN_ZEROLIMIT_MESSAGE_DISPLAYED");g=g!=null?g.valueOf():false;if(s.minimumLimit==0&&s.maximumLimit==0){$("#amount_chart_arrow").hide();if(g===false||g=="false"){Bankingapp.framework.Application.showConfirmation(resolve("bankingapp_brd_function_homescreen_zerolimit"),new Boolean(0),$.proxy(this.zeroLimitCallback,this));setSessionAttribute("HOMESCREEN_ZEROLIMIT_MESSAGE_DISPLAYED",true);}}else{$("#amount_chart_arrow").show();}var o=$("#content").width();var i=$("#amount_chart").width();if(o<i){var a=(o/i)*100;$("#amount_chart").css("zoom",a+"%");}else{$("#amount_chart").css("zoom","100%");}},zeroLimitCallback:function(a,b){setSessionAttribute("HOMESCREEN_ZEROLIMIT_MESSAGE_DISPLAYED",true);if(a.valueOf()){loadView("view://brd/bankingapp/function/accountinfo/favoriteaccount",null);}},editClickHandler:function(a){loadView("view://brd/bankingapp/function/accountinfo/favoriteaccount",null);},bankFeedButtonHandler:function(){this.clearFunctionScope();loadView("view://brd/bankingapp/function/bankfeed/bankfeedlist",null);},clearFunctionScope:function(){var a=getFunctionAttributeNames();if(a){for(var b=0;b<a.length;b++){removeFunctionAttribute(a[b]);}}},onContextMenuItemPressed:function(){debugLog("homescreen context menu item pressed");},isAuthorized:function(){return Bankingapp.framework.Application.isAuthorized("homescreen/view");},bringYourMoneyButtonClickHandler:function(b,a){debugLog("bringYourMoneyButtonClickHandler ...");loadView("view://brd/bankingapp/function/receivemoney/bringyourmoney/targetaccountselection");}});Bankingapp.framework.Application.setView(Bankingapp.functions.homescreen.HomeScreen);