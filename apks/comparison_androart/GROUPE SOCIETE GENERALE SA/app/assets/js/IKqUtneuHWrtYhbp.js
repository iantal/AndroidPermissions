Class.ns("Bankingapp.ui");Bankingapp.ui.BrdSignBlock=Class.extend(Bankingapp.ui.Component,{baseClass:"signBlock",signPasswordResourceKey:"bankingapp_component_signblock_signpassword",tokenResourceKey:"bankingapp_component_signblock_token",requestTokenButtonResourceKey:"bankingapp_component_signblock_requesttokenbutton",tokenSubmitResourceKey:"bankingapp_component_signblock_submit",submitButtonResourceKey:"bankingapp_component_signblock_submit",SIGNMODE_PASSWORD:"PASSWORD",SIGNMODE_TOKEN:"TOKEN",challenge:null,signMode:null,form:null,inputField:null,isSubmitable:true,TOKEN_REQUEST_CANCELLED:"tokenRequestCancelled",isFingerprint:false,fingerprintDisabled:false,constructor:function(d){var b=this.applyConfig(d);var a={id:b&&b.id?b.id:this.id,"class":this.baseClass+(b&&b["class"]?(" "+b["class"]):"")};if((this.signMode==undefined)||(this.signMode==null)){var c=getApplicationOption("IS_TOKEN_ACTIVATED");if((c!=undefined)&&(c!=null)&&c.valueOf()){this.signMode=this.SIGNMODE_TOKEN;}else{this.signMode=this.SIGNMODE_PASSWORD;}}Bankingapp.framework.Application.bind("onTokenReceived",$.proxy(this.onTokenReceived,this));Bankingapp.ui.BrdSignBlock.superclass.constructor.call(this,"<div>",a);this.render();},render:function(){this.form=new Bankingapp.ui.Form({id:"signForm"});this.append(this.form);if((this.signMode!=undefined)&&(this.signMode!=null)){if(this.signMode==this.SIGNMODE_TOKEN){this.renderSubmitButton(this.requestTokenButtonResourceKey,$.proxy(this.requestTokenButtonClickHandler,this));}else{if(this.signMode==this.SIGNMODE_PASSWORD){this.renderInputField(this.signPasswordResourceKey);this.renderSubmitButton(this.submitButtonResourceKey,$.proxy(this.submitHandler,this));}}}else{this.renderSubmitButton(this.submitButtonResourceKey,$.proxy(this.submitHandler,this));}},renderInputField:function(b,d){var c=$("<div>",{"class":"groupcontainer"});var a={type:"password",validation:{required:true,whitelist:false},"class":this.baseInputClass};$.extend(a,d);this.inputField=new Bankingapp.ui.InputField(resolve(b),a);c.append(this.inputField);this.form.append(c);},renderSubmitButton:function(a,b){this.submitButton=new Bankingapp.ui.SubmitButton(resolve(a));this.form.append(this.submitButton);this.form.unbind("formSubmit");this.form.bind("formSubmit",b);},requestTokenButtonClickHandler:function(){if(this.isSubmitable){this.isSubmitable=false;this.submitButton.disable();requestToken(this.challenge,this.fingerprintDisabled);this.submitButton.enable();}},onTokenReceived:function(b,a){this.isSubmitable=true;if(a.token!=""&&a.token!=null&&a.token!=undefined&&a.token!=this.TOKEN_REQUEST_CANCELLED){this.isFingerprint=a.isFingerprint;this.submitButton.remove();this.renderInputField(this.tokenResourceKey,{disabled:true,value:a.token});this.renderSubmitButton(this.tokenSubmitResourceKey,$.proxy(this.submitHandler,this));this.trigger("formSubmitted");}},submitHandler:function(){this.trigger("formSubmitted");},getCredential:function(){var a=null;if((this.inputField!=undefined)&&(this.inputField!=null)){a=this.inputField.val();}return a;},getIsFingerprint:function(){return this.isFingerprint;}});