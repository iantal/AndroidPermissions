Class.ns("Bankingapp.functions.loans");$().loadJavaScript("/js/Qjq5X1yOr8BbyH8t.js");Bankingapp.functions.loans.Loans=Class.extend(Bankingapp.framework.View,{container:null,layoutRender:function(){Bankingapp.framework.Application.bind("onResume",$.proxy(this.onResume,this));Bankingapp.framework.Application.bind("onContextMenuItemPressed",$.proxy(this.onContextMenuItemPressed,this));this.loanListAuth=this.isAuthorizedToList();this.container=$("<div>",{id:"loansMainContainer","class":"list maincontainer"});return this.container;},onResume:function(){var a=getFunctionAttribute("REFRESH_ACCOUNT_DETAILS");if((a!=undefined)&&(a!=null)){this.refreshLists(getFunctionAttribute("ACCOUNT_DETAILS"));removeFunctionAttribute("REFRESH_ACCOUNT_DETAILS");}},run:function(){if(this.loanListAuth===true){setFunctionAttribute("details_view","view://brd/bankingapp/function/loans/detail/accountcontentpage");Bankingapp.framework.Application.callService("/account/getLoanAccounts",{AccountListRequest:{FunctionType:16}},$.proxy(this.handleListResult,this));}},handleListResult:function(a){setFunctionAttribute("LOANINITFILTERDATE",a.loanInitFilterDate);console.log(a);this.containerLoanList=$("<div>",{id:"loanListContainer","class":"list maincontainer"});this.containerRevolvingList=$("<div>",{id:"revolvingListContainer","class":"list maincontainer"});this.loanMainLabelContainer=$("<div>",{id:"loanMainLabelContainer"});this.loanMainLabel=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_loans_list_loanlist_mainlabel"),{"class":"separator"});this.loanMainLabelContainer.append(this.loanMainLabel);this.container.append(this.loanMainLabelContainer);this.loanListLabel=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_loans_list_loanlist_title"),{"class":"listtitle"});this.loanList=new Bankingapp.ui.List({baseClass:"list",listData:[],itemRenderer:Bankingapp.ui.LoanListItem,noresultKey:"bankingapp_brd_function_loans_list_loanlist_empty",activeProperty:true,itemConfig:{baseClass:"accountListItem",loanIdField:"accountNumber",loanFriendlyNameField:"accountName",loanTypeField:"accountType",loanAvailableBalanceField:"loanAvailableBalance",loanBookedBalance:"loanBookedBalance",loanCreditType:"loanCreditType",loanCurrencyField:"currency"}});this.loanList.bind("itemClick",$.proxy(this.clickHandler,this));this.containerLoanList.append(this.loanListLabel);this.containerLoanList.append(this.loanList);this.container.append(this.containerLoanList);this.revolvingListLabel=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_loans_list_revolvinglist_title"),{"class":"listtitle"});this.revolvingList=new Bankingapp.ui.List({baseClass:"list",listData:[],itemRenderer:Bankingapp.ui.LoanListItem,noresultKey:"bankingapp_brd_function_loans_list_revolvinglist_empty",activeProperty:true,itemConfig:{baseClass:"accountListItem",loanIdField:"accountNumber",loanFriendlyNameField:"accountName",loanTypeField:"accountType",loanAvailableBalanceField:"loanAvailableBalance",loanBookedBalance:"loanBookedBalance",loanCreditType:"loanCreditType",loanCurrencyField:"currency"}});this.revolvingList.bind("itemClick",$.proxy(this.clickHandler,this));this.containerRevolvingList.append(this.revolvingListLabel);this.containerRevolvingList.append(this.revolvingList);this.container.append(this.containerRevolvingList);this.refreshLists(a.loanAccount);hideLoadingPopup();},clickHandler:function(b,a){this.loanList.unbind("itemClick");this.loanList.bind("itemClick",$.proxy(this.clickHandler,this));this.revolvingList.unbind("itemClick");this.revolvingList.bind("itemClick",$.proxy(this.clickHandler,this));removeFunctionAttribute("ACCOUNT_DETAILS");setFunctionAttribute("loan",a);loadView("view://brd/bankingapp/function/loans/detail/statementcontentpage",{loan:a});},onContextMenuItemPressed:function(b,a){if(a=="account_list_edit"){setFunctionAttribute("FAVORITE_SETTINGS_BUTTON","invisible");loadView("view://bankingapp/function/accountinfo/editaccountlist",null);}},refreshLists:function(d){this.loanList.empty();this.revolvingList.empty();var a=[];var b=[];for(var c in d){if(d[c].loanCreditType=="LOAN"){a.push(d[c]);}else{b.push(d[c]);}}this.loanList.appendItems(a);if(this.loanList.isEmpty()){$("#loanMainLabelContainer").hide();}this.revolvingList.appendItems(b);if(this.revolvingList.isEmpty()){$("#revolvingListContainer").hide();}setFunctionAttribute("ACCOUNT_DETAILS",d);},isAuthorizedToList:function(){return Bankingapp.framework.Application.isAuthorized("loanlist/view");}});Bankingapp.framework.Application.setView(Bankingapp.functions.loans.Loans);