$().loadJavaScript("/js/yjuDMlY6mIjPXsqj.js");Class.ns("Bankingapp.functions.bankfeed");Bankingapp.functions.bankfeed.BankFeedDetails=Class.extend(Bankingapp.functions.bankfeed.BankFeedBase,{container:null,button:null,targetView:null,selectedBankFeedItem:null,validInternalLinks:null,layoutRender:function(){console.log("item",getFunctionAttribute("SELECTED_BANKFEEDITEM"));Bankingapp.framework.Application.bind("onContextMenuItemPressed",$.proxy(this.onContextMenuItemPressed,this));this.selectedBankFeedItem=getFunctionAttribute("SELECTED_BANKFEEDITEM");this.container=$("<div>",{id:"bankFeedDetailsMainContainer","class":"maincontainer"});this.validInternalLinks=null;this.initValidInternalLinks();if((this.selectedBankFeedItem.categoryTypeId==1)||(this.selectedBankFeedItem.categoryTypeId==2)||(this.selectedBankFeedItem.categoryTypeId==7)||(this.selectedBankFeedItem.categoryTypeId==8)||(this.selectedBankFeedItem.categoryTypeId==9)||(this.selectedBankFeedItem.categoryTypeId==10)||(this.selectedBankFeedItem.categoryTypeId==11)||(this.selectedBankFeedItem.categoryTypeId==12)){if((this.selectedBankFeedItem.messageImageId!=undefined)&&(this.selectedBankFeedItem.messageImageId!=null)&&(this.selectedBankFeedItem.messageImageId!="")){Bankingapp.framework.Application.bind("onResume",$.proxy(this.onResume,this));}else{this.container.empty();var a=this.selectedBankFeedItem.messageContent;a=a.replace(/target=\"_blank\"/g,"");a=a.replace(/href=\"/g,"onClick=\"openBrowser('");a=a.replace(/(onClick="[^\"]+)(")/g,'$1\')" href="#"');this.contentDiv=$("<div>",{"class":"feedContent"}).append(a);if(new String(getDeviceInformation().os).toLowerCase()!="ios"&&this.selectedBankFeedItem.categoryTypeId==2){this.contentDiv=$("<div>",{"class":"feedContent",style:"zoom: 140%"}).append(a);}this.container.append(this.createTitleDiv());this.container.append(this.contentDiv);if((this.selectedBankFeedItem.messageExternalLinkText!=undefined)&&(this.selectedBankFeedItem.messageExternalLinkText!=null)&&(this.selectedBankFeedItem.messageExternalLinkText!="")){this.addExternalLink(this.selectedBankFeedItem.messageExternalLinkText,this.selectedBankFeedItem.messageExternalLinkUrl);}if((this.selectedBankFeedItem.messageInternalLinkText!=undefined)&&(this.selectedBankFeedItem.messageInternalLinkText!=null)&&(this.selectedBankFeedItem.messageInternalLinkText!="")){this.addInternalLink(this.selectedBankFeedItem.messageInternalLinkText,this.selectedBankFeedItem.messageInternalLinkUrl);}}}return this.container;},createTitleDiv:function(){var d=$("<div>",{"class":"bankFeedDetailsTitleSection"});var f=$("<img>");f.attr({src:$().getImagesFolder()+"bankfeed_categoryid_"+this.selectedBankFeedItem.categoryTypeId+".png"});var e=$("<div>",{"class":"bankFeedDetailsTitleIconSection"}).append(f);var b=$("<div>",{"class":"bankFeedDetailsTitleTextSection"});var a=$("<div>",{"class":"bankFeedDetailsTitleSubjectSection"});a.append(this.selectedBankFeedItem.subject);var g=$("<div>",{"class":"bankFeedDetailsTitleTimestampSection"});var c=this.selectedBankFeedItem.createTs;c=$().dateParserWithoutTimezone(c);c=c.dateFormat(resolve("bankingapp_common_dateFormatPattern"));g.append("Sent at: "+getFunctionAttribute("DayText")+", "+c);d.append(e);b.append(a);b.append(g);d.append(b);return d;},onResume:function(){this.container.empty();this.container.append(this.createTitleDiv());showLoadingPopup();this.getImage();},getImage:function(){var a={GetImageRequest:{ImageId:this.selectedBankFeedItem.messageImageId,Dpi:getDeviceInformation().dpi}};Bankingapp.framework.Application.callService("/feed/getImage",a,$.proxy(this.getImageResult,this));},getImageResult:function(c){var b=$("<img>",{src:c.image});var a=$("<div>",{align:"center"}).append(b);this.container.append(a);var e=this.selectedBankFeedItem.messageContent;e=e.replace(/target=\"_blank\"/g,"");e=e.replace(/href=\"/g,"onClick=\"openBrowser('");e=e.replace(/(onClick="[^\"]+)(")/g,'$1\')" href="#"');var d=$("<div>").append(e);this.container.append(d);if((this.selectedBankFeedItem.messageExternalLinkText!=undefined)&&(this.selectedBankFeedItem.messageExternalLinkText!=null)&&(this.selectedBankFeedItem.messageExternalLinkText!="")){this.addExternalLink(this.selectedBankFeedItem.messageExternalLinkText,this.selectedBankFeedItem.messageExternalLinkUrl);}if((this.selectedBankFeedItem.messageInternalLinkText!=undefined)&&(this.selectedBankFeedItem.messageInternalLinkText!=null)&&(this.selectedBankFeedItem.messageInternalLinkText!="")){this.addInternalLink(this.selectedBankFeedItem.messageInternalLinkText,this.selectedBankFeedItem.messageInternalLinkUrl);}hideLoadingPopup();},addExternalLink:function(d,c){var b=$("<a>",{href:"#",onClick:"openBrowser('"+c+"')"});b.append(d);var a=$("<div>",{align:"left"}).append(b);this.container.append(a);},addInternalLink:function(d,c){if(this.validInternalLinks.indexOf(this.selectedBankFeedItem.messageInternalLinkUrl)!=-1){var a=$("<a>",{href:"#",onClick:"loadView('view://"+c+"')"});a.append(d);var b=$("<div>",{align:"left"}).append(a);this.container.append(b);}else{var a=$("<a>",{href:"#",onClick:"showError('"+resolve("bankingapp_brd_function_bankfeed_invalid_url_error")+"')"});a.append(d);var b=$("<div>",{align:"left"}).append(a);this.container.append(b);}},onContextMenuItemPressed:function(b,a){if(a=="delete_internal_message"){Bankingapp.framework.Application.showConfirmation(resolve("bankingapp_function_bankfeed_deletemessage_confirmation"),new Boolean(0),$.proxy(this.handleConfirmationResult,this));}},handleConfirmationResult:function(a){if(a.valueOf()){var b={DeleteMessageRequest:{MessageIdList:[this.selectedBankFeedItem.messageId],SubjectList:[this.selectedBankFeedItem.subject],Store:"INBOX"}};Bankingapp.framework.Application.callService("/feed/deleteMessage",b,$.proxy(this.handleDeleteServiceCallResult,this));}},handleDeleteServiceCallResult:function(a){goToPreviousView();},initValidInternalLinks:function(){this.validInternalLinks=["brd/bankingapp/function/homescreen/homescreen","brd/bankingapp/function/finances/finances","brd/bankingapp/function/payments/payments","bankingapp/function/support/support","brd/bankingapp/function/accountinfo/accountinfo","brd/bankingapp/function/deposits/list/deposits","brd/bankingapp/function/loans/list/loans","brd/bankingapp/function/transferfunds/landingpage","brd/bankingapp/function/receivemoney/landingpage","brd/bankingapp/function/transactionhistory/list/transactionhistorylist","brd/bankingapp/function/contacts/contacts","brd/bankingapp/function/interestrate/interestrate","brd/bankingapp/function/loancalculator/legaldisclaimer","brd/bankingapp/function/productinformation/productinformation","bankingapp/function/fxrates/fxrates"];}});Bankingapp.framework.Application.setView(Bankingapp.functions.bankfeed.BankFeedDetails);