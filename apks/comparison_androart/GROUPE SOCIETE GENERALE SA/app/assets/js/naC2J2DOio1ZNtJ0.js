$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");$().loadJavaScript("/js/L3tNtvc7sTpdNuGu.js");$().loadJavaScript("/js/keLuT3DzbF76k58Z.js");$().loadJavaScript("/js/K9qGeq007441mwsA.js");Class.ns("Bankingapp.functions.billpayment.barcode");Bankingapp.functions.billpayment.barcode.AddDetails=Class.extend(Bankingapp.framework.View,{showProgressIndicator:true,progressIndicatorStepCount:5,progressIndicatorCurrentStep:2,container:null,form:null,formId:"billPaymentForm",formClass:"transfer-details-form",groupContainerClass:"groupcontainer",displayDateFormat:resolve("bankingapp_brd_function_billpayment_barcode_dateformat"),filterDateFormat:resolve("bankingapp_common_parsedatepattern_withouttime"),billPaymentAmount:null,billPaymentDate:null,billPaymentDateValue:new Date(),billPaymentReferenceNumber:null,billPaymentFieldList:null,billPaymentFieldObjectMap:{},formData:null,barcoding:null,layoutRender:function(){Bankingapp.framework.Application.bind("onContextMenuItemPressed",$.proxy(this.onContextMenuItemPressed,this));this.formData=getFunctionAttribute(Functions.transferfunds.TransferUtils.BILLPAYMENTRANSFER_FORMDATA);if((this.formData===undefined)||(this.formData===null)){this.formData={};}this.container=$("<div>",{id:"addDetailsMainContainer","class":"list maincontainer"});if(this.showProgressIndicator){this.container.append(new Bankingapp.ui.ProgressIndicator(this.progressIndicatorStepCount,this.progressIndicatorCurrentStep));}return this.container;},run:function(){Bankingapp.framework.Application.unBind("onErrorMessageReceived");$("body").bind("onErrorMessageReceived",$.proxy(this.errorMessageHandler,this));var a=getFunctionAttribute("BILLPAYMENT_SUBAGENTID");debugLog("BILLPAYMENT_SUBAGENTID",a);var b={GetBillPaymentDetailsInfoRequest:{BillerSubAgentId:a}};Bankingapp.framework.Application.callService("/billpayment/getPaymentDetailsInfo",b,$.proxy(this.handleGetBillPaymentDetailsInfoResult,this));},initResult:function(a){debugLog(a);},handleGetBillPaymentDetailsInfoResult:function(a){debugLog("handleGetBillPaymentDetailsInfoResult",a);this.billPaymentFieldList=a.billPaymentFieldList.billPaymentFieldItem;this.barcoding=a.billPaymentBarcodeSetting.barcoding;if(a.billPaymentBarcodeSetting.barcodeEnabled==true){this.scanBarcodeButton=new Bankingapp.ui.SubmitButton(resolve("bankingapp_brd_function_billpayment_barcode_scanbarcodebutton_title"),{id:"scanBarcodeButton","class":"scanBarcodeButton"});this.scanBarcodeButton.bind("buttonClick",$.proxy(this.scanBarcodeHandler,this));this.container.append(this.scanBarcodeButton);this.browseBarcodeButton=new Bankingapp.ui.SubmitButton(resolve("bankingapp_brd_function_billpayment_barcode_browsebarcodebutton_title"),{id:"scanBarcodeButton","class":"scanBarcodeButton"});this.browseBarcodeButton.bind("buttonClick",$.proxy(this.browseBarcodeHandler,this));this.container.append(this.browseBarcodeButton);}else{this.barcodeDisabledLabel=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_billpayment_barcode_barcodedisabled"),{"class":"pagetitle separator textcenter"});this.container.append(this.barcodeDisabledLabel);}this.furtherDetailsLabel=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_billpayment_barcode_furtherdetails"),{"class":"pagetitle separator textcenter"});this.container.append(this.furtherDetailsLabel);this.form=new Bankingapp.ui.Form({id:this.formId,submitHandler:$.proxy(this.submitHandler,this),businessValidationHandler:$.proxy(this.businessValidator,this),"class":this.formClass});this.groupContainer=$("<div>",{"class":this.groupContainerClass});this.form.append(this.groupContainer);this.container.append(this.form);this.renderForm(a);},renderForm:function(a){this.billPaymentCurrency=new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_billpayment_barcode_currency"),getFunctionAttribute("BILLPAYMENT_SOURCEACCOUNT").currency);this.groupContainer.append(this.billPaymentCurrency);this.billPaymentAmount=new Bankingapp.ui.InputField(resolve("bankingapp_brd_function_billpayment_barcode_amount"),{id:"billPaymentAmount",name:"billPaymentAmount",type:Functions.transferfunds.TransferUtils.getAmountInputFieldType(),value:(this.formData.forecastRequest==undefined?"":this.formData.forecastRequest.amount),inputMaskPattern:/[\d.]/,validation:{required:true,whitelist:false,min:0,max:999999999999,number:true}});this.groupContainer.append(this.billPaymentAmount);var d=$().dateParserWithoutTimezone(this.billPaymentDateValue).dateFormat(this.displayDateFormat);this.billPaymentDate=new Bankingapp.ui.ComplexButton([d],{id:"billPaymentDate","class":"calendar"});this.billPaymentDate.bind("buttonClick",$.proxy(this.billPaymentDateClickHandler,this));this.groupContainer.append(new Bankingapp.ui.LabeledComponent({labelText:(resolve("bankingapp_brd_function_billpayment_barcode_date")+resolve("bankingapp_component_inputfield_requiredsign")),valueComponent:this.billPaymentDate}));if(Functions.transferfunds.TransferUtils.isCorporateUser()){this.billPaymentReferenceNumber=new Bankingapp.ui.InputField(resolve("bankingapp_brd_function_billpayment_barcode_refnumber"),{id:"billPaymentReferenceNumber",name:"billPaymentReferenceNumber",type:"text",value:(this.formData.forecastRequest==undefined?"":this.formData.forecastRequest.referenceNumber),validation:{required:Functions.transferfunds.TransferUtils.isCorporateUser(),maxlength:Functions.transferfunds.TransferUtils.REFERENCE_FIELD_MAXLENGTH}});this.groupContainer.append(this.billPaymentReferenceNumber);}this.billPaymentFieldsLabel=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_billpayment_fillfields_label"),{"class":"pagetitle separator textcenter"});this.form.append(this.billPaymentFieldsLabel);this.groupContainerField=$("<div>",{"class":this.groupContainerClass});this.form.append(this.groupContainerField);for(var c in this.billPaymentFieldList){var b=new Bankingapp.ui.InputField(this.billPaymentFieldList[c].fieldName,{id:"billPaymentField"+this.billPaymentFieldList[c].fieldSequence,name:"billPaymentField"+this.billPaymentFieldList[c].fieldSequence,type:"text",value:(this.formData.forecastRequest==undefined?"":this.formData.forecastRequest.fieldList.fieldItem[this.billPaymentFieldList[c].fieldSequence-1].value),validation:{required:this.billPaymentFieldList[c].fieldMandatory,maxlength:this.billPaymentFieldList[c].fieldLength,whitelist:false},hint:(this.billPaymentFieldList[c].fieldHint===null?"":this.billPaymentFieldList[c].fieldHint)},null,{fieldTypeId:this.billPaymentFieldList[c].fieldTypeId});this.billPaymentFieldObjectMap[this.billPaymentFieldList[c].fieldSequence]=b;this.groupContainerField.append(b);}this.billPaymentSubmitButton=new Bankingapp.ui.SubmitButton(resolve("bankingapp_brd_function_billpayment_form_continue"),{"class":"continue"});this.form.append(this.billPaymentSubmitButton);},billPaymentDateClickHandler:function(b,a){showDatePicker(Bankingapp.framework.Application.proxy(this.afterDatePickerHandler,this,true));},afterDatePickerHandler:function(a){this.billPaymentDateValue=a;$("#billPaymentDate").find(".row0").text(a.dateFormat(this.displayDateFormat));},scanBarcodeHandler:function(b,c){debugLog("scan a barcode pressed");var a={barcodeTypes:[this.barcoding],callback:Bankingapp.framework.Application.proxy(this.handleBarcodeScanning,this,true)};showBarcodeReader(a);},browseBarcodeHandler:function(b,c){debugLog("browse for a barcode pressed");var a={barcodeTypes:[this.barcoding],callback:Bankingapp.framework.Application.proxy(this.handleBarcodeScanning,this,true)};showBarcodeBrowser(a);},handleBarcodeScanning:function(a){var b={BillPaymentValidateBarcodeRequest:{subAgentId:getFunctionAttribute("BILLPAYMENT_SUBAGENTID"),barcode:a.value}};debugLog("calling service");Bankingapp.framework.Application.callService("/billpaymenttransfer/validateBarcode",b,$.proxy(this.handleBarcodeValidationResult,this));},handleBarcodeValidationResult:function(a){debugLog("handleBarcodeValidationResult");debugLog(a);if(a.barcodeFieldItem!=null){debugLog("result.barcodeFieldItem");for(var b in a.barcodeFieldItem){this.billPaymentFieldObjectMap[a.barcodeFieldItem[b].fieldSequence].input.removeHint();this.billPaymentFieldObjectMap[a.barcodeFieldItem[b].fieldSequence].setValue(a.barcodeFieldItem[b].fieldValue);}}if(a.billPaymentAmount!=null){debugLog("parsed double: "+parseFloat(a.billPaymentAmount));this.billPaymentAmount.setValue(a.billPaymentAmount);}},businessValidator:function(){var k=[];var j=this.billPaymentCurrency.getValue();if(j==null||j==""){k.push(resolve("bankingapp_brd_function_billpayment_details_currencyerror"));}var e=this.billPaymentAmount.val();if(!$.isNumeric(e)){k.push(resolve("bankingapp_brd_function_billpayment_details_amounterror"));}var m=$().dateParserWithoutTime(this.billPaymentDateValue);var h=$().dateParserWithoutTime(new Date());h=$().setTimeOfDate(h,0,0,0,0);if(m.getTime()<h.getTime()){k.push(resolve("bankingapp_brd_function_billpayment_details_valuedateerror"));}var g=getFunctionAttribute("BILLPAYMENT_SOURCEACCOUNTS").maxPaymentDate;if(g>0){var h=new Date();var a=new Date();a.setDate(h.getDate()+g);if(a.getTime()<m.getTime()){k.push(resolve("bankingapp_brd_function_billpayment_maxvaluedate_error",{"0":g}));}}var l=this.billPaymentReferenceNumber;if(l!=undefined||l!=null){var c=this.billPaymentReferenceNumber.val();if((c!=null)&&(c!=undefined)&&(c!="")&&!$.isNumeric(c)){k.push(resolve("bankingapp_brd_function_billpayment_details_referencenumbererror"));}}for(var d in this.billPaymentFieldObjectMap){var b=this.billPaymentFieldObjectMap[d].val();if(this.billPaymentFieldObjectMap[d].containerConfig.fieldTypeId==1){if(!$.isNumeric(b)){k.push(this.billPaymentFieldObjectMap[d].labelText+resolve("bankingapp_brd_function_billpayment_details_numericerror"));}}else{if(this.billPaymentFieldObjectMap[d].containerConfig.fieldTypeId==2){if($.isNumeric(b)){k.push(this.billPaymentFieldObjectMap[d].labelText+resolve("bankingapp_brd_function_billpayment_details_alphanumericerror"));}}}}if(k.length==0){return true;}else{var f="";for(var d in k){f=f+"\n"+k[d];}k=[];showError(f);return false;}},submitHandler:function(){this.formData.forecastRequest={amount:this.billPaymentAmount.val(),sourceAccount:getFunctionAttribute("BILLPAYMENT_SOURCEACCOUNT").accountNumber,valueDate:$().formatDateForRequest(this.billPaymentDateValue),subAgentId:getFunctionAttribute("BILLPAYMENT_SUBAGENTID")};if(this.billPaymentReferenceNumber!=null&&this.billPaymentReferenceNumber.val()!=""){$.extend(this.formData.forecastRequest,{referenceNumber:this.billPaymentReferenceNumber.val()});}var a=[];for(var c in this.billPaymentFieldObjectMap){var e={};e.labelText=this.billPaymentFieldObjectMap[c].labelText;e.sequence=c;e.value=this.billPaymentFieldObjectMap[c].val();a.push(e);}var b={};b.fieldItem=a;this.formData.forecastRequest["fieldList"]=b;setFunctionAttribute(Functions.transferfunds.TransferUtils.BILLPAYMENTRANSFER_FORMDATA,this.formData);setFunctionAttribute(Functions.transferfunds.TransferUtils.BILLPAYMENTRANSFER_FORECAST_REQUEST,this.formData.forecastRequest);debugLog("this.formData");debugLog(this.formData);var d={BillPaymentRequest:getFunctionAttribute(Functions.transferfunds.TransferUtils.BILLPAYMENTRANSFER_FORECAST_REQUEST)};removeSessionAttribute(Functions.transactionhistory.TransactionHistoryUtil.IMMEDIATE_SEARCH);Bankingapp.framework.Application.callService("/billpaymenttransfer/forecast",d,$.proxy(this.handleForecastRequest,this));},handleForecastRequest:function(a){debugLog("forecast result");debugLog(a);setFunctionAttribute(Functions.transferfunds.TransferUtils.BILLPAYMENTRANSFER_FORECAST_REPLY,a);loadView("view://brd/bankingapp/function/billpayment/signpage",null);},errorMessageHandler:function(b,a){Bankingapp.functions.billpayment.BrdBillPaymentServiceMessageHandler.errorMessageHandler(b,a);this.renderAccountList();},onContextMenuItemPressed:function(b,a){if(a=="mark_all_as_read"){var c={};c[Functions.transactionhistory.TransactionHistoryUtil.IMMEDIATE_SEARCH_FREETEXT]=getFunctionAttribute("BILLPAYMENT_SUBAGENTNAME");c[Functions.transactionhistory.TransactionHistoryUtil.IMMEDIATE_SEARCH_TYPE]=[{type:"billPaymentTransactionLifeCycle",name:"Bill Payment"}];setSessionAttribute(Functions.transactionhistory.TransactionHistoryUtil.IMMEDIATE_SEARCH,c);loadView("view://brd/bankingapp/function/transactionhistory/list/transactionhistorylist",{custom:c});}}});Bankingapp.framework.Application.setView(Bankingapp.functions.billpayment.barcode.AddDetails);