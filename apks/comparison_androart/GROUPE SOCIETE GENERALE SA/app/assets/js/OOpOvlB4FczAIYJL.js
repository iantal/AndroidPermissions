$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");$().loadJavaScript("/js/cNGJpPRjrlEySoCA.js");Class.ns("Bankingapp.functions.transferfunds.bumppayment");Bankingapp.functions.transferfunds.bumppayment.BeneficiaryDetails=Class.extend(Bankingapp.framework.View,{showProgressIndicator:true,progressIndicatorStepCount:Functions.transferfunds.TransferUtils.BUMPRANSFER_STEPCOUNT,progressIndicatorCurrentStep:1,container:null,groupContainer:null,bumpData:null,formData:null,formId:"bumpPaymentForm",formClass:"transfer-details-form",groupContainerClass:"groupcontainer",savePartner:null,savePartnerNameAs:null,beneficiaryDetailsSubmitButton:null,bumpPaymentBeneficiaryName:null,bumpPaymentTargetAccountNumber:null,bumpPaymentTargetAccountCurrency:null,bumpPaymentBeneficiaryAddress:null,layoutRender:function(){if(getFunctionAttribute(Functions.transferfunds.TransferUtils.BUMPRANSFER_FORMDATA)!=null){this.formData=getFunctionAttribute(Functions.transferfunds.TransferUtils.BUMPRANSFER_FORMDATA);}else{this.formData={};}this.bumpData=getFunctionAttribute(Functions.transferfunds.TransferUtils.BUMPRANSFER_BUMPDATA);this.formData.bumpData=this.bumpData;this.container=$("<div>",{id:"addDetailsMainContainer","class":"list maincontainer"});if(this.showProgressIndicator){this.container.append(new Bankingapp.ui.ProgressIndicator(this.progressIndicatorStepCount,this.progressIndicatorCurrentStep));}return this.container;},run:function(){if(getFunctionAttribute("BUMPTRANSFER_TARGETCURRENCIES")==null){Bankingapp.framework.Application.callService("/bumptransfer/getTargetCurrencies",null,$.proxy(this.handleGetTargetCurrencies,this));}else{this.renderForm();}},handleGetTargetCurrencies:function(a){setFunctionAttribute("BUMPTRANSFER_TARGETCURRENCIES",a);this.renderForm();},renderForm:function(){var c=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_bumppayment_beneficiary_details_title"),{"class":"pagetitle separator textcenter"});this.container.append(c);this.form=new Bankingapp.ui.Form({id:this.formId,submitHandler:$.proxy(this.submitHandler,this),businessValidationHandler:$.proxy(this.businessValidator,this),"class":this.formClass});this.groupContainer=$("<div>",{"class":this.groupContainerClass});this.form.append(this.groupContainer);this.container.append(this.form);this.bumpPaymentBeneficiaryName=new Bankingapp.ui.InputField(resolve("bankingapp_brd_function_bumppayment_beneficiary_details_formdata_beneficiaryname"),{id:"bumpPaymentBeneficiaryName",name:"bumpPaymentBeneficiaryName",type:"text",value:(this.formData.forecastRequest==null?this.formData.bumpData.beneficiaryName:this.formData.forecastRequest.beneficiaryName),validation:{required:true,whitelist:false}});this.groupContainer.append(this.bumpPaymentBeneficiaryName);this.bumpPaymentTargetAccountNumber=new Bankingapp.ui.InputField(resolve("bankingapp_brd_function_bumppayment_beneficiary_details_formdata_accountnumber"),{id:"bumpPaymentTargetAccountNumber",name:"bumpPaymentTargetAccountNumber",type:"text",value:(this.formData.forecastRequest==null?this.formData.bumpData.targetAccountNumber:this.formData.forecastRequest.targetAccount),validation:{required:true}});this.groupContainer.append(this.bumpPaymentTargetAccountNumber);var a=getFunctionAttribute("BUMPTRANSFER_TARGETCURRENCIES");this.bumpPaymentTargetAccountCurrency=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_brd_function_bumppayment_beneficiary_details_formdata_currency"),inputRenderer:Bankingapp.ui.SelectButton,inputConfig:{id:"currencySelect",emptyString:resolve("bankingapp_function_domestictransfer_select"),popupName:"Currency",datas:a},baseInputContainerClass:"selectComboContainer combo inputfirst"});if(this.formData.forecastRequest==null){this.bumpPaymentTargetAccountCurrency.setValue(this.formData.bumpData.targetAccountCurrency);}else{this.bumpPaymentTargetAccountCurrency.setValue(this.formData.forecastRequest.currency);}this.groupContainer.append(this.bumpPaymentTargetAccountCurrency);this.bumpPaymentBeneficiaryAddress=new Bankingapp.ui.InputField(resolve("bankingapp_brd_function_bumppayment_beneficiary_details_formdata_address"),{id:"bumpPaymentBeneficiaryAddress",name:"bumpPaymentBeneficiaryAddress",type:"text",value:(this.formData.forecastRequest==null?this.formData.bumpData.beneficiaryAddress:this.formData.forecastRequest.beneficiaryAddress),validation:{required:true,whitelist:false}});this.groupContainer.append(this.bumpPaymentBeneficiaryAddress);var b=(this.formData.forecastRequest==null?false:this.formData.forecastRequest.savePartner);this.savePartner=new Bankingapp.ui.Checkbox({labelText:resolve("bankingapp_brd_function_bumppayment_beneficiary_details_savepartner"),value:b});this.form.append(this.savePartner);this.savePartner.bind("click",$.proxy(this.savePartnerClickHandler,this));this.savePartnerNameAs=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_brd_function_bumppayment_beneficiary_details_savepartneras"),showOptional:false,inputConfig:{id:"bumpPaymentPartnerName",name:"bumpPaymentPartnerName",type:"text",value:(this.formData.forecastRequest==null?"":this.formData.forecastRequest.partnerName),showOptional:false,validation:{maxlength:200,whitelist:false}}});if(!b){this.savePartnerNameAs.hide();}this.savePartnerContainer=$("<div>",{"class":this.groupContainerClass});this.form.append(this.savePartnerContainer);this.savePartnerContainer.append(this.savePartnerNameAs);this.beneficiaryDetailsSubmitButton=new Bankingapp.ui.SubmitButton(resolve("bankingapp_brd_function_bumppayment_beneficiary_details_continue"),{"class":"continue"});this.form.append(this.beneficiaryDetailsSubmitButton);},businessValidator:function(){var e=[];var g=this.bumpPaymentBeneficiaryName.val();var d=/^[0-9a-zA-Z_ -]+$/;if(g==null||g==""||!d.test(g)){e.push(resolve("bankingapp_brd_function_bumppayment_beneficiaryerror"));}var b=this.bumpPaymentTargetAccountCurrency.val();if(b==null||b==""){e.push(resolve("bankingapp_brd_function_bumppayment_currencyerror"));}var a=this.savePartner.val();var h=this.savePartnerNameAs.val();if(a&&(h==null||h=="")){e.push(resolve("bankingapp_brd_function_bumppayment_partnermissingerror"));}else{if(a&&!d.test(h)){e.push(resolve("bankingapp_brd_function_bumppayment_partnernameerror"));}}if(e.length==0){return true;}else{var c="";for(var f in e){c=c+"\n"+e[f];}e=[];showError(c);return false;}},savePartnerClickHandler:function(){if(this.savePartner.val()){this.savePartnerNameAs.show();}else{this.savePartnerNameAs.hide();}},submitHandler:function(){this.formData.forecastRequest={beneficiaryName:this.bumpPaymentBeneficiaryName.val(),beneficiaryAddress:this.bumpPaymentBeneficiaryAddress.val(),targetAccount:this.bumpPaymentTargetAccountNumber.val(),targetAccountCurrency:this.formData.bumpData["targetAccountCurrency"],currency:this.bumpPaymentTargetAccountCurrency.val(),savePartner:this.savePartner.val()};if(this.savePartner.val()){if(!(this.savePartnerNameAs===undefined)&&!(this.savePartnerNameAs===null)&&!(this.savePartnerNameAs.val()=="")){this.formData.forecastRequest["partnerName"]=this.savePartnerNameAs.val();}}console.log("forecast request");console.log(this.formData);setFunctionAttribute(Functions.transferfunds.TransferUtils.BUMPRANSFER_FORMDATA,this.formData);setFunctionAttribute(Functions.transferfunds.TransferUtils.BUMPRANSFER_FORECAST_REQUEST,this.formData.forecastRequest);loadView("view://brd/bankingapp/function/transferfunds/bumppayment/sourceaccountselection",null);}});Bankingapp.framework.Application.setView(Bankingapp.functions.transferfunds.bumppayment.BeneficiaryDetails);