$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");$().loadJavaScript("/js/CF0WiFs1SjIy0Szl.js");$().loadJavaScript("/js/0A4YRnFx1DbUd3zN.js");$().loadJavaScript("/js/AZPz8vN1TNFqZWpw.js");Class.ns("Bankingapp.functions.openaccount");Bankingapp.functions.openaccount.Forecast=Class.extend(Bankingapp.framework.View,{progressIndicatorStepCount:Functions.transferfunds.TransferUtils.OPENACCOUNT_STEPCOUNT_C,progressIndicatorCurrentStep:2,container:null,formData:null,signBlock:null,groupcontainer:null,dateFormatPattern:resolve("bankingapp_common_dateFormatPattern_per"),layoutRender:function(){debugLog("Forecast layoutRender ...");this.transferType=getFunctionAttribute("TransferType");this.formData=getFunctionAttribute(Functions.transferfunds.TransferUtils.OPENACCOUNT_FORMDATA);if(this.formData.initialAmount==undefined){debugLog("progress indicator as current account creation ...");this.progressIndicatorCurrentStep=2;this.progressIndicatorStepCount=Functions.transferfunds.TransferUtils.OPENACCOUNT_STEPCOUNT_C;}else{debugLog("progress indicator as savings account creation ...");this.progressIndicatorCurrentStep=4;this.progressIndicatorStepCount=Functions.transferfunds.TransferUtils.OPENACCOUNT_STEPCOUNT_D;}this.container=$("<div>",{id:"forecastCt","class":"maincontainer transactiondetails"});this.container.append(new Bankingapp.ui.ProgressIndicator(this.progressIndicatorStepCount,this.progressIndicatorCurrentStep));this.groupcontainer=$("<div>",{"class":"paymentdetail groupcontainer"});return this.container;},errorMessageHandler:function(b,a){debugLog("Forecast errorMessageHandler ...");Bankingapp.framework.event.ServiceMessageHandler.errorMessageHandler(b,a);this.signBlock.remove();this.signBlock=new Bankingapp.ui.ManualSignBlock({signMode:Functions.transferfunds.TransferUtils.SIGNMODE,tokenSubmitResourceKey:"bankingapp_function_transferfunds_signtransaction",submitButtonResourceKey:"bankingapp_function_transferfunds_signtransaction"});this.signBlock.bind("formSubmitted",$.proxy(this.submitHandler,this));this.container.append(this.signBlock);},run:function(){debugLog("Forecast run ...");Bankingapp.framework.Application.unBind("onErrorMessageReceived");$("body").bind("onErrorMessageReceived",$.proxy(this.errorMessageHandler,this));Bankingapp.framework.event.BrdServiceMessageHandler.handleMessages();var a=(this.formData.accountTypeName+" ("+this.formData.currency+")");if(this.transferType=="D"){a=(this.formData.accountType.accountTypeName+" ("+this.formData.sourceAccount.currency+")");}this.container.append(new Bankingapp.functions.util.component.TransactionSummary({summaryData:{titleInfo:"",upperTitle:(this.formData.sourceAccount==undefined?"":this.formData.sourceAccount.accountName),upperText:this.formData.sourceAccount==undefined?"":(this.formData.sourceAccount.accountType+" ("+this.formData.sourceAccount.currency+")"),amount:this.formData.initialAmount==undefined?"":-this.formData.initialAmount,currency:this.formData.currency,lowerTitle:(this.formData.friendlyName),lowerText:a,creditDebitFlag:"D"}}));if(this.transferType=="D"){debugLog("Savings account type: "+this.formData.accountType.accountTypeName);this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_openaccount_transferdetails_accounttype"),this.formData.accountType.accountTypeName));this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_openaccount_transferdetails_currency"),this.formData.sourceAccount.currency));}else{this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_openaccount_transferdetails_accounttype"),this.formData.accountTypeName));this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_openaccount_transferdetails_currency"),this.formData.currency));}this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_openaccount_transferdetails_friendlyname"),this.formData.friendlyName));if(this.transferType=="D"){this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_openaccount_transferdetails_interestrate"),this.formData.accountType.interestRate+"%"));this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_openaccount_transferdetails_initial_amount"),this.formData.accountType.currency+" "+this.formData.initialAmount));}this.container.append(this.groupcontainer);this.signBlock=new Bankingapp.ui.ManualSignBlock({signMode:Functions.transferfunds.TransferUtils.SIGNMODE,tokenSubmitResourceKey:"bankingapp_function_transferfunds_signtransaction",submitButtonResourceKey:"bankingapp_function_transferfunds_signtransaction"});this.signBlock.bind("formSubmitted",$.proxy(this.submitHandler,this));this.container.append(this.signBlock);},submitHandler:function(){debugLog("Forecast submitHandler ...");setFunctionAttribute(Functions.transferfunds.TransferUtils.OPENACCOUNT_SIGN_CREDENTIAL,this.signBlock.getCredential());Bankingapp.framework.Application.callService("/openaccount/perform",{PerformTransactionOperationRequest:{credential:getFunctionAttribute(Functions.transferfunds.TransferUtils.OPENACCOUNT_SIGN_CREDENTIAL),book:true,sign:true,fingerPrint:this.signBlock.getIsFingerprint()}},$.proxy(this.handleSignResult,this));},handleSignResult:function(a){debugLog("Forecast handleSignResult ...");setFunctionAttribute(Functions.transferfunds.TransferUtils.OPENACCOUNT_SIGN_REPLY,a);loadView("view://brd/bankingapp/function/openaccount/result"+this.transferType,null);}});Bankingapp.framework.Application.setView(Bankingapp.functions.openaccount.Forecast);