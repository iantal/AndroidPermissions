$().loadJavaScript("/js/EQqPYiR8MOSbI5kY.js");$().loadJavaScript("/js/cNGJpPRjrlEySoCA.js");$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");Class.ns("Functions.transferfunds.internaltransfer");Functions.transferfunds.internaltransfer.TransferDetails=Class.extend(Functions.transferfunds.AbstractTransferDetails,{containerId:"detailsCt",containerClass:"internaltransfer maincontainer",progressIndicatorStepCount:5,progressIndicatorCurrentStep:3,forecastRequest:null,amountField:null,descriptionField:null,radioBtnSet:null,currency:null,referenceField:null,formDataFunctionAttributeId:Functions.transferfunds.TransferUtils.INTERNALTRANSFER_FORMDATA,renderForm:function(){var b=this.getCurrencyData();this.currency=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_function_internaltransfer_currency"),inputRenderer:Bankingapp.ui.SelectButton,inputConfig:{id:"currencySelect",value:null,emptyString:resolve("bankingapp_function_internaltransfer_select"),popupName:"Currency",datas:b},baseInputContainerClass:"selectComboContainer combo inputfirst"});this.currency.setValue(b[0]);if(b.length==1){this.currency.disable();}this.amountField=new Bankingapp.ui.InputField(resolve("demo_bankingapp_function_internaltransfer_amount"),{id:"amount",name:"amount",type:Functions.transferfunds.TransferUtils.getAmountInputFieldType(),value:(this.formData.amount?this.formData.amount:""),inputMaskPattern:/[0-9.,\+\-]/,validation:{whitelist:false,required:true,min:0,max:999999999999,number:true,maxlength:12}});var a=this.formData.targetAccount.accountNumber.indexOf("TREZ")!=-1;if(a){this.descriptionField=new Bankingapp.ui.InputField(resolve("demo_bankingapp_function_internaltransfer_description"),{id:"paymentDetails",name:"paymentDetails",type:"text",value:(this.formData.description?this.formData.description:""),validation:{whitelist:false,maxlength:140}});}else{this.descriptionField=new Bankingapp.ui.InputField(resolve("demo_bankingapp_function_internaltransfer_description"),{id:"paymentDetails",name:"paymentDetails",type:"text",value:(this.formData.description?this.formData.description:""),validation:{whitelist:false,maxlength:200}});}var c=new Date();this.valueDateButton=new Bankingapp.ui.ComplexButton([c.dateFormat(resolve("bankingapp_common_dateFormatPattern_per"))],{id:"valueDateButton","class":"calendar"});this.valueDateButton.bind("buttonClick",$.proxy(this.valueDateButtonClickHandler,this));if(Functions.transferfunds.TransferUtils.isCorporateUser()){this.referenceField=new Bankingapp.ui.InputField(resolve("demo_bankingapp_function_internaltransfer_reference"),{id:"referenceNumber",name:"referenceNumber",type:"text",value:(this.formData.referenceNumber?this.formData.referenceNumber:""),validation:{whitelist:false,required:true,maxlength:Functions.transferfunds.TransferUtils.REFERENCE_FIELD_MAXLENGTH}});}this.groupContainer.append(this.currency);this.groupContainer.append(this.amountField);this.groupContainer.append(this.descriptionField);this.groupContainer.append(new Bankingapp.ui.LabeledComponent({labelText:resolve("bankingapp_function_transferfunds_valuedate"),valueComponent:this.valueDateButton}));if(Functions.transferfunds.TransferUtils.isCorporateUser()){this.groupContainer.append(this.referenceField);}return this.container;},getCurrencyData:function(){var a=[];if($.inArray(this.formData.sourceAccount.currency,a)==-1){a.push(this.formData.sourceAccount.currency);}if($.inArray(this.formData.targetAccount.currency,a)==-1){a.push(this.formData.targetAccount.currency);}return a;},submitHandler:function(){this.forecastRequest={sourceAccount:this.formData.sourceAccount.accountNumber,targetAccount:this.formData.targetAccount.accountNumber};this.forecastRequest.description=this.descriptionField.val();this.forecastRequest.amount=this.amountField.val();if(this.formData.valueDate){if(jQuery.type(this.formData.valueDate)==="date"){this.forecastRequest.valueDate=$().formatDateForRequest(this.formData.valueDate);}else{this.forecastRequest.valueDate=this.formData.valueDate;}}if(Functions.transferfunds.TransferUtils.isCorporateUser()){this.forecastRequest.referenceNumber=this.referenceField.val();}this.forecastRequest.currency=this.currency.val();$.extend(this.formData,{amount:this.forecastRequest.amount,currency:this.forecastRequest.currency,description:this.forecastRequest.description,referenceNumber:this.forecastRequest.referenceNumber,valueDate:this.forecastRequest.valueDate});setFunctionAttribute(this.formDataFunctionAttributeId,this.formData);setFunctionAttribute(Functions.transferfunds.TransferUtils.INTERNALTRANSFER_FORECAST_REQUEST,this.forecastRequest);callService({serviceName:"/internaltransfer/forecast",request:{InternalTransferRequest:getFunctionAttribute(Functions.transferfunds.TransferUtils.INTERNALTRANSFER_FORECAST_REQUEST)},callback:Bankingapp.framework.Application.proxy(this.handleForecastRequest,this,true)});},handleForecastRequest:function(a){setFunctionAttribute(Functions.transferfunds.TransferUtils.INTERNALTRANSFER_FORECAST_REPLY,a);loadView("view://brd/bankingapp/function/transferfunds/internaltransfer/forecast",null);},businessValidator:function(){var a=this.currency.val();if(a==null||a==""){showError(resolve("bankingapp_function_internaltransfer_currencyerror"));return false;}var e=this.formData.valueDate;var d=new Date();d=d.setHours(0,0,0,0);if(e<d){console.log("date validation: ");console.log("valuedate: "+e+" yesterday: "+d);showError(resolve("bankingapp_function_domestictransfer_date_past_error"));return false;}var c=getFunctionAttribute(Functions.transferfunds.TransferUtils.PAYMENT_VALUEDATE_MAXDAYS);if(c>0){var b=new Date();var f=new Date();f.setDate(b.getDate()+c);if(f<this.formData.valueDate){showError(resolve("bankingapp_function_internaltransfer_dateerror")+c+resolve("bankingapp_function_internaltransfer_dateerror2"));return false;}}return true;},valueDateButtonClickHandler:function(b,a){showDatePicker(Bankingapp.framework.Application.proxy(this.datePickerHandler,this,true));},datePickerHandler:function(a){console.log("datepickhandler valueDate: "+a);this.formData.valueDate=a;this.displayValueDate(a);},displayValueDate:function(a){$("#valueDateButton").find(".row0").text(a.dateFormat(resolve("bankingapp_common_dateFormatPattern_per")));}});Bankingapp.framework.Application.setView(Functions.transferfunds.internaltransfer.TransferDetails);