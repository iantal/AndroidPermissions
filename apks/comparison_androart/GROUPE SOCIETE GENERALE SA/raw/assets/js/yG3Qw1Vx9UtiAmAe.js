$().loadJavaScript("/js/cNGJpPRjrlEySoCA.js");$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");Class.ns("Functions.transferfunds.domestictransfer");Functions.transferfunds.domestictransfer.PartnerDetails=Class.extend(Bankingapp.framework.View,{containerId:"domesticTransferDetailsMainContainer",containerClass:"domestictransfer maincontainer",container:null,showProgressIndicator:true,progressIndicatorStepCount:5,progressIndicatorCurrentStep:3,forecastRequest:null,recipientNameField:null,partnerAddressField:null,partnerAccountField:null,amountField:null,paymentReferenceField:null,currency:null,savePartnerNameAs:null,showPageInstructions:true,pageInstructionsClass:"pagetitle separator",pageInstructionsResourceKey:"bankingapp_function_domestictransfer_furtherdetails",form:null,formId:"transferDetailsForm",formClass:"transfer-details-form",groupContainer:null,savePartnerContainer:null,groupContainerClass:"groupcontainer",groupContainerClass:"groupcontainer",valueDateButton:null,valueDateButtonId:"valueDateButton",valueDateButtonClass:"calendar",valueDateButtonNextBusinessDayResourceKey:"bankingapp_function_transferfunds_nextbankingday",valueDateLabelResourceKey:"bankingapp_function_transferfunds_valuedate",dateFormatPatternResourceKey:"bankingapp_common_dateFormatPattern",formData:null,layoutRender:function(){this.formData=getFunctionAttribute(Functions.transferfunds.TransferUtils.DOMESTICTRANSFER_FORMDATA);console.log(this.formData);this.container=$("<div>",{id:this.containerId,"class":this.containerClass});if(this.showProgressIndicator){this.container.append(new Bankingapp.ui.ProgressIndicator(this.progressIndicatorStepCount,this.progressIndicatorCurrentStep));}if(this.showPageInstructions){this.container.append(new Bankingapp.ui.Label(resolve(this.pageInstructionsResourceKey),{"class":this.pageInstructionsClass}));}this.form=new Bankingapp.ui.Form({id:this.formId,submitHandler:$.proxy(this.submitHandler,this),businessValidationHandler:$.proxy(this.businessValidator,this),"class":this.formClass});this.groupContainer=$("<div>",{"class":this.groupContainerClass});this.form.append(this.groupContainer);this.container.append(this.form);this.renderForm();return this.container;},renderForm:function(){this.recipientNameField=new Bankingapp.ui.InputField(resolve("bankingapp_function_domestictransfer_beneficiaryname"),{id:"beneficiaryName",name:"beneficiaryName",type:"text",value:(this.formData.beneficiaryName?this.formData.beneficiaryName:""),validation:{required:true,maxlength:200}});this.groupContainer.append(this.recipientNameField);this.partnerAccountField=new Bankingapp.ui.InputField(resolve("bankingapp_function_domestictransfer_partneraccount"),{id:"partnerAccount",name:"partnerAccount",type:"text",value:(this.formData.targetAccount?this.formData.targetAccount:""),validation:{required:true,maxlength:28}});this.groupContainer.append(this.partnerAccountField);this.currency=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_function_domestictransfer_currency"),inputRenderer:Bankingapp.ui.SelectButton,inputConfig:{id:"currencySelect",value:null,emptyString:resolve("bankingapp_function_domestictransfer_select"),popupName:"Currency"},baseInputContainerClass:"selectComboContainer combo inputfirst"});if(this.formData.currency){this.currency.setValue(this.formData.currency);}else{this.currency.setValue(Functions.transferfunds.TransferUtils.DEFAULT_CURRENCY);}this.currency.getInputComponent().bind("afterSelect",$.proxy(this.afterSelectCurrency,this));this.groupContainer.append(this.currency);this.partnerAddressField=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_function_domestictransfer_partneraddress"),showOptional:false,inputConfig:{id:"partnerAddress",name:"partnerAddress",type:"text",validation:{maxlength:200,whitelist:false,address:true,}},baseLabelContainerClass:"inputLabelContainer partnerAddressLabel"});if(this.formData.beneficiaryAddress){this.partnerAddressField.setValue(this.formData.beneficiaryAddress);}this.groupContainer.append(this.partnerAddressField);this.savePartner=new Bankingapp.ui.Checkbox({labelText:resolve("bankingapp_function_domestictransfer_savepartner"),value:false});this.form.append(this.savePartner);this.savePartner.bind("click",$.proxy(this.savePartnerClickHandler,this));this.savePartnerNameAs=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_function_domestictransfer_savepartnernameas"),showOptional:false,inputConfig:{id:"partnerName",name:"partnerName",type:"text",showOptional:false,validation:{maxlength:200}}});this.savePartnerNameAs.hide();this.savePartnerContainer=$("<div>",{"class":this.groupContainerClass});this.form.append(this.savePartnerContainer);this.savePartnerContainer.append(this.savePartnerNameAs);this.form.append(new Bankingapp.ui.SubmitButton(resolve("bankingapp_function_transferfunds_continue"),{"class":"continue"}));},afterSelectCurrency:function(b,a){if(Functions.transferfunds.TransferUtils.DEFAULT_CURRENCY!=a.selected){$(".partnerAddressLabel").find("label").text(resolve("bankingapp_function_domestictransfer_partneraddress")+"*");}else{$(".partnerAddressLabel").find("label").text(resolve("bankingapp_function_domestictransfer_partneraddress"));}},accountChangeCheck:function(){if(this.partnerAccountField.val()&&this.partnerAccountField.val().match(Functions.transferfunds.TransferUtils.TREASURY_ACCOUNT)!=null&&this.currency.val()&&this.currency.val()==Functions.transferfunds.TransferUtils.DEFAULT_CURRENCY){this.currency.disable();}else{this.currency.enable();}},savePartnerClickHandler:function(){if(this.savePartner.val()){this.savePartnerNameAs.show();}else{this.savePartnerNameAs.hide();}},submitHandler:function(){if(!this.savePartner.val()){this.savePartnerNameAs.setValue("");}this.formData.forecastRequest={sourceAccount:this.formData.sourceAccount.accountNumber,beneficiaryName:this.recipientNameField.val(),targetAccount:this.partnerAccountField.val(),targetAccountCurrency:this.currency.val(),beneficiaryAddress:this.partnerAddressField.val(),partnerName:this.savePartnerNameAs.val(),savePartner:this.savePartner.val(),};if(this.formData.requestMoneyTransactionId){this.formData.forecastRequest.requestMoneyTransactionId=this.formData.requestMoneyTransactionId;}if(this.formData.splitBillTransactionId){this.formData.forecastRequest.splitBillTransactionId=this.formData.splitBillTransactionId;}if(this.formData.parentDescription){this.formData.forecastRequest.parentDescription=this.formData.parentDescription;}$.extend(this.formData,{beneficiaryName:this.recipientNameField.val(),targetAccount:this.partnerAccountField.val(),targetAccountCurrency:this.currency.val(),beneficiaryAddress:this.partnerAddressField.val(),partnerName:this.savePartnerNameAs.val()});setFunctionAttribute(Functions.transferfunds.TransferUtils.DOMESTICTRANSFER_FORMDATA,this.formData);var a={IsIbanValidRequest:{Iban:this.partnerAccountField.val()}};Bankingapp.framework.Application.callService("/iban/check",a,$.proxy(this.handleValidateIbanResponse,this));},handleValidateIbanResponse:function(a){if(a.valid==true){loadView("view://brd/bankingapp/function/transferfunds/domestictransfer/transferdetails",null);}else{showError(resolve("bankingapp_function_domestictransfer_invalidIban"));}},businessValidator:function(){if(this.partnerAccountField.val()){this.partnerAccountField.setValue(this.partnerAccountField.val().toUpperCase());}var a=this.currency.val();if(a!=Functions.transferfunds.TransferUtils.DEFAULT_CURRENCY&&!this.partnerAddressField.val()){showError(resolve("bankingapp_function_domestictransfer_address"));return false;}if(this.savePartner.val()&&!this.savePartnerNameAs.val()){showError(resolve("bankingapp_function_domestictransfer_savepartnernameas_error"));return false;}if(this.partnerAccountField.val()&&this.partnerAccountField.val().match(Functions.transferfunds.TransferUtils.TREASURY_ACCOUNT)!=null&&this.currency.val()&&this.currency.val()!=Functions.transferfunds.TransferUtils.DEFAULT_CURRENCY){showError(resolve("bankingapp_function_domestictransfer_trez_currency_error"));this.currency.setValue(Functions.transferfunds.TransferUtils.DEFAULT_CURRENCY);this.currency.disable();return false;}return true;},run:function(){Bankingapp.framework.Application.callService("/domestictransfer/getTargetCurrencies",null,$.proxy(this.handleCurrencyResponse,this));this.partnerAccountField.bind("keyup",$.proxy(this.accountChangeCheck,this));},handleCurrencyResponse:function(b){var a=b;this.currency.getInputComponent().setDatas(a);}});Bankingapp.framework.Application.setView(Functions.transferfunds.domestictransfer.PartnerDetails);