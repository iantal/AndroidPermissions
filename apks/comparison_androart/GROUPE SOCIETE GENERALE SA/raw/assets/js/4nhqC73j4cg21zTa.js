$().loadJavaScript("/js/Erxtqs2hBPYD7iXy.js");$().loadJavaScript("/js/cNGJpPRjrlEySoCA.js");Class.ns("Bankingapp.functions.loancalculator");Bankingapp.functions.loancalculator.LoanDetails=Class.extend(Bankingapp.framework.View,{currentProgressStep:1,ProgressSteps:4,nextView:"view://brd/bankingapp/function/loancalculator/loanoffer",container:null,form:null,inputFielContainerProduct:null,inputFielContainerSpecify:null,label1:null,label2:null,loanType:null,loanProduct:null,amount:null,currency:null,period:null,submitButton:null,loanOptions:[],typeData:[],productData:[],currencyData:[],periodData:[],minAmount:null,maxAmount:null,selectedId:null,layoutRender:function(){this.container=$("<div>",{id:"container","class":"login maincontainer disclaimer"});this.container.append(new Bankingapp.ui.ProgressIndicator(this.ProgressSteps,this.currentProgressStep));this.form=new Bankingapp.ui.Form({submitHandler:$.proxy(this.submitHandler,this),businessValidationHandler:$.proxy(this.businessValidator,this)});this.container.append(this.form);this.inputFielContainerProduct=$("<div>",{id:"inputFielContainerProduct","class":"groupContainer"});this.inputFielContainerSpecify=$("<div>",{id:"inputFielContainerSpecify","class":"groupContainer"});this.label1=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_loancalculator_details_label1"),{"class":"detailstitle"});this.loanType=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_brd_function_loancalculator_details_loantype"),inputRenderer:Bankingapp.ui.SelectButton,inputConfig:{id:"loanTypeSelect",value:null,emptyString:resolve("bankingapp_brd_function_loancalculator_details_select"),popupName:resolve("bankingapp_brd_function_loancalculator_loantype_header")},baseInputContainerClass:"selectComboContainer combo inputfirst loancalculator"});this.loanProduct=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_brd_function_loancalculator_details_loanname"),inputRenderer:Bankingapp.ui.SelectButton,inputConfig:{id:"loanProductSelect",value:null,emptyString:resolve("bankingapp_brd_function_loancalculator_details_select"),popupName:resolve("bankingapp_brd_function_loancalculator_loanproduct_header")},baseInputContainerClass:"selectComboContainer combo inputfirst loancalculator"});this.currency=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_brd_function_loancalculator_details_currency"),inputRenderer:Bankingapp.ui.SelectButton,inputConfig:{id:"currencySelect",value:null,emptyString:resolve("bankingapp_brd_function_loancalculator_details_select"),popupName:resolve("bankingapp_brd_function_loancalculator_currency_header")},baseInputContainerClass:"selectComboContainer combo inputfirst"});this.label2=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_loancalculator_details_label2"),{"class":"detailstitle"});this.amount=new Bankingapp.ui.AmountInput({labelText:resolve("bankingapp_brd_function_loancalculator_details_amount"),showOptional:false,inputConfig:{id:"amount",tabindex:"3",name:"amount",type:"number",validation:{required:true}}});this.period=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_brd_function_loancalculator_details_period"),inputRenderer:Bankingapp.ui.SelectButton,inputConfig:{id:"periodSelect",value:null,emptyString:resolve("bankingapp_brd_function_loancalculator_details_select"),popupName:resolve("bankingapp_brd_function_loancalculator_period_header")},baseInputContainerClass:"selectComboContainer combo inputfirst"});this.submitButton=new Bankingapp.ui.SubmitButton(resolve("bankingapp_brd_function_loancalculator_details_offerbutton"),{tabindex:"6"});this.inputFielContainerProduct.append(this.loanType);this.inputFielContainerProduct.append(this.loanProduct);this.inputFielContainerSpecify.append(this.currency);this.inputFielContainerSpecify.append(this.amount);this.inputFielContainerSpecify.append(this.period);this.form.append(this.label1);this.form.append(this.inputFielContainerProduct);this.form.append(this.label2);this.form.append(this.inputFielContainerSpecify);this.form.append(this.submitButton);return this.container;},run:function(){Bankingapp.framework.Application.callService("/loanCalculator/init",{},$.proxy(this.onAfterInit,this));this.loanProduct.disable();this.currency.disable();this.amount.disable();this.period.disable();this.loanType.getInputComponent().bind("afterSelect",$.proxy(this.onSelectedLoanType,this));this.loanProduct.getInputComponent().bind("afterSelect",$.proxy(this.onSelectedProductType,this));this.currency.getInputComponent().bind("afterSelect",$.proxy(this.onSelectedCurrency,this));this.period.getInputComponent().bind("afterSelect",$.proxy(this.onSelectedPeriod,this));$(this.form).bind("formSubmit",$.proxy(this.onFormSubmit,this));},onAfterInit:function(a){this.loanOptions=a.loanOptions;var b=this;$.each(this.loanOptions,function(c,d){if($.inArray(d.loanType,b.typeData)==-1){b.typeData.push(d.loanType);}});this.loanType.getInputComponent().setDatas(this.typeData);},onSelectedLoanType:function(d,c){var a=c.selected;this.productData=[];var b=this;$.each(this.loanOptions,function(e,f){if(f.loanType==a&&$.inArray(f.loanName,b.productData)==-1){b.productData.push(f.loanName);}});this.loanProduct.getInputComponent().setDatas(this.productData);this.loanProduct.enable();this.loanProduct.setValue(null);this.currency.setValue(null);this.period.setValue(null);this.currency.disable();this.amount.setValue(null);this.amount.disable();this.period.disable();},onSelectedProductType:function(f,d){var b=d.selected;var a=this.loanType.val();this.currencyData=[];this.periodData=[];var c=this;$.each(this.loanOptions,function(e,h){if(h.loanType==a&&h.loanName==b&&$.inArray(h.currency,c.currencyData)==-1){c.currencyData.push(h.currency);if(c.periodData.length==0){for(var g=h.minPeriod;g<=h.maxPeriod;g++){c.periodData.push(g.toString());}}}});this.currency.getInputComponent().setDatas(this.currencyData);this.period.getInputComponent().setDatas(this.periodData);if(this.currencyData.length==1){this.currency.setValue(this.currencyData[0]);this.currency.removeClass("button");this.currency.disable();this.currency.getInputComponent().trigger("afterSelect",{selected:this.currencyData[0]});}else{this.currency.setValue(null);this.currency.enable();this.amount.setValue(null);this.amount.disable();}this.period.setValue(null);this.period.enable();},onSelectedCurrency:function(g,f){var c=f.selected;var b=this.loanType.val();var a=this.loanProduct.val();var d=this;$.each(this.loanOptions,function(e,h){if(h.loanType==b&&h.loanName==a&&h.currency==c){d.minAmount=h.minLoan;d.maxAmount=h.maxLoan;d.selectedId=h.loanId;}});this.amount.enable();},onSelectedPeriod:function(c,b){var a=b.selected;},submitHandler:function(){var a={loanId:this.selectedId,amount:this.amount.val(),period:this.period.val(),currency:this.currency.val(),loanType:this.loanType.val(),loanProduct:this.loanProduct.val()};setFunctionAttribute("loanId",this.selectedId);setFunctionAttribute("amount",this.amount.val());setFunctionAttribute("period",this.period.val());setFunctionAttribute("currency",this.currency.val());setFunctionAttribute("loanType",this.loanType.val());setFunctionAttribute("loanProduct",this.loanProduct.val());loadView(this.nextView,a);},businessValidator:function(){var b=this.loanType.val();if(b==null||b==""){console.info("loan Type is null");showError(resolve("bankingapp_brd_function_loancalculator_details_loantypeerror"));return false;}var d=this.loanProduct.val();if(d==null||d==""){console.info("loan Product is null");showError(resolve("bankingapp_brd_function_loancalculator_details_loannameerror"));return false;}var a=this.currency.val();if(a==null||a==""){console.info("currency is null");showError(resolve("bankingapp_brd_function_loancalculator_details_currencyerror"));return false;}var e=this.period.val();if(e==null||e==""){console.info("period is null");showError(resolve("bankingapp_brd_function_loancalculator_details_perioderror"));return false;}var c=this.amount.val();if(!$.isNumeric(c)||c<this.minAmount||c>this.maxAmount){console.info("amount is not valid");showError(resolve("bankingapp_brd_function_loancalculator_details_amounterror",{0:this.minAmount,1:this.maxAmount}));return false;}if(this.selectedId==null){console.info("selectedId is null");showError(resolve("bankingapp_brd_function_loancalculator_details_iderror"));return false;}return true;}});Bankingapp.framework.Application.setView(Bankingapp.functions.loancalculator.LoanDetails);