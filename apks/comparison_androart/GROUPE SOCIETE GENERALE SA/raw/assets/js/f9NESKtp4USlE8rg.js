Class.ns("Bankingapp.functions.fxrates");$().loadJavaScript("/js/qpjkKwKEgu2ZLhBD.js");$().loadJavaScript("/js/X4eLpc6dPvkXJtfy.js");$().loadJavaScript("/js/EY30pmSnIMcajXPT.js");$().loadJavaScript("/js/snosUZyjouIYavJ2.js");Bankingapp.functions.fxrates.HistoricalRates=Class.extend(Bankingapp.framework.View,{tabSet:null,currencyMapFunctionAttribute:"CURRENCY_MAP",displayDateFormat:"d/m/Y",layoutRender:function(){this.container=$("<div>",{id:"fxratesHistoricalRatesMainContainer"});Bankingapp.framework.Application.unBind("onContextMenuItemPressed");$("body").bind("onContextMenuItemPressed",$.proxy(this.onDefaultContextMenuItemPressedHandler,this));return this.container;},run:function(){this.localCurrencyId=getFunctionAttribute("LOCAL_CURRENCY");this.selectedCurrency=getFunctionAttribute("SELECTED_CURRENCY");this.selectedCurrencyId=this.selectedCurrency.currencyId;callService({serviceName:"/fxrate/gethistoricalratedata",request:{data:{sourceCurrency:this.localCurrencyId,targetCurrency:this.selectedCurrencyId}},callback:Bankingapp.framework.Application.proxy(this.handleHistoricalDataResult,this,true)});},handleHistoricalDataResult:function(b){var a=getFunctionAttribute(this.currencyMapFunctionAttribute);if(b!=null){this.historicalRateBase=new Bankingapp.ui.HistoricalRateBase({latestRateInformation:b.latestRateInformation,currencyInformation:this.selectedCurrency,displayDateFormat:resolve("bankingapp_common_dateFormatPattern"),displayTimeFormat:resolve("bankingapp_common_timeFormatPattern")});this.container.append(this.historicalRateBase);this.historicalRateInformationLabel=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_fxrate_historicalrates_rateinformation"),{"class":"pagetitle separator textcenter"});this.container.append(this.historicalRateInformationLabel);this.historicalPeriodRadioBtnSet=new Bankingapp.ui.RadioButtonSet({defaultSelected:0,idProperty:"id",listData:[{id:"1",itemData:resolve("bankingapp_brd_function_fxrate_historicalrates_1w")},{id:"2",itemData:resolve("bankingapp_brd_function_fxrate_historicalrates_1m")},{id:"3",itemData:resolve("bankingapp_brd_function_fxrate_historicalrates_3m")},{id:"4",itemData:resolve("bankingapp_brd_function_fxrate_historicalrates_6m")},{id:"5",itemData:resolve("bankingapp_brd_function_fxrate_historicalrates_1y")}]});this.container.append(this.historicalPeriodRadioBtnSet);this.historicalPeriodRadioBtnSet.bind("radioButtonItemClick",$.proxy(this.historicalPeriodSelectorHandler,this));this.getHistoricalList(resolve("bankingapp_brd_function_fxrate_historicalrates_1w"));}},historicalPeriodSelectorHandler:function(a){this.periodName=this.historicalPeriodRadioBtnSet.getSelected().itemData;this.getHistoricalList(this.periodName);},getHistoricalList:function(a){if(a==resolve("bankingapp_brd_function_fxrate_historicalrates_1w")){this.periodValue="1W";}if(a==resolve("bankingapp_brd_function_fxrate_historicalrates_1m")){this.periodValue="1M";}if(a==resolve("bankingapp_brd_function_fxrate_historicalrates_3m")){this.periodValue="3M";}if(a==resolve("bankingapp_brd_function_fxrate_historicalrates_6m")){this.periodValue="6M";}if(a==resolve("bankingapp_brd_function_fxrate_historicalrates_1y")){this.periodValue="1Y";}callService({serviceName:"/fxrate/gethistoricalrates",request:{data:{sourceCurrency:this.localCurrencyId,targetCurrency:this.selectedCurrencyId,period:this.periodValue}},callback:Bankingapp.framework.Application.proxy(this.handleHistoricalListResult,this,true)});},handleHistoricalListResult:function(d){var f=[];var a=[];for(var c=0;c<d.historicalRateInformation.length;c++){var g=$().dateParserWithoutTime(d.historicalRateInformation[c].valueDate);f.push(g.getTime());a.push(d.historicalRateInformation[c].value);}var b=Highcharts.calculateMissingValues(a,f);this.chartContainer=$("<div>",{id:"chartContainer"});this.container.append(this.chartContainer);var e=new Highcharts.Chart({title:{text:null},chart:{renderTo:"chartContainer"},tooltip:{enabled:false},legend:{enabled:false},xAxis:{type:"datetime",ordinal:false,startOnTick:false,endOnTick:false,tickPixelInterval:150,labels:{formatter:function(){var i=new Date(this.value);var j=(i.getFullYear()).toString();var k=(i.getMonth()+1).toString();if(k.length==1){k="0"+k;}var h=i.getUTCDate().toString();if(h.length==1){h="0"+h;}var l=k+"."+h+"."+j;return l;}}},yAxis:{labels:{enabled:true},title:{text:null},gridLineWidth:0},series:[{data:b}]});},onDefaultContextMenuItemPressedHandler:function(b,a){if(a=="fxrate_calculator"){setFunctionAttribute("SELECTED_CURRENCY",this.selectedCurrencyId);setFunctionAttribute("CALCULATOR_START_MODE","L");loadView("view://bankingapp/function/fxrates/fxcalculator",null);}else{Bankingapp.framework.event.ContextMenuHandler.onDefaultContextMenuItemPressedHandler(b,a);}}});Bankingapp.framework.Application.setView(Bankingapp.functions.fxrates.HistoricalRates);