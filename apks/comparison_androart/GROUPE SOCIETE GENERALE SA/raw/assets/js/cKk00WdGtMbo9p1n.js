Class.ns("Bankingapp.functions.deposits");$().loadJavaScript("/js/kaVmiVKNJGzi2apI.js");$().loadJavaScript("/js/icz25N39YleqstwB.js");$().loadJavaScript("/js/b3AgAJXnD9xu69FA.js");$().loadJavaScript("/js/r4OvTVJeDxt7kurp.js");Bankingapp.functions.deposits.Deposits=Class.extend(Bankingapp.framework.View,{container:null,layoutRender:function(){Bankingapp.framework.Application.bind("onContextMenuItemPressed",$.proxy(this.onContextMenuItemPressed,this));Bankingapp.framework.Application.bind("onResume",$.proxy(this.onResume,this));this.depositListAuth=this.isAuthorizedToList();this.depositCreateAuth=this.isAuthorizedToCreate();this.pensionFundListAuth=this.isAuthorizedToPensionFundList();this.investmentFundListAuth=this.isAuthorizedToInvestmentFundList();this.container=$("<div>",{id:"depositsMainContainer","class":"list maincontainer"});this.containerCreate=$("<div>",{id:"depositsCreateContainer","class":"list maincontainer"});this.containerList=$("<div>",{id:"depositsListContainer","class":"list maincontainer"});this.pensionfundsContainerList=$("<div>",{id:"pensionfundsListContainer","class":"list maincontainer"});this.investmentFundContainerList=$("<div>",{id:"investmentFundListContainer","class":"list maincontainer"});if(this.depositListAuth===true){this.depositListLabel=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_deposits_list_title"),{"class":"listtitle"});this.depositList=new Bankingapp.ui.List({baseClass:"list",listData:[],itemRenderer:Bankingapp.ui.DepositListItem,noresultKey:"bankingapp_brd_function_deposits_list_empty",activeProperty:true,itemConfig:{depositFriendlyNameField:"accountName",depositIdField:"depositId",depositDueDateField:"depositDueDate",depositBalanceField:"availableBalance",depositCurrencyField:"currency",depositMaturityCountField:"depositMaturityCount",baseClass:"accountListItem",maturityKey:"bankingapp_brd_function_deposits_list_item_maturity",dueDateKey:"bankingapp_brd_function_deposits_list_item_duedate",displayDateFormat:resolve("bankingapp_common_dateFormatPattern")}});this.depositList.bind("itemClick",$.proxy(this.clickHandler,this));this.containerList.append(this.depositListLabel);this.containerList.append(this.depositList);}else{this.depositListLabel=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_depositsnoauth_list_title"),{"class":"pagetitle separator textcenter"});this.containerList.append(this.depositListLabel);}this.pensionFundsListLabel=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_deposits_pensionfunds_list_title"),{"class":"listtitle"});if(this.pensionFundListAuth===true){this.pensionFundsList=new Bankingapp.ui.List({baseClass:"list",listData:[],itemRenderer:Bankingapp.ui.PensionFundsListItem,noresultKey:"bankingapp_brd_function_deposits_pensionfunds_list_empty",activeProperty:true,itemConfig:{friendlyNameField:"accountName",dateOfBalanceField:"pensionDateOfBalance",totalNumberOfUnitsField:"pensionTotalNumberOfUnits",balanceField:"pensionNetAssetValue",currencyField:"currency",baseClass:"accountListItem",unitsNumberKey:"bankingapp_brd_function_deposits_pensionfunds_list_unitsnumber",balanceDateKey:"bankingapp_brd_function_deposits_pensionfunds_list_item_duedate"}});this.pensionFundsList.bind("itemClick",$.proxy(this.pensionClickHandler,this));this.pensionfundsContainerList.append(this.pensionFundsListLabel);this.pensionfundsContainerList.append(this.pensionFundsList);}else{this.pensionFundsListNoAuthLabel=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_deposits_pensionfundsnoauth_list_title"),{"class":"pagetitle separator textcenter"});this.pensionfundsContainerList.append(this.pensionFundsListLabel);this.pensionfundsContainerList.append(this.pensionFundsListNoAuthLabel);}this.investmentFundListLabel=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_deposits_investmentfund_list_title"),{"class":"listtitle"});if(this.investmentFundListAuth===true){debugLog("investmentFundListAuth available");this.investmentFundList=new Bankingapp.ui.List({baseClass:"list",listData:[],itemRenderer:Bankingapp.ui.InvestmentFundListItem,noresultKey:"bankingapp_brd_function_deposits_investmentfund_list_empty",activeProperty:true,itemConfig:{friendlyNameField:"accountName",dateOfBalanceField:"dateOfBalance",totalNumberOfUnitsField:"investmentNumberOfUnits",balanceField:"availableBalance",currencyField:"currency",baseClass:"accountListItem",unitsNumberKey:"bankingapp_brd_function_deposits_list_item_investmentNumberOfUnits",balanceDateKey:"bankingapp_brd_function_deposits_list_item_investmentDateOfBalance"}});this.investmentFundList.bind("itemClick",$.proxy(this.investmentFundClickHandler,this));this.investmentFundContainerList.append(this.investmentFundListLabel);this.investmentFundContainerList.append(this.investmentFundList);}else{debugLog("no investmentFundListAuth available");this.investmentFundListNoAuthLabel=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_investmentfunds_list_noauth"),{"class":"pagetitle separator textcenter"});this.investmentFundContainerList.append(this.investmentFundListLabel);this.investmentFundContainerList.append(this.investmentFundListNoAuthLabel);}this.container.append(this.containerList);this.container.append(this.pensionfundsContainerList);this.container.append(this.investmentFundContainerList);return this.container;},onResume:function(){var a=getFunctionAttribute("REFRESH_ACCOUNT_DETAILS");debugLog("-onResume- REFRESH_ACCOUNT_DETAILS: "+a);if((a!=undefined)&&(a!=null)){var b=getFunctionAttribute("ACCOUNT_DETAILS");debugLog("-onResume- ACCOUNT_DETAILS: "+JSON.stringify(b));var c=this.sortDepositPensionAccounts(b);if((this.depositList!=undefined)&&(this.depositList!=null)){this.depositList.empty();this.depositList.appendItems(c.depositListData);}if((this.pensionFundsList!=undefined)&&(this.pensionFundsList!=null)){this.pensionFundsList.empty();this.pensionFundsList.appendItems(c.pensionFundsListData);}removeFunctionAttribute("REFRESH_ACCOUNT_DETAILS");}},run:function(){removeFunctionAttribute("ACCOUNT_DETAILS");removeFunctionAttribute("DEPOSIT_ACCOUNTS");if(this.depositListAuth===true){this.accountListRequest={FunctionType:13};Bankingapp.framework.Application.callService("/account/getDepositAccounts",{AccountListRequest:this.accountListRequest},$.proxy(this.handleListResult,this));}},sortDepositPensionAccounts:function(e){var d=[];var b=[];for(var c=0;c<e.length;c++){var a=e[c];if(a.accountProductTypeId!=undefined&&a.accountProductTypeId!=null&&a.accountProductTypeId==="P"){d.push(a);}else{b.push(a);}}debugLog("-sortAccounts- DEPOSIT_ACCOUNTS: "+JSON.stringify(b));debugLog("-sortAccounts- PENSION_FUNDS: "+JSON.stringify(d));setFunctionAttribute("DEPOSIT_ACCOUNTS",b);setFunctionAttribute("PENSION_FUNDS",d);var f={depositListData:b,pensionFundsListData:d};return f;},clickHandler:function(a,b){setFunctionAttribute("deposit",b);loadView("view://brd/bankingapp/function/deposits/detail/DepositDetails",null);},pensionClickHandler:function(a,b){setFunctionAttribute("pensionfund",b);loadView("view://brd/bankingapp/function/deposits/pensionfunds/detail/PensionFundsDetails",null);},investmentFundClickHandler:function(a,b){setFunctionAttribute("investmentfund",b);loadView("view://brd/bankingapp/function/deposits/detail/InvestmentFundDetails",null);},handleListResult:function(a){debugLog("handleListResult");setFunctionAttribute("DEPOSIT_ACCOUNTS",a);setFunctionAttribute("ACCOUNT_DETAILS",a);this.depositList.appendItems(a);if(this.pensionFundListAuth===true){this.getPensionFundsList();}else{if(this.investmentFundListAuth===true){debugLog("get investment funds from handleListResult");this.getInvestmentFundList();}}},getPensionFundsList:function(){removeFunctionAttribute("PENSION_FUNDS");this.pensionFundsListRequest={FunctionType:31};Bankingapp.framework.Application.callService("/account/getPensionFundsAccounts",{AccountListRequest:this.pensionFundsListRequest},$.proxy(this.handlePensionFundsListResult,this));},getInvestmentFundList:function(){debugLog("getInvestmentFundList");removeFunctionAttribute("INVESTMENT_FUNDS");this.investmentFundListRequest={FunctionType:47};Bankingapp.framework.Application.callService("/account/getInvestmentFundAccounts",{AccountListRequest:this.investmentFundListRequest},$.proxy(this.handleInvestmentFundListResult,this));},handlePensionFundsListResult:function(c){setFunctionAttribute("PENSION_FUNDS",c);var a=getFunctionAttribute("ACCOUNT_DETAILS");for(var b=0;b<c.length;b++){a.push(c[b]);}setFunctionAttribute("ACCOUNT_DETAILS",a);this.pensionFundsList.appendItems(c);if(this.investmentFundListAuth===true){debugLog("get investment funds from handlePensionFundsListResult");this.getInvestmentFundList();}},handleInvestmentFundListResult:function(a){debugLog("handleInvestmentFundListResult");setFunctionAttribute("INVESTMENT_FUNDS",a);this.investmentFundList.appendItems(a);debugLog("handleInvestmentFundListResult, ready");},isAuthorizedToList:function(){return Bankingapp.framework.Application.isAuthorized("depositlist/view");},isAuthorizedToCreate:function(){return Bankingapp.framework.Application.isAuthorized("depositcreate/view");},isAuthorizedToPensionFundList:function(){return Bankingapp.framework.Application.isAuthorized("pensionfundlist/view");},isAuthorizedToInvestmentFundList:function(){return Bankingapp.framework.Application.isAuthorized("investmentfund_list/view");},onContextMenuItemPressed:function(b,a){if(a=="deposit_preferences"){setFunctionAttribute("FAVORITE_SETTINGS_BUTTON","invisible");loadView("view://bankingapp/function/accountinfo/editaccountlist",null);}}});Bankingapp.framework.Application.setView(Bankingapp.functions.deposits.Deposits);