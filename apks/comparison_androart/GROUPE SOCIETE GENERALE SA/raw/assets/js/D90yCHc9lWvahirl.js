$().loadJavaScript("/js/cNGJpPRjrlEySoCA.js");$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");Class.ns("Functions.transferfunds.internationaltransfer");Functions.transferfunds.internationaltransfer.PartnerDetails=Class.extend(Bankingapp.framework.View,{countryCodes:["AF","AX","AL","DZ","AS","AD","AO","AI","AQ","AG","AR","AM","AW","AU","AT","AZ","BS","BH","BD","BB","BY","BE","BZ","BJ","BM","BT","BO","BQ","BA","BW","BV","BR","IO","BN","BG","BF","BI","KH","CM","CA","CV","KY","CF","TD","CL","CN","CX","CC","CO","KM","CG","CD","CK","CR","CI","HR","CU","CW","CY","CZ","DK","DJ","DM","DO","EC","EG","SV","GQ","ER","EE","ET","FK","FO","FJ","FI","FR","GF","PF","TF","GA","GM","GE","DE","GH","GI","GR","GL","GD","GP","GU","GT","GG","GN","GW","GY","HT","HM","VA","HN","HK","HU","IS","IN","ID","IR","IQ","IE","IM","IL","IT","JM","JP","JE","JO","KZ","KE","KI","KP","KR","KW","KG","LA","LV","LB","LS","LR","LY","LI","LT","LU","MO","MK","MG","MW","MY","MV","ML","MT","MH","MQ","MR","MU","YT","MX","FM","MD","MC","MN","ME","MS","MA","MZ","MM","NA","NR","NP","NL","NC","NZ","NI","NE","NG","NU","NF","MP","NO","OM","PK","PW","PS","PA","PG","PY","PE","PH","PN","PL","PT","PR","QA","RE","RO","RU","RW","BL","SH","KN","LC","MF","PM","VC","WS","SM","ST","SA","SN","RS","SC","SL","SG","SX","SK","SI","SB","SO","ZA","GS","SS","ES","LK","SD","SR","SJ","SZ","SE","CH","SY","TW","TJ","TZ","TH","TL","TG","TK","TO","TT","TN","TR","TM","TC","TV","UG","UA","AE","GB","US","UM","UY","UZ","VU","VE","VN","VG","VI","WF","EH","YE","ZM","ZW"],containerId:"internationalTransferDetailsMainContainer",containerClass:"internationaltransfer maincontainer",container:null,showProgressIndicator:true,progressIndicatorStepCount:Functions.transferfunds.TransferUtils.INTERNATIONALTRANSFER_STEPCOUNT,progressIndicatorCurrentStep:3,forecastRequest:null,recipientNameField:null,partnerAddressField:null,partnerAccountField:null,amountField:null,paymentReferenceField:null,currency:null,savePartnerNameAs:null,showPageInstructions:true,pageInstructionsClass:"pagetitle separator",pageInstructionsResourceKey:"bankingapp_function_internationaltransfer_furtherdetails",form:null,formId:"transferDetailsForm",formClass:"transfer-details-form",groupContainer1:null,groupContainer2:null,groupContainer3:null,savePartnerContainer:null,groupContainerClass:"groupcontainer",groupContainerClass:"groupcontainer",valueDateButton:null,valueDateButtonId:"valueDateButton",valueDateButtonClass:"calendar",valueDateButtonNextBusinessDayResourceKey:"bankingapp_function_transferfunds_nextbankingday",valueDateLabelResourceKey:"bankingapp_function_transferfunds_valuedate",dateFormatPatternResourceKey:"bankingapp_common_dateFormatPattern",formData:null,layoutRender:function(){this.formData=getFunctionAttribute(Functions.transferfunds.TransferUtils.INTERNATIONALTRANSFER_FORMDATA);console.log(this.formData);this.container=$("<div>",{id:this.containerId,"class":this.containerClass});if(this.showProgressIndicator){this.container.append(new Bankingapp.ui.ProgressIndicator(this.progressIndicatorStepCount,this.progressIndicatorCurrentStep));}if(this.showPageInstructions){this.container.append(new Bankingapp.ui.Label(resolve(this.pageInstructionsResourceKey),{"class":this.pageInstructionsClass}));}this.form=new Bankingapp.ui.Form({id:this.formId,submitHandler:$.proxy(this.submitHandler,this),businessValidationHandler:$.proxy(this.businessValidator,this),"class":this.formClass});this.groupContainer1=$("<div>",{"class":this.groupContainerClass});this.groupContainer2=$("<div>",{"class":this.groupContainerClass});this.groupContainer3=$("<div>",{"class":this.groupContainerClass});this.renderForm();this.form.append(this.groupContainer1);this.form.append(this.groupContainer2);this.viewBanksButton=new Bankingapp.ui.ComplexButton(resolve("bankingapp_function_internationaltransfer_view_banks"),{disabled:false,"class":"downloadProofOfPaymentButton"});this.form.append(this.viewBanksButton);this.viewBanksButton.bind("buttonClick",$.proxy(this.viewBanksClickHandler,this));this.form.append(this.groupContainer3);this.container.append(this.form);this.savePartner=new Bankingapp.ui.Checkbox({labelText:resolve("bankingapp_function_internationaltransfer_savepartner"),value:false});this.form.append(this.savePartner);this.savePartner.bind("click",$.proxy(this.savePartnerClickHandler,this));this.savePartnerNameAs=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_function_internationaltransfer_savepartnernameas"),showOptional:false,inputConfig:{id:"partnerName",name:"partnerName",type:"text",showOptional:false,validation:{maxlength:200}}});this.savePartnerNameAs.hide();this.savePartnerContainer=$("<div>",{"class":this.groupContainerClass});this.form.append(this.savePartnerContainer);this.savePartnerContainer.append(this.savePartnerNameAs);this.form.append(new Bankingapp.ui.SubmitButton(resolve("bankingapp_function_transferfunds_continue"),{"class":"continue"}));this.bicCheckboxClickHandler();Bankingapp.framework.Application.bind("onResume",$.proxy(this.onResume,this));return this.container;},renderForm:function(){this.recipientNameField=new Bankingapp.ui.InputField(resolve("bankingapp_function_internationaltransfer_beneficiaryname"),{id:"beneficiaryName",name:"beneficiaryName",type:"text",value:(this.formData.forecastRequest.beneficiaryName?this.formData.forecastRequest.beneficiaryName:""),validation:{required:true,maxlength:200}});this.groupContainer1.append(this.recipientNameField);this.partnerAddressField=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_function_internationaltransfer_partneraddress"),showOptional:false,showRequired:true,inputConfig:{id:"partnerAddress",name:"partnerAddress",type:"text",validation:{required:true,maxlength:200,whitelist:false,address:true}},baseLabelContainerClass:"inputLabelContainer partnerAddressLabel"});this.groupContainer1.append(this.partnerAddressField);this.partnerCountryField=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_function_internationaltransfer_partnercountry"),inputRenderer:Bankingapp.ui.SelectButton,showRequired:true,inputConfig:{id:"partnerCountryField",value:null,emptyString:resolve("bankingapp_function_internationaltransfer_select"),popupName:"Partner Country",validation:{required:true}},baseInputContainerClass:"selectComboContainer combo inputfirst"});this.groupContainer1.append(this.partnerCountryField);this.ibanCheckboxElement=new Bankingapp.ui.Checkbox({id:"bicCheckboxElement",value:this.formData.forecastRequest.targetAccountIBAN?this.formData.forecastRequest.targetAccountIBAN:true});this.ibanCheckbox=new Bankingapp.ui.LabeledComponent({labelConfig:{value:resolve("bankingapp_function_internationaltransfer_ibanformat")},valueComponent:this.ibanCheckboxElement});this.groupContainer1.append(this.ibanCheckbox);this.partnerAccountField=new Bankingapp.ui.InputField(resolve("bankingapp_function_internationaltransfer_partneraccount"),{id:"partnerAccount",name:"partnerAccount",type:"text",value:(this.formData.targetAccount?this.formData.targetAccount:""),showRequired:true,validation:{required:true,maxlength:40}});this.groupContainer1.append(this.partnerAccountField);this.currency=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_function_internationaltransfer_currency"),inputRenderer:Bankingapp.ui.SelectButton,showRequired:true,inputConfig:{id:"currencySelect",value:null,emptyString:resolve("bankingapp_function_internationaltransfer_select"),popupName:"Currency",validation:{required:true}},baseInputContainerClass:"selectComboContainer combo inputfirst"});this.currency.getInputComponent().bind("afterSelect",$.proxy(this.afterSelectCurrency,this));this.groupContainer1.append(this.currency);this.bicCheckboxElement=new Bankingapp.ui.Checkbox({id:"bicCheckboxElement",value:this.formData.forecastRequest.otherBankFormat?!this.formData.forecastRequest.otherBankFormat:true});this.bicCheckbox=new Bankingapp.ui.LabeledComponent({labelConfig:{value:resolve("bankingapp_function_internationaltransfer_bicformat")},valueComponent:this.bicCheckboxElement});this.bicCheckbox.bind("checkboxClick",$.proxy(this.bicCheckboxClickHandler,this));this.groupContainer2.append(this.bicCheckbox);this.bankSwiftField=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_function_internationaltransfer_bankswift"),showOptional:false,inputConfig:{id:"bankSwiftField",name:"bankSwiftField",type:"text",validation:{minlength:8,maxlength:11,whitelist:false,address:true}},baseLabelContainerClass:"inputLabelContainer partnerAddressLabel"});this.groupContainer2.append(this.bankSwiftField);this.otherFormatCheckboxElement=new Bankingapp.ui.Checkbox({id:"otherFormatCheckboxElement",value:this.formData.forecastRequest.otherBankFormat?!this.formData.forecastRequest.otherBankFormat:true});this.otherFormatCheckbox=new Bankingapp.ui.LabeledComponent({labelConfig:{value:resolve("bankingapp_function_internationaltransfer_otherformat")},valueComponent:this.otherFormatCheckboxElement});this.otherFormatCheckbox.bind("checkboxClick",$.proxy(this.otherFormatCheckboxClickHandler,this));this.groupContainer3.append(this.otherFormatCheckbox);this.routingNumberField=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_function_internationaltransfer_routingnumber"),showOptional:false,inputConfig:{id:"routingNumberField",name:"routingNumberField",type:"text",validation:{maxlength:200,whitelist:false,address:true}},baseLabelContainerClass:"inputLabelContainer partnerAddressLabel"});this.groupContainer3.append(this.routingNumberField);this.bankCountryField=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_function_internationaltransfer_bankcountry"),inputRenderer:Bankingapp.ui.SelectButton,inputConfig:{id:"partnerCountryField",value:null,emptyString:resolve("bankingapp_function_internationaltransfer_select"),popupName:"Partner Country",validation:{required:false}},baseInputContainerClass:"selectComboContainer combo inputfirst"});this.groupContainer3.append(this.bankCountryField);this.bankAddressField=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_function_internationaltransfer_bankaddress"),showOptional:false,inputConfig:{id:"bankAddressField",name:"bankAddressField",type:"text",validation:{required:false,maxlength:200,whitelist:false,address:true}},baseLabelContainerClass:"inputLabelContainer partnerAddressLabel"});this.groupContainer3.append(this.bankAddressField);this.bankNameField=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_function_internationaltransfer_bankname"),showOptional:false,inputConfig:{id:"bankNameField",name:"bankNameField",type:"text",validation:{required:false,maxlength:200,whitelist:false,address:true}},baseLabelContainerClass:"inputLabelContainer partnerAddressLabel"});this.groupContainer3.append(this.bankNameField);this.setCountryData();},afterSelectCurrency:function(b,a){debugLog("afterSelectCurrency, "+a.selected);},setCountryData:function(){var a=this;var b=resolve;this.countries=[];$.each(this.countryCodes,function(c,d){debugLog("value: "+d);if($.inArray(d,a.countries)==-1){a.countries.push(b("bankingapp_function_insternationaltransfer_details_country_"+d));}});debugLog(this.countries);this.partnerCountryField.getInputComponent().setDatas(this.countries);if(this.formData.forecastRequest.beneficiaryCountry){this.partnerCountryField.setValue(resolve("bankingapp_function_insternationaltransfer_details_country_"+this.formData.forecastRequest.beneficiaryCountry));}this.bankCountryField.getInputComponent().setDatas(this.countries);if(this.formData.forecastRequest.bankCountry){this.bankCountryField.setValue(resolve("bankingapp_function_insternationaltransfer_details_country_"+this.formData.forecastRequest.bankCountry));}},getCountryValue:function(c){var a="";var b=resolve;$.each(this.countryCodes,function(d,e){debugLog("value: "+e);if(c==b("bankingapp_function_insternationaltransfer_details_country_"+e)){debugLog("Found, "+e);a=e;return false;}});return a;},accountChangeCheck:function(){if(this.partnerAccountField.val()&&this.partnerAccountField.val().match(Functions.transferfunds.TransferUtils.TREASURY_ACCOUNT)!=null&&this.currency.val()&&this.currency.val()==Functions.transferfunds.TransferUtils.DEFAULT_CURRENCY){this.currency.disable();}else{this.currency.enable();}},savePartnerClickHandler:function(){if(this.savePartner.val()){this.savePartnerNameAs.show();}else{this.savePartnerNameAs.hide();}},updateFormData:function(){this.formData.forecastRequest={sourceAccount:this.formData.sourceAccount.accountNumber,beneficiaryName:this.recipientNameField.val(),targetAccount:this.partnerAccountField.val(),targetAccountCurrency:this.currency.val(),beneficiaryAddress:this.partnerAddressField.val(),beneficiaryCountry:this.getCountryValue(this.partnerCountryField.val()),targetAccountIBAN:this.ibanCheckboxElement.val(),otherBankFormat:this.otherFormatCheckboxElement.val(),bankSwift:this.otherFormatCheckboxElement.val()?this.routingNumberField.val():this.bankSwiftField.val(),bankName:this.bankNameField.val(),bankAddress:this.bankAddressField.val(),bankCountry:this.getCountryValue(this.bankCountryField.val()),partnerName:this.savePartnerNameAs.val(),savePartner:this.savePartner.val()};$.extend(this.formData,{beneficiaryName:this.recipientNameField.val(),targetAccount:this.partnerAccountField.val(),targetAccountCurrency:this.currency.val(),beneficiaryAddress:this.partnerAddressField.val(),partnerName:this.savePartnerNameAs.val()});setFunctionAttribute(Functions.transferfunds.TransferUtils.INTERNATIONALTRANSFER_FORMDATA,this.formData);},submitHandler:function(){if(!this.savePartner.val()){this.savePartnerNameAs.setValue("");}this.updateFormData();if(this.ibanCheckboxElement.val()){var a={IsIbanValidRequest:{Iban:this.partnerAccountField.val()}};Bankingapp.framework.Application.callService("/iban/check",a,$.proxy(this.handleValidateIbanResponse,this));}else{this.handleValidateIbanResponse({valid:true});}},handleValidateIbanResponse:function(a){if(a.valid==true){if(!this.otherFormatCheckboxElement.val()&&(!this.bankNameField.val()||!this.bankAddressField.val()||!this.bankCountryField.val()||this.bankNameField.val()==""||this.bankAddressField.val()==""||this.bankCountryField.val()=="")){var b={GetInternationalBanksRequest:{searchText:this.bankSwiftField.val(),start:0,limit:10,sort:"BANKNAME",dir:"ASC"}};Bankingapp.framework.Application.callService("/internationaltransfer/getInternationalBankByBic",b,$.proxy(this.handleInternationalBankResult,this));}else{loadView("view://brd/bankingapp/function/transferfunds/internationaltransfer/transferdetails",null);}}else{showError(resolve("bankingapp_function_internationaltransfer_invalidIban"));}},handleInternationalBankResult:function(a){debugLog("handleInternationalBankResult ...");if(!a||!a.bankName||!a.bankAddress||!a.bankCountry){showError(resolve("bankingapp_function_internationaltransfer_missing_bankswift"));return false;}var b=this.formData.forecastRequest;if(!b){b={};}b.bankName=a.bankName;b.bankAddress=a.bankAddress;b.bankCountry=a.bankCountry;setFunctionAttribute(Functions.transferfunds.TransferUtils.INTERNATIONALTRANSFER_FORMDATA,this.formData);loadView("view://brd/bankingapp/function/transferfunds/internationaltransfer/transferdetails",null);},businessValidator:function(){if(this.partnerAccountField.val()){this.partnerAccountField.setValue(this.partnerAccountField.val().toUpperCase());}var a=this.currency.val();if(a!=Functions.transferfunds.TransferUtils.DEFAULT_CURRENCY&&!this.partnerAddressField.val()){showError(resolve("bankingapp_function_internationaltransfer_address"));return false;}if(this.savePartner.val()&&!this.savePartnerNameAs.val()){showError(resolve("bankingapp_function_internationaltransfer_savepartnernameas_error"));return false;}if(this.partnerAccountField.val()&&this.partnerAccountField.val().match(Functions.transferfunds.TransferUtils.TREASURY_ACCOUNT)!=null&&this.currency.val()&&this.currency.val()!=Functions.transferfunds.TransferUtils.DEFAULT_CURRENCY){showError(resolve("bankingapp_function_internationaltransfer_trez_currency_error"));this.currency.setValue(Functions.transferfunds.TransferUtils.DEFAULT_CURRENCY);this.currency.disable();return false;}if(this.otherFormatCheckboxElement.val()){if(!this.routingNumberField.val()||this.routingNumberField.val().trim()==""){showError(resolve("bankingapp_function_internationaltransfer_missing_routing_number"));return false;}if(!this.bankCountryField.val()||this.bankCountryField.val().trim()==""){showError(resolve("bankingapp_function_internationaltransfer_missing_bank_country"));return false;}if(!this.bankAddressField.val()||this.bankAddressField.val().trim()==""){showError(resolve("bankingapp_function_internationaltransfer_missing_bank_address"));return false;}if(!this.bankNameField.val()||this.bankNameField.val().trim()==""){showError(resolve("bankingapp_function_internationaltransfer_missing_bank_name"));return false;}}else{if(!this.bankSwiftField.val()||this.bankSwiftField.val().trim()==""){showError(resolve("bankingapp_function_internationaltransfer_missing_bankswift"));return false;}}return true;},run:function(){console.log("PartnerDetails >> run ...");Bankingapp.framework.Application.callService("/internationaltransfer/getTargetCurrencies",null,$.proxy(this.handleCurrencyResponse,this));this.partnerAccountField.bind("keyup",$.proxy(this.accountChangeCheck,this));this.updateFieldsFromFormdata();},handleCurrencyResponse:function(b){var a=b;this.currency.getInputComponent().setDatas(a);},viewBanksClickHandler:function(){debugLog("bankSwiftFieldClickHandler ...");this.updateFormData();loadView("view://brd/bankingapp/function/transferfunds/internationaltransfer/internationalbankselector");},onResume:function(){debugLog("PartnerDetails >> onResume ...");this.updateFieldsFromFormdata();debugLog("PartnerDetails >> onResume ready!");},updateFieldsFromFormdata:function(){this.formData=getFunctionAttribute(Functions.transferfunds.TransferUtils.INTERNATIONALTRANSFER_FORMDATA);if(this.formData.forecastRequest.beneficiaryAddress){this.partnerAddressField.setValue(this.formData.forecastRequest.beneficiaryAddress);}if(this.formData.forecastRequest.bankSwift){this.bankSwiftField.setValue(this.formData.forecastRequest.bankSwift);}if(this.formData.forecastRequest.bankAddress){this.bankAddressField.setValue(this.formData.forecastRequest.bankAddress);}if(this.formData.forecastRequest.bankName){this.bankNameField.setValue(this.formData.forecastRequest.bankName);}if(this.formData.forecastRequest.targetAccountCurrency){this.currency.setValue(this.formData.forecastRequest.targetAccountCurrency);}else{this.currency.setValue(Functions.transferfunds.TransferUtils.DEFAULT_CURRENCY);}if(this.formData.forecastRequest.bankCountry){this.bankCountryField.setValue(resolve("bankingapp_function_insternationaltransfer_details_country_"+this.formData.forecastRequest.bankCountry));}if(this.formData.forecastRequest.targetAccountIBAN){this.ibanCheckboxElement.setValue(this.formData.forecastRequest.targetAccountIBAN);this.ibanCheckboxElement.updateClass();}if(this.formData.forecastRequest.otherBankFormat){this.otherFormatCheckboxElement.setValue(true);this.otherFormatCheckboxElement.updateClass();this.otherFormatCheckboxClickHandler();}},bicCheckboxClickHandler:function(){debugLog("bicCheckboxClickHandler: "+this.bicCheckboxElement.val());if(this.bicCheckboxElement.val()){this.otherFormatCheckboxElement.setValue(false);this.otherFormatCheckboxElement.updateClass();this.bankSwiftField.enable();this.viewBanksButton.enable();this.routingNumberField.disable();this.bankCountryField.disable();this.bankAddressField.disable();this.bankNameField.disable();this.bankNameField.setValue("");this.bankAddressField.setValue("");this.bankCountryField.getInputComponent().clearValue();}else{this.otherFormatCheckboxElement.setValue(true);this.otherFormatCheckboxElement.updateClass();this.bankSwiftField.disable();this.viewBanksButton.disable();this.routingNumberField.enable();this.bankCountryField.enable();this.bankAddressField.enable();this.bankNameField.enable();}},otherFormatCheckboxClickHandler:function(){debugLog("otherFormatCheckboxClickHandler: "+this.otherFormatCheckboxElement.val());if(this.otherFormatCheckboxElement.val()){this.bicCheckboxElement.setValue(false);this.bicCheckboxElement.updateClass();this.bankSwiftField.disable();this.viewBanksButton.disable();this.routingNumberField.enable();this.bankCountryField.enable();this.bankAddressField.enable();this.bankNameField.enable();}else{this.bicCheckboxElement.setValue(true);this.bicCheckboxElement.updateClass();this.bankSwiftField.enable();this.viewBanksButton.enable();this.routingNumberField.disable();this.bankCountryField.disable();this.bankAddressField.disable();this.bankNameField.disable();this.bankNameField.setValue("");this.bankAddressField.setValue("");this.bankCountryField.getInputComponent().clearValue();}}});Bankingapp.framework.Application.setView(Functions.transferfunds.internationaltransfer.PartnerDetails);