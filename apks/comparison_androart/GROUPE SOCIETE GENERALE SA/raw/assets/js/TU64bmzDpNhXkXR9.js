Class.ns("Bankingapp.functions.transactionhistory");$().loadJavaScript("/js/xni3aEumKLJlldQj.js");$().loadJavaScript("/js/DZS6HuDUc8k9l7BM.js");$().loadJavaScript("/js/K9qGeq007441mwsA.js");Bankingapp.functions.transactionhistory.TransactionHistoryList=Class.extend(Bankingapp.framework.View,{container:null,transactionHistoryFilter:null,_DAY_:1000*60*60*24,scroll:false,transactionAuthToLifeCycle:{billPaymentTransactionLifeCycle:"billpayment/view",createTermDepositLifeCycle:"depositcreate/view",domesticTransactionTransferLifeCycle:"domestictransfer/view",internalTransactionTransferLifeCycle:"internaltransfer/view",payment2phoneTermDepositLifeCycle:"payment2phonetransfer/view",terminateTermDepositLifeCycle:"depositterminate/view",bumpPaymentTransactionLifeCycle:"bumptransfersend/create",qrPaymentTransactionLifeCycle:"qrtransfersend/create",requestMoneyTransferLifeCycle:"requestmoneytransfer/create",splitBillTransferLifeCycle:"splitbilltransfer/create",internationalTransactionTransferLifeCycle:"domestictransfer/view",investmentFundBuyTransferLifeCycle:"investmentfund_buy/view",investmentFundSellTransferLifeCycle:"investmentfund_sell/view",westernUnionReceiveTransferLifeCycle:"westernunion_receive/view",openAccountTransferLifeCycle:"openaccount/view",bringYourMoneyTransferLifeCycle:"bring_your_money/view"},immediateSearch:null,selectedTransactionType:null,selectedTransactionId:null,layoutRender:function(){Bankingapp.framework.Application.bind("onContextMenuItemPressed",$.proxy(this.onContextMenuItemPressed,this));Bankingapp.framework.Application.bind("onResume",$.proxy(this.onResume,this));this.container=$("<div>",{id:"transactionHistoryMainContainer","class":"list maincontainer"});this.transactionHistoryListCurrentFilterContainer=$("<div>",{id:"transactionHistoryListCurrentFilterContainer","class":"list maincontainer"});this.transactionHistoryList=new Bankingapp.ui.HistoricList([],{itemRenderer:Bankingapp.functions.transactionhistory.TransactionHistoryItem,id:"transactionId",dateField:"date",dataDateFormat:resolve("bankingapp_common_parsedatepattern_withouttimezone"),displayDateFormat:resolve("bankingapp_common_dateFormatPattern"),showDateInPeriods:false,dataOrder:"desc"});this.transactionHistoryList.bind("itemClick",$.proxy(this.loadDetailHandler,this));this.container.append(this.transactionHistoryListCurrentFilterContainer);this.container.append(this.transactionHistoryListTitle);this.container.append(this.transactionHistoryList);this.transactionHistoryLoadMoreButton=new Bankingapp.ui.LandingPageButton([resolve("bankingapp_brd_function_transactionhistory_loadmore_button"),""],{"class":"a"});this.transactionHistoryLoadMoreButton.hide();this.transactionHistoryLoadMoreButton.bind("buttonClick",$.proxy(this.loadMoreHandler,this));this.container.append(this.transactionHistoryLoadMoreButton);return this.container;},run:function(){},handleInitResult:function(a){this.defaultLengthInDays=a.defaultLengthInDays;this.maxLengthInDays=a.maxLengthInDays;this.defaultCreatedAfter=a.defaultCreatedAfter;this.defaultCreatedBefore=a.defaultCreatedBefore;if(this.isImmediateSearch()){this.initialFilterTypes=this.immediateSearch[Functions.transactionhistory.TransactionHistoryUtil.IMMEDIATE_SEARCH_TYPE];}else{this.initialFilterTypes=a.transactionHistoryTransactionType;}setFunctionAttribute("transactionHistoryFilterTypes",this.initialFilterTypes);setFunctionAttribute("customerGroup",a.customerGroup);setFunctionAttribute("defaultCreatedAfter",this.defaultCreatedAfter);setFunctionAttribute("defaultCreatedBefore",this.defaultCreatedBefore);this.initializeTransactionHistoryFilter();},initializeTransactionHistoryFilter:function(){var e=getFunctionAttribute("transactionHistoryFilterMode");if(!e){var b=this.defaultCreatedAfter;var c=this.defaultCreatedBefore;console.log(b);this.transactionHistoryFilter={};this.transactionHistoryFilter.OnlyCurrentUser=true;this.transactionHistoryFilter.CreatedAfter=b;this.transactionHistoryFilter.CreatedBefore=c;this.transactionHistoryFilter.FullSearch=true;if(this.isImmediateSearch()){this.transactionHistoryFilter[Functions.transactionhistory.TransactionHistoryUtil.IMMEDIATE_SEARCH_FREETEXT]=this.immediateSearch[Functions.transactionhistory.TransactionHistoryUtil.IMMEDIATE_SEARCH_FREETEXT];}var d=[];if(this.initialFilterTypes){for(var a=0;a<this.initialFilterTypes.length;a++){d.push(this.initialFilterTypes[a].type);}}this.transactionHistoryFilter.Type=d;setFunctionAttribute("transactionHistoryFilter",this.transactionHistoryFilter);setFunctionAttribute("defaultTransactionHistoryFilter",this.transactionHistoryFilter);}else{this.transactionHistoryFilter=getFunctionAttribute("transactionHistoryFilter");}this.transactionHistoryCurrentFilter=new Bankingapp.ui.TransactionHistoryCurrentFilter({currentFilter:this.transactionHistoryFilter,initialFilterTypes:this.initialFilterTypes,displayDateFormat:resolve("bankingapp_common_dateFormatPattern"),parseDateFormat:resolve("bankingapp_common_parsedatepattern_withouttime")});this.transactionHistoryListCurrentFilterContainer.append(this.transactionHistoryCurrentFilter);this.transactionHistorySearch(true);},transactionHistorySearch:function(a){if(a===true){this.scroll=false;this.transactionHistoryList.empty();}else{this.scroll=true;}this.updateLandingPageButton();Bankingapp.framework.Application.callService("/transactionhistory/getTransactionList",{TransactionHistorySearchRequest:this.transactionHistoryFilter},$.proxy(this.handleTransactionHistorySearch,this));},handleTransactionHistorySearch:function(b,a){this.transactionHistoryList.appendItems(b);this.transactionHistoryLoadMoreButton.show();if(this.scroll===true){$("html, body").animate({scrollTop:$(document).height()},1000);}},loadMoreHandler:function(f,g){var b=$().dateParserWithoutTime(this.transactionHistoryFilter.CreatedAfter);var a=new Date(b-(7*this._DAY_)).dateFormat(resolve("bankingapp_common_parsedatepattern_withouttime"));var c=new Date(b-(1*this._DAY_)).dateFormat(resolve("bankingapp_common_parsedatepattern_withouttime"));this.transactionHistoryFilter.CreatedAfter=a;this.transactionHistoryFilter.CreatedBefore=c;this.transactionHistoryFilter.FullSearch=false;this.transactionHistorySearch(false);},loadDetailHandler:function(a,b){this.selectedTransactionType=b.type;this.selectedTransactionId=b.transactionId;if(this.transactionAuthToLifeCycle[b.type]){if(Bankingapp.framework.Application.isAuthorized(this.transactionAuthToLifeCycle[b.type])){Bankingapp.framework.Application.callService("/transactionhistory/getTransactionDetail",{TransactionHistoryDetailRequest:{transactionId:b.transactionId}},$.proxy(this.handleTransactionDetail,this));}}},handleTransactionDetail:function(f){if(this.selectedTransactionType==="splitBillTransferLifeCycle"){var b=this.createSplitBillTransactionDetailData(f);setFunctionAttribute("splitBillTransactionDetail",b);var e=[];for(var a=0;a<b.splitPartners.length;a++){e.push(b.splitPartners[a].transactionId);}var c={PayerTransactionIds:e};Bankingapp.framework.Application.callService("/splitbilltransfer/getPayerTransactionStatuses",{PayerTransactionStatusesRequest:c},$.proxy(this.handlePayerTrDataResponse,this));}else{setFunctionAttribute("transactionDetail",f);loadView("view://brd/bankingapp/function/transactionhistory/detail/transactionhistorydetail",null);}},createSplitBillTransactionDetailData:function(b){var c={};var a=b.transaction.transactionData.transactionRequest;c.status=b.transaction.status["@name"];c.totalAmount=a.totalAmount;c.currency=a.currency;c.beneficiaryName=a.beneficiaryName;c.splitPartners=a.splitPartners;return c;},handlePayerTrDataResponse:function(a){setFunctionAttribute("splitbill_payerTrData",a.payerTransactionData);loadView("view://brd/bankingapp/function/transactionhistory/detail/splittransactionhistorydetail",null);},updateLandingPageButton:function(){var b=$().dateParserWithoutTime(this.transactionHistoryFilter.CreatedAfter);var a=new Date(b-(7*this._DAY_)).dateFormat(resolve("bankingapp_common_dateFormatPattern"));this.transactionHistoryLoadMoreButton.find(".row1").text(resolve("bankingapp_brd_function_transactionhistory_loadmore_till")+" : "+a);},onContextMenuItemPressed:function(b,a){if(a=="transaction_history_filter"){loadView("view://brd/bankingapp/function/transactionhistory/filter/transactionhistoryfilter",null);}},onResume:function(){if(!this.transactionHistoryFilter){Bankingapp.framework.Application.callService("/transactionhistory/init",null,$.proxy(this.handleInitResult,this));}if(getFunctionAttribute("needListRefresh")==true){this.transactionHistorySearch(true);setFunctionAttribute("needListRefresh",false);}},isImmediateSearch:function(){this.immediateSearch=getSessionAttribute(Functions.transactionhistory.TransactionHistoryUtil.IMMEDIATE_SEARCH);if(this.immediateSearch!=null){return true;}else{return false;}}});Bankingapp.framework.Application.setView(Bankingapp.functions.transactionhistory.TransactionHistoryList);