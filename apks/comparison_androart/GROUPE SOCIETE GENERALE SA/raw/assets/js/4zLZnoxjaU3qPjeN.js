$().loadJavaScript("/js/cNGJpPRjrlEySoCA.js");$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");Class.ns("Bankingapp.functions.openaccount");Bankingapp.functions.openaccount.AmountSelector=Class.extend(Bankingapp.framework.View,{progressIndicatorStepCount:Functions.transferfunds.TransferUtils.OPENACCOUNT_STEPCOUNT_D,progressIndicatorCurrentStep:3,showPageInstructions:true,showProgressIndicator:true,containerId:"detailsCt",containerClass:"internaltransfer maincontainer",form:null,formId:"transferDetailsForm",formClass:"transfer-details-form",groupContainer:null,groupContainerClass:"groupcontainer",submitButtonLabelResourceKey:"bankingapp_brd_function_finances_openaccount_transferdetails_continue",submitButtonClass:"submit",currencyResourceKey:"bankingapp_brd_function_finances_openaccount_transferdetails_currency",emptyStringResourceKey:"bankingapp_brd_function_finances_openaccount_select",currencyPopupResourceKey:"bankingapp_brd_function_finances_openaccount_currency_popup_title",initialAmountResourceKey:"bankingapp_brd_function_finances_openaccount_transferdetails_initial_amount",friendlyNameFieldResourceKey:"bankingapp_brd_function_finances_openaccount_transferdetails_friendlyname",pageInstructionsResourceKey:"bankingapp_brd_function_finances_openaccount_amount_pageinstruction",pageInstructionsClass:"pagetitle separator textcenter",comboClass:"selectComboContainer combo inputfirst",amountField:null,currency:null,formDataFunctionAttributeId:Functions.transferfunds.TransferUtils.OPENACCOUNT_FORMDATA,layoutRender:function(){console.log("AmountSelector layoutRender ...");this.formData=getFunctionAttribute(this.formDataFunctionAttributeId);this.transferType=getFunctionAttribute("TransferType");console.log("transferType: "+this.transferType);this.container=$("<div>",{id:this.containerId,"class":this.containerClass});if(this.showProgressIndicator){this.container.append(new Bankingapp.ui.ProgressIndicator(this.progressIndicatorStepCount,this.progressIndicatorCurrentStep));}if(this.showPageInstructions){this.container.append(new Bankingapp.ui.Label(resolve(this.pageInstructionsResourceKey),{"class":this.pageInstructionsClass}));}this.form=new Bankingapp.ui.Form({id:this.formId,submitHandler:$.proxy(this.submitHandler,this),businessValidationHandler:$.proxy(this.businessValidator,this),"class":this.formClass});this.groupContainer=$("<div>",{"class":this.groupContainerClass});this.form.append(this.groupContainer);this.container.append(this.form);this.currencies=[this.formData.sourceAccount.currency];console.log(this.currencies);this.currency=new Bankingapp.ui.InputField({labelText:resolve(this.currencyResourceKey),inputRenderer:Bankingapp.ui.SelectButton,inputConfig:{id:"currencySelect",value:null,emptyString:resolve(this.emptyStringResourceKey),popupName:resolve(this.currencyPopupResourceKey),datas:this.currencies},baseInputContainerClass:this.comboClass});this.currency.setValue(this.currencies[0]);if(this.currencies.length==1){this.currency.disable();}this.amountField=new Bankingapp.ui.InputField(resolve(this.initialAmountResourceKey),{id:"amount",name:"amount",type:Functions.transferfunds.TransferUtils.getAmountInputFieldType(),value:(this.formData.initialAmount?this.formData.initialAmount:""),inputMaskPattern:/[0-9.,\+\-]/,validation:{whitelist:false,required:true,min:0,max:999999999999,number:true,maxlength:12}});this.friendlyNameField=new Bankingapp.ui.InputField(resolve(this.friendlyNameFieldResourceKey),{id:"friendlyNameField",name:"friendlyNameField",type:"text",value:"",validation:{required:false,whitelist:false,maxlength:200}});this.sourceAccountBalanceField=new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_openaccount_transferdetails_balance"),this.formData.sourceAccount.currency+" "+(this.formData.sourceAccount.availableBalance==undefined?"0":this.formData.sourceAccount.availableBalance));this.interestRateField=new Bankingapp.ui.OutputField(resolve("bankingapp_brd_function_finances_openaccount_transferdetails_interestrate"),this.formData.accountType.interestRate+" %");this.groupContainer.append(this.currency);this.groupContainer.append(this.amountField);this.groupContainer.append(this.friendlyNameField);this.groupContainer.append(this.sourceAccountBalanceField);this.groupContainer.append(this.interestRateField);this.renderSubmitButton();return this.container;},submitHandler:function(){console.log("submit handler ...");$.extend(this.formData,{initialAmount:this.amountField.val(),friendlyName:this.friendlyNameField.val(),transactionType:this.transferType});setFunctionAttribute(this.formDataFunctionAttributeId,this.formData);console.log("Forecast is possible ...");this.forecastRequest={InitialAmountNeeded:this.formData.accountType.initialAmountNeeded,InterestRate:this.formData.accountType.interestRate,InterestType:this.formData.accountType.interestType,MinInitialAmount:this.formData.accountType.minInitialAmount,TransactionType:"D",AccountType:this.formData.accountType.accountTypeCode,Currency:this.formData.sourceAccount.currency,FriendlyName:this.formData.friendlyName,SourceAccount:this.formData.sourceAccount.accountNumber,InitialAmount:this.formData.initialAmount};setFunctionAttribute(Functions.transferfunds.TransferUtils.OPENACCOUNT_FORECAST_REQUEST,this.forecastRequest);callService({serviceName:"/openaccount/forecast",request:{OpenAccountTransferRequest:getFunctionAttribute(Functions.transferfunds.TransferUtils.OPENACCOUNT_FORECAST_REQUEST)},callback:Bankingapp.framework.Application.proxy(this.handleForecastRequest,this,true)});},businessValidator:function(){if(this.amountField.val()==undefined||this.amountField.val()==""||this.amountField.val()<0.01){console.log("The amount is not valid!");return false;}return true;},renderSubmitButton:function(){console.log("render submit ...");var a={labelResourceKey:this.submitButtonLabelResourceKey,"class":this.submitButtonClass};this.submitButton=new Bankingapp.ui.SubmitButton(resolve(a.labelResourceKey),{"class":a["class"]});this.form.append(this.submitButton);},handleForecastRequest:function(a){setFunctionAttribute(Functions.transferfunds.TransferUtils.OPENACCOUNT_FORECAST_REPLY,a);loadView("view://brd/bankingapp/function/openaccount/forecastD",null);}});Bankingapp.framework.Application.setView(Bankingapp.functions.openaccount.AmountSelector);