$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");$().loadJavaScript("/js/AZPz8vN1TNFqZWpw.js");Class.ns("Bankingapp.functions.devicemanagement.activate");Bankingapp.functions.devicemanagement.activate.ActivateDeviceStep1=Class.extend(Bankingapp.framework.View,{container:null,signBlock:null,signReplyAttribute:"ACTIVATE_SIGN_REPLY",layoutRender:function(){this.container=$("<div>",{id:"activateDeviceMainContainer","class":"titledlist maincontainer"});this.step1Title=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_devicemanagement_activate_step1_title"),{"class":"title"});this.step1Label=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_devicemanagement_activate_step1_label"),{"class":"separator"});this.step1Time=$('<div style="font-size: 1em; font-weight: bold;">'+resolve("bankingapp_brd_function_devicemanagement_activate_step1_time")+"</div>");this.continueButton=new Bankingapp.ui.SubmitButton(resolve("bankingapp_brd_function_devicemanagement_step1_button_label"),{id:"continueButton","class":"continueButton"});this.continueButton.bind("buttonClick",$.proxy(this.activateButtonHandler,this));this.innerDiv=$("<div>",{});this.innerDiv.append(this.step1Title);this.innerDiv.append(this.step1Label);this.container.append(this.innerDiv);this.container.append(this.continueButton);debugLog("html: "+this.container.html());return this.container;},run:function(){debugLog("updatetime ...");var a={GetSystemTimeRequest:{}};Bankingapp.framework.Application.callService("/devicesmanagement/updatetime",a,$.proxy(this.handleUpdateTimeResponse,this));},activateButtonHandler:function(a,b){debugLog("Forecast run ...");Bankingapp.framework.Application.unBind("onErrorMessageReceived");$("body").bind("onErrorMessageReceived",$.proxy(this.errorMessageHandler,this));Bankingapp.framework.event.BrdServiceMessageHandler.handleMessages();this.continueButton.hide();this.signBlock=new Bankingapp.ui.ManualSignBlock({signMode:Functions.transferfunds.TransferUtils.SIGNMODE,tokenSubmitResourceKey:"bankingapp_function_transferfunds_signtransaction",submitButtonResourceKey:"bankingapp_function_transferfunds_signtransaction"});this.signBlock.bind("formSubmitted",$.proxy(this.submitHandler,this));this.container.append(this.signBlock);},handleUpdateTimeResponse:function(a){debugLog("handleUpdateTimeResponse");if(a!=undefined&&a.systemTime!==null){var d=a.systemTime;debugLog("system time: "+d);var b=Date.parseDate(d,resolve("bankingapp_common_parsedatepattern_withouttimezone"));var c=b.dateFormat(resolve("bankingapp_common_timeFormatPattern"));debugLog("formatted system time: "+c);this.step1Time=$('<div style="font-size: 1em; font-weight: bold;">'+resolve("bankingapp_brd_function_devicemanagement_activate_step1_time")+": "+c+"</div>");this.innerDiv.append(this.step1Time);}else{debugLog("Could not get system time!");}},errorMessageHandler:function(b,a){debugLog("Forecast errorMessageHandler ...");Bankingapp.framework.event.ServiceMessageHandler.errorMessageHandler(b,a);this.signBlock.remove();this.signBlock=new Bankingapp.ui.ManualSignBlock({signMode:Functions.transferfunds.TransferUtils.SIGNMODE,tokenSubmitResourceKey:"bankingapp_function_transferfunds_signtransaction",submitButtonResourceKey:"bankingapp_function_transferfunds_signtransaction"});this.signBlock.bind("formSubmitted",$.proxy(this.submitHandler,this));this.container.append(this.signBlock);},submitHandler:function(){debugLog("Forecast submitHandler ...");setFunctionAttribute(this.signReplyAttribute,this.signBlock.getCredential());Bankingapp.framework.Application.callService("/devicesmanagement/step1",{ActivationStep1Request:{credential:getFunctionAttribute(this.signReplyAttribute)}},$.proxy(this.handleSignResult,this));},handleSignResult:function(a){debugLog("Forecast handleSignResult ...");setFunctionAttribute(this.signReplyAttribute,a);loadView("view://brd/bankingapp/function/devicemanagement/activatestep2",null);}});Bankingapp.framework.Application.setView(Bankingapp.functions.devicemanagement.activate.ActivateDeviceStep1);