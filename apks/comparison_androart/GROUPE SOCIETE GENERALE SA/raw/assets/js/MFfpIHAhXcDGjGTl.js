$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");$().loadJavaScript("/js/cNGJpPRjrlEySoCA.js");Class.ns("Bankingapp.functions.transferfunds.bumppayment");Bankingapp.functions.transferfunds.bumppayment.TransferDetails=Class.extend(Bankingapp.framework.View,{showProgressIndicator:true,progressIndicatorStepCount:Functions.transferfunds.TransferUtils.BUMPRANSFER_STEPCOUNT,progressIndicatorCurrentStep:3,container:null,groupContainer:null,bumpData:null,formData:null,formId:"bumpPaymentForm",formClass:"transfer-details-form",groupContainerClass:"groupcontainer",bumpPaymentTargetAccountCurrency:null,bumpPaymentAmount:null,bumpPaymentDescription:null,bumpPaymentDate:null,bumpPaymentDateValue:new Date(),bumpPaymentReferenceNumber:null,displayDateFormat:resolve("bankingapp_brd_function_bumppayment_further_details_formdata_dateformat"),filterDateFormat:resolve("bankingapp_common_parsedatepattern_withouttime"),layoutRender:function(){debugLog(getFunctionAttribute(Functions.transferfunds.TransferUtils.BUMPRANSFER_FORMDATA));this.bumpData=getFunctionAttribute(Functions.transferfunds.TransferUtils.BUMPRANSFER_BUMPDATA);this.formData=getFunctionAttribute(Functions.transferfunds.TransferUtils.BUMPRANSFER_FORMDATA);this.container=$("<div>",{id:"addDetailsMainContainer","class":"list maincontainer"});if(this.showProgressIndicator){this.container.append(new Bankingapp.ui.ProgressIndicator(this.progressIndicatorStepCount,this.progressIndicatorCurrentStep));}return this.container;},run:function(){this.renderForm();},renderForm:function(){var b=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_bumppayment_further_details"),{"class":"pagetitle separator textcenter"});this.container.append(b);this.form=new Bankingapp.ui.Form({id:this.formId,submitHandler:$.proxy(this.submitHandler,this),businessValidationHandler:$.proxy(this.businessValidator,this),"class":this.formClass});this.groupContainer=$("<div>",{"class":this.groupContainerClass});this.form.append(this.groupContainer);this.container.append(this.form);var a=getFunctionAttribute("BUMPTRANSFER_TARGETCURRENCIES");this.bumpPaymentTargetAccountCurrency=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_brd_function_bumppayment_further_details_formdata_currency")+resolve("bankingapp_component_inputfield_requiredsign"),inputRenderer:Bankingapp.ui.SelectButton,inputConfig:{id:"currencySelectesA",emptyString:resolve("bankingapp_function_domestictransfer_select"),popupName:"Currency",datas:a},baseInputContainerClass:"selectComboContainer combo inputfirst"});this.bumpPaymentTargetAccountCurrency.setValue(getFunctionAttribute(Functions.transferfunds.TransferUtils.BUMPRANSFER_FORMDATA).forecastRequest.targetAccountCurrency);this.bumpPaymentTargetAccountCurrency.input.disable();this.bumpPaymentTargetAccountCurrency.input.removeClass("state_disabled");this.groupContainer.append(this.bumpPaymentTargetAccountCurrency);this.bumpPaymentAmount=new Bankingapp.ui.InputField(resolve("bankingapp_brd_function_bumppayment_further_details_formdata_amount"),{id:"billPaymentAmount",name:"billPaymentAmount",type:Functions.transferfunds.TransferUtils.getAmountInputFieldType(),value:(this.formData.forecastRequest==null?"":this.formData.forecastRequest.amount),inputMaskPattern:/[\d.]/,validation:{required:true,whitelist:false,min:0,max:999999999999,number:true}});this.groupContainer.append(this.bumpPaymentAmount);this.bumpPaymentDescription=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_brd_function_bumppayment_further_details_formdata_description"),showOptional:false,inputConfig:{id:"bumpPaymentDescription",name:"bumpPaymentDescription",type:"text",value:(this.formData.forecastRequest==null?"":this.formData.forecastRequest.description),validation:{required:false}}});this.groupContainer.append(this.bumpPaymentDescription);var c=$().dateParserWithoutTimezone(this.bumpPaymentDateValue).dateFormat(this.displayDateFormat);this.bumpPaymentDate=new Bankingapp.ui.ComplexButton([c],{id:"bumpPaymentDate","class":"calendar"});this.bumpPaymentDate.bind("buttonClick",$.proxy(this.bumpPaymentDateClickHandler,this));this.groupContainer.append(new Bankingapp.ui.LabeledComponent({labelText:(resolve("bankingapp_brd_function_bumppayment_further_details_formdata_date")+resolve("bankingapp_component_inputfield_requiredsign")),valueComponent:this.bumpPaymentDate}));if(Functions.transferfunds.TransferUtils.isCorporateUser()){this.bumpPaymentReferenceNumber=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_brd_function_bumppayment_further_details_formdata_referencenumber"),showOptional:false,inputConfig:{id:"bumpPaymentReferenceNumber",name:"bumpPaymentReferenceNumber",type:"text",value:(this.formData.forecastRequest==null?"":this.formData.forecastRequest.referenceNumber),validation:{required:Functions.transferfunds.TransferUtils.isCorporateUser(),maxlength:Functions.transferfunds.TransferUtils.REFERENCE_FIELD_MAXLENGTH}}});this.groupContainer.append(this.bumpPaymentReferenceNumber);}this.beneficiaryDetailsSubmitButton=new Bankingapp.ui.SubmitButton(resolve("bankingapp_brd_function_bumppayment_further_details_continue"),{"class":"continue"});this.form.append(this.beneficiaryDetailsSubmitButton);},businessValidator:function(){var h=[];var g=this.bumpPaymentTargetAccountCurrency.val();if(g==null||g==""){h.push(resolve("bankingapp_brd_function_bumppayment_currencyerror"));}var c=this.bumpPaymentAmount.val();if(!$.isNumeric(c)){h.push(resolve("bankingapp_brd_function_bumppayment_amounterror"));}var j=$().dateParserWithoutTime(this.bumpPaymentDateValue);var f=$().dateParserWithoutTime(new Date());f=$().setTimeOfDate(f,0,0,0,0);if(j.getTime()<f.getTime()){h.push(resolve("bankingapp_brd_function_bumppayment_valuedateinpast"));}var e=getFunctionAttribute("BUMPPAYMENT_INITRESPONSE").maxPaymentDate;if(e>0){var f=new Date();var a=new Date();a.setDate(f.getDate()+e);if(a.getTime()<j.getTime()){h.push(resolve("bankingapp_brd_function_bumppayment_valuedatetoofar",{"0":e}));}}if(h.length==0){return true;}else{var d="";for(var b in h){d=d+"\n"+h[b];}h=[];showError(d);return false;}},submitHandler:function(){$.extend(this.formData.forecastRequest,{amount:this.bumpPaymentAmount.val(),valueDate:$().formatDateForRequest(this.bumpPaymentDateValue)});if(this.bumpPaymentDescription.val()!=""){$.extend(this.formData.forecastRequest,{description:this.bumpPaymentDescription.val()});}if(this.bumpPaymentReferenceNumber!=null&&this.bumpPaymentReferenceNumber.val()!=""){$.extend(this.formData.forecastRequest,{referenceNumber:this.bumpPaymentReferenceNumber.val()});}debugLog("form data");debugLog(this.formData);setFunctionAttribute(Functions.transferfunds.TransferUtils.BUMPRANSFER_FORMDATA,this.formData);setFunctionAttribute(Functions.transferfunds.TransferUtils.BUMPRANSFER_FORECAST_REQUEST,this.formData.forecastRequest);var a={BillPaymentRequest:getFunctionAttribute(Functions.transferfunds.TransferUtils.BUMPRANSFER_FORECAST_REQUEST)};Bankingapp.framework.Application.callService("/bumptransfer/forecast",a,$.proxy(this.handleForecastRequest,this));},bumpPaymentDateClickHandler:function(b,a){showDatePicker(Bankingapp.framework.Application.proxy(this.afterDatePickerHandler,this,true));},afterDatePickerHandler:function(a){this.bumpPaymentDateValue=a.dateFormat(this.filterDateFormat);$("#bumpPaymentDate").find(".row0").text(a.dateFormat(this.displayDateFormat));},handleForecastRequest:function(a){debugLog("forecast result");debugLog(a);setFunctionAttribute(Functions.transferfunds.TransferUtils.BUMPRANSFER_FORECAST_REPLY,a);debugLog("forwarding to sign");loadView("view://brd/bankingapp/function/transferfunds/bumppayment/signpage",null);}});Bankingapp.framework.Application.setView(Bankingapp.functions.transferfunds.bumppayment.TransferDetails);