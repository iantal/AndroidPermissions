$().loadJavaScript("/js/cNGJpPRjrlEySoCA.js");$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");$().loadJavaScript("/js/GbyLuVz1r2rbR3xe.js");$().loadJavaScript("/js/CJoxWTp7R6qiVv1c.js");$().loadJavaScript("/js/tLpwqMHtBCZqub02.js");Class.ns("Bankingapp.functions.receivemoney.bringyourmoney");Bankingapp.functions.receivemoney.bringyourmoney.Dashboard=Class.extend(Bankingapp.framework.View,{progressIndicatorStepCount:Functions.transferfunds.TransferUtils.BRINGYOURMONEY_STEPCOUNT_1+1,formDataFunctionAttributeId:Functions.transferfunds.TransferUtils.BRINGYOURMONEY_FORMDATA,initDataFunctionAttributeId:Functions.transferfunds.TransferUtils.BRINGYOURMONEY_INITDATA,progressIndicatorCurrentStep:0,showPageInstructions:false,showProgressIndicator:true,containerId:"detailsCt",containerClass:"bring-your-money internaltransfer maincontainer",form:null,formId:"transferDetailsForm",formClass:"transfer-details-form",groupContainer:null,groupContainerClass:"groupcontainer",submitButtonLabelResourceKey:"bankingapp_brd_function_bringyourmoney_dashboard_initiatecardselection",submitButtonClass:"submit",pageInstructionsClass:"pagetitle separator left",pageInstructionsResourceKey:"bankingapp_brd_function_bringyourmoney_transferdetails_information_label",emptyStringResourceKey:"bankingapp_brd_function_bringyourmoney_select",formData:null,$this:null,layoutRender:function(){$this=this;this.container=$("<div>",{id:this.containerId,"class":this.containerClass});if(this.showProgressIndicator){this.container.append(new Bankingapp.ui.ProgressIndicator(this.progressIndicatorStepCount,this.progressIndicatorCurrentStep));}if(this.showPageInstructions){this.container.append(new Bankingapp.ui.Label(resolve(this.pageInstructionsResourceKey),{"class":this.pageInstructionsClass}));}this.form=new Bankingapp.ui.Form({id:this.formId,submitHandler:$.proxy(this.submitHandler,this),businessValidationHandler:$.proxy(this.businessValidator,this),"class":this.formClass});this.groupContainer=$("<div>",{"class":this.groupContainerClass});this.renderSubmitButton();this.form.append(this.groupContainer);this.container.append(this.form);this.refreshCardList();return this.container;},refreshCardList:function(){debugLog("refreshCardList ...");var a={GetBringYourMoneyCardListRequest:{}};Bankingapp.framework.Application.callService("/bringyourmoney/getCardList",a,$.proxy(this.handleListResult,this));},handleListResult:function(a){if(a){debugLog("storing the response ...");this.cardList=a.cardList;}else{debugLog("The response is not available!");}this.renderForm();debugLog("handleListResult, "+this.container.html());},renderForm:function(){debugLog("Dashboard renderForm ...");var f=this;this.lastItemCount=0;$("#fel").remove();$("#cardSelectionContainer").remove();var g=resolve("bankingapp_brd_function_bringyourmoney_dashboard_cardcategory");var d={};d.categoryName=g;d.cardList=this.transformToExpandableList(this.cardList);var e=new Array();e.push(d);var a=e;this.cardSelectionContainer=$("<div>",{id:"cardSelectionContainer","class":"list maincontainer"});debugLog("transformResult[i].categoryName: "+a[0].categoryName);this.lastItemCount=this.lastItemCount+1;var c=$("<div>",{id:"cardSelectionItemContainer"+this.lastItemCount,"class":"list maincontainer"});var b=new Bankingapp.ui.Label(a[0].categoryName,{"class":"listtitle"});var h=new Bankingapp.ui.ExpandableList({listData:a[0].cardList,secondLevelListName:"subDataList",itemRenderer:Bankingapp.functions.receivemoney.bringyourmoney.CardSelectionItem,secondLevelItemRenderer:Bankingapp.functions.receivemoney.bringyourmoney.CardSelectionItemSecondLevel,toggleListItem:function(i){debugLog("overridden toggleListItem ...");var j=this;$.each(this.itemsArray,function(k,l){if(l!=i){debugLog("Collapse item at: "+k);j.collapseListItem(l);}});if(i.hasClass(this.expandedClass)){this.collapseListItem(i);}else{this.expandListItem(i);}}});h.clickEventHandler=function(){};h.unbind("itemClick");h.bind("itemClick",$.proxy(this.itemClickHandler,this));h.unbind("refreshCardList");h.bind("refreshCardList",$.proxy(this.refreshCardList,this));if(this.lastItemCount==e.length){c.unbind("click");c.clickEventHandler=function(){};c.bind("click",$.proxy(this.listClickHandler,this));}c.append(b);c.append(h);this.cardSelectionContainer.append(c);this.container.append(this.cardSelectionContainer);this.container.append($("<div>",{id:"fel"}));return this.container;},transformToExpandableList:function(e){var c=new Array();if(!e){cosole.log("The input list is not available");return c;}for(var d in e){debugLog("processing "+e[d].cardNumber);var b={};b.cardId=e[d].cardId;b.cardType=e[d].cardType;b.cardExpiryDate=e[d].cardExpiryDate;b.cardNumber=e[d].cardNumber;b.lastUsedDate=e[d].lastUsedDate==undefined?null:e[d].lastUsedDate;if(b.lastUsedDate!=null){b.lastUsedDate=$().dateParserWithoutTime(b.lastUsedDate);}b.nextPaymentDate=e[d].nextPaymentDate==undefined?null:e[d].nextPaymentDate;if(b.nextPaymentDate!=null){b.nextPaymentDate=$().dateParserWithoutTime(b.nextPaymentDate);}b.frequency=e[d].frequency==undefined?null:e[d].frequency;b.currency=e[d].currency;b.amount=e[d].amount;b.transactionId=e[d].transactionId;var a=new Array();var f={};f.cardId=e[d].cardId;f.cardType=e[d].cardType;f.cardNumber=e[d].cardNumber;f.cardExpiryDate=e[d].cardExpiryDate;f.lastUsedDate=e[d].lastUsedDate;f.nextPaymentDate=e[d].nextPaymentDate;f.currency=e[d].currency;f.amount=e[d].amount;f.transactionId=e[d].transactionId;a.push(f);b.subDataList=a;c.push(b);}return c;},run:function(){debugLog("run ...");debugLog("run ready, "+this.container.html());},submitHandler:function(){debugLog("submitHandler ...");if(!this.businessValidator()){debugLog("The form is not valid!");return;}this.saveState();loadView("view://brd/bankingapp/function/receivemoney/bringyourmoney/targetaccountselection");},businessValidator:function(){return true;},renderSubmitButton:function(){var a={labelResourceKey:this.submitButtonLabelResourceKey,"class":this.submitButtonClass};this.submitButton=new Bankingapp.ui.SubmitButton(resolve(a.labelResourceKey),{"class":a["class"]});this.form.append(this.submitButton);},listClickHandler:function(b,c,a){debugLog("listClickHandler");setTimeout(function(){$("html, body").animate({scrollTop:$("#fel").offset().top},500);},300);},itemClickHandler:function(a,b){debugLog("item clicked");},saveState:function(){debugLog("saveState ...");this.formData=getFunctionAttribute(this.formDataFunctionAttributeId);if((this.formData==undefined)||(this.formData==null)){debugLog("formdata is not defined ...");this.formData={};}$.extend(this.formData,{progressIndicatorCurrentStep:this.progressIndicatorCurrentStep,savedCardId:null,savedCardType:null,savedMaskedCardNumber:null,savedAmount:null,savedCurrency:null});setFunctionAttribute(this.formDataFunctionAttributeId,this.formData);}});Bankingapp.framework.Application.setView(Bankingapp.functions.receivemoney.bringyourmoney.Dashboard);