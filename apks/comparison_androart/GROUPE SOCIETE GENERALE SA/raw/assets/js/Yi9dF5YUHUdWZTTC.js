$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");$().loadJavaScript("/js/CF0WiFs1SjIy0Szl.js");$().loadJavaScript("/js/NqvpUjhTwDggG7lG.js");Class.ns("Bankingapp.functions.devicemanagement");Bankingapp.functions.devicemanagement.UnlinkResult=Class.extend(Bankingapp.framework.View,{unlinkForecastReplyAttribute:"UNLINK_FORECAST_REPLY",selectedDevicesAttribute:"UNLINK_SELECTED_DEVICES",signDataAttribute:"UNLINK_SIGN_DATA",signReplyAttribute:"UNLINK_SIGN_REPLY",container:null,detailContainer:null,selectedDevices:null,currentDeviceDeleted:false,currentDeviceId:null,layoutRender:function(){debugLog("layoutRender");this.selectedDevices=getFunctionAttribute(this.selectedDevicesAttribute);this.container=$("<div>");this.ct=$("<div>",{"class":"formcontainer result"});this.container.append(this.ct);try{this.currentDeviceId=getDeviceId()+"";debugLog("this.currentDeviceId, "+this.currentDeviceId);}catch(b){debugLog("getDeviceId error");debugLog(b);}if(this.currentDeviceId){for(var a in this.selectedDevices){var c=this.selectedDevices[a].deviceId+"";if(c==this.currentDeviceId){this.currentDeviceDeleted=true;}}}debugLog("layoutRender ready! "+this.container.html());return this.container;},run:function(){Bankingapp.framework.event.BrdServiceMessageHandler.handleMessages();var h=getFunctionAttribute(this.signReplyAttribute);debugLog("signReply.success: "+h.deviceId);var l=h.deviceId?"successful":"error";debugLog("success: "+l);var j=this.currentDeviceDeleted?"bankingapp_brd_function_devicemanagement_unlink_current_success":"bankingapp_brd_function_devicemanagement_unlink_success";var m=resolve(j);if(!h.deviceId){debugLog("unlink failed!");m=resolve("bankingapp_brd_function_devicemanagement_unlink_failed");var e=getFunctionAttribute("MESSAGE_HANDLER_MESSAGES");if(e&&e.warnings){var c="";for(var f=0;f<e.warnings.length;f++){var k=e.warnings[f];if(c!=""){c=c+"\n";}c=c+k.code;}m=resolve("bankingapp_brd_function_devicemanagement_unlink_failed")+"("+c+")";}}var d={status:l,message:m,title:[resolve("bankingapp_brd_function_devicemanagement_unlink_title")],details:[]};for(var f in this.selectedDevices){var b=Date.parseDate(this.selectedDevices[f].activatedAt,resolve("bankingapp_common_parsedatepattern_withouttime"));var a=b.dateFormat(resolve("bankingapp_common_dateFormatPattern"));d.details.push({label:this.selectedDevices[f].friendlyName,value:""},{label:this.selectedDevices[f].deviceVendor,value:""},{label:resolve("bankingapp_brd_function_devicemanagement_activatedat")+": "+$.encoder.encodeForHTML(a),value:""});}this.ct.append(new Functions.transferfunds.DetailsResultComponent({detailsData:d,displayDateFormatKey:"bankingapp_brd_function_transfer_result_createTimeFormat"}));this.clearFunctionScope();var g=new Bankingapp.ui.ComplexButton(resolve("bankingapp_brd_function_devicemanagement_back_to_home"),{});this.ct.append(g);g.bind("buttonClick",$.proxy(this.backButtonHandler,this));Bankingapp.framework.event.ButtonHandler.setButtonHandler("BACK",$.proxy(this.backButtonHandler,this));debugLog("UnlinkResult run ready! "+this.container.html());},clearFunctionScope:function(){removeFunctionAttribute(this.unlinkForecastReplyAttribute);removeFunctionAttribute(this.selectedDevicesAttribute);removeFunctionAttribute(this.signDataAttribute);removeFunctionAttribute(this.signReplyAttribute);},backButtonHandler:function(a){if(this.currentDeviceDeleted){try{debugLog("resetActivationData ...");resetActivationData();}catch(b){debugLog("resetActivationData error");debugLog(b);}goToHomeView();}else{goToHomeView();}}});Bankingapp.framework.Application.setView(Bankingapp.functions.devicemanagement.UnlinkResult);