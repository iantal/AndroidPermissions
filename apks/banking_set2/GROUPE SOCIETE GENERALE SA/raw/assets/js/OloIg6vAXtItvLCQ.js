$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");$().loadJavaScript("/js/cNGJpPRjrlEySoCA.js");$().loadJavaScript("/js/SZANNrGlkovJNvLL.js");Class.ns("Bankingapp.functions.transferfunds.qrpayment");Bankingapp.functions.transferfunds.qrpayment.BeneficiaryDetails=Class.extend(Bankingapp.framework.View,{showProgressIndicator:true,progressIndicatorStepCount:Functions.transferfunds.TransferUtils.QRTRANSFER_STEPCOUNT,progressIndicatorCurrentStep:1,container:null,groupContainer:null,qrData:null,formData:null,formId:"idPaymentForm",formClass:"transfer-details-form",groupContainerClass:"groupcontainer",savePartner:null,savePartnerNameAs:null,beneficiaryDetailsSubmitButton:null,qrPaymentBeneficiaryName:null,qrPaymentTargetAccountNumber:null,qrPaymentTargetAccountCurrency:null,qrPaymentBeneficiaryAddress:null,layoutRender:function(){if(getFunctionAttribute(Functions.transferfunds.TransferUtils.QRTRANSFER_FORMDATA)!=null){this.formData=getFunctionAttribute(Functions.transferfunds.TransferUtils.QRTRANSFER_FORMDATA);}else{this.formData={};}this.qrData=getFunctionAttribute(Functions.transferfunds.TransferUtils.QRTRANSFER_BENEFICIARYDATA);this.formData.qrData=this.qrData;this.container=$("<div>",{id:"addDetailsMainContainer","class":"list maincontainer"});if(this.showProgressIndicator){this.container.append(new Bankingapp.ui.ProgressIndicator(this.progressIndicatorStepCount,this.progressIndicatorCurrentStep));}debugLog("this.formData");debugLog(this.formData);return this.container;},run:function(){if(getFunctionAttribute(Functions.transferfunds.TransferUtils.QRTRANSFER_TARGETCURRENCIES)==null){Bankingapp.framework.Application.callService("/qrtransfer/getTargetCurrencies",null,$.proxy(this.handleGetTargetCurrencies,this));}else{this.renderForm();}},handleGetTargetCurrencies:function(a){setFunctionAttribute(Functions.transferfunds.TransferUtils.QRTRANSFER_TARGETCURRENCIES,a);this.renderForm();},renderForm:function(){var c=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_qrpayment_beneficiary_details_title"),{"class":"pagetitle separator textcenter"});this.container.append(c);this.form=new Bankingapp.ui.Form({id:this.formId,submitHandler:$.proxy(this.submitHandler,this),businessValidationHandler:$.proxy(this.businessValidator,this),"class":this.formClass});this.groupContainer=$("<div>",{"class":this.groupContainerClass});this.form.append(this.groupContainer);this.container.append(this.form);this.qrPaymentBeneficiaryName=new Bankingapp.ui.InputField(resolve("bankingapp_brd_function_qrpayment_beneficiary_details_formdata_beneficiaryname"),{id:"qrPaymentBeneficiaryName",name:"qrPaymentBeneficiaryName",type:"text",value:(this.formData.forecastRequest==null?this.formData.qrData[Functions.transferfunds.QRNodeNamesISO20022.BENEFICIARY_NAME]:this.formData.forecastRequest.beneficiaryName),validation:{required:true,whitelist:false}});this.groupContainer.append(this.qrPaymentBeneficiaryName);this.qrPaymentTargetAccountNumber=new Bankingapp.ui.InputField(resolve("bankingapp_brd_function_qrpayment_beneficiary_details_formdata_accountnumber"),{id:"qrPaymentTargetAccountNumber",name:"qrPaymentTargetAccountNumber",type:"text",value:(this.formData.forecastRequest==null?this.formData.qrData[Functions.transferfunds.QRNodeNamesISO20022.BENEFICIARY_ACCOUNT]:this.formData.forecastRequest.targetAccount),validation:{required:true}});this.groupContainer.append(this.qrPaymentTargetAccountNumber);var a=getFunctionAttribute(Functions.transferfunds.TransferUtils.QRTRANSFER_TARGETCURRENCIES);this.qrPaymentTargetAccountCurrency=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_brd_function_qrpayment_beneficiary_details_formdata_currency"),inputRenderer:Bankingapp.ui.SelectButton,inputConfig:{id:"currencySelect",value:(this.formData.forecastRequest==null?this.formData.qrData[Functions.transferfunds.QRNodeNamesISO20022.BENEFICIARY_ACCOUNT_CURRENCY]:this.formData.forecastRequest.targetAccountCurrency),emptyString:resolve("bankingapp_function_domestictransfer_select"),popupName:"Currency",datas:a},baseInputContainerClass:"selectComboContainer combo inputfirst"});if(this.formData.qrData.targetAccountCurrency==null){this.qrPaymentTargetAccountCurrency.setValue(Functions.transferfunds.TransferUtils.DEFAULT_CURRENCY);}else{this.qrPaymentTargetAccountCurrency.setValue(this.formData.qrData[Functions.transferfunds.QRNodeNamesISO20022.BENEFICIARY_ACCOUNT_CURRENCY]);}this.groupContainer.append(this.qrPaymentTargetAccountCurrency);this.qrPaymentBeneficiaryAddress=new Bankingapp.ui.InputField(resolve("bankingapp_brd_function_qrpayment_beneficiary_details_formdata_address"),{id:"qrPaymentBeneficiaryAddress",name:"qrPaymentBeneficiaryAddress",type:"text",value:(this.formData.forecastRequest==null?this.formData.qrData[Functions.transferfunds.QRNodeNamesISO20022.BENEFICIARY_ADDRESS]:this.formData.forecastRequest.beneficiaryAddress),validation:{required:true,whitelist:false}});this.groupContainer.append(this.qrPaymentBeneficiaryAddress);var b=(this.formData.forecastRequest==null?false:this.formData.forecastRequest.savePartner);this.savePartner=new Bankingapp.ui.Checkbox({labelText:resolve("bankingapp_brd_function_qrpayment_beneficiary_details_savepartner"),value:b});this.savePartnerNameAs=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_brd_function_qrpayment_beneficiary_details_savepartneras"),showOptional:false,inputConfig:{id:"idPaymentPartnerName",name:"idPaymentPartnerName",type:"text",value:(this.formData.forecastRequest==null?"":this.formData.forecastRequest.partnerName),showOptional:false,validation:{maxlength:200,whitelist:false}}});if(!b){this.savePartnerNameAs.hide();}this.savePartnerContainer=$("<div>",{"class":this.groupContainerClass});if(Bankingapp.framework.Application.isAuthorized("domestictransferoneshot/create")){this.form.append(this.savePartner);this.savePartner.bind("click",$.proxy(this.savePartnerClickHandler,this));this.form.append(this.savePartnerContainer);this.savePartnerContainer.append(this.savePartnerNameAs);}else{debugLog("The domestictransferoneshot is not allowed!");}this.beneficiaryDetailsSubmitButton=new Bankingapp.ui.SubmitButton(resolve("bankingapp_brd_function_qrpayment_beneficiary_details_continue"),{"class":"continue"});this.form.append(this.beneficiaryDetailsSubmitButton);},businessValidator:function(){var e=[];var g=this.qrPaymentBeneficiaryName.val();var d=/^[0-9a-zA-Z_ -]+$/;if(g==null||g==""||!d.test(g)){e.push(resolve("bankingapp_brd_function_qrpayment_beneficiaryerror"));}var b=this.qrPaymentTargetAccountCurrency.val();if(b==null||b==""){e.push(resolve("bankingapp_brd_function_qrpayment_currencyerror"));}var a=this.savePartner.val();var h=this.savePartnerNameAs.val();if(a&&(h==null||h=="")){e.push(resolve("bankingapp_brd_function_qrpayment_partnermissingerror"));}else{if(a&&!d.test(h)){e.push(resolve("bankingapp_brd_function_qrpayment_partnernameerror"));}}if(e.length==0){return true;}else{var c="";for(var f in e){c=c+"\n"+e[f];}e=[];showError(c);return false;}},savePartnerClickHandler:function(){if(this.savePartner.val()){this.savePartnerNameAs.show();}else{this.savePartnerNameAs.hide();}},submitHandler:function(){this.formData.forecastRequest={beneficiaryName:this.qrPaymentBeneficiaryName.val(),beneficiaryAddress:this.qrPaymentBeneficiaryAddress.val(),targetAccount:this.qrPaymentTargetAccountNumber.val(),savePartner:this.savePartner.val()};targetAccountCurrency=this.qrPaymentTargetAccountCurrency.val();$.extend(this.formData.forecastRequest,{targetAccountCurrency:targetAccountCurrency});if(this.savePartner.val()){if(!(this.savePartnerNameAs===undefined)&&!(this.savePartnerNameAs===null)&&!(this.savePartnerNameAs.val()=="")){this.formData.forecastRequest["partnerName"]=this.savePartnerNameAs.val();}}debugLog("forecast request");debugLog(this.formData);setFunctionAttribute(Functions.transferfunds.TransferUtils.QRTRANSFER_FORMDATA,this.formData);setFunctionAttribute(Functions.transferfunds.TransferUtils.QRTRANSFER_FORECAST_REQUEST,this.formData.forecastRequest);loadView("view://brd/bankingapp/function/transferfunds/qrpayment/sourceaccountselection",null);}});Bankingapp.framework.Application.setView(Bankingapp.functions.transferfunds.qrpayment.BeneficiaryDetails);