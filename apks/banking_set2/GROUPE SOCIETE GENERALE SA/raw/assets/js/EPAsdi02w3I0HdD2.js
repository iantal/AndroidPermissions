Class.ns("Bankingapp.functions.accountinfo");$().loadJavaScript("/js/NxUuHk46cC4lqfew.js");Bankingapp.functions.accountinfo.AccountStatementList=Class.extend(Bankingapp.ui.Component,{accountStatementFilterAttributeName:"STATEMENT_FILTER",accountStatementContainer:null,displayDateFormat:resolve("bankingapp_common_dateFormatPattern"),displayTimeFormat:resolve("bankingapp_common_timeFormatPattern_min"),filterDateFormat:resolve("bankingapp_common_dateFormatPattern"),displayTimeFormatFilter:resolve("bankingapp_common_timeFormatPattern"),printButton:null,printButtonContainer:null,loadMoreFilter:null,constructor:function(a){this.applyConfig(a);Bankingapp.framework.Application.bind("onContextMenuItemPressed",$.proxy(this.onContextMenuItemPressed,this));this.accountStatementContainer=$("<div>",{id:"accountStatementContainer","class":"list maincontainer"});this.append(this.accountStatementContainer);this.currentFilterContainer=$("<div>",{id:"currentFilterContainer"});this.accountStatementContainer.append(this.currentFilterContainer);this.lastSyncContainer=$("<div>",{id:"lastSyncContainer"});this.accountStatementContainer.append(this.lastSyncContainer);this.printButtonContainer=$("<div>",{id:"printButtonContainer"});this.accountStatementContainer.append(this.printButtonContainer);this.accountStatementListContainer=$("<div>",{id:"accountStatementListContainer"});this.accountStatementContainer.append(this.accountStatementListContainer);this.getStatementList();return this.accountStatementContainer;},getStatementList:function(){var a={AccountNumber:getSessionAttribute(this.accountStatementFilterAttributeName).AccountNumber,FromDate:getSessionAttribute(this.accountStatementFilterAttributeName).FromDate,EndDate:getSessionAttribute(this.accountStatementFilterAttributeName).EndDate,Credit:getSessionAttribute(this.accountStatementFilterAttributeName).Credit,Debit:getSessionAttribute(this.accountStatementFilterAttributeName).Debit};this.loadMoreFilter=getSessionAttribute(this.accountStatementFilterAttributeName);Bankingapp.framework.Application.callService("/statement/getStatementList",{StatementListRequest:a},$.proxy(this.handleListResult,this));},handleListResult:function(c){this.accountStatementListFilterDiv=$("<div>",{"class":"accountStatementListFilterOuter"});var h=$("<div>",{"class":"accountStatementListFilterRow"});var g=$("<div>",{"class":"accountStatementListFilterRow"});var i=$("<span>",{"class":"accountStatementListFilterCell-left"});var b=$("<span>",{"class":"accountStatementListFilterCell-left"});var a=$("<span>",{"class":"accountStatementListFilterCell-right"});i.append($("<span>").append(resolve("bankingapp_brd_function_statement_currentfilter_title")));b.append($("<span>").append(resolve("bankingapp_brd_function_statement_currentfilter_date")));var e=$().dateParserWithoutTimezone(c.statementSyncTime);var f=$().dateParserWithoutTime(getSessionAttribute(this.accountStatementFilterAttributeName).FromDate);var d=$().dateParserWithoutTime(getSessionAttribute(this.accountStatementFilterAttributeName).EndDate);a.append($("<span>").append(": "+f.dateFormat(this.displayDateFormat)+" - "+d.dateFormat(this.displayDateFormat)));h.append(i);g.append(b);g.append(a);this.accountStatementListFilterDiv.append(h);this.accountStatementListFilterDiv.append(g);this.currentFilterContainer.append(this.accountStatementListFilterDiv);this.accountStatementListSyncDiv=$("<div>",{"class":"accountStatementListSyncDiv"});this.accountStatementListSyncDiv.append(resolve("bankingapp_brd_function_statement_lastsync",{"0":e.dateFormat(this.displayTimeFormatFilter)}));this.lastSyncContainer.append(this.accountStatementListSyncDiv);this.printButton=new Bankingapp.ui.SubmitButton(resolve("bankingapp_brd_function_statement_printlist"),{id:"downloadButton","class":"downloadButton"});this.printButton.bind("buttonClick",$.proxy(this.downloadPdfClickHandler,this));this.printButtonContainer.append(this.printButton);this.accountStatementList=new Bankingapp.ui.HistoricList([],{itemRenderer:Bankingapp.functions.accountinfo.AccountStatementItem,id:"transactionId",dateField:"transactionDate",dataDateFormat:resolve("bankingapp_common_parsedatepattern_withouttimezone"),displayDateFormat:resolve("bankingapp_common_dateFormatPattern"),showDateInPeriods:false,dataOrder:"desc"});this.accountStatementList.appendItems(c.statementList);this.accountStatementListContainer.append(this.accountStatementList);this.generateLoadMoreButton();this.accountStatementList.bind("itemClick",$.proxy(this.itemClickHandler,this));},bankloadMoreButtonHandler:function(){var d=this.loadMoreFilter;var a=$().dateParserWithoutTime(d.EndDate);var b=$().dateParserWithoutTime(d.FromDate);b.setDate(b.getDate()-7);var c={AccountNumber:getSessionAttribute(this.accountStatementFilterAttributeName).AccountNumber,FromDate:b,EndDate:a,Credit:getSessionAttribute(this.accountStatementFilterAttributeName).Credit,Debit:getSessionAttribute(this.accountStatementFilterAttributeName).Debit};debugLog("XXXX from date"+b);debugLog("XXXX end date : "+a);d.FromDate=b;d.EndDate=a;this.loadMoreFilter=d;Bankingapp.framework.Application.callService("/statement/getStatementList",{StatementListRequest:c},$.proxy(this.handleLoadMoreResult,this));},handleLoadMoreResult:function(a){this.accountStatementList.empty();this.accountStatementList.appendItems(a.statementList);this.generateLoadMoreButton();},generateLoadMoreButton:function(){if(this.accountStatementList.isEmpty()){return;}var a=$().dateParserWithoutTime(this.loadMoreFilter.FromDate);if(this.loadMoreButton!=null){$("#loadMoreButtonContainer").find(".row1").text(resolve("bankingapp_brd_function_statement_transactionstill",{"0":a.dateFormat(this.displayDateFormat)}));}else{this.loadMoreButtonContainer=$("<div>",{id:"loadMoreButtonContainer"});this.loadMoreButton=new Bankingapp.ui.LandingPageButton([resolve("bankingapp_brd_function_statement_loadonemoreweek"),resolve("bankingapp_brd_function_statement_transactionstill",{"0":a.dateFormat(this.displayDateFormat)})],{"class":"buttonClass"});this.loadMoreButton.bind("buttonClick",$.proxy(this.bankloadMoreButtonHandler,this));this.loadMoreButtonContainer.append(this.loadMoreButton);this.accountStatementListContainer.append(this.loadMoreButtonContainer);}},itemClickHandler:function(b,a){setFunctionAttribute("SELECTED_TRANSACTION",a);loadView("view://brd/bankingapp/function/accountinfo/statementdetails",null);},onContextMenuItemPressed:function(b,a){if(a=="statement_list_filter"){}},setStatementFilterResult:function(a){this.getStatementList();},downloadPdfClickHandler:function(b,c){var a={AccountNumber:getSessionAttribute(this.accountStatementFilterAttributeName).AccountNumber,From:getSessionAttribute(this.accountStatementFilterAttributeName).FromDate,To:getSessionAttribute(this.accountStatementFilterAttributeName).EndDate,Credit:getSessionAttribute(this.accountStatementFilterAttributeName).Credit,Debit:getSessionAttribute(this.accountStatementFilterAttributeName).Debit};Bankingapp.framework.Application.callService("/statement/getStatementDownloadKey",{GetDocumentDownloadKeyRequest:a},$.proxy(this.handlePdfDownload,this));},handlePdfDownload:function(b){var a=getGatewayUrl()+"/statement/getPrintedDocument/"+b.key;openBrowser(a);}});