$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");Class.ns("Functions.transferfunds.payment2phone");Functions.transferfunds.payment2phone.TransferDetails=Class.extend(Bankingapp.framework.View,{container:null,containerId:"payment2phoneDetailsMainContainer",containerClass:"payment2phone maincontainer",showProgressIndicator:true,progressIndicatorStepCount:4,progressIndicatorCurrentStep:2,showPageInstructions:true,pageInstructionsClass:"pagetitle separator textcenter",pageInstructionsResourceKey:"bankingapp_function_payment2phone_instruction",phonenumberListResourceKey:"bankingapp_function_payment2phone_phone_numberlist",pageWarningBeneficiary:"bankingapp_function_payment2phone_warning_beneficiary",pageWarningBeneficiaryTitle:"bankingapp_function_payment2phone_warning_title",COUNT_PHONENUMBERS_12:12,COUNT_PHONENUMBERS_13:13,COUNT_PHONENUMBERS_10:10,form:null,formId:"transferDetailsForm",formClass:"transfer-details-form",groupContainer:null,groupContainerClass:"groupcontainer",valueDateButton:null,formData:null,forecastRequest:null,amountField:null,descriptionField:null,beneficiaryField:null,phoneNumber:null,currencyField:null,layoutRender:function(){this.formData=getFunctionAttribute(Functions.transferfunds.TransferUtils.PAYMENT2PHONE_FORMDATA);this.container=$("<div>",{id:this.containerId,"class":this.containerClass});this.container.append(new Bankingapp.ui.ProgressIndicator(this.progressIndicatorStepCount,this.progressIndicatorCurrentStep));this.container.append(new Bankingapp.ui.Label(resolve(this.pageInstructionsResourceKey),{"class":this.pageInstructionsClass}));var d=[];var c=new Object();c.title=resolve(this.pageWarningBeneficiaryTitle);c.details=resolve(this.pageWarningBeneficiary);d.push(c);this.container.append(new Bankingapp.ui.MessageBlock(d,{baseClass:"warningblock"}));var b=new Bankingapp.ui.ComplexButton(resolve("bankingapp_function_payment2phone_selectcontact"),{});this.container.append(b);b.bind("buttonClick",$.proxy(this.contactListHandler,this));this.form=new Bankingapp.ui.Form({id:this.formId,submitHandler:$.proxy(this.submitHandler,this),businessValidationHandler:$.proxy(this.businessValidator,this),"class":this.formClass});this.groupContainer=$("<div>",{"class":this.groupContainerClass});this.form.append(this.groupContainer);this.container.append(this.form);this.beneficiaryField=new Bankingapp.ui.InputField(resolve("bankingapp_function_payment2phone_beneficiaryname"),{id:"beneficiaryName",name:"beneficiaryName",type:"text",validation:{required:true,maxlength:200}});this.groupContainer.append(this.beneficiaryField);this.phoneNumber=new Bankingapp.ui.InputField(resolve("bankingapp_function_payment2phone_phonenumber"),{id:"phoneNumber",name:"phoneNumber",type:"text",inputMaskPattern:/[+\d]/,validation:{required:true,maxlength:200,whitelist:false}});this.groupContainer.append(this.phoneNumber);var a=[];a.push(this.formData.sourceAccount.currency);this.currencyField=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_function_payment2phone_currency"),inputRenderer:Bankingapp.ui.SelectButton,inputConfig:{id:"currency",value:null,emptyString:resolve("bankingapp_function_internaltransfer_select"),popupName:"Currency",datas:a},baseInputContainerClass:"selectComboContainer combo inputfirst"});this.currencyField.setValue(a[0]);this.currencyField.disable();this.groupContainer.append(this.currencyField);this.amountField=new Bankingapp.ui.InputField(resolve("bankingapp_function_payment2phone_amount"),{id:"amount",name:"amount",type:Functions.transferfunds.TransferUtils.getAmountInputFieldType(),value:(this.formData.amount?this.formData.amount:""),inputMaskPattern:/[0-9.,\+\-]/,validation:{whitelist:false,required:true,min:0,max:999999999999,number:true,maxlength:12}});this.groupContainer.append(this.amountField);this.descriptionField=new Bankingapp.ui.InputField(resolve("bankingapp_function_payment2phone_description"),{id:"description",name:"description",type:"text",value:(this.formData.description?this.formData.description:""),validation:{whitelist:false,maxlength:200}});this.groupContainer.append(this.descriptionField);this.form.append(new Bankingapp.ui.SubmitButton(resolve("bankingapp_function_transferfunds_continue"),{"class":"sumbit"}));return this.container;},formPhoneNumber:function(a){var b=undefined;if(a){b=a.replace(/-/g,"").replace(/\//g,"").replace(/\s/g,"");if(b.indexOf("(072)")==0){b=b.replace("(072)","+4072");}b=b.replace("(","").replace(")","");}return b;},joinNames:function(b){var a=(b.prefix?b.prefix+" ":"")+(b.firstName?b.firstName+" ":"")+(b.middleName?b.middleName+" ":"")+(b.lastName?b.lastName+" ":"")+(b.suffix?b.suffix+" ":"");return a.trim();},contactListHandler:function(){showContactPicker(Bankingapp.framework.Application.proxy(this.showContactPickerCallback,this,true));},showContactPickerCallback:function(a){this.beneficiaryField.setValue(this.joinNames(a.name));if(a.phoneNumbers.length>1){var c=[];for(var b=0;b<a.phoneNumbers.length;b++){var d=this.formPhoneNumber(a.phoneNumbers[b].phoneNumber);if(d){c.push(d);}}showListPicker(resolve(this.phonenumberListResourceKey),c,Bankingapp.framework.Application.proxy(this.showListPickerCallback,this,true));}else{var d=this.formPhoneNumber(a.phoneNumbers[0].phoneNumber);if(d){this.phoneNumber.setValue(d);}}},showListPickerCallback:function(a){this.phoneNumber.setValue(a);},submitHandler:function(){this.forecastRequest=new Object();this.forecastRequest.description=this.descriptionField.val();this.forecastRequest.amount=this.amountField.val();this.forecastRequest.beneficiaryName=this.beneficiaryField.val();this.forecastRequest.phoneNumber=this.phoneNumber.val();this.forecastRequest.sourceAccount=this.formData.sourceAccount.accountNumber;this.forecastRequest.currency=this.formData.sourceAccount.currency;$.extend(this.formData,{description:this.forecastRequest.description,amount:this.forecastRequest.amount,beneficiaryName:this.forecastRequest.beneficiaryName,phoneNumber:this.forecastRequest.phoneNumber,currency:this.formData.sourceAccount.currency});setFunctionAttribute(Functions.transferfunds.TransferUtils.PAYMENT2PHONE_FORMDATA,this.formData);Bankingapp.framework.Application.callService("/payment2phone/forecast",{Payment2PhoneTransferRequest:this.forecastRequest},$.proxy(this.handleForecastRequest,this));},handleForecastRequest:function(a){setFunctionAttribute(Functions.transferfunds.TransferUtils.PAYMENT2PHONE_FORECAST_REPLY,a);loadView("view://brd/bankingapp/function/transferfunds/payment2phone/sign",null);},businessValidator:function(){var f=false;var g=getFunctionAttribute(Functions.transferfunds.TransferUtils.PAYMENT2PHONE_INITDATA);if(g&&g.validPhoneNumberPrefixes){var h=g.validPhoneNumberPrefixes.split(",");var c=this.phoneNumber.val();var b=null;var a=null;if(c.indexOf("+")==0){if(c.length==12&&c.substring(1,3)=="40"){b=c.substring(3,5);a=c.substring(5,12);f=true;}}else{if(c.indexOf("00")==0){if(c.length==13&&c.substring(2,4)=="40"){b=c.substring(4,6);a=c.substring(6,13);f=true;}}else{if(c.indexOf("0")==0){if(c.length==10){b=c.substring(1,3);a=c.substring(3,10);f=true;}}}}if(f){f=false;for(var e=0;e<h.length;e++){var d=h[e];if(d==b){f=true;break;}}}if(!f){showError(resolve("bankingapp_function_payment2phone_phone_validation"));return false;}this.phoneNumber.setValue("+40"+b+a);}return true;}});Bankingapp.framework.Application.setView(Functions.transferfunds.payment2phone.TransferDetails);