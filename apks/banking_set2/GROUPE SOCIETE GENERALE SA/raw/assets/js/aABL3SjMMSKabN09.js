$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");$().loadJavaScript("/js/SZANNrGlkovJNvLL.js");$().loadJavaScript("/js/cNGJpPRjrlEySoCA.js");Class.ns("Bankingapp.functions.transferfunds.qrpayment");Bankingapp.functions.transferfunds.qrpayment.TransferDetails=Class.extend(Bankingapp.framework.View,{showProgressIndicator:true,progressIndicatorStepCount:Functions.transferfunds.TransferUtils.QRTRANSFER_STEPCOUNT,progressIndicatorCurrentStep:3,container:null,groupContainer:null,qrData:null,formData:null,formId:"qrPaymentForm",formClass:"transfer-details-form",groupContainerClass:"groupcontainer",qrPaymentTargetAccountCurrency:null,qrPaymentAmount:null,qrPaymentDescription:null,qrPaymentDate:null,qrPaymentDateValue:new Date(),qrPaymentReferenceNumber:null,displayDateFormat:resolve("bankingapp_brd_function_qrpayment_further_details_formdata_dateformat"),filterDateFormat:resolve("bankingapp_common_parsedatepattern_withouttime"),layoutRender:function(){debugLog(getFunctionAttribute(Functions.transferfunds.TransferUtils.QRTRANSFER_FORMDATA));this.qrData=getFunctionAttribute(Functions.transferfunds.TransferUtils.QRTRANSFER_BENEFICIARYDATA);this.formData=getFunctionAttribute(Functions.transferfunds.TransferUtils.QRTRANSFER_FORMDATA);this.container=$("<div>",{id:"addDetailsMainContainer","class":"list maincontainer"});if(this.showProgressIndicator){this.container.append(new Bankingapp.ui.ProgressIndicator(this.progressIndicatorStepCount,this.progressIndicatorCurrentStep));}return this.container;},run:function(){this.renderForm();},renderForm:function(){var f=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_qrpayment_further_details"),{"class":"pagetitle separator textcenter"});this.container.append(f);this.form=new Bankingapp.ui.Form({id:this.formId,submitHandler:$.proxy(this.submitHandler,this),businessValidationHandler:$.proxy(this.businessValidator,this),"class":this.formClass});this.groupContainer=$("<div>",{"class":this.groupContainerClass});this.form.append(this.groupContainer);this.container.append(this.form);var e=getFunctionAttribute("QRPAYMENT_SOURCEACCOUNT").currency;var c=this.formData.forecastRequest.targetAccountCurrency;var d=[];d.push(e);d.push(c);this.qrPaymentTargetAccountCurrency=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_brd_function_qrpayment_further_details_formdata_currency")+resolve("bankingapp_component_inputfield_requiredsign"),inputRenderer:Bankingapp.ui.SelectButton,inputConfig:{id:"currencySelectes",emptyString:resolve("bankingapp_function_domestictransfer_select"),popupName:"Currency",datas:d},baseInputContainerClass:"selectComboContainer combo inputfirst"});if(e==c){this.qrPaymentTargetAccountCurrency.disable();}this.qrPaymentTargetAccountCurrency.setValue(e);this.groupContainer.append(this.qrPaymentTargetAccountCurrency);var b=null;if(this.formData.forecastRequest.amount!=null){b=this.formData.forecastRequest.amount;}else{if(this.formData.qrData[Functions.transferfunds.QRNodeNamesISO20022.TRANSACTION_AMOUNT]!=null){b=this.formData.qrData[Functions.transferfunds.QRNodeNamesISO20022.TRANSACTION_AMOUNT];}else{b="";}}this.qrPaymentAmount=new Bankingapp.ui.AmountInput({labelText:resolve("bankingapp_brd_function_qrpayment_further_details_formdata_amount"),showOptional:false,required:true,inputConfig:{id:"qrPaymentAmount",name:"qrPaymentAmount",type:Functions.transferfunds.TransferUtils.getAmountInputFieldType(),value:b,inputMaskPattern:/[\d.]/,validation:{required:true,whitelist:false,min:0,max:999999999999,number:true}}});this.groupContainer.append(this.qrPaymentAmount);var a=null;if(this.formData.forecastRequest.description!=null){a=this.formData.forecastRequest.description;}else{if(this.formData.qrData[Functions.transferfunds.QRNodeNamesISO20022.TRANSACTION_DESCRIPTION]!=null){a=this.formData.qrData[Functions.transferfunds.QRNodeNamesISO20022.TRANSACTION_DESCRIPTION];}else{a="";}}this.qrPaymentDescription=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_brd_function_qrpayment_further_details_formdata_description"),showOptional:true,inputConfig:{id:"qrPaymentDescription",name:"qrPaymentDescription",type:"text",value:a,validation:{required:false}}});this.groupContainer.append(this.qrPaymentDescription);var g=$().dateParserWithoutTimezone(this.qrPaymentDateValue).dateFormat(this.displayDateFormat);this.qrPaymentDate=new Bankingapp.ui.ComplexButton([g],{id:"qrPaymentDate","class":"calendar"});this.qrPaymentDate.bind("buttonClick",$.proxy(this.qrPaymentDateClickHandler,this));this.groupContainer.append(new Bankingapp.ui.LabeledComponent({labelText:(resolve("bankingapp_brd_function_qrpayment_further_details_formdata_date")+resolve("bankingapp_component_inputfield_requiredsign")),valueComponent:this.qrPaymentDate}));if(Functions.transferfunds.TransferUtils.isCorporateUser()){this.qrPaymentReferenceNumber=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_brd_function_qrpayment_further_details_formdata_referencenumber"),showOptional:false,required:true,inputConfig:{id:"qrPaymentReferenceNumber",name:"qrPaymentReferenceNumber",type:"text",value:(this.formData.forecastRequest==null?"":this.formData.forecastRequest.referenceNumber),validation:{required:Functions.transferfunds.TransferUtils.isCorporateUser(),maxlength:Functions.transferfunds.TransferUtils.REFERENCE_FIELD_MAXLENGTH}}});this.groupContainer.append(this.qrPaymentReferenceNumber);}this.beneficiaryDetailsSubmitButton=new Bankingapp.ui.SubmitButton(resolve("bankingapp_brd_function_qrpayment_further_continue"),{"class":"continue"});this.form.append(this.beneficiaryDetailsSubmitButton);},businessValidator:function(){var h=[];var g=this.qrPaymentTargetAccountCurrency.val();if(g==null||g==""){h.push(resolve("bankingapp_brd_function_qrpayment_currencyerror"));}var c=this.qrPaymentAmount.val();if(!$.isNumeric(c)){h.push(resolve("bankingapp_brd_function_qrpayment_amounterror"));}var j=$().dateParserWithoutTime(this.qrPaymentDateValue);var f=$().dateParserWithoutTime(new Date());f=$().setTimeOfDate(f,0,0,0,0);if(j.getTime()<f.getTime()){h.push(resolve("bankingapp_brd_function_qrpayment_valuedateinpast"));}var e=getFunctionAttribute("QRPAYMENT_INITRESPONSE").maxPaymentDate;if(e>0){var f=new Date();var a=new Date();a.setDate(f.getDate()+e);if(a.getTime()<j.getTime()){h.push(resolve("bankingapp_brd_function_qrpayment_valuedatetoofar",{"0":e}));}}if(h.length==0){return true;}else{var d="";for(var b in h){d=d+"\n"+h[b];}h=[];showError(d);return false;}},submitHandler:function(){this.formData.forecastRequest.currency=this.qrPaymentTargetAccountCurrency.val();$.extend(this.formData.forecastRequest,{amount:this.qrPaymentAmount.val(),valueDate:this.qrPaymentDateValue});if(this.qrPaymentDescription.val()!=""){$.extend(this.formData.forecastRequest,{description:this.qrPaymentDescription.val()});}if(this.qrPaymentReferenceNumber!=null&&this.qrPaymentReferenceNumber.val()!=""){$.extend(this.formData.forecastRequest,{referenceNumber:this.qrPaymentReferenceNumber.val()});}debugLog("form data");debugLog(this.formData);setFunctionAttribute(Functions.transferfunds.TransferUtils.QRTRANSFER_FORMDATA,this.formData);setFunctionAttribute(Functions.transferfunds.TransferUtils.QRTRANSFER_FORECAST_REQUEST,this.formData.forecastRequest);var a={DomesticTransferRequest:getFunctionAttribute(Functions.transferfunds.TransferUtils.QRTRANSFER_FORECAST_REQUEST)};debugLog("forecastRequest");debugLog(a);Bankingapp.framework.Application.callService("/qrtransfer/forecast",a,$.proxy(this.handleForecastRequest,this));},qrPaymentDateClickHandler:function(b,a){showDatePicker(Bankingapp.framework.Application.proxy(this.afterDatePickerHandler,this,true));},afterDatePickerHandler:function(a){this.qrPaymentDateValue=a.dateFormat(this.filterDateFormat);$("#qrPaymentDate").find(".row0").text(a.dateFormat(this.displayDateFormat));},handleForecastRequest:function(a){debugLog("forecast result");debugLog(a);setFunctionAttribute(Functions.transferfunds.TransferUtils.QRTRANSFER_FORECAST_REPLY,a);debugLog("forwarding to sign");loadView("view://brd/bankingapp/function/transferfunds/qrpayment/signpage",null);}});Bankingapp.framework.Application.setView(Bankingapp.functions.transferfunds.qrpayment.TransferDetails);