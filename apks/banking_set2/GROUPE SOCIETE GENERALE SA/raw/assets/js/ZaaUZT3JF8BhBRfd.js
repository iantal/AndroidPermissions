Class.ns("Functions.transferfunds.domestictransfer.partnerselection");$().loadJavaScript("/js/7q8BJALyaANUXYuq.js");$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");Functions.transferfunds.domestictransfer.partnerselection.PartnerSelection=Class.extend(Bankingapp.framework.View,{container:null,partnerItemIdField:"partnerId",partnerList:null,listData:[],formData:null,emptyListResourceKey:"bankingapp_function_domestictransfer_no_partners",formDataFunctionAttributeId:Functions.transferfunds.TransferUtils.DOMESTICTRANSFER_FORMDATA,layoutRender:function(){Bankingapp.framework.Application.bind("onContextMenuItemPressed",$.proxy(this.onContextMenuItemPressed,this));this.container=$("<div>",{id:"partnerSelectionMainContainer","class":"list maincontainer"});debugLog("Oneshot enabled: "+Bankingapp.framework.Application.isAuthorized("domestictransferoneshot/create"));var b=new Bankingapp.ui.SubmitButton(resolve("bankingapp_function_domestictransfer_setpartnermanually"),{disabled:!Bankingapp.framework.Application.isAuthorized("domestictransferoneshot/create"),"class":"submit"});this.container.append(b);b.bind("buttonClick",$.proxy(this.setPartnerManuallyHandler,this));this.container.append(new Bankingapp.ui.Label(resolve("bankingapp_function_domestictransfer_selectpartnertemplate"),{"class":"pagetitle separator"}));var a=["partnerName","partnerBank","targetAccount","targetAccountCurrency"];this.search=new Bankingapp.ui.SearchField({searchConfig:{propertyArray:a,triggerdelay:500,errorTriggerdelay:1000,validation:{whitelist:false}}});this.search.bind("search",$.proxy(this.handleSearchResult,this));this.search.bind("clear",$.proxy(this.handleClearResult,this));this.container.append(this.search);debugLog("val: ",this.search.val());return this.container;},run:function(){this.listData=getFunctionAttribute(Functions.transferfunds.TransferUtils.TRANSFERFUNDS_PARTNERLIST);this.formData=getFunctionAttribute(this.formDataFunctionAttributeId);if((this.formData==undefined)||(this.formData==null)){this.formData={};}if((this.listData===null)||(this.listData===undefined)){Bankingapp.framework.Application.callService("/domestictransfer/getPaymentTemplates",null,$.proxy(this.handlePartnerListResult,this));}else{this.setSearchInput();}},setPartnerManuallyHandler:function(){loadView("view://brd/bankingapp/function/transferfunds/domestictransfer/partnerdetails",null);},handlePartnerListResult:function(a){this.listData=[];for(var b=0;b<a.length;b++){this.listData.push({partnerName:a[b].name,beneficiaryName:a[b].data.beneficiaryName,partnerBank:a[b].data.beneficiaryBankName,targetAccount:a[b].data.targetAccount,targetAccountCurrency:a[b].data.targetAccountCurrency,beneficiaryAddress:a[b].data.beneficiaryAddress,partnerId:a[b].identifier});}if((getFunctionAttribute(Functions.transferfunds.TransferUtils.TRANSFERFUNDS_PARTNERLIST)===null)||(getFunctionAttribute(Functions.transferfunds.TransferUtils.TRANSFERFUNDS_PARTNERLIST)===undefined)){setFunctionAttribute(Functions.transferfunds.TransferUtils.TRANSFERFUNDS_PARTNERLIST,this.listData);}this.setSearchInput();},setSearchInput:function(){this.search.input.lastText="dummytext";this.search.setListData(this.listData);this.search.input.hintClass=$.encoder.encodeForHTMLAttribute("class",this.search.input.hintClass,true);this.search.input.data("hint",$.trim($.encoder.encodeForHTML(resolve("bankingapp_function_domestictransfer_search_hint"))));this.search.input.addHint();this.search.input.blur($.proxy(this.search.input.addHint,this.search.input));this.search.input.focus($.proxy(this.search.input.removeHint,this.search.input));},refreshPartnerList:function(a){debugLog("refreshPartnerList inputList",a);$("#partnerSelectionContainer").remove();this.partnerSelectionContainer=$("<div>",{id:"partnerSelectionContainer","class":"list maincontainer"});this.partnerList=new Bankingapp.ui.List({baseClass:"list",idProperty:this.partnerItemIdField,listData:a,itemRenderer:Functions.transferfunds.domestictransfer.partnerselection.PartnerListItem,noresultKey:this.emptyListResourceKey,itemConfig:{nameField:"partnerName",bankField:"partnerBank",accountNumberField:"targetAccount",currencyField:"targetAccountCurrency",baseClass:"accountListItem"}});this.partnerList.bind("itemClick",$.proxy(this.itemClickHandler,this));this.partnerSelectionContainer.append(this.partnerList);this.container.append(this.partnerSelectionContainer);},itemClickHandler:function(b,a){var c=this.partnerList.getItem(a[this.partnerItemIdField]);if(c){$.each(this.partnerList.itemsMap,function(d,e){e.removeClass("state_selected");});c.removeClass("state_default");c.addClass("state_selected");}this.formData.forecastRequest={sourceAccount:this.formData.sourceAccount.accountNumber,beneficiaryName:a.beneficiaryName,targetAccount:a.targetAccount,targetAccountCurrency:a.targetAccountCurrency,beneficiaryAddress:a.beneficiaryAddress,partnerId:a.partnerId};$.extend(this.formData,{beneficiaryName:a.beneficiaryName,targetAccount:a.targetAccount,targetAccountCurrency:a.targetAccountCurrency,partnerName:a.partnerName});setFunctionAttribute(this.formDataFunctionAttributeId,this.formData);loadView("view://brd/bankingapp/function/transferfunds/domestictransfer/transferdetails",null);},handleSearchResult:function(b,a){debugLog("handleSearchResult");debugLog(b);debugLog(a);this.refreshPartnerList(a.array);},handleClearResult:function(b,a){debugLog("handleClearResult");debugLog(a);this.refreshPartnerList(a.array);},onContextMenuItemPressed:function(b,a){if(a=="delete_partner"){loadView("view://brd/bankingapp/function/transferfunds/domestictransfer/partnerdelete",null);}}});Bankingapp.framework.Application.setView(Functions.transferfunds.domestictransfer.partnerselection.PartnerSelection);