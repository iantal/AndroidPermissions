Class.ns("Bankingapp.functions.login");Bankingapp.functions.login.AbstractLogin=Class.extend(Bankingapp.framework.View,{ATTRIBUTE_CUSTOMERS:"CUSTOMERS",ATTRIBUTE_LOGOUT_VIEW_URL:"LOGOUT_VIEW",ATTRIBUTE_CUSTOMER_NAME:"CUSTOMER_NAME",ATTRIBUTE_CURRENT_CUSTOMER:"CURRENT_CUSTOMER",ATTRIBUTE_CURRENT_TRUSTEE:"CURRENT_TRUSTEE",ATTRIBUTE_LOCAL_CURRENCY:"LOCAL_CURRENCY",VIEW_URL_LOGOUT:"view://bankingapp/function/logout/logout",VIEW_URL_CAP_SELECT:"view://bankingapp/function/login/capselect",VIEW_URL_DISCLAIMER:"view://bankingapp/function/login/disclaimer",VIEW_URL_PASSWORD_CHANGE:"view://bankingapp/function/login/passwordchange",SERVICE_NAME_PRELOAD:"/channel/application/preload",handleLoginResult:function(a){var c=getFunctionAttribute("activation");if(a.success==true){callService({serviceName:this.SERVICE_NAME_PRELOAD,request:{data:{}},callback:Bankingapp.framework.Application.proxy(this.handlePreloadResult,this,true)});}else{if(a.nextStep=="CAP_SELECT"){if(!a.response.customer){if(this.form){this.loginIdField.setValue("");this.passwordField.setValue("");this.form.enable();}showError(resolve("bankingapp_function_login_nocustomer"));return;}setFunctionAttribute(this.ATTRIBUTE_CUSTOMERS,a.response.customer);setFunctionAttribute(this.ATTRIBUTE_LOGOUT_VIEW_URL,this.VIEW_URL_LOGOUT);if(c==true){loadView(this.VIEW_URL_DISCLAIMER);}else{loadView(this.VIEW_URL_CAP_SELECT);}}if(a.nextStep=="PCC_CV_EXPIRED_PASSWORD"){var b=null;if(c==true){b={nextView:this.VIEW_URL_DISCLAIMER,loginId:this.loginIdField.val()};}else{b={nextView:this.VIEW_URL_CAP_SELECT,loginId:this.loginIdField.val()};}loadView(this.VIEW_URL_PASSWORD_CHANGE,b);}}},handlePreloadResult:function(a){debugLog("AbstractLogin -> handlePreloadResult");var c=removeFunctionAttribute(this.ATTRIBUTE_CUSTOMERS);if((c!=undefined)&&(c!=null)){setSessionAttribute(this.ATTRIBUTE_CUSTOMERS,c);}var b=removeFunctionAttribute(this.ATTRIBUTE_LOGOUT_VIEW_URL);if((b!=undefined)&&(b!=null)){setSessionAttribute(this.ATTRIBUTE_LOGOUT_VIEW_URL,b);}setSessionAttribute(this.ATTRIBUTE_CUSTOMER_NAME,a.currentCustomer.name);setSessionAttribute(this.ATTRIBUTE_CURRENT_CUSTOMER,a.currentCustomer);setSessionAttribute(this.ATTRIBUTE_CURRENT_TRUSTEE,a.currentTrustee);setAuthorizationData(a.actionData);if((a.secureKey!=undefined)&&(a.secureKey!=null)){setCacheSecureKey(a.secureKey);}setSessionAttribute(this.ATTRIBUTE_LOCAL_CURRENCY,"EUR");if((a.romcardMPIData!=undefined)&&(a.romcardMPIData!=null)){if((a.romcardMPIData.bymRomcardSecureKey!=undefined)&&(a.romcardMPIData.bymRomcardSecureKey!=null)){setSessionAttribute("ROMCARD_MPI_SECURE_KEY",a.romcardMPIData.bymRomcardSecureKey);}if((a.romcardMPIData.bymRomcardMPIUrl!=undefined)&&(a.romcardMPIData.bymRomcardMPIUrl!=null)){setSessionAttribute("ROMCARD_MPI_URL",a.romcardMPIData.bymRomcardMPIUrl);}if((a.romcardMPIData.bymRomcardMPIWhiteList!=undefined)&&(a.romcardMPIData.bymRomcardMPIWhiteList!=null)){setSessionAttribute("ROMCARD_MPI_WHITELIST",a.romcardMPIData.bymRomcardMPIWhiteList);}}loggedIn();Bankingapp.framework.Application.doPushNotificationOperations($.proxy(this.handleDoPushNotificationOperationsResult,this));},handleDoPushNotificationOperationsResult:function(){goToHomeView();}});