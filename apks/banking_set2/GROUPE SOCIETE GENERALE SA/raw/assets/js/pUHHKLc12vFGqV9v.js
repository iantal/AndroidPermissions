Class.ns("Bankingapp.functions.locations");Bankingapp.functions.locations.LocationDetails=Class.extend(Bankingapp.framework.View,{container:null,atmDetails:null,phoneContactListContainer:null,phoneContactList:null,faxContactListContainer:null,faxContactList:null,emailContactListContainer:null,emailContactList:null,openingHoursValue:null,openingHours:null,services:[],groupContainer:null,groupContainerClass:"groupcontainer",cacheItemIdAtmServices:"DICTIONARY_ATM_SERVICES",atmServicesMapAttribute:"ATM_SERVICES_MAP",atmServiceMap:null,layoutRender:function(){this.container=$("<div>",{id:"locationDetailsMainContainer","class":"locationDetails maincontainer details"});this.atmDetails=getFunctionAttribute("SELECTED_ATM");this.container.append(new Bankingapp.ui.Location(this.atmDetails,{id:"location"}));this.renderContacts();this.groupContainer=$("<div>",{"class":this.groupContainerClass});this.container.append(this.groupContainer);this.renderOpeningHours();return this.container;},run:function(){this.atmServiceMap=getFunctionAttribute(this.atmServicesMapAttribute);if(!this.atmServicesMap){callService({serviceName:"/component/dictionary",request:{DictionaryRequest:{TypeName:"pegasus.commonparameters.dictionary:AtmService",Locale:getLocale()}},callback:Bankingapp.framework.Application.proxy(this.handleDictionaryResponse,this,true),cacheItemId:this.cacheItemIdAtmServices,scope:Bankingapp.constant.Constant.CACHE_SCOPES.PERSISTENT});}else{this.renderServices();this.renderButtons();}},handleDictionaryResponse:function(a){this.atmServiceMap={};if(a&&a.dictionaryEntry){for(var b=0;b<a.dictionaryEntry.length;b++){this.atmServiceMap[a.dictionaryEntry[b].typeCode]=a.dictionaryEntry[b];}}setFunctionAttribute(this.atmServicesMapAttribute,this.atmServiceMap);this.renderServices();this.renderButtons();},renderContacts:function(){var d=[];var c=[];var f={};if(this.atmDetails.phoneNumbers!=undefined&&this.atmDetails.phoneNumbers!=null){if($.isArray(this.atmDetails.phoneNumbers)){for(var b=0;b<this.atmDetails.phoneNumbers.length;b++){f={};f.contactPhone=this.atmDetails.phoneNumbers[b].phoneNumber;f.contactPhoneNumber=this.atmDetails.phoneNumbers[b].phoneNumber;if(this.atmDetails.phoneNumbers[b].phoneType=="P"){f.contactName=resolve("bankingapp_function_locations_phone");d.push(f);}else{if(this.atmDetails.phoneNumbers[b].phoneType=="F"){f.contactName=resolve("bankingapp_function_locations_fax");c.push(f);}}}}}if(d.length>0){this.phoneContactListContainer=$("<div>").attr("id","phoneContactListContainer");this.phoneContactList=new Bankingapp.ui.ContactList(d,{itemConfig:{baseClass:"phoneContactListItem"}});this.phoneContactListContainer.append(this.phoneContactList);this.container.append(this.phoneContactListContainer);this.phoneContactList.bind("itemClick",$.proxy(this.itemClickHandlerPhone,this));}if(c.length>0){this.faxContactListContainer=$("<div>").attr("id","faxContactListContainer");this.faxContactList=new Bankingapp.ui.ContactList(c,{itemConfig:{baseClass:"phoneContactListItem"}});this.faxContactListContainer.append(this.faxContactList);this.container.append(this.faxContactListContainer);this.faxContactList.bind("itemClick",$.proxy(this.itemClickHandlerFax,this));}var e=[];var a={};if(this.atmDetails.emailAddress!=undefined&&this.atmDetails.emailAddress!=null){a.contactName=resolve("bankingapp_function_locations_email");a.contactEmail=this.atmDetails.emailAddress;e.push(a);}if(e.length>0){this.emailContactListContainer=$("<div>").attr("id","emailContactListContainer");this.emailContactList=new Bankingapp.ui.ContactList(e,{itemConfig:{baseClass:"emailContactListItem"}});this.emailContactListContainer.append(this.emailContactList);this.container.append(this.emailContactListContainer);this.emailContactList.bind("itemClick",$.proxy(this.itemClickHandlerEmail,this));}},renderOpeningHours:function(){if(this.atmDetails.openingHours!=null&&this.atmDetails.openingHours.length>0){this.openingHours=new Bankingapp.ui.LabeledComponent({labelText:resolve("bankingapp_function_locations_openinghours"),containerConfig:{"class":"openingHours"}});for(var a=0;a<this.atmDetails.openingHours.length;a++){var b=new Bankingapp.ui.Label(resolve("bankingapp_function_locations_openinghours_displayformat",{openingHoursId:resolve("bankingapp_function_locations_openinghours_"+this.atmDetails.openingHours[a].openingHoursId),timeRange:this.atmDetails.openingHours[a].timeRange}));this.openingHours.addComponent(b);}this.groupContainer.append(this.openingHours);}},renderServices:function(){if(this.atmDetails.services!=null&&this.atmDetails.services.length>0){this.services=new Bankingapp.ui.LabeledComponent({labelText:resolve("bankingapp_function_locations_services"),containerConfig:{"class":"services"}});for(var a=0;a<this.atmDetails.services.length;a++){console.log("Service map: "+JSON.stringify(this.atmServiceMap));console.log("Service id: "+this.atmDetails.services[a].serviceId);var b=new Bankingapp.ui.Label(this.atmServiceMap&&this.atmServiceMap[this.atmDetails.services[a].serviceId]?this.atmServiceMap[this.atmDetails.services[a].serviceId].resolvedText:"",{"class":"servicename atmservices_"+this.atmDetails.services[a].serviceId});this.services.addComponent(b);}this.groupContainer.append(this.services);}},renderButtons:function(){var a=new Bankingapp.ui.ComplexButton(resolve("bankingapp_function_locations_showonmap"),{"class":"showonmap"});this.container.append(a);a.bind("buttonClick",$.proxy(this.showOnMapButtonClickHandler,this));},itemClickHandlerPhone:function(b,a){callPhoneNumber(a.contactPhoneNumber);return false;},itemClickHandlerFax:function(b,a){callPhoneNumber(a.contactPhoneNumber);return false;},itemClickHandlerEmail:function(b,a){sendEMail(a.contactEmail,null,null);return false;},showOnMapButtonClickHandler:function(b,a){showOnMap({label:this.atmDetails.name,location:{latitude:this.atmDetails.coordinates.latitude,longitude:this.atmDetails.coordinates.longitude},type:"DRIVING"});}});Bankingapp.framework.Application.setView(Bankingapp.functions.locations.LocationDetails);