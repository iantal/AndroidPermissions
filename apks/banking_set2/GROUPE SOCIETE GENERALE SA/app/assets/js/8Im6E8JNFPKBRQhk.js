$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");$().loadJavaScript("/js/CF0WiFs1SjIy0Szl.js");$().loadJavaScript("/js/0A4YRnFx1DbUd3zN.js");$().loadJavaScript("/js/AZPz8vN1TNFqZWpw.js");Class.ns("Functions.transferfunds.internationaltransfer");Functions.transferfunds.internationaltransfer.Sign=Class.extend(Bankingapp.framework.View,{container:null,forecastReply:null,formData:null,signBlock:null,groupcontainer:null,progressIndicatorStepCount:Functions.transferfunds.TransferUtils.INTERNATIONALTRANSFER_STEPCOUNT,progressIndicatorCurrentStep:4,dateFormatPattern:resolve("bankingapp_common_dateFormatPattern_per"),layoutRender:function(){this.container=$("<div>",{id:"internationalTransferSignMainContainer","class":"maincontainer internationaltransfer transactiondetails"});this.container.append(new Bankingapp.ui.ProgressIndicator(this.progressIndicatorStepCount,this.progressIndicatorCurrentStep));this.groupcontainer=$("<div>",{"class":"paymentdetail groupcontainer"});return this.container;},errorMessageHandler:function(c,b){Bankingapp.framework.event.ServiceMessageHandler.errorMessageHandler(c,b);this.signBlock.remove();var a=typeof this.formData.forecastRequest.partnerId==="undefined";this.signBlock=new Bankingapp.ui.ManualSignBlock({signMode:Functions.transferfunds.TransferUtils.SIGNMODE,tokenSubmitResourceKey:"bankingapp_function_transferfunds_signtransaction",submitButtonResourceKey:"bankingapp_function_transferfunds_signtransaction",fingerprintDisabled:a});this.signBlock.bind("formSubmitted",$.proxy(this.submitHandler,this));this.container.append(this.signBlock);},run:function(){Bankingapp.framework.Application.unBind("onErrorMessageReceived");$("body").bind("onErrorMessageReceived",$.proxy(this.errorMessageHandler,this));Bankingapp.framework.event.BrdServiceMessageHandler.handleMessages();this.formData=getFunctionAttribute(Functions.transferfunds.TransferUtils.INTERNATIONALTRANSFER_FORMDATA);this.forecastReply=getFunctionAttribute(Functions.transferfunds.TransferUtils.INTERNATIONALTRANSFER_FORECAST_REPLY);this.container.append(new Bankingapp.functions.util.component.TransactionSummary({fields:{titleInfo:"titleInfo",upperTitle:"upperTitle",upperText:["upperText"],amount:"amount",currency:"currency",lowerTitle:"lowerTitle",lowerText:["lowerText","lowerText2"],creditDebitFlag:"creditDebitFlag"},summaryData:{titleInfo:resolve("bankingapp_function_internationaltransfer_sign_please_confirm"),upperTitle:this.formData.sourceAccount.accountName,upperText:this.formData.sourceAccount.accountType+" ("+this.formData.sourceAccount.currency+")",amount:-this.formData.amount,currency:this.formData.currency,lowerTitle:this.formData.partnerName?this.formData.partnerName:this.formData.beneficiaryName,lowerText:this.formData.targetAccount,creditDebitFlag:"D"}}));this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_function_internationaltransfer_beneficiaryname"),this.formData.forecastRequest.beneficiaryName));this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_function_internationaltransfer_partneraddress"),this.formData.forecastRequest.beneficiaryAddress));this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_function_internationaltransfer_partnercountry"),resolve("bankingapp_function_insternationaltransfer_details_country_"+this.formData.forecastRequest.beneficiaryCountry)));this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_function_internationaltransfer_bankswift"),this.formData.forecastRequest.bankSwift));this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_function_internationaltransfer_bankaddress"),this.formData.forecastRequest.bankAddress));this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_function_internationaltransfer_bankcountry"),resolve("bankingapp_function_insternationaltransfer_details_country_"+this.formData.forecastRequest.bankCountry)));this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_function_internationaltransfer_bankname"),this.formData.forecastRequest.bankName));this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_function_internationaltransfer_description"),this.formData.description));var b=this.formData.valueDate?$().dateParserWithTimezone(this.formData.valueDate):new Date();this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_function_transferfunds_valuedate"),b.dateFormat(this.dateFormatPattern)));if(Functions.transferfunds.TransferUtils.isCorporateUser()){this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_function_internationaltransfer_reference"),this.formData.referenceNumber));}this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_function_internationaltransfer_feetype"),this.formData.feeType));if(this.forecastReply.forecastReply&&this.forecastReply.forecastReply.fXAmountData.fXRate&&this.forecastReply.forecastReply.fXAmountData.fXRate!=1){this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_function_internationaltransfer_fxrate"),this.forecastReply.forecastReply.fXAmountData.fXRate));this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_function_internationaltransfer_amount_in_source_currency"),(new Bankingapp.functions.util.component.Amount({currency:this.forecastReply.forecastReply.fXAmountData.fromCurrency,amount:this.forecastReply.forecastReply.fXAmountData.fromAmount,decorate:true})).value));this.groupcontainer.append(new Bankingapp.ui.OutputField(resolve("bankingapp_function_internationaltransfer_amount_in_target_currency"),(new Bankingapp.functions.util.component.Amount({currency:this.forecastReply.forecastReply.fXAmountData.toCurrency,amount:this.forecastReply.forecastReply.fXAmountData.toAmount,decorate:true})).value));}this.container.append(this.groupcontainer);var a=typeof this.formData.forecastRequest.partnerId==="undefined";this.signBlock=new Bankingapp.ui.ManualSignBlock({signMode:Functions.transferfunds.TransferUtils.SIGNMODE,tokenSubmitResourceKey:"bankingapp_function_transferfunds_signtransaction",submitButtonResourceKey:"bankingapp_function_transferfunds_signtransaction",fingerprintDisabled:a});this.signBlock.bind("formSubmitted",$.proxy(this.submitHandler,this));this.container.append(this.signBlock);},submitHandler:function(){setFunctionAttribute(Functions.transferfunds.TransferUtils.INTERNATIONALTRANSFER_SIGN_CREDENTIAL,this.signBlock.getCredential());Bankingapp.framework.Application.callService("/internationaltransfer/perform",{PerformTransactionOperationRequest:{credential:getFunctionAttribute(Functions.transferfunds.TransferUtils.INTERNATIONALTRANSFER_SIGN_CREDENTIAL),book:true,sign:true,fingerPrint:this.signBlock.getIsFingerprint()}},$.proxy(this.handleSignResult,this));},handleSignResult:function(a){setFunctionAttribute(Functions.transferfunds.TransferUtils.INTERNATIONALTRANSFER_SIGN_REPLY,a);loadView("view://brd/bankingapp/function/transferfunds/internationaltransfer/result",null);}});Bankingapp.framework.Application.setView(Functions.transferfunds.internationaltransfer.Sign);