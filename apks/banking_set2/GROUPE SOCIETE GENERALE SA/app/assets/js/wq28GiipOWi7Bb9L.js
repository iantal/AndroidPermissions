Class.ns("Bankingapp.functions.transactionhistory");$().loadJavaScript("/js/Ap7fyZ9Z2rYd6BIg.js");$().loadJavaScript("/js/IJEyRrFiv7BizsJV.js");Bankingapp.functions.transactionhistory.TransactionHistoryDetail=Class.extend(Bankingapp.framework.View,{container:null,layoutRender:function(){this.container=$("<div>",{id:"transactionHistoryDetailContainer","class":"list maincontainer"});this.transactionHistorySpecificDetailContainer=$("<div>",{id:"transactionHistorySpecificDetailContainer","class":"list maincontainer"});this.transactionHistoryStatusDetailContainer=$("<div>",{id:"transactionHistoryStatusDetailContainer","class":"list maincontainer"});this.transactionHistorySpecificDetailContainer=$("<div>",{id:"transactionHistorySpecificDetailContainer","class":"list maincontainer"});this.transactionDetail=getFunctionAttribute("transactionDetail")?getFunctionAttribute("transactionDetail"):getSessionAttribute("transactionDetail");this.transactionHistoryStatusDetailLabel=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_transactionhistory_details_status_title"),{"class":"pagetitle separator textcenter"});this.transactionHistorySpecificDetail=new Bankingapp.ui.TransactionHistorySpecificDetail({detailsData:this.transactionDetail,displayDateFormat:resolve("bankingapp_common_dateFormatPattern"),displayTimeFormat:resolve("bankingapp_common_timeFormatPattern")});this.transactionHistoryStatusDetail=new Bankingapp.ui.TransactionHistoryStatusDetail({detailsData:this.transactionDetail,displayDateFormat:resolve("bankingapp_common_dateFormatPattern"),displayTimeFormat:resolve("bankingapp_common_timeFormatPattern_min_per")});this.transactionHistorySpecificDetailContainer.append(this.transactionHistorySpecificDetail);this.transactionHistoryStatusDetailContainer.append(this.transactionHistoryStatusDetail);this.container.append(this.transactionHistorySpecificDetailContainer);this.container.append(this.transactionHistoryStatusDetailLabel);this.container.append(this.transactionHistoryStatusDetailContainer);var a=this.transactionDetail.transaction.status["@name"];if(a=="DRAFT"){this.transactionHistoryAcceptButton=new Bankingapp.ui.SubmitButton(resolve("bankingapp_brd_function_transactionhistory_acceptbutton"),{id:"acceptButton","class":"acceptButton"});this.transactionHistoryAcceptButton.bind("buttonClick",$.proxy(this.acceptClickHandler,this));this.container.append(this.transactionHistoryAcceptButton);}if(a=="VALUEDATED"||a=="OFFLINE"||a=="WAITINGFORCOLLECTION"||a=="DRAFT"){this.transactionHistoryCancelButton=new Bankingapp.ui.SubmitButton(resolve("bankingapp_brd_function_transactionhistory_cancelbutton"),{id:"cancelButton","class":"cancelButton"});this.transactionHistoryCancelButton.bind("buttonClick",$.proxy(this.cancelClickHandler,this));this.container.append(this.transactionHistoryCancelButton);}if((this.transactionDetail.transaction.type!="requestMoneyTransferLifeCycle")&&(this.transactionDetail.transaction.type!="splitBillTransferLifeCycle")){this.transactionHistoryPDFButton=new Bankingapp.ui.SubmitButton(resolve("bankingapp_brd_function_transactionhistory_downloadpdf"),{id:"downloadButton","class":"downloadButton"});this.transactionHistoryPDFButton.bind("buttonClick",$.proxy(this.downloadPdfClickHandler,this));this.container.append(this.transactionHistoryPDFButton);}else{console.log("The transaction type is not proof of payment enabled!");}return this.container;},handleTransactionCancel:function(b){if(b.lastModified&&b.statusName){var a=$().dateParserWithoutTimezone(b.lastModified);$("#statusName").text(b.statusName);$("#statusChangeDate").text(a.dateFormat(resolve("bankingapp_common_timeFormatPattern")));this.transactionHistoryCancelButton.remove();if(this.transactionHistoryAcceptButton){this.transactionHistoryAcceptButton.remove();}setFunctionAttribute("needListRefresh",true);}},cancelClickHandler:function(a,b){Bankingapp.framework.Application.showConfirmation(resolve("bankingapp_brd_function_transactionhistory_cancelconfirmation"),new Boolean(0),$.proxy(this.handleConfirmation,this));},handleConfirmation:function(a,b){if(a.valueOf()){Bankingapp.framework.Application.callService("/transactionhistory/cancelTransaction",null,$.proxy(this.handleTransactionCancel,this));}else{goToPreviousView();}},acceptClickHandler:function(a,b){setSessionAttribute("draftdomestictransfer",this.transactionDetail.transaction);loadView("view://brd/bankingapp/function/transferfunds/domestictransfer/sourceaccountselection",null);},handleTransactionStatus:function(a){if(a.transactionStatus!="DRAFT"){if(this.transactionHistoryCancelButton){this.transactionHistoryCancelButton.remove();}if(this.transactionHistoryAcceptButton){this.transactionHistoryAcceptButton.remove();}}},run:function(){if(this.transactionDetail.transaction.type=="investmentFundSellTransferLifeCycle"&&(this.transactionDetail.transaction.status["@name"]=="FAILED"||this.transactionDetail.transaction.status["@name"]=="PROCESSING"||this.transactionDetail.transaction.status["@name"]=="PENDING")){$(".currencyField").css("visibility","hidden");$(".amountWholeField").css("visibility","hidden");$(".amountDecimalField").css("visibility","hidden");}if(this.transactionDetail.transaction.status["@name"]=="DRAFT"){Bankingapp.framework.Application.callService("/transactionhistory/getTransactionStatus",{TransactionStatusRequest:{transactionId:this.transactionDetail.transaction.id}},$.proxy(this.handleTransactionStatus,this));}},downloadPdfClickHandler:function(b,c){var a={TransactionId:this.transactionDetail.transaction.id};Bankingapp.framework.Application.callService("/statement/getStatementDownloadKey",{GetDocumentDownloadKeyRequest:a},$.proxy(this.handlePdfDownload,this));},handlePdfDownload:function(b){var a=getGatewayUrl()+"/statement/getTfwTransactionDetailsPdf/"+b.key;openBrowser(a);}});Bankingapp.framework.Application.setView(Bankingapp.functions.transactionhistory.TransactionHistoryDetail);