Class.ns("Bankingapp.functions.logout");Bankingapp.functions.logout.Logout=Class.extend(Bankingapp.framework.View,{container:null,customerList:null,form:null,button:null,hasMultipleCustomers:false,layoutRender:function(){this.container=$("<div>",{id:"logoutMainContainer","class":"maincontainer logout"});var a=getSessionAttribute("CUSTOMERS");if((a)!=null&&(a.length>1)){var b=getSessionAttribute("CURRENT_CUSTOMER");this.hasMultipleCustomers=true;this.container.append(new Bankingapp.ui.Label(resolve("demo_bankingapp_function_login_capselect_selectcustomer")));this.customerList=new Bankingapp.ui.List({listData:a,itemRenderer:Bankingapp.ui.CustomerListItem});this.container.append(this.customerList);this.customerList.bind("itemClick",$.proxy(this.itemClickHandler,this));this.form=new Bankingapp.ui.Form({id:"logoutform",submitHandler:$.proxy(this.submitHandler,this)});this.container.append(this.form);this.button=new Bankingapp.ui.SubmitButton("Logout",{tabindex:"2"});this.form.append(this.button);}else{Bankingapp.framework.Application.showConfirmation(resolve("demo_bankingapp_function_logout_confirmation"),new Boolean(0),$.proxy(this.handleConfirmationResult,this));}return this.container;},handleConfirmationResult:function(a,b){if(a.valueOf()){callService({serviceName:"/security/logout",backgroundCall:true,ignoreErrors:true});loggedOut();setAuthorizationData(null);removeSessionAttribute("CUSTOMER_NAME");goToHomeView();}else{if(!this.hasMultipleCustomers){goToPreviousView();}}},submitHandler:function(){Bankingapp.framework.Application.showConfirmation(resolve("demo_bankingapp_function_logout_confirmation"),new Boolean(0),$.proxy(this.handleConfirmationResult,this));},itemClickHandler:function(e,c){var b=getSessionAttribute("CUSTOMERS");var a=null;for(var d=0;d<b.length;d++){if(b[d].id==c.id){a=b[d];break;}}if(a==null){console.error("Undefined customer identifier!");}else{callService({serviceName:"/customercontract/capselect/setCustomer",request:{SetCustomerRequest:{CustomerId:c.id}},callback:Bankingapp.framework.Application.proxy(this.handleSetCustomerResult,this,true)});}},handleSetCustomerResult:function(a){removeSessionAttribute("WELCOME_MESSAGE_DISPLAYED");callService({serviceName:"/channel/application/preload",request:{data:{}},callback:Bankingapp.framework.Application.proxy(this.handlePreloadResult,this,true)});},handlePreloadResult:function(a){debugLog("logout -> handlePreloadResult");setSessionAttribute("CUSTOMER_NAME",a.currentCustomer.name);setSessionAttribute("CURRENT_CUSTOMER",a.currentCustomer);setSessionAttribute("CURRENT_TRUSTEE",a.currentTrustee);setAuthorizationData(a.actionData);if((a.secureKey!=undefined)&&(a.secureKey!=null)){setCacheSecureKey(a.secureKey);}if((a.romcardMPIData!=undefined)&&(a.romcardMPIData!=null)){if((a.romcardMPIData.bymRomcardSecureKey!=undefined)&&(a.romcardMPIData.bymRomcardSecureKey!=null)){setSessionAttribute("ROMCARD_MPI_SECURE_KEY",a.romcardMPIData.bymRomcardSecureKey);}if((a.romcardMPIData.bymRomcardMPIUrl!=undefined)&&(a.romcardMPIData.bymRomcardMPIUrl!=null)){setSessionAttribute("ROMCARD_MPI_URL",a.romcardMPIData.bymRomcardMPIUrl);}if((a.romcardMPIData.bymRomcardMPIWhiteList!=undefined)&&(a.romcardMPIData.bymRomcardMPIWhiteList!=null)){setSessionAttribute("ROMCARD_MPI_WHITELIST",a.romcardMPIData.bymRomcardMPIWhiteList);}}loggedIn();Bankingapp.framework.Application.doPushNotificationOperations($.proxy(this.handleDoPushNotificationOperationsResult,this));},handleDoPushNotificationOperationsResult:function(){goToHomeView();},filterCustomers:function(b,d){var a=[];for(var c=0;c<b.length;c++){if(d.id!=b[c].id){a[a.length]=b[c];}}return a;}});Bankingapp.framework.Application.setView(Bankingapp.functions.logout.Logout);