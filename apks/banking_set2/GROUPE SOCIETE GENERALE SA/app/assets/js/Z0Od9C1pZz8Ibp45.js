$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");$().loadJavaScript("/js/CF0WiFs1SjIy0Szl.js");$().loadJavaScript("/js/NqvpUjhTwDggG7lG.js");Class.ns("Bankingapp.functions.receivemoney.bringyourmoney");Bankingapp.functions.receivemoney.bringyourmoney.Result=Class.extend(Bankingapp.framework.View,{formDataFunctionAttributeId:Functions.transferfunds.TransferUtils.BRINGYOURMONEY_FORMDATA,mpiDataFunctionAttributeId:Functions.transferfunds.TransferUtils.BRINGYOURMONEY_MPIDATA,initDataFunctionAttributeId:Functions.transferfunds.TransferUtils.BRINGYOURMONEY_INITDATA,dateFormatPattern:resolve("bankingapp_common_dateFormatPattern_per"),container:null,homeButton:null,formDate:null,ct:null,messages:[],layoutRender:function(){this.container=$("<div>");this.ct=$("<div>",{"class":"formcontainer result"});this.container.append(this.ct);return this.container;},run:function(){debugLog("Result -> run ...");Bankingapp.framework.event.BrdServiceMessageHandler.handleMessages();var f=getFunctionAttribute(Functions.transferfunds.TransferUtils.BRINGYOURMONEY_SIGN_REPLY);debugLog("authenticateReply: "+f);this.formData=getFunctionAttribute(this.formDataFunctionAttributeId);this.mpiData=getFunctionAttribute(this.mpiDataFunctionAttributeId);this.initData=getFunctionAttribute(this.initDataFunctionAttributeId);this.transactionId=this.mpiData.TransactionID;this.cardNumber=this.formData.savedMaskedCardNumber?this.formData.savedMaskedCardNumber:"";if(this.cardNumber==undefined||this.cardNumber==""){this.cardNumber=this.formData.maskedCardNumber;}this.sourceAccount=this.cardNumber;if(f!=undefined&&f!=null&&f.forecastReply!=undefined&&f.forecastReply!=null){if(f.forecastReply.bringYourMoneyData!=null&&f.forecastReply.bringYourMoneyData!=undefined){this.sourceAccount=f.forecastReply.bringYourMoneyData.sourceAccount;debugLog("this.sourceAccount: "+this.sourceAccount);}else{debugLog("Source account is null! (1)");}}else{debugLog("Source account is null! (2)");}if(this.formData.mpiErrorCode){var i=new Object();i.title=resolve("bankingapp_brd_function_bringyourmoney_result_info_"+this.formData.mpiErrorCode.trim());i.details="";if(i.title.indexOf("[unresolved")<0){this.messages.push(i);}}debugLog("this.formData.selectedDate: "+this.formData.selectedDate);var b=$().dateParserWithTimezone(new Date());debugLog("date: "+b);var c=b.dateFormat(this.dateFormatPattern);var g=resolve("bankingapp_brd_function_bringyourmoney_result_details");var d="successful";var h="bankingapp_brd_function_bringyourmoney_result_success";if(f==undefined||f==null||f.status==undefined||f.status==null||f.status=="FAILED"){d="error";h="bankingapp_brd_function_bringyourmoney_result_failure";}var a={status:d,message:resolve(h),warning:this.messages,title:[resolve("bankingapp_brd_function_bringyourmoney_result_bankname"),g],timestamp:b,id:this.transactionId,details:[{label:resolve("bankingapp_brd_function_bringyourmoney_result_sourceaccount"),value:this.cardNumber?Functions.transferfunds.TransferUtils.maskCardNumber(Functions.transferfunds.TransferUtils.formatCardNumber(this.cardNumber)):""},{label:resolve("bankingapp_brd_function_bringyourmoney_result_targetaccount"),value:this.formData.targetAccount.accountName+" ("+this.formData.targetAccount.currency+")"},{label:resolve("bankingapp_brd_function_bringyourmoney_result_amount"),value:new Bankingapp.functions.util.component.Amount({currency:this.mpiData.CURRENCY,amount:this.mpiData.AMOUNT,decorate:false})},{label:resolve("bankingapp_brd_function_bringyourmoney_result_description"),value:this.initData.description},{label:resolve("bankingapp_function_transferfunds_valuedate"),value:c},{label:resolve("bankingapp_brd_function_bringyourmoney_result_merchant"),value:this.initData.merchant},{label:resolve("bankingapp_brd_function_bringyourmoney_result_beneficiary"),value:this.mpiData.BFNAME+" "+this.mpiData.BLNAME}]};this.ct.append(new Functions.transferfunds.DetailsResultComponent({detailsData:a,displayDateFormatKey:"bankingapp_brd_function_transfer_result_createTimeFormat"}));this.downloadProofOfPaymentButton=new Bankingapp.ui.ComplexButton(resolve("bankingapp_brd_function_transactionhistory_downloadpdf"),{id:"downloadButton","class":"downloadProofOfPaymentButton"});this.downloadProofOfPaymentButton.bind("buttonClick",$.proxy(this.downloadPdfClickHandler,this));this.ct.append(this.downloadProofOfPaymentButton);var e=new Bankingapp.ui.ComplexButton(resolve("bankingapp_brd_function_bringyourmoney_back_to_payments"),{});this.ct.append(e);e.bind("buttonClick",$.proxy(this.backToPaymentsHandler,this));Bankingapp.framework.event.ButtonHandler.setButtonHandler("BACK",$.proxy(this.backBtnHandler,this));this.clearFunctionScope();},clearFunctionScope:function(){var a=getFunctionAttributeNames();if(a){for(var b=0;b<a.length;b++){removeFunctionAttribute(a[b]);}}},backToPaymentsHandler:function(){this.goToPaymentsLandingPage();},backBtnHandler:function(a){this.goToPaymentsLandingPage();},goToPaymentsLandingPage:function(){loadView("view://brd/bankingapp/function/payments/payments");},downloadPdfClickHandler:function(a,b){debugLog("downloadPdfClickHandler ...");if(this.transactionId){Functions.transferfunds.TransferUtils.getDocumentDownloadKey(this.transactionId);}else{debugLog("The authentication reply is not available");showError(resolve("bankingapp_brd_function_payments_download_proofofpayments_failure"));}}});Bankingapp.framework.Application.setView(Bankingapp.functions.receivemoney.bringyourmoney.Result);