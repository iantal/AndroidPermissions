Class.ns("Bankingapp.functions.loancalculator");Bankingapp.functions.loancalculator.LoanSend=Class.extend(Bankingapp.framework.View,{currentProgressStep:3,ProgressSteps:4,container:null,label:null,form:null,inputFielContainer:null,phoneField:null,emailField:null,submitButton:null,layoutRender:function(){this.container=$("<div>",{id:"container","class":"login maincontainer disclaimer"});this.container.append(new Bankingapp.ui.ProgressIndicator(this.ProgressSteps,this.currentProgressStep));this.labelContainer=$("<div>",{id:"labelContainer","class":"info"});this.label=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_loancalculator_send_label"),{"class":"detailstitle"});this.labelContainer.append(this.label);this.form=new Bankingapp.ui.Form({submitHandler:$.proxy(this.submitHandler,this),businessValidationHandler:$.proxy(this.businessValidator,this)});this.inputFielContainer=$("<div>",{id:"inputFielContainerProduct","class":"groupContainer"});this.phoneField=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_brd_function_loancalculator_send_phone"),inputConfig:{id:"phone",name:"phone",tabindex:"1",type:"text",baseInputContainerClass:"filled",validation:{whitelist:false}}});this.emailField=new Bankingapp.ui.InputField({labelText:resolve("bankingapp_brd_function_loancalculator_send_email"),inputConfig:{id:"email",name:"email",tabindex:"2",type:"text",baseInputContainerClass:"filled",validation:{email:true,whitelist:false}}});this.submitButton=new Bankingapp.ui.SubmitButton(resolve("bankingapp_brd_function_loancalculator_send_sendbutton"),{tabindex:"3"});this.inputFielContainer.append(this.phoneField);this.inputFielContainer.append(this.emailField);this.form.append(this.inputFielContainer);this.form.append(this.submitButton);this.container.append(this.labelContainer);this.container.append(this.form);return this.container;},run:function(){Bankingapp.framework.Application.callService("/loanCalculator/contacts",null,$.proxy(this.onGetContacts,this));},onGetContacts:function(a){console.debug(a);if(a.phone!==undefined){console.debug("setPhone",a.phone);this.phoneField.setValue(a.phone);this.phoneField.baseClass=this.phoneField.baseClass+" filled";}if(a.email!==undefined){console.debug("setEmail",a.email);this.emailField.setValue(a.email);this.emailField.baseClass=this.phoneField.baseClass+" filled";}},businessValidator:function(){if((this.phoneField.val()==null||this.phoneField.val()=="")&&(this.emailField.val()==null||this.emailField.val()=="")){showError(resolve("bankingapp_brd_function_loancalculator_send_contacterror"));return false;}return true;},submitHandler:function(){params={LoanId:getFunctionAttribute("loanId"),LoanType:getFunctionAttribute("loanType"),LoanName:getFunctionAttribute("loanProduct"),Currency:getFunctionAttribute("currency"),Amount:getFunctionAttribute("amount"),Period:getFunctionAttribute("period"),DAE:getFunctionAttribute("DAE"),Interest:getFunctionAttribute("interest"),IntarestType:getFunctionAttribute("interestType"),Fee:getFunctionAttribute("fee"),AdminFee:getFunctionAttribute("adminFee"),FNGCFee:getFunctionAttribute("FNGCFee"),TotalRep:getFunctionAttribute("totalRep"),MounthRep:getFunctionAttribute("mounthRep"),Phone:this.phoneField.val(),Email:this.emailField.val(),};Bankingapp.framework.Application.callService("/loanCalculator/sendtobank",{SendToBankRequest:params},$.proxy(this.mailSent,this));},mailSent:function(){goToPreviousView("view://bankingapp/function/support/support");}});Bankingapp.framework.Application.setView(Bankingapp.functions.loancalculator.LoanSend);