$().loadJavaScript("/js/ub7EBPmB1JG8uW5S.js");$().loadJavaScript("/js/UTo6WsoyQcdUSv0z.js");$().loadJavaScript("/js/ZJCxVR3I5IqpC6QQ.js");$().loadJavaScript("/js/82F09eW7OW4IuVAu.js");Class.ns("Bankingapp.functions.accountinfo");Bankingapp.functions.accountinfo.FavoriteAccount=Class.extend(Bankingapp.framework.View,{container:null,currentAmout:0,amountChart:null,minAmount:null,maxAmount:null,layoutRender:function(){Bankingapp.framework.Application.bind("onOrientationChanged",$.proxy(this.onOrientationChanged,this));this.container=$("<div>",{id:"favoriteAccountMainContainer","class":"list maincontainer"});this.amountchart=$("<div>",{id:"amount_chart","class":"amount_chart"});this.accountList=getFunctionAttribute("ACCOUNT_DETAILS");debugLog(this.accountList);var f=[];if(this.accountList){var a=0;var d=0;for(var b=0;b<this.accountList.length;b++){var c=this.accountList[b];if(d==0){d=c.accountOrder;a=b;}if(c.accountOrder<d){d=c.accountOrder;a=b;}}this.favoriteAccount=this.accountList[a];this.currentAmount=this.favoriteAccount.availableBalance;f[0]=this.favoriteAccount;}this.homeScreenInformation=getSessionAttribute("HOMESCREEN_INFORMATION");if(this.homeScreenInformation){debugLog(this.homeScreenInformation);this.favoriteAccount={accountName:this.homeScreenInformation.favoriteAccountName,accountType:this.homeScreenInformation.favoriteAccountType,currency:this.homeScreenInformation.favoriteAccountCurrency,availableBalance:this.homeScreenInformation.favoriteAccountBalance};f[0]=this.favoriteAccount;this.currentAmount=this.homeScreenInformation.favoriteAccountBalance;}this.favoriteAccountLabel=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_favoriteaccount_label"),{"class":"pagetitle separator"});this.container.append(this.favoriteAccountLabel);this.accountListComponent=new Bankingapp.functions.accountinfo.AccountList(f,{"class":""});this.container.append(this.accountListComponent);this.accountListComponent.bind("itemClick",$.proxy(this.itemClickHandler,this));this.favoriteAccountIndicatorLabel=new Bankingapp.ui.Label(resolve("bankingapp_brd_function_favoriteaccount_indicator_label"),{"class":"pagetitle separator"});this.container.append(this.favoriteAccountIndicatorLabel);this.container.append(this.amountchart);this.wrapDiv=$("<div>",{"class":"favoritAccountAmount-wrap"});this.innerDiv=$("<div>",{"class":"favoritAccountAmount-inner"});this.minDiv=$("<div>",{"class":"favoritAccountAmount-cell"});this.maxDiv=$("<div>",{"class":"favoritAccountAmount-cell favoritAccountAmount-cell-right"});this.innerDiv.append(this.minDiv);this.innerDiv.append(this.maxDiv);this.wrapDiv.append(this.innerDiv);$.Validation.addRules({interval:{check:$.proxy(this.intervalCheck,this),msg:function(h,g){return resolve("bankingapp_error_intervalerror");}}});this.minAmountField=new Bankingapp.ui.TextField({id:"minAmount",name:"minAmount",type:"number",value:(this.minAmount?this.minAmount:""),inputMaskPattern:/[\d.]/,validation:{required:true,min:0,max:999999999999,number:true,maxlength:12,interval:true}});this.minAmountField.bind("blur",$.proxy(this.blurHandler,this));this.maxAmountField=new Bankingapp.ui.TextField({id:"maxAmount",name:"maxAmount",type:"number",value:(this.maxAmount?this.maxAmount:""),inputMaskPattern:/[\d.]/,validation:{required:true,min:0,max:999999999999,number:true,maxlength:12}});this.maxAmountField.bind("blur",$.proxy(this.blurHandler,this));this.minDiv.append(this.minAmountField);this.maxDiv.append(this.maxAmountField);this.favoriteAccountButton=new Bankingapp.ui.SubmitButton(resolve("bankingapp_brd_function_favoriteaccount_accept_button"),{id:"favoriteAccountAcceptButton","class":"favoriteAccountAcceptButton"});this.form=new Bankingapp.ui.Form({id:this.formId,submitHandler:$.proxy(this.submitHandler,this),"class":this.formClass});this.form.append(this.wrapDiv);this.form.append(this.favoriteAccountButton);this.container.append(this.form);return this.container;},run:function(){Bankingapp.framework.Application.callService("/account/getFavoriteAccountLimit",null,$.proxy(this.handleLimitResult,this));},handleLimitResult:function(a){if(a.favoriteAccountLimit){setFunctionAttribute("FAV_ACCOUNT_DATA_MIN",a.favoriteAccountLimit.minAmount);setFunctionAttribute("FAV_ACCOUNT_DATA_MAX",a.favoriteAccountLimit.maxAmount);this.initChart(a.favoriteAccountLimit.minAmount,a.favoriteAccountLimit.maxAmount);this.createChart();}},initChart:function(b,a){this.minAmountField.setValue(b);this.maxAmountField.setValue(a);this.minAmount=b;this.maxAmount=a;setFunctionAttribute("FAV_ACCOUNT_DATA_MIN",b);setFunctionAttribute("FAV_ACCOUNT_DATA_MAX",a);},createChart:function(){this.amountChart=new Bankingapp.ui.AmountChart({mainContainerId:"favoriteAccountMainContainer",containerId:"amount_chart",duration:5000,editIcon:false,defaultInformation:false});this.refreshChart();},refreshChart:function(){this.amountChart.refreshChart({minAmount:this.minAmount,maxAmount:this.maxAmount,actualAmount:this.currentAmount});},blurHandler:function(){this.minAmount=this.minAmountField.val();this.maxAmount=this.maxAmountField.val();this.refreshChart();},itemClickHandler:function(b,a){},intervalCheck:function(){return this.minAmountField.val()*1<=this.maxAmountField.val()*1;},submitHandler:function(){var a={minAmount:this.minAmountField.val(),maxAmount:this.maxAmountField.val()};Bankingapp.framework.Application.callService("/account/saveFavoriteAccountLimit",{SaveFavoriteAccountLimitRequest:a},$.proxy(this.saveFavoriteAccountLimitHandler,this));},saveFavoriteAccountLimitHandler:function(a){goToPreviousView();},onOrientationChanged:function(b,c){var a=getFunctionAttribute("FAV_ACCOUNT_DATA_MIN");var d=getFunctionAttribute("FAV_ACCOUNT_DATA_MAX");if(e.favoriteAccountLimit){this.initChart(a,d);this.createChart();}}});Bankingapp.framework.Application.setView(Bankingapp.functions.accountinfo.FavoriteAccount);