Class.ns("Functions.transferfunds.internationaltransfer");$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");$().loadJavaScript("/js/1P8ZlW6keI10ssxG.js");Functions.transferfunds.internationaltransfer.InternationalBankSelector=Class.extend(Bankingapp.framework.View,{showProgressIndicator:true,progressIndicatorStepCount:Functions.transferfunds.TransferUtils.INTERNATIONALTRANSFER_STEPCOUNT,progressIndicatorCurrentStep:3,container:null,listData:[],formData:null,emptyListResourceKey:"bankingapp_function_internationaltransfer_no_banks",formDataFunctionAttributeId:Functions.transferfunds.TransferUtils.INTERNATIONALTRANSFER_FORMDATA,pageLimit:10,pageStart:0,bankItemIdField:"bankSwift",layoutRender:function(){Bankingapp.framework.Application.bind("onContextMenuItemPressed",$.proxy(this.onContextMenuItemPressed,this));this.container=$("<div>",{id:"partnerSelectionMainContainer","class":"list maincontainer"});if(this.showProgressIndicator){this.container.append(new Bankingapp.ui.ProgressIndicator(this.progressIndicatorStepCount,this.progressIndicatorCurrentStep));}var c=["bankName","bankAddress","bankCountry","bankSwift"];this.search=new Bankingapp.ui.SearchField({searchConfig:{propertyArray:c,triggerdelay:500,errorTriggerdelay:1000,validation:{whitelist:false}}});this.search.bind("search",$.proxy(this.handleSearchResult,this));this.search.bind("clear",$.proxy(this.handleClearResult,this));this.container.append(this.search);debugLog("val: ",this.search.val());var g=new Bankingapp.ui.ComplexButton(resolve("bankingapp_function_internationaltransfer_selectbank_next"),{disabled:false,"class":"submit"});g.bind("buttonClick",$.proxy(this.nextButtonHandler,this));var e=new Bankingapp.ui.ComplexButton(resolve("bankingapp_function_internationaltransfer_selectbank_prev"),{disabled:false,"class":"submit"});e.bind("buttonClick",$.proxy(this.prevButtonHandler,this));var f=$("<table>",{"class":"international-transfer-bank-selector"});var a=f.appendRow();var d=a.appendCell();var b=a.appendCell();d.append(e);b.append(g);this.container.append(f);this.container.append(new Bankingapp.ui.Label(resolve("bankingapp_function_internationaltransfer_selectbank"),{"class":"pagetitle separator"}));return this.container;},run:function(){this.formData=getFunctionAttribute(this.formDataFunctionAttributeId);if((this.formData==undefined)||(this.formData==null)){this.formData={};}this.searchOnline();},handleListResult:function(a){debugLog("handleListResult ...");this.listData=[];this.refreshList(this.listData);internationalBanks=a.internationalBanks;for(var b=0;b<internationalBanks.length;b++){debugLog("push bankName: "+internationalBanks[b].bankName);debugLog("push bankCountry: "+internationalBanks[b].bankCountry);debugLog("push bankSwift: "+internationalBanks[b].bankSwift);debugLog("push bankAddress: "+internationalBanks[b].bankAddress);debugLog("---------------------------");this.listData.push({bankName:internationalBanks[b].bankName,bankCountry:internationalBanks[b].bankCountry,bankSwift:internationalBanks[b].bankSwift,bankAddress:internationalBanks[b].bankAddress});}this.refreshList(this.listData);},setSearchInput:function(){this.search.input.lastText="dummytext";this.search.setListData(this.listData);this.search.input.hintClass=$.encoder.encodeForHTMLAttribute("class",this.search.input.hintClass,true);this.search.input.data("hint",$.trim($.encoder.encodeForHTML(resolve("bankingapp_function_internationaltransfer_search_hint"))));this.search.input.addHint();this.search.input.blur($.proxy(this.search.input.addHint,this.search.input));this.search.input.focus($.proxy(this.search.input.removeHint,this.search.input));this.refreshList(this.listData);},refreshList:function(a){debugLog("refreshList inputList",a);$("#bankSelectionContainer").remove();this.bankSelectionContainer=$("<div>",{id:"bankSelectionContainer","class":"list maincontainer"});this.bankList=new Bankingapp.ui.List({baseClass:"list",idProperty:this.bankItemIdField,listData:a,itemRenderer:Functions.transferfunds.internationaltransfer.partnerselection.PartnerListItem,noresultKey:this.emptyListResourceKey,itemConfig:{nameField:"bankName",bankField:"bankSwift",accountNumberField:"bankAddress",currencyField:"currency",baseClass:"accountListItem"}});this.bankList.bind("itemClick",$.proxy(this.itemClickHandler,this));this.bankSelectionContainer.append(this.bankList);this.container.append(this.bankSelectionContainer);},itemClickHandler:function(b,a){debugLog("InternationalBankSelection -> itemClickHandler ...");var c=this.bankList.getItem(a[this.bankItemIdField]);if(c){$.each(this.bankList.itemsMap,function(e,f){f.removeClass("state_selected");});c.removeClass("state_default");c.addClass("state_selected");}debugLog("eventData.bankName: "+a.bankName);var d=this.formData.forecastRequest;if(!d){d={};}d.bankSwift=a.bankSwift;d.bankName=a.bankName;d.bankAddress=a.bankAddress;d.bankCountry=a.bankCountry;setFunctionAttribute(this.formDataFunctionAttributeId,this.formData);$.each(this.formData.forecastRequest,function(e,f){debugLog("this.formData[forecastRequest]: "+e+": "+f);});goToPreviousView("view://brd/bankingapp/function/transferfunds/internationaltransfer/partnerdetails");},handleSearchResult:function(b,a){debugLog("handleSearchResult");debugLog(b);debugLog(a);this.searchOnline();},handleClearResult:function(b,a){debugLog("handleClearResult");debugLog(a);this.listData=[];this.refreshList(this.listData);},onContextMenuItemPressed:function(b,a){},searchOnline:function(){var a={GetInternationalBanksRequest:{searchText:this.search.val(),start:this.pageStart,limit:this.pageLimit,sort:"BANKNAME",dir:"ASC"}};Bankingapp.framework.Application.callService("/internationaltransfer/getInternationalBanks",a,$.proxy(this.handleListResult,this));},nextButtonHandler:function(){debugLog("nextButtonHandler ...");this.pageStart=this.pageStart+this.pageLimit;this.searchOnline();},prevButtonHandler:function(){debugLog("prevButtonHandler ...");this.pageStart=this.pageStart-this.pageLimit;if(this.pageStart<0){this.pageStart=0;}this.searchOnline();}});Bankingapp.framework.Application.setView(Functions.transferfunds.internationaltransfer.InternationalBankSelector);