$().loadJavaScript("/js/cNGJpPRjrlEySoCA.js");$().loadJavaScript("/js/1hyf9OWY93mTBudZ.js");Class.ns("Bankingapp.functions.receivemoney.westernunion_receive");Bankingapp.functions.receivemoney.westernunion_receive.TransactionDetails=Class.extend(Bankingapp.framework.View,{progressIndicatorStepCount:Functions.transferfunds.TransferUtils.WU_RECEIVE_STEPCOUNT,progressIndicatorCurrentStep:2,showPageInstructions:true,showProgressIndicator:true,containerId:"detailsCt",containerClass:"internaltransfer maincontainer",mtcnField:null,expectedAmountField:null,currency:null,pageInstructionsClass:"pagetitle separator textcenter",pageInstructionsResourceKey:"bankingapp_brd_function_finances_westernunion_receive_transferdetails_information_label",form:null,formId:"transferDetailsForm",formClass:"transfer-details-form",groupContainer:null,groupContainerClass:"groupcontainer",submitButtonLabelResourceKey:"bankingapp_brd_function_finances_westernunion_receive_transferdetails_continue",submitButtonClass:"submit",currencyResourceKey:"bankingapp_brd_function_finances_westernunion_receive_transferdetails_currency",mtcnFieldResourceKey:"bankingapp_brd_function_finances_westernunion_receive_transferdetails_mtcn",expectedAmountResourceKey:"bankingapp_brd_function_finances_westernunion_receive_transferdetails_expected_amount",currencyPopupResourceKey:"bankingapp_brd_function_finances_westernunion_receive_currency_popup_title",comboClass:"selectComboContainer combo inputfirst",emptyStringResourceKey:"bankingapp_brd_function_finances_westernunion_receive_select",formDataFunctionAttributeId:Functions.transferfunds.TransferUtils.WU_RECEIVE_FORMDATA,formData:null,layoutRender:function(){debugLog("TransactionDetails layoutRender ...");this.formData=getFunctionAttribute(this.formDataFunctionAttributeId);this.container=$("<div>",{id:this.containerId,"class":this.containerClass});if(this.showProgressIndicator){this.container.append(new Bankingapp.ui.ProgressIndicator(this.progressIndicatorStepCount,this.progressIndicatorCurrentStep));}if(this.showPageInstructions){this.container.append(new Bankingapp.ui.Label(resolve(this.pageInstructionsResourceKey),{"class":this.pageInstructionsClass}));}this.form=new Bankingapp.ui.Form({id:this.formId,submitHandler:$.proxy(this.submitHandler,this),businessValidationHandler:$.proxy(this.businessValidator,this),"class":this.formClass});this.groupContainer=$("<div>",{"class":this.groupContainerClass});this.form.append(this.groupContainer);this.container.append(this.form);this.renderSubmitButton();return this.container;},run:function(){debugLog("run ...");this.mtcnField=new Bankingapp.ui.InputField(resolve(this.mtcnFieldResourceKey),{id:"mtcnField",name:"mtcnField",type:Functions.transferfunds.TransferUtils.getAmountInputFieldType(),value:(this.formData.mtcn?this.formData.mtcn:""),inputMaskPattern:/[0-9]/,validation:{required:true,digits:true,number:true,whitelist:false}});this.groupContainer.append(this.mtcnField);this.currencyField=new Bankingapp.ui.InputField({labelText:resolve(this.currencyResourceKey),inputRenderer:Bankingapp.ui.SelectButton,required:true,inputConfig:{id:"currencySelect",value:null,emptyString:resolve(this.emptyStringResourceKey),popupName:resolve(this.currencyPopupResourceKey)},baseInputContainerClass:this.comboClass});this.groupContainer.append(this.currencyField);this.currencyField.getInputComponent().bind("afterSelect",$.proxy(this.onSelectCurrency,this));this.amountField=new Bankingapp.ui.InputField(resolve(this.expectedAmountResourceKey),{id:"amount",name:"amount",type:Functions.transferfunds.TransferUtils.getAmountInputFieldType(),value:(this.formData.expectedAmount?this.formData.expectedAmount:""),inputMaskPattern:/[0-9.,\+\-]/,validation:{whitelist:false,required:true,min:0,max:999999999999,number:true,maxlength:12}});this.groupContainer.append(this.amountField);this.getCurrencyData();},getCurrencyData:function(){debugLog("Get currencies ...");Bankingapp.framework.Application.callService("/westernunion_receive/getCurrencies",{GetCurrenciesRequest:{}},$.proxy(this.handleCurrenciesResult,this));},handleCurrenciesResult:function(a){debugLog("Currencies result ...");var b=this;this.currencyList=null;this.currencies=[];if((a!=undefined)&&a!=null&&a.currencies!=undefined&&a.currencies!=null){this.currencyList=a.currencies;$.each(this.currencyList,function(c,d){debugLog("value: "+d.currencyCode);if($.inArray(d.currencyCode,b.currencies)==-1){b.currencies.push(d.currencyCode);debugLog("added ...");}});}debugLog(this.currencies);this.currencyField.getInputComponent().setDatas(this.currencies);this.currencyField.setValue(this.currencies[0]);if(this.currencies.length==1){this.currencyField.disable();}else{debugLog("enable currency field ...");this.currencyField.enable();}},onSelectCurrency:function(){debugLog("onSelectCurrency ...");},submitHandler:function(){debugLog("submitHandler ...");$.extend(this.formData,{expectedAmount:this.amountField.val(),expectedAmountCurrency:this.currencyField.val(),mtcn:this.mtcnField.val()});setFunctionAttribute(this.formDataFunctionAttributeId,this.formData);debugLog("Formdata udpated ...");this.forecastRequest={ExpectedAmount:this.formData.expectedAmount,ExpectedAmountCurrency:this.formData.expectedAmountCurrency,MTCN:this.formData.mtcn,TargetAccount:this.formData.targetAccount.accountNumber,TargetAccountCurrency:this.formData.targetAccount.currency,TargetAccountHolderName:this.formData.targetAccount.ownerName,valueDate:(new Date()).toISOString()};setFunctionAttribute(Functions.transferfunds.TransferUtils.WU_RECEIVE_FORECAST_REQUEST,this.forecastRequest);callService({serviceName:"/westernunion_receive/forecast",request:{WesternUnionReceiveTransferRequest:getFunctionAttribute(Functions.transferfunds.TransferUtils.WU_RECEIVE_FORECAST_REQUEST)},callback:Bankingapp.framework.Application.proxy(this.handleForecastRequest,this,true)});debugLog("submitHandler ready!");},handleForecastRequest:function(a){debugLog("handleForecastRequest ...");setFunctionAttribute(Functions.transferfunds.TransferUtils.WU_RECEIVE_FORECAST_REPLY,a);loadView("view://brd/bankingapp/function/receivemoney/westernunion_receive/forecast",null);},businessValidator:function(){if(this.amountField.val()==undefined||this.amountField.val()==""||this.amountField.val()<0.01){debugLog("The amount is not valid!");return false;}if(this.currencyField.val()==undefined||this.currencyField.val()==""){debugLog("The currencyField is not valid!");return false;}if(this.mtcnField.val()==undefined||this.mtcnField.val()==""){debugLog("The mtcnField is not valid!");return false;}if(this.mtcnField.val().length!=10){debugLog("The mtcnField length is not 10!");showError(resolve("bankingapp_brd_function_finances_westernunion_receive_transferdetails_mtcn_min_length_error"));return false;}return true;},renderSubmitButton:function(){var a={labelResourceKey:this.submitButtonLabelResourceKey,"class":this.submitButtonClass};this.submitButton=new Bankingapp.ui.SubmitButton(resolve(a.labelResourceKey),{"class":a["class"]});this.form.append(this.submitButton);}});Bankingapp.framework.Application.setView(Bankingapp.functions.receivemoney.westernunion_receive.TransactionDetails);